define(["moment"],(function(e){return function(){var t={667:function(){var e=localStorage.setItem,t=localStorage.getItem,r=localStorage.removeItem,i={};Storage.prototype.setItem=function(t,r){try{e.apply(this,[t,r])}catch(e){i[t]=String(r)}return!0},Storage.prototype.getItem=function(e){try{return t.apply(this,[e])}catch(t){return i.hasOwnProperty(e)?i[e]:void 0}return null},Storage.prototype.removeItem=function(e){try{r.apply(this,[e])}catch(t){delete i[e]}return!0}},350:function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}String.prototype.pluralize=function(e,t){return"is"==this&&1!=e?"are":"this"==this?1==e?this:"these":this.endsWith("s")?(t=t||"es",1==e?this:this+t):this.endsWith("y")?(t=t||"ies",1==e?this:this.substr(0,this.length-1)+t):(t=t||"s",1==e?this:this+t)},String.prototype.capitalize=function(e){return(e?this.toLowerCase():this).replace(/(?:^|\s)\S/g,(function(e){return e.toUpperCase()}))},String.prototype.truncate||(String.prototype.truncate=function(e){e=null!=e?e:25;var t=this.match(RegExp("^.{0,"+e+"}[S]*")),r=t[0].length;return t=t[0].replace(/\s$/,""),r<this.length&&(t+="&hellip;"),t}),String.prototype.isValidUrl||(String.prototype.isValidUrl=function(){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(this)}),String.prototype.hashCode||(String.prototype.hashCode=function(){var e,t,r=0;if(0==this.length)return r;for(e=0,t=this.length;e<t;e++)r=(r<<5)-r+this.charCodeAt(e),r|=0;return r});var t={latin_map:{"Á":"A","Ă":"A","Ắ":"A","Ặ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ǎ":"A","Â":"A","Ấ":"A","Ậ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ä":"A","Ǟ":"A","Ȧ":"A","Ǡ":"A","Ạ":"A","Ȁ":"A","À":"A","Ả":"A","Ȃ":"A","Ā":"A","Ą":"A","Å":"A","Ǻ":"A","Ḁ":"A","Ⱥ":"A","Ã":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ḃ":"B","Ḅ":"B","Ɓ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ć":"C","Č":"C","Ç":"C","Ḉ":"C","Ĉ":"C","Ċ":"C","Ƈ":"C","Ȼ":"C","Ď":"D","Ḑ":"D","Ḓ":"D","Ḋ":"D","Ḍ":"D","Ɗ":"D","Ḏ":"D","ǲ":"D","ǅ":"D","Đ":"D","Ƌ":"D","Ǳ":"DZ","Ǆ":"DZ","É":"E","Ĕ":"E","Ě":"E","Ȩ":"E","Ḝ":"E","Ê":"E","Ế":"E","Ệ":"E","Ề":"E","Ể":"E","Ễ":"E","Ḙ":"E","Ë":"E","Ė":"E","Ẹ":"E","Ȅ":"E","È":"E","Ẻ":"E","Ȇ":"E","Ē":"E","Ḗ":"E","Ḕ":"E","Ę":"E","Ɇ":"E","Ẽ":"E","Ḛ":"E","Ꝫ":"ET","Ḟ":"F","Ƒ":"F","Ǵ":"G","Ğ":"G","Ǧ":"G","Ģ":"G","Ĝ":"G","Ġ":"G","Ɠ":"G","Ḡ":"G","Ǥ":"G","Ḫ":"H","Ȟ":"H","Ḩ":"H","Ĥ":"H","Ⱨ":"H","Ḧ":"H","Ḣ":"H","Ḥ":"H","Ħ":"H","Í":"I","Ĭ":"I","Ǐ":"I","Î":"I","Ï":"I","Ḯ":"I","İ":"I","Ị":"I","Ȉ":"I","Ì":"I","Ỉ":"I","Ȋ":"I","Ī":"I","Į":"I","Ɨ":"I","Ĩ":"I","Ḭ":"I","Ꝺ":"D","Ꝼ":"F","Ᵹ":"G","Ꞃ":"R","Ꞅ":"S","Ꞇ":"T","Ꝭ":"IS","Ĵ":"J","Ɉ":"J","Ḱ":"K","Ǩ":"K","Ķ":"K","Ⱪ":"K","Ꝃ":"K","Ḳ":"K","Ƙ":"K","Ḵ":"K","Ꝁ":"K","Ꝅ":"K","Ĺ":"L","Ƚ":"L","Ľ":"L","Ļ":"L","Ḽ":"L","Ḷ":"L","Ḹ":"L","Ⱡ":"L","Ꝉ":"L","Ḻ":"L","Ŀ":"L","Ɫ":"L","ǈ":"L","Ł":"L","Ǉ":"LJ","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ń":"N","Ň":"N","Ņ":"N","Ṋ":"N","Ṅ":"N","Ṇ":"N","Ǹ":"N","Ɲ":"N","Ṉ":"N","Ƞ":"N","ǋ":"N","Ñ":"N","Ǌ":"NJ","Ó":"O","Ŏ":"O","Ǒ":"O","Ô":"O","Ố":"O","Ộ":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ö":"O","Ȫ":"O","Ȯ":"O","Ȱ":"O","Ọ":"O","Ő":"O","Ȍ":"O","Ò":"O","Ỏ":"O","Ơ":"O","Ớ":"O","Ợ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ȏ":"O","Ꝋ":"O","Ꝍ":"O","Ō":"O","Ṓ":"O","Ṑ":"O","Ɵ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Õ":"O","Ṍ":"O","Ṏ":"O","Ȭ":"O","Ƣ":"OI","Ꝏ":"OO","Ɛ":"E","Ɔ":"O","Ȣ":"OU","Ṕ":"P","Ṗ":"P","Ꝓ":"P","Ƥ":"P","Ꝕ":"P","Ᵽ":"P","Ꝑ":"P","Ꝙ":"Q","Ꝗ":"Q","Ŕ":"R","Ř":"R","Ŗ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ȑ":"R","Ȓ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꜿ":"C","Ǝ":"E","Ś":"S","Ṥ":"S","Š":"S","Ṧ":"S","Ş":"S","Ŝ":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṩ":"S","Ť":"T","Ţ":"T","Ṱ":"T","Ț":"T","Ⱦ":"T","Ṫ":"T","Ṭ":"T","Ƭ":"T","Ṯ":"T","Ʈ":"T","Ŧ":"T","Ɐ":"A","Ꞁ":"L","Ɯ":"M","Ʌ":"V","Ꜩ":"TZ","Ú":"U","Ŭ":"U","Ǔ":"U","Û":"U","Ṷ":"U","Ü":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ǖ":"U","Ṳ":"U","Ụ":"U","Ű":"U","Ȕ":"U","Ù":"U","Ủ":"U","Ư":"U","Ứ":"U","Ự":"U","Ừ":"U","Ử":"U","Ữ":"U","Ȗ":"U","Ū":"U","Ṻ":"U","Ų":"U","Ů":"U","Ũ":"U","Ṹ":"U","Ṵ":"U","Ꝟ":"V","Ṿ":"V","Ʋ":"V","Ṽ":"V","Ꝡ":"VY","Ẃ":"W","Ŵ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẁ":"W","Ⱳ":"W","Ẍ":"X","Ẋ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ẏ":"Y","Ỵ":"Y","Ỳ":"Y","Ƴ":"Y","Ỷ":"Y","Ỿ":"Y","Ȳ":"Y","Ɏ":"Y","Ỹ":"Y","Ź":"Z","Ž":"Z","Ẑ":"Z","Ⱬ":"Z","Ż":"Z","Ẓ":"Z","Ȥ":"Z","Ẕ":"Z","Ƶ":"Z","Ĳ":"IJ","Œ":"OE","ᴀ":"A","ᴁ":"AE","ʙ":"B","ᴃ":"B","ᴄ":"C","ᴅ":"D","ᴇ":"E","ꜰ":"F","ɢ":"G","ʛ":"G","ʜ":"H","ɪ":"I","ʁ":"R","ᴊ":"J","ᴋ":"K","ʟ":"L","ᴌ":"L","ᴍ":"M","ɴ":"N","ᴏ":"O","ɶ":"OE","ᴐ":"O","ᴕ":"OU","ᴘ":"P","ʀ":"R","ᴎ":"N","ᴙ":"R","ꜱ":"S","ᴛ":"T","ⱻ":"E","ᴚ":"R","ᴜ":"U","ᴠ":"V","ᴡ":"W","ʏ":"Y","ᴢ":"Z","á":"a","ă":"a","ắ":"a","ặ":"a","ằ":"a","ẳ":"a","ẵ":"a","ǎ":"a","â":"a","ấ":"a","ậ":"a","ầ":"a","ẩ":"a","ẫ":"a","ä":"a","ǟ":"a","ȧ":"a","ǡ":"a","ạ":"a","ȁ":"a","à":"a","ả":"a","ȃ":"a","ā":"a","ą":"a","ᶏ":"a","ẚ":"a","å":"a","ǻ":"a","ḁ":"a","ⱥ":"a","ã":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ḃ":"b","ḅ":"b","ɓ":"b","ḇ":"b","ᵬ":"b","ᶀ":"b","ƀ":"b","ƃ":"b","ɵ":"o","ć":"c","č":"c","ç":"c","ḉ":"c","ĉ":"c","ɕ":"c","ċ":"c","ƈ":"c","ȼ":"c","ď":"d","ḑ":"d","ḓ":"d","ȡ":"d","ḋ":"d","ḍ":"d","ɗ":"d","ᶑ":"d","ḏ":"d","ᵭ":"d","ᶁ":"d","đ":"d","ɖ":"d","ƌ":"d","ı":"i","ȷ":"j","ɟ":"j","ʄ":"j","ǳ":"dz","ǆ":"dz","é":"e","ĕ":"e","ě":"e","ȩ":"e","ḝ":"e","ê":"e","ế":"e","ệ":"e","ề":"e","ể":"e","ễ":"e","ḙ":"e","ë":"e","ė":"e","ẹ":"e","ȅ":"e","è":"e","ẻ":"e","ȇ":"e","ē":"e","ḗ":"e","ḕ":"e","ⱸ":"e","ę":"e","ᶒ":"e","ɇ":"e","ẽ":"e","ḛ":"e","ꝫ":"et","ḟ":"f","ƒ":"f","ᵮ":"f","ᶂ":"f","ǵ":"g","ğ":"g","ǧ":"g","ģ":"g","ĝ":"g","ġ":"g","ɠ":"g","ḡ":"g","ᶃ":"g","ǥ":"g","ḫ":"h","ȟ":"h","ḩ":"h","ĥ":"h","ⱨ":"h","ḧ":"h","ḣ":"h","ḥ":"h","ɦ":"h","ẖ":"h","ħ":"h","ƕ":"hv","í":"i","ĭ":"i","ǐ":"i","î":"i","ï":"i","ḯ":"i","ị":"i","ȉ":"i","ì":"i","ỉ":"i","ȋ":"i","ī":"i","į":"i","ᶖ":"i","ɨ":"i","ĩ":"i","ḭ":"i","ꝺ":"d","ꝼ":"f","ᵹ":"g","ꞃ":"r","ꞅ":"s","ꞇ":"t","ꝭ":"is","ǰ":"j","ĵ":"j","ʝ":"j","ɉ":"j","ḱ":"k","ǩ":"k","ķ":"k","ⱪ":"k","ꝃ":"k","ḳ":"k","ƙ":"k","ḵ":"k","ᶄ":"k","ꝁ":"k","ꝅ":"k","ĺ":"l","ƚ":"l","ɬ":"l","ľ":"l","ļ":"l","ḽ":"l","ȴ":"l","ḷ":"l","ḹ":"l","ⱡ":"l","ꝉ":"l","ḻ":"l","ŀ":"l","ɫ":"l","ᶅ":"l","ɭ":"l","ł":"l","ǉ":"lj","ſ":"s","ẜ":"s","ẛ":"s","ẝ":"s","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ᵯ":"m","ᶆ":"m","ń":"n","ň":"n","ņ":"n","ṋ":"n","ȵ":"n","ṅ":"n","ṇ":"n","ǹ":"n","ɲ":"n","ṉ":"n","ƞ":"n","ᵰ":"n","ᶇ":"n","ɳ":"n","ñ":"n","ǌ":"nj","ó":"o","ŏ":"o","ǒ":"o","ô":"o","ố":"o","ộ":"o","ồ":"o","ổ":"o","ỗ":"o","ö":"o","ȫ":"o","ȯ":"o","ȱ":"o","ọ":"o","ő":"o","ȍ":"o","ò":"o","ỏ":"o","ơ":"o","ớ":"o","ợ":"o","ờ":"o","ở":"o","ỡ":"o","ȏ":"o","ꝋ":"o","ꝍ":"o","ⱺ":"o","ō":"o","ṓ":"o","ṑ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","õ":"o","ṍ":"o","ṏ":"o","ȭ":"o","ƣ":"oi","ꝏ":"oo","ɛ":"e","ᶓ":"e","ɔ":"o","ᶗ":"o","ȣ":"ou","ṕ":"p","ṗ":"p","ꝓ":"p","ƥ":"p","ᵱ":"p","ᶈ":"p","ꝕ":"p","ᵽ":"p","ꝑ":"p","ꝙ":"q","ʠ":"q","ɋ":"q","ꝗ":"q","ŕ":"r","ř":"r","ŗ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ȑ":"r","ɾ":"r","ᵳ":"r","ȓ":"r","ṟ":"r","ɼ":"r","ᵲ":"r","ᶉ":"r","ɍ":"r","ɽ":"r","ↄ":"c","ꜿ":"c","ɘ":"e","ɿ":"r","ś":"s","ṥ":"s","š":"s","ṧ":"s","ş":"s","ŝ":"s","ș":"s","ṡ":"s","ṣ":"s","ṩ":"s","ʂ":"s","ᵴ":"s","ᶊ":"s","ȿ":"s","ɡ":"g","ᴑ":"o","ᴓ":"o","ᴝ":"u","ť":"t","ţ":"t","ṱ":"t","ț":"t","ȶ":"t","ẗ":"t","ⱦ":"t","ṫ":"t","ṭ":"t","ƭ":"t","ṯ":"t","ᵵ":"t","ƫ":"t","ʈ":"t","ŧ":"t","ᵺ":"th","ɐ":"a","ᴂ":"ae","ǝ":"e","ᵷ":"g","ɥ":"h","ʮ":"h","ʯ":"h","ᴉ":"i","ʞ":"k","ꞁ":"l","ɯ":"m","ɰ":"m","ᴔ":"oe","ɹ":"r","ɻ":"r","ɺ":"r","ⱹ":"r","ʇ":"t","ʌ":"v","ʍ":"w","ʎ":"y","ꜩ":"tz","ú":"u","ŭ":"u","ǔ":"u","û":"u","ṷ":"u","ü":"u","ǘ":"u","ǚ":"u","ǜ":"u","ǖ":"u","ṳ":"u","ụ":"u","ű":"u","ȕ":"u","ù":"u","ủ":"u","ư":"u","ứ":"u","ự":"u","ừ":"u","ử":"u","ữ":"u","ȗ":"u","ū":"u","ṻ":"u","ų":"u","ᶙ":"u","ů":"u","ũ":"u","ṹ":"u","ṵ":"u","ᵫ":"ue","ꝸ":"um","ⱴ":"v","ꝟ":"v","ṿ":"v","ʋ":"v","ᶌ":"v","ⱱ":"v","ṽ":"v","ꝡ":"vy","ẃ":"w","ŵ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẁ":"w","ⱳ":"w","ẘ":"w","ẍ":"x","ẋ":"x","ᶍ":"x","ý":"y","ŷ":"y","ÿ":"y","ẏ":"y","ỵ":"y","ỳ":"y","ƴ":"y","ỷ":"y","ỿ":"y","ȳ":"y","ẙ":"y","ɏ":"y","ỹ":"y","ź":"z","ž":"z","ẑ":"z","ʑ":"z","ⱬ":"z","ż":"z","ẓ":"z","ȥ":"z","ẕ":"z","ᵶ":"z","ᶎ":"z","ʐ":"z","ƶ":"z","ɀ":"z","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ĳ":"ij","œ":"oe","ﬆ":"st","ₐ":"a","ₑ":"e","ᵢ":"i","ⱼ":"j","ₒ":"o","ᵣ":"r","ᵤ":"u","ᵥ":"v","ₓ":"x"}};String.prototype.latinise=function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,(function(e){return t.latin_map[e]||e}))},String.prototype.latinize=String.prototype.latinise,String.prototype.isLatin=function(){return this==this.latinise()},String.prototype.OnlyAlphaNumSpaceAndUnderscore=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[\W]/g,"")},String.prototype.OnlyAlphaNumSpaceUnderscoreAndDot=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[^a-z0-9_\.]/g,"")},String.prototype.NoWhiteSpaceInWord||(String.prototype.NoWhiteSpaceInWord=function(){return this.replace(/[\s]+/g,"")}),String.prototype.addLeadingZero||(String.prototype.addLeadingZero=function(e){var t=this.toString();return t.length<e?("0"+t).addLeadingZero(e):t}),String.prototype.lpad=function(e,t){for(var r=this;r.length<t;)r=e+r;return r},Number.prototype.between||(Number.prototype.between=function(e,t){var r=Math.min(e,t),i=Math.max(e,t);return this>=r&&this<=i}),Array.prototype.joinOther||(Array.prototype.joinOther=function(e,t,r){if(this.length<2)return this.join(t);t=t||", ",r=r||"other",(!e||e<0)&&(e=1);for(var i=this.slice(0),s=i.join(t);i.length>1&&s.length>e;)i.pop(),s=i.join(t);var n=this.length-i.length;return n>0&&(s+=" +"+n+" "+r),s}),Array.prototype.joinAdvanced||(Array.prototype.joinAdvanced=function(e,t){var r=this.slice(0),i="";return 1===r.length?i=r[0]:2===r.length?i=r.join(t):r.length>2&&(i=r.slice(0,-1).join(e)+t+r.slice(-1)),i}),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.roundRect=function(t,r,i,s,n,o,a){var c={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};if(void 0===a&&(a=!0),"object"===e(n))for(var u in n)c[u]=n[u];this.beginPath(),this.moveTo(t+c.upperLeft,r),this.lineTo(t+i-c.upperRight,r),this.quadraticCurveTo(t+i,r,t+i,r+c.upperRight),this.lineTo(t+i,r+s-c.lowerRight),this.quadraticCurveTo(t+i,r+s,t+i-c.lowerRight,r+s),this.lineTo(t+c.lowerLeft,r+s),this.quadraticCurveTo(t,r+s,t,r+s-c.lowerLeft),this.lineTo(t,r+c.upperLeft),this.quadraticCurveTo(t,r,t+c.upperLeft,r),this.closePath(),a&&this.stroke(),o&&this.fill()})},283:function(t){"use strict";t.exports=e}},r={};function i(e){var s=r[e];if(void 0!==s)return s.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,i),n.exports}i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return function(){"use strict";i.r(s),i.d(s,{default:function(){return Dt}});var e=i(283),t=i.n(e),r={sortFields:function(e,t,r,i){var s=[],n=null,o=null;t=t.slice(),null!=r&&(t=t.filter((function(e){return e.form==r})));for(var a=0;a<t.length&&(o=e[(n=t[a]).name],s.push(Object.assign({value:o},n)),!(null!=i&&s.length>=i));a++);return s},stringifyOrdered:function(e){if(keys=[],e)for(var t in e)keys.push(t);keys.sort();var r={};for(var i in keys)r[t=keys[i]]=e[t];return JSON.stringify(r)},areEqual:function(e,t){return r.stringifyOrdered(e||{})==r.stringifyOrdered(t||{})},badgeify:function(e){return e>100?"99+":e>10?"10+":e>0?""+e:""},getLoginName:function(e,t){var r=/[\s-]*/gim,i=[];return e&&i.push(e.latinise().toLowerCase().replace(r,"")),t&&i.push(t.latinise().toLowerCase().replace(r,"")),i.join(".")},getUrlParam:function(e,t,r){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(r||window.location.href);return i?decodeURIComponent(i[1].replace(/\+/g," ")):t},getParsedLines:function(e){return e&&e.length>0?e.split(/\s*([,;\r\n]+|\s\s)\s*/).filter((function(e,t,r){return e.length>0&&e.indexOf(",")<0&&e.indexOf(";")<0&&e.trim().length>0&&r.indexOf(e)>=t})).map((function(e){return e.trim()})):[]},getFriendlyKind:function(e){var t=e;return"string"==e&&(t="single line text"),"text"==e&&(t="multi line text"),"select"==e&&(t="dropdown list"),"number"==e&&(t="numeric"),t},arrayToCSV:function(e,t){var r,i;r=new Blob([e],{type:"text/csv;charset=utf-8;"}),window.navigator&&window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(r,t):((i=window.document.createElement("a")).download=t,i.href=window.URL.createObjectURL(r),i.style.display="none",window.document.body.appendChild(i),i.click())},kFormatter:function(e){return Math.abs(e)>999?Math.sign(e)*(Math.abs(e)/1e3).toFixed(0)+"k":Math.sign(e)*Math.abs(e)},sanitizeHtml:function(e){return $("<div />").text(e).html().replace(/&nbsp;/g," ").replace(/&amp;/g,"&")},removeHtmlTags:function(e){return e.replace(/(<([^>]+)>)/gi,"")}},n=function(e){var t;for(t in e)return!1;return!0},o=r,a=function(){var e=Promise.resolve();return function(t,r){if("function"!=typeof t)throw"must be a function";return e=e.then(t,r||t)}};function c(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"myRequest",value:function(e,t){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=new Headers,n=new AbortController,o=n.signal;s.get("content-type")||"GET"===t||s.set("content-type","application/json; charset=UTF-8"),i.timeOut=void 0!==i.timeOut&&i.timeOut,i.parms=void 0!==i.parms&&i.parms;var a={method:t,signal:o,headers:s};return i.parms&&(a.body=JSON.stringify(i.parms)),i.timeOut&&setTimeout((function(){return r.controller.abort()}),i.timeOut),new Promise((function(t,r){fetch(e,a).then((function(e){if(e.ok){var t=e.headers.get("content-type");if(t.includes("application/json"))return e.json();if(t.includes("text/html"))return e.text();throw new Error("Sorry, content-type ".concat(t," is not supported"))}throw new d.ApiError(e.statusText,e.status)})).then((function(e){return t(d._handleAjaxSuccess(e))})).catch((function(e){return r(d._handleAjaxError(e))}))}))}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.myRequest(e,"GET",t)}},{key:"post",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.myRequest(e,"POST",t)}},{key:"put",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.myRequest(e,"PUT",t)}},{key:"patch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.myRequest(e,"PATCH",t)}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.myRequest(e,"DELETE",t)}}],null&&c(t.prototype,null),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),l=2048,d={ApiError:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,r=arguments.length>2?arguments[2]:void 0;this.code=t,this.message=e||"Something went wrong on the server",this.opt=r}};d.ApiError.prototype=new Error,d.NetworkNotConnected=function(e,t){this.code=999,this.message=e||"",this.opt=t},d.NetworkNotConnected.prototype=new Error,d.NetworkTimeout=function(e,t){this.code=408,this.message=e||"Could not reach the server in time",this.opt=t},d.NetworkTimeout.prototype=new Error,d.ApiNotFound=function(e,t){this.code=404,this.message=e||"Could not find what you're looking for",this.opt=t},d.ApiNotFound.prototype=new Error,d.ApiBadRequest=function(e,t){this.code=400,this.message=e||"The server did not understand your request",this.opt=t},d.ApiBadRequest.prototype=new Error,d.ApiUnauthorized=function(e,t){this.code=401,this.message=e||"Your session has expired",this.opt=t},d.ApiUnauthorized.prototype=new Error,d.ApiForbidden=function(e,t){this.code=403,this.message=e||"You don't have sufficient rights",this.opt=t},d.ApiForbidden.prototype=new Error,d.ApiUnprocessableEntity=function(e,t){this.code=422,this.message=e||"Some data is invalid",this.opt=t},d.ApiUnprocessableEntity.prototype=new Error,d.ApiSubscriptionLimit=function(e,t){this.code=422,this.message=e||"You have reached your subscription limit",this.opt=t},d.ApiSubscriptionLimit.prototype=new Error,d.ApiPaymentRequired=function(e,t){this.code=402,this.message=e||"Your subscription has expired",this.opt=t},d.ApiPaymentRequired.prototype=new Error,d.ApiServerCapicity=function(e,t){this.code=503,this.message=e||"Back-end server is at capacity",this.opt=t},d.ApiServerCapicity.prototype=new Error,d.ApiAjax=function(e){e=e||{},this.timeOut=e.timeOut||1e4,this.responseInTz=!0,this.beforeSend=e.beforeSend||function(){}},d.ApiAjax.prototype.get=function(e,t){return this._getAjax(e,t)},d.ApiAjax.prototype.post=function(e,t,r){return this._postAjax(e,t,r)},d.ApiAjax.prototype._handleAjaxSuccess=function(e,t,r){return this.responseInTz&&(t=this._fixDates(t)),e.resolve(t)},d.ApiAjax.prototype._handleAjaxError=function(e){var t=e.name,r=e.message;if("AbortError"!=t){var i="";if("timeout"===r)return new d.NetworkTimeout(i,opt);switch(r&&(r.indexOf("Notify user:")>-1&&(i=r),422==code&&(i=r,opt={detail:r,status:code})),code){case 400:return new d.ApiBadRequest(i,opt);case 401:return new d.ApiUnauthorized(i,opt);case 402:return new d.ApiPaymentRequired(i,opt);case 403:return new d.ApiForbidden(i,opt);case 404:return new d.ApiNotFound(i,opt);case 408:return new d.NetworkTimeout(i,opt);case 422:return r.indexOf("limit")>=0&&r.indexOf("reach")>=0?new d.ApiSubscriptionLimit(i,opt):new d.ApiUnprocessableEntity(i,opt);case 503:return new d.ApiServerCapicity(i,opt);default:return new d.ApiError(i,opt)}}},d.ApiAjax.prototype._postAjax=function(e,t,r,i){return u.post(e,{parms:this._prepareDict(t),timeOut:r||this.timeOut})},d.ApiAjax.prototype._getAjax=function(e,t,r){return u.get(e,{timeOut:t||this.timeOut})},d.ApiAjax.prototype._prepareDict=function(e){return e?(e.forEach((function(r,i){t().isMoment(r)&&(e[i]=r.toJSONDate())})),e):{}},d.ApiAjax.prototype._fixDates=function(e){if("string"==typeof e||e instanceof String){if(e.endsWith("+00:00")){var r=e.length;if(25==r)return t()(e.substring(0,r-6));if(32==r)return t()(e.substring(0,r-6).split(".")[0])}}else if(e instanceof Object||Array.isArray(e)){var i=this;e.forEach((function(t,r){e[r]=i._fixDates(t)}))}return e},d.ApiUser=function(e){e=e||{},this.userId=e.userId||"",this.userEmail=e.userEmail||"",this.userToken=e.userToken||"",this.userJwt=e.jwt||"",this.tokenType=e.tokenType||"",this.impersonated=e.impersonated||!1},d.ApiUser.prototype.fromStorage=function(){this.userId=window.localStorage.getItem("userId")||"",this.userEmail=window.localStorage.getItem("userEmail")||"",this.userToken=window.localStorage.getItem("userToken")||"",this.userJwt=window.localStorage.getItem("userJwt")||"",this.tokenType=window.localStorage.getItem("tokenType")||"",this.impersonated="true"===window.localStorage.getItem("impersonated")},d.ApiUser.prototype.toStorage=function(){window.localStorage.setItem("userId",this.userId),window.localStorage.setItem("userEmail",this.userEmail),window.localStorage.setItem("userToken",this.userToken),window.localStorage.setItem("userJwt",this.userJwt),window.localStorage.setItem("tokenType",this.tokenType),window.localStorage.setItem("impersonated",this.impersonated)},d.ApiUser.prototype.removeFromStorage=function(){window.localStorage.removeItem("userId"),window.localStorage.removeItem("userEmail"),window.localStorage.removeItem("userToken"),window.localStorage.removeItem("userJwt"),window.localStorage.removeItem("tokenType"),window.localStorage.removeItem("impersonated")},d.ApiUser.prototype.clearToken=function(){window.localStorage.setItem("userToken",null),window.localStorage.setItem("userJwt",null),window.localStorage.setItem("tokenType",null)},d.ApiUser.prototype.isValid=function(){return null!=this.userId&&this.userId.length>0&&null!=this.userToken&&this.userToken.length>0},d.ApiUser.prototype._reset=function(){this.userId="",this.userToken="",this.userJwt="",this.tokenType="",this.userEmail="",this.impersonated=!1},d.ApiAuth=function(e){e=e||{},this.urlAuth=e.urlAuth||"",this.ajax=e.ajax,this.version=e.version,this.platform=e.platform,this.device=e.device,this.sso=e.sso,this.allowAccountOwner=void 0===e.allowAccountOwner||e.allowAccountOwner},d.ApiAuth.prototype.authenticate=function(e,t){var r=this,i={user:e,password:t,_v:this.version};return this.platform&&(i.platform=this.platform),this.device&&(i.device=this.device),this.sso&&(i.sso=this.sso),u.post(this.urlAuth,{parms:i,timeOut:3e4}).then((function(e){return"OK"!=e.status||-1!=["expired","cancelled_expired","archived"].indexOf(e.subscription)&&!r.allowAccountOwner?Promise.reject(e):Promise.resolve(e.data,!0===e.is_impersonated)})).catch((function(e){return Promise.reject(e)}))},d.ApiAuthV2=d.ApiAuth,d.ApiAnonymous=function(e){e=e||{},this.ajax=e.ajax,this.urlApi=e.urlApi||"",this.version=e.version},d.ApiAnonymous.prototype.call=function(e,t,r,i){this.version&&((t=t||{})._v=this.version);var s=this.urlApi+"/"+e,n=s+"?"+Object.keys(t).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t[e]))})).join("&");return i||n.length>=l?this.ajax.post(s,t,r):this.ajax.get(n,r)},d.ApiAnonymous.prototype.longCall=function(e,t,r){return this.call(e,t,6e4,r)},d.ApiDataSource=function(e){e=e||{},this.collection=e.collection||"",this.urlApi=e.urlApi||"",this.user=e.user,this.ajax=e.ajax,this.version=e.version},d.ApiDataSource.prototype.exists=function(e,t){var r=this;this.collection;var i=this.getBaseUrl()+e,s=this.getParams(t);return n(s)||(i+="?"+this.getParams(s)),new Promise((function(e,t){r._ajaxGet("exists",i).done((function(t){e(t)})).fail((function(r){r instanceof d.ApiNotFound?e(null):t(r)}))}))},d.ApiDataSource.prototype.get=function(e,t){this.collection;var r=this.getBaseUrl()+e,i=this.getParamsDict(t);return n(i)||(r+="?"+this.getParams(i)),this._ajaxGet("get",r)},d.ApiDataSource.prototype.getIgnore404=function(e,t){var r=this;return this.collection,new Promise((function(i,s){r.get(e,t).done((function(e){i(e)})).fail((function(e){e instanceof d.ApiNotFound?i(null):s(e)}))}))},d.ApiDataSource.prototype.getMultiple=function(e,t){this.collection;var r=e.map((function(t,r){return r%100==0?e.slice(r,r+100):null})).filter((function(e){return e})),i=this,s=[],o=new a,c=[],u=new Promise((function(e){r.forEach((function(e){var r=i.getBaseUrl()+e.join(","),a=i.getParamsDict(t);n(a)||(r+="?"+i.getParams(a)),o((function(){var e=i._ajaxGet("getMultiple",r);return e.then((function(e){e=Array.isArray(e)?e:[e],s=s.concat(e)})),c.push(e),e}))})),o((function(){return e(s)}))}));return u.abort=function(){c.forEach((function(e){e.abort()}))},u},d.ApiDataSource.prototype.delete=function(e){this.collection;var t=this.getBaseUrl()+e+"/delete";return this._ajaxGet("delete",t)},d.ApiDataSource.prototype.deleteMultiple=function(e,t){this.collection;var r="deleteMultiple",i=this.getBaseUrl()+"delete",s={pk:e},n=i+"?"+this.getParams(s);return t||n.length>=l?this._ajaxPost(r,i,s):this._ajaxGet(r,n)},d.ApiDataSource.prototype.update=function(e,t,r,i,s){this.collection;var n="update",o=this.getBaseUrl()+e+"/update",a=Object.assign({},t);null!=r&&r.length>0&&(a._fields=Array.isArray(r)?r.join(","):r);var c=o+"?"+this.getParams(a);return s||c.length>=l?this._ajaxPost(n,o,a,i):this._ajaxGet(n,c,i)},d.ApiDataSource.prototype.create=function(e,t,r,i){this.collection;var s="create",n=this.getBaseUrl()+"create",o=Object.assign({},e);null!=t&&t.length>0&&(o._fields=Array.isArray(t)?t.join(","):t);var a=n+"?"+this.getParams(o);return i||a.length>=l?this._ajaxPost(s,n,o,r):this._ajaxGet(s,a,r)},d.ApiDataSource.prototype.createMultiple=function(e,t){this.collection,e.length;var r=this,i=e.slice(0),s=[];return function e(i){return new Promise((function(n,o){if(i.length>0){var a=i.pop();r.create(a,t).done((function(t){return s.push(t._id),e(i)})).fail((function(e){o(e)}))}else n(s)}))}(i)},d.ApiDataSource.prototype.list=function(e,t,r,i,s){e=e||"",this.collection;var o="list."+e,a=this.getBaseUrl();null!=e&&e.length>0&&(a+="list/"+e+"/");var c=this.getParamsDict(t,r,i,s);return n(c)||(a+="?"+this.getParams(c)),this._ajaxGet(o,a)},d.ApiDataSource.prototype.search=function(e,t,r,i,s,n){this.collection;var o="search",a=this.getBaseUrl()+"search",c=this.searchUrl(e,t,r,i,s,n);if(c.length>=l){var u=this.searchParams(e,t,r,i,s,n);return this._ajaxPost(o,a,u)}return this._ajaxGet(o,c)},d.ApiDataSource.prototype.searchUrl=function(e,t,r,i,s,n){var o=this.getBaseUrl()+"search",a=Object.assign(this.getParamsDict(t,r,i,s),e);return null!=n&&n.length>0&&(a.mimeType=n),o+"?"+this.getParams(a)},d.ApiDataSource.prototype.searchParams=function(e,t,r,i,s,n){this.getBaseUrl();var o=Object.assign(this.getParamsDict(t,r,i,s),e);return null!=n&&n.length>0&&(o.mimeType=n),o},d.ApiDataSource.prototype.export=function(e,t,r,i,s,n){this.collection;var o=this.exportUrl(e,t,r,i,s,n);return this._ajaxGet("export",o)},d.ApiDataSource.prototype.exportUrl=function(e,t,r,i,s,n){var o=this.getBaseUrl()+"call/export",a=Object.assign(this.getParamsDict(t,r,i,s),e);return null!=n&&n.length>0&&(a.mimeType=n),o+"?"+this.getParams(a)},d.ApiDataSource.prototype.call=function(e,t,r,i,s,n){this.collection;var o="call."+t,a=null!=e&&e.length>0?this.getBaseUrl()+e+"/call/"+t:this.getBaseUrl()+"call/"+t,c=Object.assign({},this.getParamsDict(i,null,null,null),r),u=a+"?"+this.getParams(c);return n||u.length>=l?this._ajaxPost(o,a,c,s):this._ajaxGet(o,u,s)},d.ApiDataSource.prototype.callMultiple=function(e,t,r,i,s,n){this.collection;var o="call."+t,a=this.getBaseUrl()+e.join(",")+"/call/"+t,c=Object.assign({},this.getParamsDict(i,null,null,null),r),u=a+"?"+this.getParams(c);return n||u.length>=l?this._ajaxPost(o,a,c,s):this._ajaxGet(o,u,s)},d.ApiDataSource.prototype.longCall=function(e,t,r,i,s){return this.call(e,t,r,i,6e4,s)},d.ApiDataSource.prototype.getBaseUrl=function(e){var t=null!=this.user.tokenType&&this.user.tokenType.length>0?this.user.tokenType:"null";return this.urlApi+"/"+this.user.userId+"/"+("jwt"!==t||e?this.user.userToken:"null")+"/"+(e?"null":t)+"/"+this.collection+"/"},d.ApiDataSource.prototype.getParams=function(e){var t=this.ajax._prepareDict(e);return Object.keys(t).map((function(e){return"".concat(encodeURIComponent(e),"=").concat(encodeURIComponent(t[e]))})).join("&")},d.ApiDataSource.prototype.getParamsDict=function(e,t,r,i){var s={};return e&&(s._fields=Array.isArray(e)?e.join(","):e.replace(/\s/g,"")),t&&(s._limit=t),r&&(s._skip=r),i&&(s._sort=i),this.version&&(s._v=this.version),s},d.ApiDataSource.prototype._ajaxGet=function(e,t,r){return this.ajax.get(t,r,{coll:this.collection,cmd:e})},d.ApiDataSource.prototype._ajaxPost=function(e,t,r,i){return this.ajax.post(t,r,i,{coll:this.collection,cmd:e})};var h=d,p={isCodeValid:function(e){return null!=e.trim().match(/^[a-z0-9]{8}$/i)},isCodeFromScanner:function(e){if(!e||0==e.length)return!1;var t=e.substring(0,23);return 0=="http://cheqroom.com/qr/".indexOf(t)},isValidBarcode:function(e){return e&&null!=e.match(/^([A-Z0-9\s\-]{3,43})$/i)},isValidQRCode:function(e){return this.isValidItemQRCode(e)||this.isValidTransferQRCode(e)},isValidTransferQRCode:function(e){return null!=e.match(/^http:\/\/cheqroom\.com\/ordertransfer\/[a-zA-Z0-9]{22}$/i)},isValidDocQRCode:function(e){return e&&(null!=e.match(/^http:\/\/cheqroom\.com\/qr\/[a-z0-9]{8}$/i)||null!=e.match(/^[a-z0-9]{8}$/i))},isValidItemQRCode:function(e){return this.isValidDocQRCode(e)},isValidKitQRCode:function(e){return this.isValidDocQRCode(e)},getCheqRoomRedirectUrl:function(e){return this.isCodeValid(e)?"http://cheqroom.com/qr/"+e.trim():""},getCheqRoomRedirectUrlQR:function(e,t){return this.isCodeValid(e)?"https://chart.googleapis.com/chart?chs="+t+"x"+t+"&cht=qr&choe=UTF-8&chld=L|0&chl="+encodeURI(this.getCheqRoomRedirectUrl(e)):""},getQRCodeUrl:function(e,t,r){return e+"?code="+t+"&scale="+{XS:1,S:2,M:3,L:4,XL:5}[r]},getBarcodeUrl:function(e,t,r,i){return e+"?code="+t+"&width="+r+(i?"&height="+i:"")}},m={getFriendlyOrderStatus:function(e){switch(e){case"creating":return"Draft";case"open":return"Open";case"closed":return"Completed";default:return"Unknown"}},getFriendlyOrderCss:function(e){switch(e){case"creating":return"label-creating";case"open":return"label-open";case"closed":return"label-closed";default:return""}},getFriendlyOrderSize:function(e){if(e.items&&e.items.length>0){var t=e.items.length+" item";return e.items.length>1&&(t+="s"),t}return"No items"},isOrderOverdue:function(e,r){return r=r||t()(),"open"==e.status&&r.isAfter(e.due)},isOrderArchived:function(e){return e&&null!=e.archived},getOrderStatus:function(e,r){return r=r||t()(),this.isOrderOverdue(e,r)?"Overdue":this.isOrderArchived(e)?"Archived":this.getFriendlyOrderStatus(e.status)},getOrderCss:function(e,r){return r=r||t()(),this.isOrderOverdue(e,r)?"label-overdue":this.isOrderArchived(e)?"label-archived":this.getFriendlyOrderCss(e.status)},canOrderSpotcheck:function(e){return null==e.archived&&-1==["closed"].indexOf(e.status)}},f={getFriendlyReservationCss:function(e){switch(e){case"creating":return"label-creating";case"open":return"label-open";case"closed":return"label-converted";case"closed_manually":return"label-closed";case"cancelled":return"label-cancelled";default:return""}},getFriendlyReservationStatus:function(e){switch(e){case"creating":return"Draft";case"open":return"Booked";case"closed":return"Converted";case"closed_manually":return"Closed";case"cancelled":return"Cancelled";default:return"Unknown"}},getFriendlyReservationFrequency:function(e){switch(e){case"every_day":return"Repeats every day";case"every_weekday":return"Repeats every weekday";case"every_week":return"Repeats every week";case"every_2_weeks":return"Repeats every 2 weeks";case"every_month":return"Repeats every month";case"every_2_months":return"Repeats every 2 months";case"every_3_months":return"Repeats every 3 months";case"every_6_months":return"Repeats every 6 months";default:return"Repeating reservation"}},isReservationOverdue:function(e,t){return t=t||moment(),"open"==e.status&&t.isAfter(e.fromDate||e.from)},isReservationInThePast:function(e,t){return t=t||moment(),"open"==e.status&&t.isAfter(e.fromDate)&&t.isAfter(e.toDate)},isReservationArchived:function(e){return e&&null!=e.archived},getReservationCss:function(e){return this.isReservationArchived(e)?"label-archived":this.getFriendlyReservationCss(e.status)},getReservationStatus:function(e){return this.isReservationArchived(e)?"Archived":this.getFriendlyReservationStatus(e.status)},canReservationSpotcheck:function(e){return null==e.archived&&-1==["cancelled","closed"].indexOf(e.status)}},y={},g=o.sanitizeHtml;y.itemCanTakeCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"available"==e.status},y.itemCanReleaseCustody=function(e){return"in_custody"==e.status},y.itemCanTransferCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"in_custody"==e.status},y.itemCanReserve=function(e){return void 0===e.canReserve||"available"===e.canReserve},y.itemCanCheckout=function(e){return void 0===e.canOrder||"available"===e.canOrder},y.itemCanGoToCheckout=function(e){return"checkedout"==e.status||"await_checkout"==e.status},y.itemCanCheckin=function(e){return"checkedout"==e.status},y.itemCanExpire=function(e){return"available"==e.status},y.itemCanUndoExpire=function(e){return"expired"==e.status},y.itemCanDelete=function(e){return"available"==e.status||"expired"==e.status},y.getFriendlyItemStatus=function(e){switch(e){case"available":return"Available";case"checkedout":return"Checked out";case"await_checkout":return"Checking out";case"in_transit":return"In transit";case"in_custody":return"In custody";case"maintenance":return"Maintenance";case"repair":return"Repair";case"inspection":return"Inspection";case"expired":return"Expired";default:return"Unknown"}},y.getItemStatusCss=function(e){switch(e){case"available":return"label-available";case"checkedout":return"label-checkedout";case"await_checkout":return"label-awaitcheckout";case"in_transit":return"label-transit";case"in_custody":return"label-custody";case"maintenance":return"label-maintenance";case"repair":return"label-repair";case"inspection":return"label-inspection";case"expired":return"label-expired";default:return""}},y.getItemStatusIcon=function(e){switch(e){case"available":return"fa fa-check-circle";case"checkedout":return"fa fa-times-circle";case"await_checkout":return"fa fa-ellipsis-h";case"in_transit":return"fa fa-truck";case"in_custody":return"fa fa-exchange";case"maintenance":case"repair":return"fa fa-wrench";case"inspection":return"fa fa-stethoscope";case"expired":return"fa fa-bug";default:return""}},y.getItemsByStatus=function(e,t){return e?e.filter((function(e){return"string"==typeof t?e.status==t:t(e)})):[]},y.getAvailableItems=function(e){return this.getItemsByStatus(e,"available").filter((function(e){return"available"===e.canOrder}))},y.getActiveItems=function(e){return this.getItemsByStatus(e,(function(e){return"expired"!=e.status&&"in_custody"!=e.status})).filter((function(e){return"available"===e.canReserve}))},y.getItemIds=function(e){return e.map((function(e){return"string"==typeof e?e:e._id}))},y.getItemMessages=function(e,r,i,s,n,o){var a=[],c=i,u=!c.hasContactReadOtherPermission(),l=function(e){return e.format("MMMM Do"+(e.year()==t()().year()?"":" YYYY"))},d=function(e){return e="string"!=typeof e?e||{}:{_id:e},(n=n||{}).customer||(n.customer={}),e._id==n.customer._id},h=new Promise((function(t,i){if(!c.hasCheckoutPermission("read")||"checkedout"!=e.status&&"await_checkout"!=e.status)t();else{var s="";new Promise((function(t){r("orders").search({_fields:"name,itemSummary,status,started,due,finished,customer.name,customer.user.picture,customer.cover,customer.kind",_restrict:!u,_sort:"started",status:"checkedout"==e.status?"open":"creating",pk:"string"!=typeof e.order?e.order._id:e.order,_limit:1,_skip:0,items__contains:e.id}).then((function(e){e&&e.count>0&&t(e.docs[0])}))})).then((function(r){if(d((r=r||{}).customer)&&(r.customer=n.customer,r.customer.user=n),"await_checkout"==e.status)s="Item is currently <strong>awaiting checkout</strong>";else{var i=g("string"!=typeof r.customer?r.customer.name:"");s=r&&m.isOrderOverdue(r)?"Item was <strong>due back</strong> "+r.due.fromNow()+(i?" from "+i:""):"Item is <strong>checked out</strong>"+(i?" to "+i:"")+" until "+l(r.due)}a.push({kind:"checkout",priority:0,message:s,checkout:!d(r.customer)&&u?{}:r}),t()}))}})),p=new Promise((function(i){c.hasReservationPermission("read")?r("reservations").search({status:"open",fromDate__gte:t()(),_fields:"name,status,itemSummary,fromDate,toDate,customer.name,customer.user.picture,customer.cover,customer.kind",_restrict:!u||!c.hasReservationPermission("read"),_sort:"fromDate",_limit:1,_skip:0,items__contains:e.id}).then((function(e){if(e&&e.count>0){var t=e.docs[0];E="Next <strong>reservation</strong> is "+t.fromDate.fromNow()+" <span class='text-muted'>on "+l(t.fromDate)+"</span>",a.push({kind:"reservation",priority:1,reservation:t,isOwn:d(t.customer),message:E})}i()})):i()})),f=new Promise((function(t){if("in_custody"==e.status){var i=new Promise((function(t){u?t(null):r("items").call(e.id,"getChangeLog",{action__in:["takeCustody","transferCustody"],limit:1,skip:0}).then((function(e){r("contacts").get(e[0].obj,"name,cover,user.picture,kind").then((function(r){t(r,e[0].created)}))}))}));i.then((function(r,i){var s="Item is <strong>in "+(d(e.custody)?"your":"")+" custody</strong>"+(r&&!d(e.custody)?" of "+g(r.name)+" <span class='text-muted'>since "+l(i)+"</span>":"");a.push({kind:"custody",priority:1,by:r||{},message:s}),t()}))}else t()})),y=c.hasItemPermission("reserve")&&e.allowReserve,v=c.hasItemPermission("checkout")&&e.allowCheckout,_=c.hasItemPermission("takeCustody")&&e.allowCustody,w=o.itemFlags.find((function(t){return t.id==e.flag})),C=w&&!w.available;if(!(e.allowReserve&&e.allowCheckout&&e.allowCustody||C)){var R=[],k=[];c.hasReservationPermission("read")&&c.hasCheckoutPermission("read")&&(!y&&!v||y&&v)?y&&v?k.push("Bookings"):c.hasCheckoutPermission("read")&&c.hasReservationPermission("read")&&R.push("Bookings"):(y?k.push("Reservation"):c.hasReservationPermission("read")&&R.push("Reservation"),v?k.push("Check-out"):c.hasCheckoutPermission("read")&&R.push("Check-out")),_?k.push("Custody"):c.hasItemPermission("takeCustody")&&R.push("Custody");var E="";E=y||v||_?"Item is <strong>available</strong> for "+k.joinAdvanced(", "," and ")+"<span class='text-muted'>, not for "+R.joinAdvanced(", "," and ")+"</span>":"Item is <strong>unavailable</strong> for "+R.joinAdvanced(", "," and "),a.push({kind:"permission",priority:2,message:E})}if(w){var D=g(w.name);E="Item was <strong>flagged</strong> as "+D+(e.flagged?" <span class='text-muted'>"+e.flagged.fromNow()+"</span>":""),C&&(E="Item is <strong>unavailable</strong> because of flag "+D+(e.flagged?" <span class='text-muted'>"+e.flagged.fromNow()+"</span>":"")),a.push({kind:"flag",priority:C?1:2,message:E,flag:w})}if(e.warrantyDate){E="";var T=Math.round(t()().diff(e.warrantyDate,"days"))>=0;E=T?"Went <strong>out of warranty</strong> "+e.warrantyDate.fromNow()+" <span class='text-muted'>on "+l(e.warrantyDate)+"</span>":"Warranty <strong>expires</strong> "+e.warrantyDate.fromNow()+" <span class='text-muted'>on "+l(e.warrantyDate)+"</span>",a.push({kind:"warranty",priority:3,message:E,inWarranty:T})}return"expired"==e.status&&(E="Item was <strong>expired</strong> "+(e.expired?"<span class='text-muted'>"+e.expired.fromNow()+"</span>":""),a.push({kind:"expired",priority:0,message:E})),Promise.all(h,p,f).then((function(){return a.sort((function(e,t){return e.priority-t.priority}))}))};var v=y,_={getCategoryKeyFromName:function(e){return"cheqroom.types.item."+e.split(" ").join("_").split(".").join("").toLowerCase()},getCategoryNameFromKey:function(e){var t=new RegExp("_","g");return e.split(".").pop().replace(t," ")},getCategorySummary:function(e){if(0==(e=e||[]).length)return"No items";for(var t,r=null,i=null,s=null,n={},o="",a=0,c=0,u=e.length;c<u;c++)n[i=(s=(r=e[c]).category?"string"==typeof(t=r.category)?t:t.name:"")?this.getCategoryNameFromKey(s):""]?n[i]+=1:n[i]=1,n[i]>a&&(o=i,a=n[i]);var l=n[o]+" ";return 1==a&&String.prototype.singularize?l+=o.singularize():l+=o,e.length>n[o]&&(l+=" +"+(e.length-n[o])+" other"),l},getItemSummary:function(e){if(0==(e=e||[]).length)return"No items";for(var t=", ",r=null,i=0,s={},n=[],o=0,a=e.length;o<a;o++)(r=e[o]).kit&&r.kit.name?s[r.kit.name]?s[r.kit.name].push(r):(s[r.kit.name]=[r],i+=1):n.push(r);if(0==i)return this.getCategorySummary(e);var c=$.map(s,(function(e,t){return t}));return 0==n.length?c.joinOther(30,t,"other kits"):1==i?c[0]+t+this.getCategorySummary(n):a(c)+" kits"+t+this.getCategorySummary(n)}},w={getAvatarInitial:function(e,t){var r={XS:32,S:64,M:128,L:256,XL:512},i=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7"],s=(e=e||"Unknown").split(" "),n=2==s.length?s[0].charAt(0).toUpperCase()+s[1].charAt(0).toUpperCase():s[0].charAt(0).toUpperCase(),o=(n.charCodeAt(0)-65)%i.length,a=r[t],c=r[t],u=a,l=c,d=$("<canvas />").attr({width:a,height:c}),h=d.get(0).getContext("2d");return window.devicePixelRatio&&(d.attr("width",a*window.devicePixelRatio),d.attr("height",c*window.devicePixelRatio),d.css("width",u),d.css("height",l),h.scale(window.devicePixelRatio,window.devicePixelRatio)),h.fillStyle=i[o],h.fillRect(0,0,a,c),h.font=a/2+"px Arial",h.textAlign="center",h.fillStyle="#FFF",h.fillText(n,u/2,l/1.5),d.get(0).toDataURL()},getMaintenanceAvatar:function(e){return this.getIconAvatar(e,"f0ad")},getIconAvatar:function(e,t,r,i,s){var n={XS:32,S:64,M:128,L:256,XL:512},o=n[e],a=n[e],c=o,u=a;r||(r="#aaa"),i||(i="#f5f5f5"),s||(s=o/2);var l=$("<canvas />").attr({width:o,height:a}),d=l.get(0).getContext("2d");return window.devicePixelRatio&&(l.attr("width",o*window.devicePixelRatio),l.attr("height",a*window.devicePixelRatio),l.css("width",c),l.css("height",u),d.scale(window.devicePixelRatio,window.devicePixelRatio)),d.fillStyle=i,d.fillRect(0,0,o,a),d.font=s+"px FontAwesome",d.textAlign="center",d.fillStyle=r,d.fillText(String.fromCharCode("0x"+t),c/2,u/1.5),l.get(0).toDataURL()},getTextImage:function(e,t,r,i){var s={XS:32,S:64,M:128,L:256,XL:512};r||(r="#aaa"),i||(i="#e5e5e5");var n=s[t],o=s[t],a=n,c=o,u=$("<canvas />").attr({width:n,height:o}),l=u.get(0).getContext("2d");return window.devicePixelRatio&&(u.attr("width",n*window.devicePixelRatio),u.attr("height",o*window.devicePixelRatio),u.css("width",a),u.css("height",c),l.scale(window.devicePixelRatio,window.devicePixelRatio)),l.fillStyle=i,l.fillRect(0,0,n,o),l.font=n/2.7+"px Arial",l.textAlign="center",l.fillStyle=r,l.fillText(e,a/2,c/1.5),u.get(0).toDataURL()},getImageUrl:function(e,t,r,i){"production"!==environment&&console.warn("[Deprecation] Getting CDN url through getImageUrl is deprecated",t);var s=e.getBaseUrl(!0)+t+"?mimeType=image/jpeg";return r&&"orig"!=r&&(s+="&size="+r),i&&(s+="&_bust="+(new Date).getTime()),s},getImageCDNUrl:function(e,t,r,i){"production"!==environment&&console.warn("[Deprecation] Getting CDN url through getImageCDNUrl is deprecated",r);var s="https://assets.cheqroomcdn.com/"+e.amazonBucket+"/groups/"+t+"/"+r;if(i&&i.length>0){var n=s.split(".");-1!=r.indexOf(".")&&n.pop(),s=n.join(".")+"-"+i+".jpg"}return s},getNoImage:function(e){return{XS:"https://app.cheqroom.com/image-XS.png",S:"https://app.cheqroom.com/image-S.png",M:"https://app.cheqroom.com/image-M.png",L:"https://app.cheqroom.com/image-L.png",XL:"https://app.cheqroom.com/image-XL.png"}[e||"S"]}},C=["jpg","jpeg","png","gif"],R={getImgFileNameFromName:function(e){return null!=e&&e.length>0?e.split(" ").join("_").split(".").join("_")+".jpg":"upload "+t()().format("YYYY-MM-DD at hh:mm:ss a")+".jpg"},makeFileNameJpg:function(e){return e.indexOf(".")>=0?e.substr(0,e.lastIndexOf("."))+".jpg":e},getFileNameFromUrl:function(e){if(e){var t=e.toString().match(/.*\/(.+?)\./);if(t&&t.length>1)return t[1]}return""},isImage:function(e){var t=this.getExt(e);return C.includes(t)},getExt:function(e){return(/(?:\.([^.]+))?$/.exec(e)[1]||"").toLowerCase()}},k=(i(350),{isValidEmail:function(e){var t=e.match(/^([\w-\+']+(?:\.[\w-\+']+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,}(?:\.[a-z]{2})?)$/i);return null!=t&&t.length>0},isValidPhone:function(e){if(t=e=e.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,""),!isNaN(parseFloat(t))&&isFinite(t))return!0;var t,r=e.match(/^[\s()+-]*([0-9][\s()+-]*){7,20}(( x| ext)\d{1,5}){0,1}$/);return null!=r&&r.length>0},isValidURL:function(e){var t=e.match(/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{1,}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_@\!-]+))*$/);return null!=t&&t.length>0},isValidPassword:function(e){var t=e.match(/[0-9]/);return e.length>=4&&t},isNumeric:function(e,t){var r=r(e);return t?(0^e)===Number(e):r(e)},isValidDate:function(e){return isNaN(e)||(e=parseInt(e)),t()(e).isValid()}}),E=function(){this.rules=[{regex:/(#{1,6})\s(.*)/g,replacement:function(e,t,r){var i=t.length;return"<h"+i+">"+r.trim()+"</h"+i+">"}},{regex:/!\[([^\[]+)\]\(([^\)]+)\)/g,replacement:"<img src='$2' alt='$1'>"},{regex:/\[([^\[]+)\]\(([^\)]+)\)/g,replacement:"<a href='$2'>$1</a>"},{regex:/(\*\*|__)(.*?)\1/g,replacement:"<strong>$2</strong>"},{regex:/(\*|_)(.*?)\1/g,replacement:"<em>$2</em>"},{regex:/\~\~(.*?)\~\~/g,replacement:"<del>$1</del>"},{regex:/\:\"(.*?)\"\:/g,replacement:"<q>$1</q>"},{regex:/`(.*?)`/g,replacement:"<code>$1</code>"},{regex:/\n\*(.*)/g,replacement:function(e,t){return"\n<ul>\n\t<li>"+t.trim()+"</li>\n</ul>"}},{regex:/\n[0-9]+\.\s(.*)/g,replacement:function(e,t){return"\n<ol>\n\t<li>"+t.trim()+"</li>\n</ol>"}},{regex:/\n(&gt;|\>)(.*)/g,replacement:function(e,t,r){return"\n<blockquote>"+r.trim()+"</blockquote>"}},{regex:/\n-{5,}/g,replacement:"\n<hr />"},{regex:/<\/ul>\s?<ul>/g,replacement:""},{regex:/<\/ol>\s?<ol>/g,replacement:""},{regex:/(?:[^\n]|(?:<[^>].*>)\n(?! *\n))+/g,replacement:function(e,t){var r=(""+e).trim();return/^<\/?(ul|ol|li|h|p|bl)/i.test(r)?r:"<p>"+(r=r.replace(/\n/g,"<br />"))+"</p>"}},{regex:/<\/blockquote><blockquote>/g,replacement:"\n"}],this.addRule=function(e,t){e.global=!0,e.multiline=!1,this.rules.push({regex:e,replacement:t})},this.render=function(e){return e=function(e){var t=e.match(/(\(?https?:\/\/[-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#\/%=~_()|])(">|<\/a>|\)|\])?/gm);if(null==t)return e;for(var r={},i=0;i<t.length;i++){var s=t[i];if(-1!=s.lastIndexOf("]")||-1!=s.lastIndexOf(")"))break;if(r[s])break;r[s]=s,e=e.replace(s,"["+s+"]("+s+")")}return e}(e="\n"+e+"\n"),this.rules.forEach((function(t){e=e.replace(t.regex,t.replacement)})),e.trim()}};window.Slimdown=E;var D=E,T={},S=o.sanitizeHtml;T.kitCanCheckout=function(e){return void 0===e.canOrder||"available"===e.canOrder||"available_partially"===e.canOrder},T.kitCanReserve=function(e){return void 0===e.canReserve||"available"===e.canReserve||"available_partially"===e.canReserve},T.kitCanTakeCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"available"==e.status},T.kitCanReleaseCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"in_custody"==e.status},T.kitCanTransferCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"in_custody"==e.status},T.getKitStatus=function(e){var t={},r=[],i={},s=[];return e.forEach((function(e){t[e.status]||(t[e.status]=!0,r.push(e.status)),i[e.order]||(i[e.order]=!0,s.push(e.order))})),1==r.length&&s.length<=1?r[0]:"incomplete"},T.getFriendlyKitStatus=function(e){return"incomplete"==e?"Incomplete":v.getFriendlyItemStatus(e)},T.getKitStatusCss=function(e){return"incomplete"==e?"label-incomplete":v.getItemStatusCss(e)},T.getKitStatusIcon=function(e){switch(e){case"available":return"fa fa-check-circle";case"checkedout":return"fa fa-times-circle";case"await_checkout":case"empty":return"fa fa-ellipsis-h";case"incomplete":return"fa fa-warning";case"in_transit":return"fa fa-truck";case"in_custody":return"fa fa-exchange";case"maintenance":case"repair":return"fa fa-wrench";case"inspection":return"fa fa-stethoscope";case"expired":return"fa fa-bug";default:return""}},T.getKitIds=function(e){var t={},r=[];return e.forEach((function(e){if(e.kit){var i="string"==typeof e.kit?e.kit:e.kit._id;t[i]||(t[i]=!0,r.push(i))}})),r},T.getKitMessages=function(e,r,i,s,n){var o=[],a=i,c=!a.hasContactReadOtherPermission(),u=function(e){return e.format("MMMM Do"+(e.year()==t()().year()?"":" YYYY"))},l=function(e){return e="string"!=typeof e?e||{}:{_id:e},(n=n||{}).customer||(n.customer={}),e._id==n.customer._id},d=new Promise((function(t){if(!a.hasCheckoutPermission("read")||"checkedout"!=e.status&&"await_checkout"!=e.status)t();else{var i="";new Promise((function(t){r("orders").search({_fields:"name,itemSummary,status,started,due,finished,customer.name,customer.user.picture,customer.cover,customer.kind",_restrict:!c||!a.hasCheckoutPermission("read"),_sort:"started",status:"checkedout"==e.status?"open":"creating",_limit:1,_skip:0,items__in:v.getItemIds(e.items)}).then((function(e){e&&e.count>0&&t(e.docs[0])}))})).then((function(r){if(l((r=r||{}).customer)&&(r.customer=n.customer,r.customer.user=n),"await_checkout"==e.status)i="Kit is currently <strong>awaiting checkout</strong>";else{var s=S("string"!=typeof r.customer?r.customer.name:"");i=r&&m.isOrderOverdue(r)?"Kit was <strong>due back</strong> "+r.due.fromNow()+(s?" from "+s:""):"Kit is <strong>checked out</strong>"+(s?" to "+s:"")+" until "+u(r.due)}o.push({kind:"checkout",priority:0,message:i,checkout:!l(r.customer)&&c?{}:r}),t()}))}})),h=new Promise((function(i){a.hasReservationPermission("read")&&e.items.length>0?r("reservations").search({status:"open",fromDate__gte:t()(),_fields:"name,status,itemSummary,fromDate,toDate,customer.name,customer.user.picture,customer.cover,customer.kind",_restrict:!c,_sort:"fromDate",_limit:1,_skip:0,items__in:v.getItemIds(e.items)}).then((function(e){if(e&&e.count>0){var t=e.docs[0];k="Next <strong>reservation</strong> is "+t.fromDate.fromNow()+" <span class='text-muted'>on "+u(t.fromDate)+"</span>",o.push({kind:"reservation",priority:1,reservation:t,isOwn:l(t.customer),message:k})}i()})):i()})),p=new Promise((function(t){if("in_custody"==e.status){var i=new Promise((function(t){c?t(null):r("kits").call(e.id,"getChangeLog",{action__in:["takeCustody","transferCustody"],limit:1,skip:0}).then((function(i){new Promise((function(t){0==i.length?r("items").call(e.items[0]._id,"getChangeLog",{action__in:["takeCustody","transferCustody"],limit:1,skip:0}).then((function(e){t(e)})):t(i)})).then((function(e){r("contacts").get(e[0].obj,"name,cover,user.picture,kind").then((function(r){t(r,e[0].created)}))}))}))}));i.then((function(e,r){var i="Kit is <strong>in custody</strong>"+(e?" of "+S(e.name)+" <span class='text-muted'>since "+u(r)+"</span>":"");o.push({kind:"custody",priority:1,by:e||{},message:i}),t()}))}else t()})),f=a.hasKitPermission("reserve")&&(e._canReserve||e.canReserve),y=a.hasKitPermission("checkout")&&(e._canOrder||e.canOrder),g="available"===f||"available_partially"===f,_="available"===y||"available_partially"===y,w="available"===(a.hasKitPermission("takeCustody")&&(e._canCustody||e.canCustody));if(g||_||w){var C=[],R=[];a.hasReservationPermission("read")&&a.hasCheckoutPermission("read")&&g&&_||!g&&!_?g&&_?R.push("Bookings"):a.hasCheckoutPermission("read")&&a.hasReservationPermission("read")&&C.push("Bookings"):(g?R.push("Reservation"):a.hasReservationPermission("read")&&C.push("Reservation"),_?R.push("Check-out"):a.hasCheckoutPermission("read")&&C.push("Check-out")),w?R.push("Custody"):a.hasItemPermission("takeCustody")&&C.push("Custody");var k="";k=g||w||_?"Kit is <strong>"+("available_partially"==f||"available_partially"==y?"partially ":"")+"available</strong> for "+R.joinAdvanced(", "," and ")+(C.length>0?"<span class='text-muted'>, not for "+C.joinAdvanced(", "," and ")+"</span>":""):"Kit is <strong>unavailable</strong> for "+C.joinAdvanced(", "," and "),o.push({kind:"permission",priority:2,message:k})}if("empty"==e.status&&(k="Kit is <strong>empty</strong>",o.push({kind:"empty",priority:3,message:k})),"incomplete"==e.status){k="Kit is <strong>incomplete</strong>";var E=e.items,D={};E.forEach((function(e){var t=e.status;if("available"==e.status){var r=e.canReserve,i=e.canOrder;"available"!==r&&"unavailable_status"!==r&&"available"!==i&&"unavailable_status"!==i&&(t="unavailable")}var s=D[t]||0;D[t]=s+1}));var T=D.unavailable||0,b=D.checkedout||0,A=D.await_checkout||0,O=D.expired||0,I=D.available||0,x=D.in_custody||0;if(E.length," item".pluralize(E.length),I==E.length||b==E.length||A==E.length||O==E.length||x==E.length);else{var N=[];T>0&&N.push(T+" unavailable"),I>0&&N.push(I+" available"),b>0&&N.push(b+" checked out"),A>0&&N.push(A+" awaiting checkout"),O>0&&N.push(O+" expired"),x>0&&N.push(x+" in custody"),k+=" <span class='text-muted'>("+N.joinAdvanced(", "," and ")+")</span>"}o.push({kind:"incomplete",priority:3,message:k})}return"expired"==e.status&&(k="Kit is <strong>expired</strong>",o.push({kind:"expired",priority:0,message:k})),Promise.all(d,h,p).then((function(){return o.sort((function(e,t){return e.priority-t.priority}))}))};var b=T,A={contactGetUserId:function(e){if(e.user){if("string"==typeof e.user)return e.user;if(e.user.hasOwnProperty("_id"))return e._id}},contactGetUserSync:function(e){if(e.user&&e.user.sync)return e.user.sync},contactCanReserve:function(e){return"active"==e.status},contactCanCheckout:function(e){return"active"==e.status},contactCanGenerateDocument:function(e){return"active"==e.status},contactCanArchive:function(e){return"active"==e.status&&!A.contactGetUserSync(e)},contactCanUndoArchive:function(e){return"archived"==e.status&&!A.contactGetUserSync(e)},contactCanDelete:function(e){return!A.contactGetUserSync(e)},contactCanBlock:function(e){return"active"==e.status},contactCanUndoBlock:function(e){return"blocked"==e.status},getContactImageUrl:function(e,t,r,i){if(t.cover){if(-1!=t.cover.indexOf("data:image")||-1!=t.cover.indexOf("file:"))return t.cover;if(R.isImage(t.cover))return w.getImageUrl(e,t.cover,r,i)}return t.user&&t.user.picture?w.getImageUrl(e,t.user.picture,r,i):w.getAvatarInitial(t.name,r)},getContactImageCDNUrl:function(e,t,r,i,s){return r.cover?w.getImageCDNUrl(e,t,r.cover,i,s):r.user&&r.user.picture?w.getImageCDNUrl(e,t,r.user.picture,i,s):w.getAvatarInitial(r.name,i)},getContactMessages:function(e,t,r,i,s,n){var o=[];if("maintenance"==e.kind){var a="Contact can <strong>maintenance / repair</strong>";o.push({kind:"maintenance",priority:3,message:a,contact:{kind:"maintenance",name:""}})}return"blocked"==e.status&&(a="Contact was <strong>blocked</strong> "+(e.blocked?"<span class='text-muted'>"+e.blocked.fromNow()+"</span>":""),o.push({kind:"blocked",priority:1,message:a})),Promise.resolve().then((function(){return o.sort((function(e,t){return e.priority-t.priority}))}))}},O=A,I={getUserImageUrl:function(e,t,r,i){return t&&t.picture?w.getImageUrl(e,t.picture,r,i):w.getAvatarInitial(t.name,r)},getUserImageCDNUrl:function(e,t,r,i,s){return r&&r.picture?w.getImageCDNUrl(e,t,r.picture,i,s):w.getAvatarInitial(r.name,i)}},x=(i(667),{containsValue:function(e,t,r){return e=e||{},r=r||["name","fields","codes","barcodes"],t=t.trim().toLowerCase(),!(-1==r.indexOf("name")||!e.name||-1==e.name.toLowerCase().indexOf(t))||(!(-1==r.indexOf("fields")||!e.fields||!Object.values(e.fields).find((function(e){return-1!=e.toString().toLowerCase().indexOf(t)})))||(!(-1==r.indexOf("codes")||!e.codes||!e.codes.find((function(e){return-1!=e.toLowerCase().indexOf(t)})))||!(-1==r.indexOf("barcodes")||!e.barcodes||!e.barcodes.find((function(e){return-1!=e.toLowerCase().indexOf(t)})))))},getDocumentIds:function(e){return e.map((function(e){return"string"==typeof e?e:e._id}))}}),N={getTransactionSummary:function(e,t){return(e=e||{}).name?e.name:e.itemSummary&&"No items"!=e.itemSummary?e.itemSummary:t||"No items"},getOrderDuration:function(e){var r=e.started||t()(),i="closed"==e.status?e.finished:e.due;return i?t().duration(i-r):null},getFriendlyOrderDuration:function(e,t){var r=N.getOrderDuration(e);return null!=r?t.getFriendlyDuration(r):""},getReservationDuration:function(e){if(e)return null!=e.fromDate&&null!=e.toDate?t().duration(e.toDate-e.fromDate):null},getFriendlyReservationDuration:function(e,t){var r=N.getReservationDuration(e);return null!=r?t.getFriendlyDuration(r):""},getMessages:function(e,r,i,s,n,o){var a=$.Deferred();if(messages=[],MessagePriority={Critical:0,High:1,Medium:2,Low:3},o=o.raw?o.raw:o,perm=i,"creating"==e.status){var c=(o.cleanup||{}).deleteReservationsCreating;if(c>0){var u=e.modified.clone().add(c,"minutes"),l=t()(),d=u.isBefore(l),h="Reservation will be deleted <strong>"+u.fromNow()+"</strong>";d&&(h="Reservation will be deleted <strong>in a few seconds</strong>"),messages.push({kind:"cleanup",priority:MessagePriority.Critical,message:h,deleteTime:u,isPassed:d})}}return a.resolve(),a.then((function(){return messages.sort((function(e,t){return e.priority-t.priority}))}))}},P=N,U={},M=new D,F=o.sanitizeHtml;U.getChangeLogEvent=function(e,r,i,s,n,a,c,u,l,d,h){var m="Unknown",f=a.timeFormat24?"H:mm":"h:mma";e.friendlyText=e.action,e.by=e.by||{},e.by.name=e.by.name||"CHEQROOM";var y=e.arg||{},g={by:e.by,kind:e.kind};y.customerName&&e.by.name!=y.customerName&&(g.contact={id:y.customerId,name:F(y.customerName||m)});var v,C=s.find((function(e){return e._id==(y.location||y.locationId)}))||{},k=s.filter((function(e){return"active"==e.status})),E=F(k.length>1?" at "+(C.name||m):""),D=F(e.by.name),T=l(),S=function(t){return n[{"check-out":"orderFields",reservation:"reservationFields",item:"itemFields",contact:"customerFields",kit:"kitFields"}[e.kind]].find((function(e){return e.name==t}))},b=h||function(e,t){if("string"==typeof e&&0==e.indexOf("http"))return e;var r="string"==typeof e?e:e._id||e.id||e.attachmentId;return w.getImageCDNUrl(c,n.id,t?R.makeFileNameJpg(r):r,t)},A=d||function(e,t){return w.getImageCDNUrl(c,n.id,"string"==typeof e?e:e.cover||e._id||e.id,t)},O=function(e,t){var r=F(t);return T.hasCheckoutPermission("read")?"<a href='#check-outs/"+e+"' class='transaction-link' data-kind='order' data-id='"+e+"'>"+r+"</a>":r},I=function(e,t){var r=F(t);return T.hasReservationPermission("read")?"<a href='#reservations/"+e+"' class='transaction-link' data-kind='reservation' data-id='"+e+"'>"+r+"</a>":r},x=function(e,t){return"<a href='"+e+"'>"+F(t)+"</a>"},N=function(e,t){return T.hasContactReadOtherPermission()?x("#contacts/"+e,t):F(t)},P=function(e,t){return T.hasKitPermission()?x("#kits/"+e,t):F(t)},U=function(e){return 0==e.length?"":"<ul class='list-group field-group'>"+e.map((function(e){return"<li class='list-group-item'>"+e+"</li>"})).join("")+"</ul>"},L=function(e){return e?U([e]):""};switch(e.action){case"changeCategory":var j=F(y.category?y.category.split(".").pop().replace(/_/gim," ").capitalize():m);e.friendlyText=D+" updated category to "+j;break;case"addCodes":case"removeCodes":var B=y.codes&&y.codes.length>0?y.codes[0]:m;switch(e.action){case"addCodes":e.friendlyText=D+" added qr code "+B+" <img class='qrcode' title='"+B+"' src='"+p.getQRCodeUrl(c.qrCodeUtilsApi,B,"S")+"' />";break;case"removeCodes":e.friendlyText=D+" removed qr code "+B}break;case"addBarcode":case"removeBarcode":var V=y.barcode||m;switch(e.action){case"addBarcode":e.friendlyText=D+" added barcode "+V+" <img class='barcode' title='"+V+"' src='"+p.getQRCodeUrl(c.barcodeUtilsApi,V,"S")+"' />";break;case"removeBarcode":e.friendlyText=D+" removed barcode "+V}break;case"archive":var W=!g.by._id;e.friendlyText=D+(W?" auto-":" ")+"archived "+e.kind;break;case"undoArchive":e.friendlyText=D+" unarchived "+e.kind;break;case"takeCustody":case"item.takeCustody":case"kit.takeCustody":var H=e.obj,J=y.custodyName||m;"takeCustody"==e.action?e.friendlyText=D+" placed "+e.kind+" in custody of "+N(e.obj,J):"item.takeCustody"==e.action?e.friendlyText=D+" took "+x("#items/"+H,"item")+" custody":e.friendlyText=D+" took "+x("#kits/"+H,"kit")+" custody";break;case"transferCustody":case"item.transferCustody":case"kit.transferCustody":H=e.obj,e.by!=y.hadCustodyName?(J=y.hadCustodyName||m,"transferCustody"==e.action?e.friendlyText=D+" transfered "+e.kind+" custody from "+N(y.hadCustody,J):"item.transferCustody"==e.action?e.friendlyText=D+" transfered "+x("#items/"+H,"item")+" custody from "+N(y.hadCustody,J):e.friendlyText=D+" transfered "+x("#kits/"+H,"kit")+" custody from "+N(y.hadCustody,J)):(J=y.custodyName||m,"transferCustody"==e.action?e.friendlyText=D+" transfered "+e.kind+" custody to "+N(y.custody,J):"item.transferCustody"==e.action?e.friendlyText=D+" transfered "+x("#items/"+H,"item")+" custody to "+N(y.custody,J):e.friendlyText=D+" transfered "+x("#kits/"+H,"kit")+" custody to "+N(y.custody,J));break;case"releaseCustody":case"item.releaseCustody":case"kit.releaseCustody":H=e.obj,J=y.hadCustodyName||m,"releaseCustody"==e.action?e.friendlyText=D+" released "+e.kind+" custody of "+N(y.hadCustody,J)+E:"item.releaseCustody"==e.action?e.friendlyText=D+" released "+x("#items/"+H,"item")+" custody":e.friendlyText=D+" released "+x("#kits/"+H,"kit")+" custody";break;case"setFlag":case"clearFlag":var q=(v="setFlag"==e.action?y.flag:y.oldFlag,n.itemFlags.find((function(e){return e.id==v}))||{}),z=F(q.name||m),K=q.color||"orange",G=F(y&&y.message?y.message:""),Y=y&&y.attachments_url&&y.attachments_url.length>0,Z=y&&y.attachments_url?y.attachments_url.map((function(e,t){return{id:y.attachments[t],url:e.XS}})):[];switch(e.by={kind:"flag",name:e.by.name,color:"setFlag"==e.action?K:"gray"},e.action){case"setFlag":e.friendlyText=D+" set flag <span class='text-"+K.toLowerCase()+"'><svg class='inline-svg'><use href='#flag-icon' /></svg> "+z+"</span>"+(G?"<ul class='list-group field-group'><li class='list-group-item'><small class='text-muted'>Message</small><br />"+G+"</li>"+(Y?"<li class='list-group-item'><small class='text-muted'>Attachments</small><div>"+Z.map((function(e){return"<img class='flag-attachment' data-id='"+e.id+"' src='"+e.url+"' style='display:inline-block;margin-right:5px;' />"})).join("")+"</div></li>":"")+"</ul>":"");break;case"clearFlag":e.friendlyText=D+" cleared flag <span style='text-decoration:line-through;'><svg class='inline-svg'><use href='#flag-icon' /></svg> "+z+"</span>"+(G?"<ul class='list-group field-group'><li class='list-group-item'><small class='text-muted'>Message</small><br />"+G+"</li>"+(Y?"<li class='list-group-item'><small class='text-muted'>Attachments</small><div>"+Z.map((function(e){return"<img class='flag-attachment' data-id='"+e.id+"' src='"+e.url+"' style='display:inline-block;margin-right:5px;' />"})).join("")+"</div></li>":"")+"</ul>":"")}break;case"sendMessage":e.by={kind:"email",name:"CHEQROOM"},H=e.id;var X=F("text"===y.request.dialect?y.request.body:o.removeHtmlTags(/<td.*class=.container-padding.*[\n]+([\s\S]*)<\/td>/gim.exec(y.request.body)[1])),Q=y.request.to,ee=F(y.request.subject);e.friendlyText="Sent mail to "+Q+" <ul class='list-group field-group'><li class='list-group-item'><div class='mail-subject'>"+ee+"</div><div class='mail-body multiline-text-truncate'>"+X+"</div><div><a href='javascript:void(0)' class='open-email' data-id='"+H+"'>View email</a></div></li></ul>";break;case"sendSMS":e.by={kind:"sms",name:"CHEQROOM"},H=e.id,X=F(y.request.sms_body),Q=y.request.sms_to_number,e.friendlyText="Sent sms to "+Q+" <ul class='list-group field-group'><li class='list-group-item'><div class='mail-body multiline-text-truncate'>"+X+"</div></li></ul>";break;case"block":case"undoBlock":G=F(y?y.message:null);var te="block"==e.action?"blocked":"unblocked";e.friendlyText=D+" "+te+" contact "+L(G);break;case"import":e.friendlyText=D+" created "+e.kind+" from import";break;case"attach":var re=y&&y.attachments.length>0&&y.attachments[0],ie="string"==typeof re?re:re.attachmentId,se=-1!=ie.indexOf(".pdf"),ne=y&&y.attachments.length>0?b(re,se?"S":"XS"):null,oe=y&&y.attachments.length>0?u("attachments").getBaseUrl()+ie+"?download=true":"javascript:void(0);";e.friendlyText=D+" added attachment "+(oe?"<a class='open-attachment' data-id='"+ie+"' href='"+oe+"' target='_blank'>":"")+(ne?"<img "+(se?"class='pdf'":"")+" src='"+ne+"' />":"")+(oe?"</a>":"");break;case"detach":e.friendlyText=D+" removed attachment";break;case"order.checkout":case"checkout":case"checkoutAgain":H=e.obj;var ae=g.contact;if("order.checkout"==e.action)switch(e.kind){case"item":e.friendlyText=D+" "+O(H,"checked out")+" item "+(ae?"to "+N(ae.id,ae.name):"")+E;break;case"contact":e.friendlyText=D+" "+O(H,"checked out")+" equipment"+E}else e.friendlyText=D+" checked out equipment";break;case"order.checkin":case"checkin":H=e.obj,ae=g.contact;var ce=r.due||e.arg.due,ue=(Q=e.created,"");if(ce){var le=t().duration(ce.diff(e.created));Q.isAfter(ce)?ue=le.humanize(!0).replace(" ago","").replace("in ","")+" late":Q.isBefore(ce)&&(ue=le.humanize(!0).replace(" ago","").replace("in ","")+" early")}if("order.checkin"==e.action)switch(e.kind){case"item":e.friendlyText=D+" "+O(H,"checked in")+" item "+ue+(ae?" from "+N(ae.id,ae.name):"")+E;break;case"contact":e.friendlyText=D+" "+O(H,"checked in")+" equipment "+ue+E}else{var de=y.items||[],he=(de.length,ce?ce.format("D MMM "+f):"Unknown"),pe=r.items.filter((function(e){return e.imageUrl=A(e,"XS"),-1!=de.indexOf(e._id)}));e.friendlyText=D+" checked in equipment "+ue+U(pe.map((function(e){return"<div class='media'><div class='media-left'><img class='item-image' src='"+e.imageUrl+"' /></div><div class='media-body'><a href='#items/"+e._id+"'>"+F(e.name)+"</a><br /><small class='text-muted text-truncate item-info'>"+e.codes.map((function(e){return"<i class='fa fa-qrcode'></i> "+e}))+e.barcodes.map((function(e){return"<i class='fa fa-barcode'></i> "+e}))+"</small></div></div>"})))}break;case"order.undoCheckout":case"undoCheckout":if(H=e.obj,ae=g.contact,"undoCheckout"==e.action)e.friendlyText=D+" undid check-out";else switch(e.kind){case"item":e.friendlyText=D+" undid item "+O(H,"check out")+(ae?" for "+N(ae.id,ae.name):"");break;case"contact":e.friendlyText=D+" undid equipment "+O(H,"check out")}break;case"order.extend":case"extend":H=e.obj,ae=g.contact,he=y.due.format("MMM DD"),"extend"==e.action?e.friendlyText=D+" extended check-out until "+he:("contact"==e.kind&&(ae=null),e.friendlyText=D+" extended "+O(H,"check out")+(ae?" from "+N(ae.id,ae.name):"")+" until "+he);break;case"reservation.makeOrder":case"makeOrder":"makeOrder"==e.action?e.friendlyText=D+" converted reservation to "+O(e.obj,"check-out"):e.friendlyText=D+" created check-out from "+I(e.obj,"reservation");break;case"reserve":case"reservation.reserve":if(H=e.obj,ae=g.contact,"reserve"==e.action)e.friendlyText=D+" reserved equipment";else{var me="item"==e.kind?" item ":" equipment ";"contact"==e.kind&&(ae=null),e.friendlyText=D+" "+I(H,"reserved")+me+(ae?"for "+N(ae.id,ae.name):"")+E}break;case"cancel":case"reservation.cancel":H=e.obj,ae=g.contact,G=F(y?y.message:null),"cancel"==e.action?e.friendlyText=D+" cancelled reservation"+L(G):("contact"==e.kind&&(ae=null),e.friendlyText=D+" cancelled "+I(H,"reservation")+(ae?" for "+N(ae.id,ae.name):"")+E);break;case"undoReserve":case"reservation.undoReserve":H=e.obj,ae=g.contact,"undoReserve"==e.action?e.friendlyText=D+" undid reservation":("contact"==e.kind&&(ae=null),e.friendlyText=D+" undid "+I(H,"reservation")+(ae?" from "+N(ae.id,ae.name):"")+E);break;case"close":case"reservation.close":H=e.obj,G=F(y?y.message:null),ae=g.contact,"close"==e.action?e.friendlyText=D+" closed reservation"+L(G):("contact"==e.kind&&(ae=null),e.friendlyText=D+" closed "+I(H,"reservation")+(ae?" for "+N(ae.id,ae.name):"")+E);break;case"undoClose":case"reservation.undoClose":H=e.obj,ae=g.contact,"undoClose"==e.action?e.friendlyText=D+" undid close reservation":("contact"==e.kind&&(ae=null),e.friendlyText=D+" undid close "+I(H,"reservation")+(ae?" from "+N(ae.id,ae.name):"")+E);break;case"kit.addItems":case"addItems":H=e.obj;var fe=(pe=y&&y.items?y.items:[]).length;"addItems"==e.action?e.friendlyText=D+" added "+fe+" item".pluralize(-1!=pe.length):e.friendlyText=D+" added item to "+P(H,"kit");break;case"kit.removeItems":case"removeItems":H=e.obj,fe=(pe=y&&y.items?y.items:[]).length,"removeItems"==e.action?e.friendlyText=D+" removed "+fe+" item".pluralize(-1!=pe.length):e.friendlyText=D+" removed item from "+P(H,"kit");break;case"kit.duplicate":e.friendlyText=D+" created kit from duplicate";break;case"setName":var ye=F(y.name||m);e.friendlyText=D+" updated "+e.kind+" name to "+ye;break;case"addComment":case"updateComment":var ge=F(y.comment).replace(/\n/gim,"<br />");e.friendlyText=D+" wrote comment <div class='card comment-card'><div class='card-block'><span class='gu-truncate'>"+ge+"</span></div></div>";break;case"removeComment":e.friendlyText=D+" removed comment";break;case"setAllowedActions":var ve=y.allowCustody!=y.oldAllowCustody,_e=y.allowReserve!=y.oldAllowReserve,we=y.allowOrder!=y.oldAllowOrder,Ce=[],Re=[];ve&&(y.allowCustody?Ce.push("Custody"):Re.push("Custody")),_e&&(y.allowReserve?Ce.push("Reservations"):Re.push("Reservations")),we&&(y.allowOrder?Ce.push("Check-outs"):Re.push("Check-outs"));var ke=[];Ce.length>0&&ke.push("<small>Available for</small><br />"+Ce.joinAdvanced(","," and ")),Re.length>0&&ke.push("<small>Unavailable for</small><br />"+Re.joinAdvanced(","," and ")),e.friendlyText=D+" changed "+e.kind+" permission to"+U(ke);break;case"setField":case"clearField":case"renameField":var Ee=F(y.field||m),De=S(Ee)||{};switch(e.action){case"setField":var Te=F(y.value);ye=t()(Te.toString().split(" (")[0],"ddd MMM DD YYYY HH:mm:ss [GMT]ZZ",!0).isValid()?t()(Te).format("MMM DD YYYY"+("datetime"==De.editor?" [at] "+f:"")):M.render(Te),e.friendlyText=D+" set "+e.kind+" field "+L("<small class='text-muted'>"+Ee+"</small><br />"+ye);break;case"clearField":e.friendlyText=D+" cleared "+Ee+" field";break;case"renameField":e.friendlyText=D+" renamed field "+F(y.oldName)+" to "+F(y.newName)}break;case"setFields":var Se=Object.keys(y).map((function(e){var r=y[e]||"",i=S(e)||{},s=t()(r.toString().split(" (")[0],"ddd MMM DD YYYY HH:mm:ss [GMT]ZZ",!0).isValid();return{name:F(e),value:s?t()(y[e]).format("MMM DD YYYY"+("datetime"==i.editor?" [at] "+f:"")):M.render(F(y[e]))}}));e.friendlyText=D+" set "+e.kind+" field".pluralize(Se.length>1)+U(Se.map((function(e){return"<small class='text-muted'>"+e.name+"</small><br />"+e.value})));break;case"create":y.fields&&(Object.entries(y.fields).forEach((function(e){y[e[0]]=e[1]})),delete y.fields),Se=Object.keys(y).filter((function(t){return!!y[t]&&("item"!=e.kind?-1==["check-out","reservation"].indexOf(e.kind)&&("contact"==e.kind?-1==["category","user","kind"].indexOf(t):-1==["category","kind"].indexOf(t)):1!=k.length||"location"!=t)})).map((function(e){var r,i,n=F(y[e]||""),o=t()(n.toString().split(" (")[0],"ddd MMM DD YYYY HH:mm:ss [GMT]ZZ",!0).isValid(),a="",c=S(e)||{};if(o)a=t()(y[e]).format("MMM DD YYYY"+("datetime"==c.editor?" [at] "+f:""));else if("category"==e)a=F(_.getCategoryNameFromKey(y[e]).capitalize());else if("location"==e){var u=(r=n,s.find((function(e){return e._id==r}))||{});a=F(u.name||m)}else a=M.render(n);return{name:F((i=e,"residualValue"==i?"Residual value":"warrantyDate"==i?"Warranty date":i.capitalize())),value:a}})),e.friendlyText=D+" created "+e.kind+U(Se.map((function(e){return"<small class='text-muted'>"+e.name+"</small><br />"+e.value})));break;case"update":if(y.hasOwnProperty("name"))e.friendlyText=D+" updated "+e.kind+" name to "+F(y.name);else if(y.hasOwnProperty("kind")&&"importer"==y.kind)e.friendlyText=D+" updated "+e.kind+" from import";else switch(e.kind){case"item":y.hasOwnProperty("purchasePrice")?(y.field="Purchase price",y.purchasePrice&&(y.value=y.purchasePrice+" "+a.currency)):y.hasOwnProperty("warrantyDate")?(y.field="Warranty date",y.warrantyDate&&(y.value=y.warrantyDate.format("MMM DD YYYY"))):y.hasOwnProperty("purchaseDate")?(y.field="Purchase date",y.purchaseDate&&(y.value=y.purchaseDate.format("MMM DD YYYY"))):y.hasOwnProperty("brand")?(y.field="Brand",y.brand&&(y.value=y.brand)):y.hasOwnProperty("model")&&(y.field="Model",y.model&&(y.value=y.model)),y.value?e.friendlyText=D+" set "+e.kind+" field"+L("<small class='text-muted'>"+F(y.field)+"</small><br />"+F(y.value)):e.friendlyText=D+" cleared "+F(y.field)+" field";break;case"contact":y.hasOwnProperty("email")?e.friendlyText=D+" updated contact email to "+F(y.email):e.friendlyText=D+" updated contact";break;case"kit":e.friendlyText=D+" updated kit name to "+F(y.name)}break;case"duplicate":e.friendlyText=D+" duplicated item "+y.times+" times";break;case"expire":G=F(y?y.message:null),e.friendlyText=D+" expired item"+L(G);break;case"undoExpire":e.friendlyText=D+" unexpired item";break;case"setCover":e.friendlyText=D+" updated cover image";break;case"scanCode":switch(B=y.code||m,y.kind){case"qrcode":e.friendlyText=D+" scanned QR code "+B;break;case"barcode":e.friendlyText=D+" scanned barcode "+B}break;case"item.duplicate":H=e.obj,e.friendlyText=D+" created "+x("#items/"+H,"item")+" from duplicate";break;case"setCatalog":Se=Object.keys(y).map((function(e){return{name:e,value:F(y[e])}})),e.friendlyText=D+" set catalog"+U(Se.map((function(e){return"<small class='text-muted'>"+e.name+"</small><br />"+e.value})));break;case"setLabel":case"clearLabel":var be=y.labelId,Ae=function(e,t){return n[e].find((function(e){return e.id==t}))}({"cheqroom.types.order":"orderLabels","cheqroom.types.reservation":"reservationLabels","cheqroom.types.item":"itemLabels","cheqroom.types.customer":"customerLabels","cheqroom.types.kit":"kitLabels"}[r.crtype],be)||{name:y.labelName,color:y.labelColor};e.friendlyText=D+" set <span class='label-tag label-"+Ae.color.toLowerCase()+"'></span> "+F(Ae.name);break;case"spotchecks.close":H=e.obj;var Oe=y.numChecked,Ie=y.numUnchecked+y.numUnexpected,xe=y.items?y.items.checked_scanner&&y.items.checked_scanner.slice(0,2).map((function(e){return w.getTextImage("","S")})).concat(y.numChecked>2?w.getTextImage("+"+(y.numChecked-2),"S"):[]):[],Ne=y.items&&y.items.unchecked?y.items.unchecked:[],Pe=y.items&&y.items.unexpected?y.items.unexpected:[],Ue=Ne.concat(Pe).slice(0,2).map((function(e){return w.getTextImage("","S")})).concat(Ie>2?w.getTextImage("+"+(Ie-2),"S"):[]);if("item"==e.kind)e.friendlyText=D+" scanned item in a <a href='#spotchecks/"+H+"' class='spotcheck'>spotcheck</a>";else{var Me=function(e){var t=[];return e.forEach((function(e){var r={_id:e.item_id};e.cover_id&&(r.cover=e.cover_id),e.cover_id_url&&(r.cover_url=e.cover_id_url);for(var i=0;i<e.count;i++)t.push(r)})),t.slice(0,2).map((function(e){return"<img class='item-image' src='"+A(e,"S")+"' />"})).concat(t.length>2?"<img class='item-image' src='"+w.getTextImage("+"+(t.length-2),"S")+"' />":"").join("")};u("spotchecks").call(H,"getThumbnails").then((function(e){e.checked&&$("#checkedImg_"+H).html(Me(e.checked));var t=e.unchecked.concat(e.unexpected);t.length>0&&$("#issuesImg_"+H).html(Me(t))})),e.friendlyText=D+" finished a <a href='#spotchecks/"+H+"' class='spotcheck'>spotcheck</a> <ul class='list-group field-group spotcheck' data-id='"+H+"'><li class='list-group-item'>"+(Oe?"<div class='media legend-item'><div class='media-left'><span class='legend-color success'></span></div><div class='media-body'><div class='item-images' id='checkedImg_"+H+"'>"+xe.map((function(e){return"<img class='item-image' src='"+e+"' />"})).join("")+"</div><div>Checked</div><div class='text-muted'>"+Oe+" "+"item".pluralize(Oe)+"</div></div></div>":"")+(Ie?"<div class='media legend-item'><div class='media-left'><span class='legend-color warning'></span></div><div class='media-body'><div class='item-images' id='issuesImg_"+H+"'>"+Ue.map((function(e){return"<img class='item-image' src='"+e+"' />"})).join("")+"</div><div>Issues</div><div class='text-muted'>"+Ie+" "+"item".pluralize(Ie)+"</div></div></div>":"")+"</li></ul>"}break;case"changeLocation":var Fe=F(y.name||m);e.friendlyText=D+" updated location to "+Fe;break;case"updateGeo":var Le=F(y.address||m).split(",").map((function(e){return e.trim()}));e.friendlyText=D+" updated geo position to "+L("<address>"+Le.map((function(e){return"<span>"+e+"</span>"})).join("")+"</address>");break;case"changeKind":e.friendlyText=D+" changed kind to "+y.kind}return e};var L=U,j={getFriendlySpotcheckCss:function(e){switch((e=e||{}).status){case"open":return"status-progress";case"closed":return e.numUnexpected||e.numUnchecked?"status-exclamation":"status-success";case"cancelled":return"status-cancelled";default:return""}},getFriendlySpotcheckStatus:function(e){switch((e=e||{}).status){case"open":return"In progress";case"closed":return e.numUnexpected||e.numUnchecked?"Finished with issues ("+(e.numUnexpected+e.numUnchecked)+")":"Finished";case"cancelled":return"Cancelled";default:return""}},getSpotcheckProgressMessage:function(e){if("open"===e.status)return e.numUnchecked?e.numUnchecked+" item".pluralize(e.numUnchecked)+" left to scan":"<i class='fa fa-check-circle color-green'></i> All "+e.numChecked+" item".pluralize(e.numChecked)+" have been scanned";if(e.numUnchecked+e.numUnexpected){if(0===e.numChecked)return"<i class='fa fa-exclamation-circle color-orange'></i> No items scanned";var t="<i class='fa fa-exclamation-circle color-orange'></i> ",r=[];return e.numUnchecked&&r.push(e.numUnchecked+" unscanned "+"issue".pluralize(e.numUnchecked)),e.numUnexpected&&r.push(e.numUnexpected+" scanned "+"exception".pluralize(e.numUnexpected)+" issue".pluralize(e.numUnexpected)),t+r.joinAdvanced(", "," and ")}return"<i class='fa fa-check-circle color-green'></i> All "+e.numChecked+" item".pluralize(e.numChecked)+" scanned"},getSpotcheckMessages:function(e){var t=[];return"open"===e.status&&t.push({kind:"progress",spotcheck:e,priority:0,message:j.getSpotcheckProgressMessage(e)}),Promise.resolve().then((function(){return t.sort((function(e,t){return e.priority-t.priority}))}))}},B=j,V=Object.assign({},p,m,f,v,{getFriendlyConflictKind:function(e){switch(e){case"location":return"At wrong location";case"order":return"Checked out";case"reservation":return"Already reserved";case"expired":return"Item is expired";case"in_custody":case"custody":return"Item is in custody";case"not_allowed_reservation":return"Item cannot be reserved";case"not_allowed_order":return"Item cannot be checked out";case"flag":return"Item is flagged";default:return""}}},_,w,R,k,o,b,O,I,{templateIsArchived:function(e){return!(null==e.archived)},templateCanDelete:function(e){return!e.system},templateCanActivate:function(e){return"inactive"==e.status&&null==e.archived},templateCanDeactivate:function(e){return"active"==e.status&&null==e.archived},templateCanArchive:function(e){return null==e.archived},templateCanUndoArchive:function(e){return null!=e.archived},getFriendlyTemplateStatus:function(e){switch(e){case"inactive":return"Inactive";case"active":return"Active";case"archived":return"Archived";default:return"Unknown"}},getFriendlyTemplateCss:function(e){switch(e){case"inactive":return"label-inactive";case"active":return"label-active";case"archived":return"label-archived";default:return""}},getFriendlyTemplateSize:function(e,t,r){if(0==e||0==t)return"";if("inch"==r&&(8.5==e&&11==t||11==e&&8.5==t))return"US Letter";if("inch"==r&&(11==e&&17==t||17==e&&11==t))return"US Tabloid";if("mm"==r&&(210==e&&297==t||297==e&&210==t))return"A4";if("cm"==r&&(21==e&&29.7==t||29.7==e&&21==t))return"A4";var i="inch"==r?'"':r;return e+i+" x "+t+i},getPageSizes:function(){return[{id:"letter",name:"US Letter",width:8.5,height:11,unit:"inch",layout:"portrait",px:{width:816,height:1056}},{id:"a4",name:"A4",width:210,height:297,unit:"mm",layout:"portrait",px:{width:793,height:1122}},{id:"tabloid",name:"US Tabloid",width:11,height:17,unit:"inch",layout:"portrait",px:{width:1056,height:1632}},{id:"label4x6",name:'4" x 6" Shipping Label',width:4,height:6,unit:"inch",layout:"portrait",px:{width:384,height:576}}]},getPageSize:function(e,t,r){var i=this.getPageSizes(),s=null;return(s=i.find((function(i){return i.unit==e&&i.width==t&&i.height==r})))?s:(s=i.find((function(i){return i.unit==e&&i.width==r&&i.height==t})))?(s.layout="landscape",s):null}},x,P,L,B),W={id:null,name:"",color:"Gold",readonly:!1,selected:!1,default:!1},H=function(e){e=e||{},this.raw=Object.assign({},W,e),this.id=e.id||W.id,this.name=e.name||W.name,this.color=e.color||W.color,this.readonly=e.readonly||W.readonly,this.selected=e.selected||W.selected,this.default=e.default||W.default};H.prototype.isDirty=function(){return this.raw.name!=this.name||this.raw.color!=this.color},H.prototype.isValid=function(){return this.name&&this.name.length>0},H.prototype._fromJson=function(e){return this.id=e.id||W.id,this.name=e.name||W.name,this.color=e.color||W.color,this.selected=e.selected||W.selected,this.readonly=e.readonly||W.readonly,this.default=e.default||W.default,Promise.resolve()},H.prototype._toJson=function(){return{id:this.id,name:this.name,color:this.color,selected:this.selected,readonly:this.readonly,default:this.default}};var J=H,q={id:""},z=function(e){this.raw=null,this.id=e.id||q.id,this.ds=e.ds,this._fields=e._fields};z.prototype.reset=function(){return this._fromJson(this._getDefaults(),null)},z.prototype.existsInDb=function(){return null!=this.id&&this.id.length>0},z.prototype.isEmpty=function(){return!0},z.prototype.isDirty=function(){return!1},z.prototype.isValid=function(){return!0},z.prototype.discardChanges=function(){return this.raw?this._fromJson(this.raw,null):this.reset()},z.prototype.reload=function(e){if(this.existsInDb())return this.get(e);throw new h.ApiError("Cannot reload document, id is empty or null")},z.prototype.get=function(e){if(this.existsInDb()){var t=this;return this.ds.get(this.id,e||this._fields).then((function(e){return t._fromJson(e)}))}throw new h.ApiError("Cannot get document, id is empty or null")},z.prototype.create=function(e){if(this.existsInDb())throw new Error("Cannot create document, already exists in database");if(!this.isValid())throw new Error("Cannot create, invalid document");return this._create(e)},z.prototype.update=function(e){if(!this.existsInDb())throw new Error("Cannot update document without id");if(this.isEmpty())throw new Error("Cannot update to empty document");if(!this.isValid())throw new Error("Cannot update, invalid document");return this._update(e)},z.prototype.delete=function(){if(this.existsInDb())return this._delete();throw new Error("Document does not exist")},z.prototype._getDefaults=function(){return q},z.prototype._toJson=function(e){return{id:this.id}},z.prototype._fromJson=function(e,t){return this.raw=e,this.id=e._id||q.id,Promise.resolve(e)},z.prototype._create=function(e){var t=this,r=this._toJson();return delete r.id,this.ds.create(r,this._fields).then((function(r){return 1==e?r:t._fromJson(r)}))},z.prototype._update=function(e){var t=this,r=this._toJson();return delete r.id,this.ds.update(this.id,r,this._fields).then((function(r){return 1==e?r:t._fromJson(r)}))},z.prototype._delete=function(){var e=this;return this.ds.delete(this.id).then((function(){return e.reset()}))},z.prototype._isDirtyProperty=function(e){return!!this.raw&&this[e]!=this.raw[e]},z.prototype._isDirtyStringProperty=function(e){return!!this.raw&&!(this[e]==this.raw[e]||""==this[e]&&null==this.raw[e])},z.prototype._isDirtyMomentProperty=function(e){if(this.raw){var t=this[e],r=this.raw[e];return!(null==t&&null==r||t&&r&&t.isSame(r))}return!1},z.prototype._getId=function(e,t){return"string"==typeof e?e:e[t||"_id"]},z.prototype._getIds=function(e,t){return e.map((function(e){return"string"==typeof e?e:e[t||"_id"]}))},z.prototype._doApiCall=function(e){var t=this;return this.ds.call(1==e.collectionCall?null:e.pk||this.id,e.method,e.params,e._fields||this._fields,e.timeOut,e.usePost).then((function(r){return 1==e.skipRead?r:t._fromJson(r).done((function(e){return e}))}))},z.prototype._doApiLongCall=function(e){return e.timeOut=e.timeOut||6e4,this._doApiCall(e)},z.prototype._getColorLabel=function(e,t){var r=Object.assign({},t||{},e);return new J(r)};var K=z,G={id:"",planning:"",item:"",from:null,to:null,order:"",reservation:""},Y=function(){};Y.prototype=K.prototype;var Z=function(e){var t=Object.assign({},e);K.call(this,t),this.planning=t.planning||G.planning,this.item=t.item||G.item,this.from=t.from||G.from,this.to=t.to||G.to,this.order=t.order||G.order,this.reservation=t.reservation||G.reservation};(Z.prototype=new Y).constructor=Z,Z.prototype._getDefaults=function(){return G},Z.prototype.isEmpty=function(){return!1},Z.prototype.canDelete=function(){return Promise.resolve(!1)},Z.prototype._toJson=function(e){var t=K.prototype._toJson.call(this,e);return t.planning=this.planning,t.item=this.item,t.fromDate=this.from,t.toDate=this.to,t.order=this.order,t.reservation=this.reservation,t},Z.prototype._fromJson=function(e,t){var r=this;return K.prototype._fromJson.call(this,e,t).then((function(){return r.planning=e.planning||G.planning,r.item=e.item||G.item,r.from=e.fromDate||G.from,r.to=e.toDate||G.to,r.order=e.order||G.order,r.reservation=e.reservation||G.reservation,e}))};var X=Z,Q=["jpg","jpeg","png","gif","pdf"],ee={fileName:"",fileSize:0,isCover:!1,canBeCover:!0,value_url:null},te=function(e){e=e||{},this.ds=e.ds,this.raw=null,this.fileName=e.fileName||ee.fileName,this.fileSize=e.fileSize||ee.fileSize,this.value=e.value||ee.value,this.value_url=e.value_url||ee.value_url,this.created=e.created||ee.created,this.by=e.by||ee.by,this.isCover=null!=e.isCover?e.isCover:ee.isCover,this.canBeCover=null!=e.canBeCover?e.canBeCover:ee.canBeCover,this.forKind=e.forKind};te.prototype.getThumbnailUrl=function(e){return this.hasPreview()?this.helper.getImageUrl(this.ds,this.value,e||"S"):""},te.prototype.getDownloadUrl=function(){return this.ds.getBaseUrl(!0)+this.value+"?download=True"},te.prototype.getExt=function(e){return R.getExt(e||this.fileName)},te.prototype.getFriendlyFileSize=function(){var e=this.fileSize;return isNaN(e)&&(e=0),e<1024?e+" Bytes":(e/=1024)<1024?e.toFixed(2)+" Kb":(e/=1024)<1024?e.toFixed(2)+" Mb":(e/=1024)<1024?e.toFixed(2)+" Gb":(e/=1024).toFixed(2)+" Tb"},te.prototype.isImage=function(){return R.isImage(this.fileName)},te.prototype.hasPreview=function(){var e=this.getExt(this.fileName);return Q.includes(e)},te.prototype._toJson=function(e){return{fileName:this.fileName,fileSize:this.fileSize,value:this.value,created:this.created,by:this.by}},te.prototype._fromJson=function(e,t){return this.raw=e,this.fileName=e.fileName||ee.fileName,this.fileSize=e.fileSize||ee.fileSize,this.value=e.value||ee.value,this.value_url=e.value_url||ee.value_url,this.created=e.created||ee.created,this.by=e.by||ee.by,Promise.resolve(e)};var re=te,ie=function(e){e=e||{},this.ds=e.ds,this.raw=null,this.id=e.id||"",this.value=e.value||null,this.created=e.created||null,this.modified=e.modified||null,this.by=e.by||null,this.fromReservation=e.fromReservation||!1};ie.prototype._toJson=function(e){return{id:this.id,value:this.value,created:this.created,modified:this.modified,by:this.by}},ie.prototype._fromJson=function(e,t){return this.raw=e,this.id=e.id||"",this.value=e.value||null,this.created=e.created||null,this.modified=e.modified||null,this.by=e.by||null,Promise.resolve(e)};var se=ie,ne={name:null,value:null,required:!1,unit:"",kind:"string",form:!1,editor:null,description:"",select:[]},oe=function(e){e=e||{},this.raw=e,this.name=e.name||ne.name,this.value=e.value||ne.value,this.required=e.required||ne.required,this.unit=e.unit||ne.unit,this.kind=e.kind||ne.kind,this.form=e.form||ne.form,this.editor=e.editor||ne.editor,this.description=e.description||ne.description,this.select=e.select||ne.select};oe.prototype.isValid=function(e){var t=this.value.trim();if(!this.required&&""==t)return!0;switch(this.kind){case"float":case"decimal":case"currency":return k.isNumeric(t);case"int":return k.isNumeric(t,!0);case"date":case"datetime":return k.isValidDate(t);case"string":case"select":return"phone"==this.editor?k.isValidPhone(t):"email"==this.editor?k.isValidEmail(t):"url"==this.editor?k.isValidURL(t):"number"==this.editor?k.isNumeric(t):""!=t;default:return!0}},oe.prototype.isDirty=function(){return this.raw.value!=this.value},oe.prototype.isEmpty=function(){return""==this.value.trim()};var ae=oe,ce={id:"",modified:null,cover:null,cover_url:null,flag:null,label:null,fields:{},comments:[],attachments:[],barcodes:[]},ue=function(){};ue.prototype=K.prototype;var le=function(e){var t=Object.assign({},e);K.call(this,t),this.dsAttachments=t.dsAttachments,this.crtype=t.crtype,this.modified=t.modified||ce.modified,this.flag=t.flag||ce.flag,this.fields=t.fields||Object.assign({},ce.fields),this.comments=t.comments||ce.comments.slice(),this.attachments=t.attachments||ce.attachments.slice(),this.cover=t.cover||ce.cover,this.cover_url=t.cover_url||ce.cover_url,this.barcodes=t.barcodes||ce.barcodes.slice(),this.label=t.label||ce.label};(le.prototype=new ue).constructor=le,le.prototype._getDefaults=function(){return ce},le.prototype.isEmpty=function(){return!(this.flag!=ce.flag||null!=this.fields&&0!=Object.keys(this.fields).length||null!=this.comments&&0!=this.comments.length||null!=this.attachments&&0!=this.attachments.length)},le.prototype.isDirty=function(){return this._isDirtyFlag()||this._isDirtyFields()},le.prototype.canDelete=function(){return this.existsInDb()?this.ds.call(this.id,"canDelete"):Promise.resolve({result:!1,message:""})},le.prototype.addComment=function(e,t){return this._doApiCall({method:"addComment",params:{comment:e},skipRead:t})},le.prototype.updateComment=function(e,t,r){return this._doApiCall({method:"updateComment",params:{commentId:e,comment:t},skipRead:r})},le.prototype.deleteComment=function(e,t){return this._doApiCall({method:"removeComment",params:{commentId:e},skipRead:t})},le.prototype.setFields=function(e,t){var r=this,i={};return e.forEach((function(t,s){r.raw.fields[s]!=e[s]&&(i[s]=t)})),this._doApiCall({method:"setFields",params:i,skipRead:t,usePost:!0})},le.prototype.setField=function(e,t,r){return t?this._doApiCall({method:"setField",params:{field:e,value:t},skipRead:r}):this.clearField(e,r)},le.prototype.clearField=function(e,t){return this._doApiCall({method:"clearField",params:{field:e},skipRead:t})},le.prototype.addBarcode=function(e,t){return this._doApiCall({method:"addBarcode",params:{barcode:e},skipRead:t})},le.prototype.removeBarcode=function(e,t){return this._doApiCall({method:"removeBarcode",params:{barcode:e},skipRead:t})},le.prototype.getImageUrl=function(e,t,r,i){var s=r||this.cover;return null!=s&&s.length>0?this.helper.getImageCDNUrl(t,s,e):this.helper.getImageUrl(this.ds,this.id,e,i)},le.prototype.setCover=function(e,t){return this._doApiCall({method:"setCover",params:{attachmentId:e._id},skipRead:t})},le.prototype.clearCover=function(e){return this._doApiCall({method:"clearCover",params:{},skipRead:e})},le.prototype.attach=function(e,t){if(this.existsInDb())return this._doApiCall({method:"attach",params:{attachments:[e]},skipRead:t});throw new h.ApiError("Cannot attach attachment, id is empty or null")},le.prototype.detach=function(e,t){if(this.existsInDb())return this._doApiCall({method:"detach",params:{attachments:[e]},skipRead:t});throw new h.ApiError("Cannot detach attachment, id is empty or null")},le.prototype.setFlag=function(e,t,r,i){return this._doApiCall({method:"setFlag",params:{flag:e,message:t,attachments:r},skipRead:i})},le.prototype.clearFlag=function(e,t,r){return this._doApiCall({method:"clearFlag",params:{message:e,attachments:t},skipRead:r})},le.prototype.setLabel=function(e,t){return this._doApiCall({method:"setLabel",params:{labelId:e},skipRead:t})},le.prototype.clearLabel=function(e){return this._doApiCall({method:"clearLabel",params:{},skipRead:e})},le.prototype.getSortedFields=function(e,t,r){var i=[],s=null,n=null;e=(e=e.slice()).filter((function(e){return 1!=t||e.form}));for(var o=0;o<e.length;o++)s=e[o],n=this.fields[s.name]||"",(null==r||r>i.length)&&i.push(this._getField(Object.assign({value:n},s)));return i},le.prototype.setSortedFields=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];i.isEmpty()?t?this.fields[i.name]=null:delete this.fields[i.name]:this.fields[i.name]=i.value}},le.prototype.validateSortedFields=function(e){for(var t=0;t<e.length;t++)if(!e[t].isValid())return!1;return!0},le.prototype.updateFields=function(){return this._updateFields()},le.prototype._isDirtyFlag=function(){return!!this.raw&&this.flag!=this.raw.flag},le.prototype._isDirtyFields=function(){return!!this.raw&&!V.areEqual(this.fields,this.raw.fields)},le.prototype._updateFields=function(){var e=[];if(this.raw)for(var t in this.fields)this.fields[t]!=this.raw.fields[t]&&e.push(this.setField(t,this.fields[t],!0));return e.length>0?Promise.all(e):Promise.resolve(this)},le.prototype._toJson=function(e){return K.prototype._toJson.call(this,e)},le.prototype._fromJson=function(e,t){var r=this;return K.prototype._fromJson.call(this,e,t).then((function(){return r.flag=e.flag||ce.flag,r.fields=null!=e.fields?Object.assign({},e.fields):Object.assign({},ce.fields),r.modified=e.modified||ce.modified,r.barcodes=e.barcodes||ce.barcodes,r.label=e.label||ce.label,r.cover_url=e.cover_url||ce.cover_url,r.cover=e.cover||ce.cover,r._fromCommentsJson(e,t).then((function(){return r._fromAttachmentsJson(e,t)}))}))},le.prototype._toJsonFields=function(e){var t={};if(this.fields)for(var r in this.fields)t["fields__"+r]=this.fields[r];return t},le.prototype._fromCommentsJson=function(e,t){var r=null,i=this;return this.comments=ce.comments.slice(),e.comments&&e.comments.length>0&&e.comments.forEach((function(e){(r=i._getComment(e,t))&&i.comments.push(r)})),Promise.resolve(e)},le.prototype._fromAttachmentsJson=function(e,t){var r=null,i=this;return this.attachments=ce.attachments.slice(),e.attachments&&e.attachments.length>0&&e.attachments.forEach((function(e){(r=i._getAttachment(e,Object.assign(t,{forKind:i.crtype})))&&i.attachments.push(r)})),Promise.resolve(e)},le.prototype._getComment=function(e,t){var r=Object.assign({ds:this.ds},t||{},e);return new se(r)},le.prototype._getAttachment=function(e,t){var r=Object.assign({ds:this.ds},t||{},e);return new re(r)},le.prototype._getField=function(e,t){var r=Object.assign({},t||{},e);return new ae(r)};var de=le,he={id:"",name:"",count:0,defs:[],parent:"",modified:null},pe=function(){};pe.prototype=K.prototype;var me=function(e){var t=Object.assign({},e);K.call(this,t),this.name=t.name||he.name,this.count=t.count||he.count,this.defs=t.defs||he.defs.slice(),this.parent=t.parent||he.parent,this.modified=t.modified||he.modified};(me.prototype=new pe).constructor=me,me.prototype.isValidName=function(){if(this.name=this.name.trim(),this.name.length>=3){var e=this.name.latinise().replace(/[`~!@#$%^&*()_|+\-=?;:'",.<\{\}\[\]\\\/]/gi,"");return this.name==e}return!1},me.prototype.isValid=function(){return this.isValidName()},me.prototype._getDefaults=function(){return he},me.prototype.isEmpty=function(){return K.prototype.isEmpty.call(this)&&this.name==he.name},me.prototype.isDirty=function(){var e=K.prototype.isDirty.call(this);return!e&&this.raw&&(e=this.name!=this.raw.name),e},me.prototype.canDelete=function(){return this.ds.call(this.id,"canDeleteCategory",{omitFields:!0})},me.prototype.canChangeName=function(e){return this.ds.call(this.id,"canChangeName",{name:e})},me.prototype.changeName=function(e){return this._doApiCall({pk:this.id,method:"changeName",params:{name:e}})},me.prototype.canChangeParent=function(e){return this.ds.call(this.id,"canChangeParent",{parent:e,omitFields:!0})},me.prototype.changeParent=function(e){return this._doApiCall({pk:this.id,method:"changeParent",params:{parent:e,omitFields:!0}})},me.prototype._toJson=function(e){var t=K.prototype._toJson.call(this,e);return t.name=this.name,t},me.prototype._fromJson=function(e,t){var r=this;return K.prototype._fromJson.call(this,e,t).then((function(){return r.name=e.name||he.name,r.count=e.count||he.count,r.defs=e.defs||he.defs.slice(),r.parent=e.parent||he.parent,r.modified=e.modified||he.modified,e}))};var fe=me,ye=function(e){this.ds=e.ds,this._fields=e._fields,this.raw=null,this.kind=e.kind||"",this.doc=e.doc||"",this.item=e.item||"",this.itemName=e.itemName||"",this.locationCurrent=e.locationCurrent||"",this.locationDesired=e.locationDesired||"",this.fromDate=e.fromDate||null,this.toDate=e.toDate||null};ye.prototype._toJson=function(e){return{kind:this.kind,doc:this.doc,item:this.item,itemName:this.itemName,locationCurrent:this.locationCurrent,locationDesired:this.locationDesired,fromDate:this.fromDate,toDate:this.toDate}},ye.prototype._fromJson=function(e,t){return this.raw=e,this.kind=e.kind||"",this.item=e.item||"",this.itemName=e.itemName||"",this.fromDate=e.fromDate||null,this.toDate=e.toDate||null,Promise.resolve(e)};var ge=ye,ve={name:"",email:"",group:"",picture:"",role:"user",active:!0,isOwner:!1,archived:null},_e=function(){};_e.prototype=de.prototype;var we=function(e){var t=Object.assign({_fields:["*","group","picture"]},e);de.call(this,t),this.helper=t.helper,this.name=t.name||ve.name,this.picture=t.picture||ve.picture,this.email=t.email||ve.email,this.role=t.role||ve.role,this.group=t.group||ve.group,this.active=null!=t.active?t.active:ve.active,this.isOwner=null!=t.isOwner?t.isOwner:ve.isOwner,this.archived=t.archived||ve.archived,this.dsAnonymous=t.dsAnonymous};(we.prototype=new _e).constructor=we,we.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=4},we.prototype.isValidEmail=function(){return this.email=this.email.trim(),V.isValidEmail(this.email)},we.prototype.emailExists=function(){return this.isValidEmail()?null!=this.id&&this.email==this.raw.email?Promise.resolve(!1):this.dsAnonymous.call("emailExists",{email:this.email}).then((function(e){return e.result})):Promise.resolve(!1)},we.prototype.isValidPassword=function(){return this.password=this.password.trim(),V.isValidPassword(this.password)},we.prototype.isValid=function(){return this.isValidName()&&this.isValidEmail()},we.prototype.isEmpty=function(){return de.prototype.isEmpty.call(this)&&this.name==ve.name&&this.email==ve.email&&this.role==ve.role},we.prototype._isDirtyInfo=function(){if(this.raw){var e=this.raw.name||ve.name,t=this.raw.email||ve.email,r=null!=this.raw.active?this.raw.active:ve.active;return this.name!=e||this.email!=t||this.active!=r}return!1},we.prototype._isDirtyRole=function(){if(this.raw){var e=this.raw.role||ve.role;return this.role!=e}return!1},we.prototype.isDirty=function(){return de.prototype.isDirty.call(this)||this._isDirtyInfo()||this._isDirtyRole()},we.prototype.getImageUrl=function(e,t){return null!=this.picture&&this.picture.length>0?this.helper.getImageCDNUrl(this.group,this.picture,e,t):this.helper.getImageUrl(this.ds,this.id,e,t)},we.prototype._getDefaults=function(){return ve},we.prototype.addKeyValue=function(e,t,r,i){throw new Error("Not implemented for User, use setPicture instead?")},we.prototype.addKeyValue=function(e,t,r,i,s){throw new Error("Not implemented for User, use setPicture instead?")},we.prototype.removeKeyValue=function(e,t){throw new Error("Not implemented for User, use clearPicture instead?")},we.prototype.setPicture=function(e,t){if(!this.existsInDb())throw new Error("User does not exist in database");return this.picture=e,this._doApiCall({method:"setPicture",params:{attachment:e},skipRead:t})},we.prototype.clearPicture=function(e){if(!this.existsInDb())throw new Error("User does not exist in database");return this._doApiCall({method:"clearPicture",skipRead:e})},we.prototype.canActivate=function(){return!this.active&&null==this.archived},we.prototype.canDeactivate=function(){return this.active&&null==this.archived&&!this.isOwner},we.prototype.canArchive=function(){return null==this.archived&&!this.isOwner},we.prototype.canUndoArchive=function(){return null!=this.archived},we.prototype.canBeOwner=function(){return null==this.archived&&this.active&&!this.isOwner&&"admin"==this.role},we.prototype.activate=function(e){if(!this.existsInDb())throw new Error("User does not exist in database");return this._doApiCall({method:"activate",skipRead:e})},we.prototype.deactivate=function(e){if(!this.existsInDb())throw new Error("User does not exist in database");return this._doApiCall({method:"deactivate",skipRead:e})},we.prototype.archive=function(e){if(!this.existsInDb())throw new Error("User does not exist in database");return this._doApiCall({method:"archive",skipRead:e})},we.prototype.undoArchive=function(e){if(!this.existsInDb())throw new Error("User does not exist in database");return this._doApiCall({method:"undoArchive",skipRead:e})},we.prototype.update=function(e){if(this.isEmpty())throw new Error("Cannot update to empty user");if(!this.existsInDb())throw new Error("Cannot update user without id");if(!this.isValid())throw new Error("Cannot update, invalid user");var t,r;if(this._isDirtyInfo()){var i=this._toJson();delete i.id,t=this.ds.update(this.id,i,this._fields)}else t=Promise.resolve();return r=this._isDirtyRole()?this._doApiCall({method:"updateUserRole",params:{role:this.role},skipRead:!0}):Promise.resolve(),Promise.all(t,r)},we.prototype._toJson=function(e){var t=de.prototype._toJson.call(this,e);return t.name=this.name||ve.name,t.email=this.email||ve.email,t},we.prototype._fromJson=function(e,t){var r=this;return de.prototype._fromJson.call(this,e,t).then((function(){return r.group=e.group&&null!=e.group._id?e.group._id:e.group||ve.group,r.name=e.name||ve.name,r.picture=e.picture||ve.picture,r.email=e.email||ve.email,r.role=e.role||ve.role,r.active=null!=e.active?e.active:ve.active,r.isOwner=null!=e.isOwner?e.isOwner:ve.isOwner,r.archived=e.archived||ve.archived,e}))};var Ce=we;function Re(e){return e=e,{getSettings:function(){return e},getImageUrl:function(e,t,r,i){var s=e.getBaseUrl(!0)+t+"?mimeType=image/jpeg";return r&&"orig"!=r&&(s+="&size="+r),i&&(s+="&_bust="+(new Date).getTime()),s},getICalUrl:function(e,t,r,i,s,n,o,a){i=i||[],s=s||[],a=a||[];var c=new URL("".concat(e,"/ical/").concat(t,"/").concat(r,"/public/").concat(a&&a.length>0?"items":"locations","/call/ical"));o&&c.searchParams.append("locations[]",o),n&&c.searchParams.append("customer",n),a.length>0&&a.forEach((function(e){return c.searchParams.append("items[]",e)}));var u=s.filter((function(e){return e.selected})).map((function(e){return e.id||""}));0==u.length?c.searchParams.append("skipOpenReservations",!0):u.length!=s.length&&u.forEach((function(e){return c.searchParams.append("rlab[]",e)}));var l=i.filter((function(e){return e.selected})).map((function(e){return e.id||""}));return 0==l.length?c.searchParams.append("skipOpenOrder",!0):l.length!=i.length&&l.forEach((function(e){return c.searchParams.append("olab[]",l)})),c.toString()},getQRCodeUrl:function(t,r){return V.getQRCodeUrl(e.qrCodeUtilsApi,t,r)},getBarcodeUrl:function(t,r,i){return V.getBarcodeUrl(e.barcodeUtilsApi,t,r,i)},getNumItemsLeft:function(e,t){var r=this.getStat(t,"items","status");return e.maxItems-this.getStat(t,"items","total")+r.expired},getNumUsersLeft:function(e,t){var r=this.getStat(t,"users","status");return e.maxUsers-r.active},getStat:function(e,t,r,i,s){if(void 0===(e=(e=e||{})[i&&"null"!=i?i:"all"]||e.all))throw"Invalid stats";var n=(e=e[s||"production"])[t];if(!n)return{};if(!r)return n;var o=n[r];return void 0===o?{}:o},ensureValue:function(e,t){return"string"==typeof e?e:e&&e.hasOwnProperty(t)?e[t]:e},ensureId:function(e){return e&&e.hasOwnProperty("id")?this.ensureValue(e,"id"):this.ensureValue(e,"_id")}}}var ke={name:"",email:"",status:"active",user:{},kind:"contact",cover:"",blocked:null},Ee=function(){};Ee.prototype=de.prototype;var De=function(e){var t=Object.assign({_fields:["*"],crtype:"cheqroom.types.customer"},e);de.call(this,t),this.helper=t.helper||new Re,this.name=t.name||ke.name,this.email=t.email||ke.email,this.status=t.status||ke.status,this.user=t.user||ke.user,this.kind=t.kind||ke.kind,this.cover=t.cover||ke.cover,this.blocked=t.blocked||ke.blocked};(De.prototype=new Ee).constructor=De,De.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=3},De.prototype.isValidEmail=function(){return this.email=this.email.trim(),V.isValidEmail(this.email)},De.prototype.getUserId=function(){return this.helper.ensureId(this.user)},De.prototype.getUserSync=function(){return null!=this.user&&null!=this.user.sync?this.user.sync:""},De.prototype.canReserve=function(){return V.contactCanReserve(this)},De.prototype.canCheckout=function(){return V.contactCanCheckout(this)},De.prototype.canGenerateDocument=function(){return V.contactCanGenerateDocument(this)},De.prototype.canArchive=function(){return V.contactCanArchive(this)},De.prototype.canUndoArchive=function(){return V.contactCanUndoArchive(this)},De.prototype.canBlock=function(){return V.contactCanBlock(this)},De.prototype.canUndoBlock=function(){return V.contactCanUndoBlock(this)},De.prototype.canDelete=function(){return V.contactCanDelete(this)},De.prototype.changeKind=function(e,t){return this._doApiCall({method:"changeKind",params:{kind:e},skipRead:t})},De.prototype.archive=function(e){return this._doApiCall({method:"archive",params:{},skipRead:e})},De.prototype.undoArchive=function(e){return this._doApiCall({method:"undoArchive",params:{},skipRead:e})},De.prototype.block=function(e,t){return this._doApiCall({method:"block",params:{message:e},skipRead:t})},De.prototype.undoBlock=function(e,t){return this._doApiCall({method:"undoBlock",params:{message:e},skipRead:t})},De.prototype.generateDocument=function(e,t,r){return this._doApiLongCall({method:"generateDocument",params:{template:e,signature:t},skipRead:r})},De.prototype.isValid=function(){return this.isValidName()&&this.isValidEmail()},De.prototype.isEmpty=function(){return de.prototype.isEmpty.call(this)&&this.name==ke.name&&this.email==ke.email},De.prototype.isDirty=function(){var e=de.prototype.isDirty.call(this);return!e&&this.raw&&(e=this._isDirtyStringProperty("name")||this._isDirtyStringProperty("email")||this._isDirtyStringProperty("kind")),e},De.prototype._getDefaults=function(){return ke},De.prototype._toJson=function(e){var t=de.prototype._toJson.call(this,e);return t.name=this.name||ke.name,t.email=this.email||ke.email,t.kind=this.kind||ke.kind,t},De.prototype._fromJson=function(e,t){var r=this;return de.prototype._fromJson.call(this,e,t).then((function(e){r.name=e.name||ke.name,r.email=e.email||ke.email,r.status=e.status||ke.status,r.user=e.user||ke.user,r.kind=e.kind||ke.kind,r.blocked=e.blocked||ke.blocked;var t=e.cover||ke.cover;return r.cover=V.isImage(t)?t:"",e}))},De.prototype._create=function(e){var t=this,r=Object.assign({},this._toJson(),this._toJsonFields());return delete r.id,this.ds.create(r,this._fields).then((function(r){return 1==e?r:t._fromJson(r)}))},De.prototype._update=function(e){var t,r=this,i={};return this._isDirtyStringProperty("name")&&(i.name=r.name),this._isDirtyStringProperty("email")&&(i.email=r.email),t=this._isDirtyStringProperty("kind")?this.changeKind(r.kind,!0):Promise.resolve(),this.ds.update(this.id,i,this._fields).then((function(i){return t.then((function(){return 1==e?i:r._fromJson(i)}))}))};var Te=De;t().fn.toJSONDate=function(){return this.format("YYYY-MM-DD[T]HH:mm:ss.000[Z]")},t().fn.roundTo=function(e,r,i){e=t().normalizeUnits(e),r=r||1;var s=function(e){switch(i){case"up":e=Math.ceil(e/r);break;case"down":e=Math.floor(e/r);break;default:e=Math.round(e/r)}return e*r};switch(e){case"year":this.year(s(this.year()));break;case"month":this.month(s(this.month()));break;case"week":this.weekday(s(this.weekday()));break;case"isoWeek":this.isoWeekday(s(this.isoWeekday()));break;case"day":this.day(s(this.day()));break;case"hour":this.hour(s(this.hour()));break;case"minute":this.minute(s(this.minute()));break;case"second":this.second(s(this.second()));break;default:this.millisecond(s(this.millisecond()))}return this};var Se=function(e){e=e||{},this.roundType=e.roundType||"nearest",this.roundMinutes=e.roundMinutes||15,this.timeFormat24=!!e.timeFormat24&&e.timeFormat24,this._momentFormat=this.timeFormat24?"MMM D [at] H:mm":"MMM D [at] h:mm a",this.startOfDayHours=null!=e.startOfDayHours?startOfDayHours:9,this.endOfDayHours=null!=e.endOfDayHours?endOfDayHours:17,this.businessHours=e.businessHours||[],this.weekStart=e.weekStart||1};Se.prototype.parseDate=function(e){if(("string"==typeof e||e instanceof String)&&e.endsWith("+00:00")){var r=e.length;if(25==r)return t()(e.substring(0,r-6));if(32==r)return t()(e.substring(0,r-6).split(".")[0])}},Se.prototype.getNow=function(){return t()()},Se.prototype.getFriendlyDuration=function(e){return e.humanize()},Se.prototype.getFriendlyDateParts=function(e,r,i){return t().isMoment(e)||(e=t()(e)),r=r||this.getNow(),e.calendar().replace("AM","am").replace("PM","pm").split(" at ")},Se.prototype.getDateRanges=function(e,r,s,n){s&&!t().isMoment(s)&&(s=t()(s)),n=n||{year:"year",years:"years",month:"month",months:"months",week:"week",weeks:"weeks",day:"day",days:"days",hour:"hour",hours:"hours"};for(var o=["years","months","weeks","days","hours"],a=[8760,720,168,24,1],c=null,u=null,l=null,d=0,h=-1,p=[],m=0;m<o.length;m++)if(c=o[m],e>=(u=a[m])&&e%u==0){h=m;break}if(s=s||this.getNow(),h>=0)for(m=1;m<=r;m++)l=n[1==(d=m*e)?c.replace("s",""):c],p.push({option:c,hours:d,title:d/a[h]+" "+l,from:s.clone(),to:s.clone().add(d,"hours")});return p.filter((function(e){return i.g.dateHelper.isValidBusinessDate(e.to)}))},Se.prototype.getFriendlyFromTo=function(e,r,i,s,n,o){t().isMoment(e)||(e=t()(e)),t().isMoment(r)||(r=t()(r)),s=s||this.getNow();var a=n||" - ",c=this.getFriendlyDateParts(e,s,o),u=this.getFriendlyDateParts(r,s,o),l={dayDiff:e?e.clone().startOf("day").diff(r,"days"):-1,fromDate:e?c[0]:"No from date set",fromTime:i&&null!=e?c[1]:"",toDate:r?u[0]:"No to date set",toTime:i&&null!=r?u[1]:""};return l.fromText=l.fromDate,l.toText=l.toDate,i&&(l.fromTime&&(l.fromText+=" "+l.fromTime),l.toTime&&(l.toText+=" "+l.toTime)),0==l.dayDiff?l.text=i?l.fromText+a+l.toText:l.fromText:l.text=l.fromText+a+l.toText,l},Se.prototype.getFriendlyFromToOld=function(e,r,i){var s=this.roundFromTime(e,i),n=this.roundToTime(r,i);return{from:s,to:n,daysBetween:n.clone().startOf("day").diff(s.clone().startOf("day"),"days"),duration:t().duration(s-n).humanize(),fromText:s.calendar().replace(" at "," "),toText:n.calendar().replace(" at "," ")}},Se.prototype.makeStartDate=function(e,r,i,s,n,o){if(r=null==r||r,i=null!=i&&i,o=o||t()(),r&&!i)e=this.roundTimeFrom(e);else{var a=e.isSame(o,"day"),c=this._makeStartOfBusinessDay(e);e=a?e.isBefore(c)?c:this.roundTimeFrom(e):c}return s&&e.isBefore(s)?s:e},Se.prototype.makeEndDate=function(e,r,i,s,n,o){if(r=null==r||r,i=null!=i&&i,o=o||t()(),r&&!i)e=this.roundTimeTo(e);else{var a=e.isSame(o,"day"),c=this._makeEndOfBusinessDay(e),u=this._makeEndOfDay(e);e=a?e.isBefore(c)?c:u:e.isAfter(c)?u:c}return n&&e.isAfter(n)?n:e},Se.prototype.getFriendlyDateText=function(e,t,r,i){if(null==e)return"Not set";var s=this.getFriendlyDateParts(e,r,i);return t?s.join(" "):s[0]},Se.prototype.addAverageDuration=function(e){return e.clone().add(1,"day")},Se.prototype.roundTimeFrom=function(e){return this.roundMinutes<=1?e:this.roundTime(e,this.roundMinutes,this._typeToDirection(this.roundType,"from"))},Se.prototype.roundTimeTo=function(e){return this.roundMinutes<=1?e:this.roundTime(e,this.roundMinutes,this._typeToDirection(this.roundType,"to"))},Se.prototype.roundTime=function(e,r,i){var s=t().isMoment(e)?e:t()(e);return s.seconds(0).milliseconds(0),s.roundTo("minute",r||15,i)},Se.prototype.roundTimeUp=function(e,r){var i=t().isMoment(e)?e:t()(e);return i.seconds(0).milliseconds(0),i.roundTo("minute",r||15,"up")},Se.prototype.roundTimeDown=function(e,r){var i=t().isMoment(e)?e:t()(e);return i.seconds(0).milliseconds(0),i.roundTo("minute",r||15,"down")},Se.prototype._typeToDirection=function(e,t){switch(e){case"longer":switch(t){case"from":return"down";case"to":return"up"}break;case"shorter":switch(t){case"from":return"up";case"to":return"down"}}},Se.prototype.isValidBusinessDate=function(e){var r=!1;return this.businessHours.length>0?this._getBusinessHours(e).forEach((function(i){var s=t()(t().utc(t().duration(i.openTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),n=t()(t().utc(t().duration(i.closeTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),o=t()(e.clone().format("H:mm"),"H:mm");if(r=o.isBetween(s,n)||o.isSame(s)||o.isSame(n))return!1})):r=!0,r},Se.prototype.getValidBusinessDate=function(e){var t=this.getNow(),r=0;for(e.isBefore(t)&&e.date(t.date());!this.isValidBusinessDate(e)||r>=10080;)e=e.add(this.roundMinutes,"minutes"),r+=this.roundMinutes;return e},Se.prototype._getBusinessHours=function(e){var t=this.businessHours;return t.length>0?t.filter((function(t){return t.isoWeekday==e.isoWeekday()})):[]},Se.prototype._makeStartOfBusinessDay=function(e){var r=e.clone().hour(this.startOfDayHours).minutes(0).seconds(0).milliseconds(0);if(this.businessHours.length>0){var i=this._getBusinessHours(e);if(i.length>0){var s=t()(t().utc(t().duration(i[0].openTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm");r.hour(s.hour()).minute(s.minute())}}return this.getValidBusinessDate(r)},Se.prototype._makeEndOfBusinessDay=function(e){var r=e.clone().hour(this.endOfDayHours).minutes(0).seconds(0).milliseconds(0);if(this.businessHours.length>0){var i=this._getBusinessHours(e).sort((function(e,t){return e.closeTime<t.closeTime}));if(i.length>0){var s=t()(t().utc(t().duration(i[0].closeTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm");r.hour(s.hour()).minute(s.minute())}}return this.getValidBusinessDate(r)},Se.prototype._makeEndOfDay=function(e){return e.clone().hours(23).minutes(45).seconds(0).milliseconds(0)};var be=Se,Ae={id:"",name:"",itemFlags:[],kitFlags:[],customerFlags:[],orderFlags:[],reservationFlags:[],itemFields:[],kitFields:[],customerFields:[],orderFields:[],reservationFields:[],itemLabels:[],kitLabels:[],customerLabels:[],reservationLabels:[],orderLabels:[],businessHours:[],cancelled:null,calendarTemplate:"{{number}}: {{name_or_summary}} - {{contact.name}}"},Oe=function(){};Oe.prototype=K.prototype;var Ie=function(e){var t=Object.assign({},e);K.call(this,t),this.name=t.name||Ae.name,this.itemFlags=this.getFlags(t.itemFlags||Ae.itemFlags.slice()),this.kitFlags=this.getFlags(t.kitFlags||Ae.kitFlags.slice()),this.customerFlags=this.getFlags(t.customerFlags||Ae.customerFlags.slice()),this.orderFlags=this.getFlags(t.orderFlags||Ae.orderFlags.slice()),this.reservationFlags=this.getFlags(t.reservationFlags||Ae.reservationFlags.slice()),this.itemFields=t.itemFields||Ae.itemFields.slice(),this.kitFields=t.kitFields||Ae.kitFields.slice(),this.customerFields=t.customerFields||Ae.customerFields.slice(),this.reservationFields=t.reservationFields||Ae.reservationFields.slice(),this.orderFields=t.orderFields||Ae.orderFields.slice(),this.itemLabels=t.itemLabels||Ae.itemLabels.slice(),this.kitLabels=t.kitLabels||Ae.kitLabels.slice(),this.customerLabels=t.customerLabels||Ae.customerLabels.slice(),this.reservationLabels=t.reservationLabels||Ae.reservationLabels.slice(),this.orderLabels=t.orderLabels||Ae.orderLabels.slice(),this.businessHours=t.businessHours||Ae.businessHours.slice(),this.calendarTemplate=t.calendarTemplate||Ae.calendarTemplate};(Ie.prototype=new Oe).constructor=Ie,Ie.prototype.updateName=function(e){return this._doApiCall({pk:this.id,method:"updateName",location:e})},Ie.prototype.getStats=function(e){return this._doApiCall({pk:this.id,method:"getStats",location:e})},Ie.prototype.updateFlags=function(e,t,r){return this._doApiCall({pk:this.id,method:"updateFlags",collection:e,flags:t,skipRead:r})},Ie.prototype.createField=function(e,t,r,i,s,n,o,a,c,u,l){var d={collection:e,name:t,kind:r,required:i,form:s,unit:n,editor:o,description:a,search:u};return c&&c.length>0&&(d.select=c),this._doApiCall({pk:this.id,method:"createField",skipRead:l,params:d})},Ie.prototype.updateField=function(e,t,r,i,s,n,o,a,c,u,l){var d={collection:e,name:t,required:i,form:s,unit:n,editor:o,description:a,search:u};return c&&c.length>0&&(d.select=c),t!=r&&(d.newName=r),this._doApiCall({pk:this.id,method:"updateField",skipRead:l,params:d})},Ie.prototype.deleteField=function(e,t,r){return this._doApiCall({pk:this.id,method:"deleteField",skipRead:r,params:{collection:e,name:t}})},Ie.prototype.moveField=function(e,t,r,i){return this._doApiCall({pk:this.id,method:"moveField",skipRead:i,params:{collection:e,oldPos:t,newPos:r}})},Ie.prototype.createLabel=function(e,t,r,i,s){return this._doApiCall({pk:this.id,method:"createLabel",skipRead:s,params:{collection:e,labelColor:t,labelName:r,labelDefault:i}})},Ie.prototype.updateLabel=function(e,t,r,i,s,n){return this._doApiCall({pk:this.id,method:"updateLabel",skipRead:n,params:{collection:e,labelId:t,labelColor:r,labelName:i,labelDefault:s}})},Ie.prototype.deleteLabel=function(e,t,r){return this._doApiCall({pk:this.id,method:"deleteLabel",skipRead:r,params:{collection:e,labelId:t}})},Ie.prototype.buyProduct=function(e,t,r){return this._doApiCall({pk:this.id,method:"buyProduct",skipRead:!0,params:{productId:e,quantity:t,shipping:r}})},Ie.prototype.buyProducts=function(e,t,r){return this._doApiCall({pk:this.id,method:"buyProducts",skipRead:!0,params:{products:e,shipping:t,coupon:r}})},Ie.prototype.addTags=function(e){return this._doApiCall({pk:this.id,method:"addTags",skipRead:!0,params:{tags:e}})},Ie.prototype.removeTags=function(e){return this._doApiCall({pk:this.id,method:"removeTags",skipRead:!0,params:{tags:e}})},Ie.prototype.getFieldsForCollection=function(e,t){var r=[];switch(e){case"items":r=this.itemFields;break;case"kits":r=this.kitFields;break;case"contacts":case"customers":r=this.customerFields;break;case"reservations":r=this.reservationFields;break;case"checkouts":case"orders":r=this.orderFields}return null!=t&&(r=r.find((function(e){return e.form==t}))),r},Ie.prototype.getFlagsForCollection=function(e){switch(e){case"items":return this.getFlags(this.itemFlags);case"kits":return this.getFlags(this.kitFlags);case"contacts":case"customers":return this.getFlags(this.customerFlags);case"reservations":return this.getFlags(this.reservationFlags);case"checkouts":case"orders":return this.getFlags(this.orderFlags);default:return this.getFlags([])}},Ie.prototype.getFlags=function(e){return e.map((function(e){return"string"==typeof e&&(e={_id:e,name:e}),e._id||(e._id=e.id),e}))},Ie.prototype.getBusinessDays=function(){return this.businessHours.map((function(e){return e.isoWeekday}))},Ie.prototype.getBusinessHoursForIsoWeekday=function(e){return this.businessHours.filter((function(t){return t.isoWeekday==e}))},Ie.prototype.setBusinessHours=function(e,t){return e=(e=e||[]).slice().map((function(e){var t=Object.assign({},e);return t.dayOfWeek=e.isoWeekday-1,delete t.isoWeekday,t})),this._doApiCall({method:"setBusinessHours",params:{businessHours:e,_fields:this._fields},skipRead:t,usePost:!0})},Ie.prototype.getDefaultBusinessHours=function(){return[{isoWeekday:1,openTime:540,closeTime:1020},{isoWeekday:2,openTime:540,closeTime:1020},{isoWeekday:3,openTime:540,closeTime:1020},{isoWeekday:4,openTime:540,closeTime:1020},{isoWeekday:5,openTime:540,closeTime:1020}]},Ie.prototype.setCalendarTemplate=function(e,t){return this._doApiCall({method:"setCalendarTemplate",params:{template:e,kind:t},skipRead:!0,usePost:!0})},Ie.prototype.clearCalendarTemplate=function(){return this._doApiCall({method:"clearCalendarTemplate",skipRead:!0})},Ie.prototype.getCalendarTemplatePreview=function(e,t){return this._doApiCall({method:"getCalendarTemplatePreview",params:{template:e,kind:t},skipRead:!0,usePost:!0})},Ie.prototype.getDefaultCalendarTemplate=function(){return Ae.calendarTemplate},Ie.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=3},Ie.prototype._toJson=function(e){var t=K.prototype._toJson.call(this,e);return t.name=this.name,t},Ie.prototype._fromJson=function(e,t){var r=this;return K.prototype._fromJson.call(this,e,t).then((function(){return r.name=e.name||Ae.name,r.itemFlags=r.getFlags(e.itemFlags||Ae.itemFlags.slice()),r.kitFlags=r.getFlags(e.kitFlags||Ae.kitFlags.slice()),r.customerFlags=r.getFlags(e.customerFlags||Ae.customerFlags.slice()),r.orderFlags=r.getFlags(e.orderFlags||Ae.orderFlags.slice()),r.reservationFlags=r.getFlags(e.reservationFlags||Ae.reservationFlags.slice()),r.itemFields=e.itemFields||Ae.itemFields.slice(),r.kitFields=e.kitFields||Ae.kitFields.slice(),r.customerFields=e.customerFields||Ae.customerFields.slice(),r.reservationFields=e.reservationFields||Ae.reservationFields.slice(),r.orderFields=e.orderFields||Ae.orderFields.slice(),r.cancelled=e.cancelled||Ae.cancelled,r.businessHours=e.businessHours||Ae.businessHours.slice(),r.calendarTemplate=e.calendarTemplate||Ae.calendarTemplate,r._fromColorLabelsJson(e,t).then((function(e){return r._fromBusinessHoursJson(e,t)}))}))},Ie.prototype._fromBusinessHoursJson=function(e,t){return e.businessHours=e.businessHours.map((function(e){return e.isoWeekday||(e.isoWeekday=e.dayOfWeek+1),delete e.dayOfWeek,e})),Promise.resolve(e)},Ie.prototype._fromColorLabelsJson=function(e,t){var r=null,i=this;return["itemLabels","kitLabels","customerLabels","reservationLabels","orderLabels"].forEach((function(s){i[s]=Ae[s].slice(),"orderLabels"==s&&i[s].push(i._getColorLabel({readonly:!0,default:!e[s].some((function(e){return!0===e.default})),name:"Unlabeled",color:"SlateGray"},t)),"reservationLabels"==s&&i[s].push(i._getColorLabel({readonly:!0,default:!e[s].some((function(e){return!0===e.default})),name:"Unlabeled",color:"LimeGreen"},t)),e[s]&&e[s].length>0&&e[s].forEach((function(e){(r=i._getColorLabel(e,t))&&i[s].push(r)}))})),Promise.resolve(e)};var xe=Ie;function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}var Pe={name:"",status:"",codes:[],brand:"",model:"",warrantyDate:null,purchaseDate:null,purchasePrice:null,residualValue:0,location:"",category:"",geo:[0,0],address:"",order:null,kit:null,custody:null,cover:"",catalog:null,canReserve:"available",canOrder:"available",canCustody:"available",allowReserve:!0,allowOrder:!0,allowCustody:!0,flagged:null,expired:null},Ue=function(){};Ue.prototype=de.prototype;var Me=function(e){var t=Object.assign({_fields:["*"],crtype:"cheqroom.types.item"},e);de.call(this,t),this.name=t.name||Pe.name,this.status=t.status||Pe.status,this.brand=t.brand||Pe.brand,this.model=t.model||Pe.model,this.warrantyDate=t.warrantyDate||Pe.warrantyDate,this.purchaseDate=t.purchaseDate||Pe.purchaseDate,this.purchasePrice=t.purchasePrice||Pe.purchasePrice,this.residualValue=t.residualValue||Pe.residualValue,this.codes=t.codes||Pe.codes,this.location=t.location||Pe.location,this.category=t.category||Pe.category,this.geo=t.geo||Pe.geo.slice(),this.address=t.address||Pe.address,this.order=t.order||Pe.order,this.kit=t.kit||Pe.kit,this.custody=t.custody||Pe.custody,this.cover=t.cover||Pe.cover,this.catalog=t.catalog||Pe.catalog,this.allowReserve=void 0!==t.allowReserve?t.allowReserve:Pe.allowReserve,this.allowCheckout=void 0!==t.allowOrder?t.allowOrder:Pe.allowOrder,this.allowCustody=void 0!==t.allowCustody?t.allowCustody:Pe.allowCustody,this._canReserve=void 0!==t.canReserve?t.canReserve:Pe.canReserve,this._canCheckout=void 0!==t.canOrder?t.canOrder:Pe.canOrder,this._canCustody=void 0!==t.canCustody?t.canCustody:Pe.canCustody};(Me.prototype=new Ue).constructor=Me,Me.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=3},Me.prototype.isValidCategory=function(){return this.category.trim().length>0},Me.prototype.isValidLocation=function(){return this.location.trim().length>0},Me.prototype.isValid=function(){return this.isValidName()&&this.isValidCategory()&&("in_custody"==this.status||this.isValidLocation())},Me.prototype.isEmpty=function(){return de.prototype.isEmpty.call(this)&&this.name==Pe.name&&this.status==Pe.status&&this.brand==Pe.brand&&this.model==Pe.model&&this.warrantyDate==Pe.warrantyDate&&this.purchaseDate==Pe.purchaseDate&&this.purchasePrice==Pe.purchasePrice&&this.residualValue==Pe.residualValue&&0==this.codes.length&&this.location==Pe.location&&this.category==Pe.category},Me.prototype.isDirty=function(){return de.prototype.isDirty.call(this)||this._isDirtyName()||this._isDirtyBrand()||this._isDirtyModel()||this._isDirtyWarrantyDate()||this._isDirtyPurchaseDate()||this._isDirtyPurchasePrice()||this._isDirtyResidualValue()||this._isDirtyCategory()||this._isDirtyLocation()||this._isDirtyGeo()||this._isDirtyFlag()||this._isDirtyPermissions()},Me.prototype._getDefaults=function(){return Pe},Me.prototype._toJson=function(e){var t=de.prototype._toJson.call(this,e);for(var r in t.name=this.name||Pe.name,t.brand=this.brand||Pe.brand,t.model=this.model||Pe.model,t.warrantyDate=this.warrantyDate||Pe.warrantyDate,t.purchaseDate=this.purchaseDate||Pe.purchaseDate,t.purchasePrice=this.purchasePrice||Pe.purchasePrice,t.residualValue=this.residualValue||Pe.residualValue,t.category=this.category||Pe.category,t.location=this.location||Pe.location,t.catalog=this.catalog||Pe.catalog,t)null==t[r]&&delete t[r];return t},Me.prototype._fromJson=function(e,t){var r=this;return void 0===e.allowOrder&&(e.allowOrder=Pe.allowOrder),void 0===e.allowReserve&&(e.allowReserve=Pe.allowReserve),void 0===e.allowCustody&&(e.allowCustody=Pe.allowCustody),de.prototype._fromJson.call(this,e,t).then((function(){r.name=e.name||Pe.name,r.status=e.status||Pe.status,r.brand=e.brand||Pe.brand,r.model=e.model||Pe.model,r.warrantyDate=e.warrantyDate||Pe.warrantyDate,r.purchaseDate=e.purchaseDate||Pe.purchaseDate,r.purchasePrice=e.purchasePrice||Pe.purchasePrice,r.residualValue=e.residualValue||Pe.residualValue,r.codes=e.codes||Pe.codes,r.address=e.address||Pe.address,r.geo=e.geo||Pe.geo.slice(),r.cover=e.cover||Pe.cover,r.catalog=e.catalog||Pe.catalog,r.flagged=e.flagged||Pe.flagged,r.expired=e.expired||Pe.expired;var t=Pe.location;e.location&&(t=e.location._id?e.location._id:e.location),r.location=t;var i=Pe.category;e.category&&(i=e.category._id?e.category._id:e.category),r.category=i;var s=Pe.order;e.order&&(s=e.order._id?e.order._id:e.order),r.order=s;var n=Pe.kit;e.kit&&(n=e.kit._id?e.kit._id:e.kit),r.kit=n;var o=Pe.custody;return e.custody&&(o=e.custody._id?e.custody._id:e.custody),r.custody=o,r._canReserve=void 0!==e.canReserve?e.canReserve:Pe.canReserve,r._canOrder=void 0!==e.canOrder?e.canOrder:Pe.canOrder,r._canCustody=void 0!==e.canCustody?e.canCustody:Pe.canCustody,r.allowReserve=void 0!==e.allowReserve?e.allowReserve:Pe.allowReserve,r.allowCheckout=void 0!==e.allowOrder?e.allowOrder:Pe.allowOrder,r.allowCustody=void 0!==e.allowCustody?e.allowCustody:Pe.allowCustody,e}))},Me.prototype._toJsonKeyValues=function(){var e={};return null!=this.keyValues&&this.keyValues.length>0&&this.keyValues.forEach((function(t){var r="keyValues__"+t.key;e[r+"__kind"]=t.kind,e[r+"__value"]=t.value})),e},Me.prototype._isDirtyName=function(){return this._isDirtyStringProperty("name")},Me.prototype._isDirtyBrand=function(){return this._isDirtyStringProperty("brand")},Me.prototype._isDirtyModel=function(){return this._isDirtyStringProperty("model")},Me.prototype._isDirtyWarrantyDate=function(){return this._isDirtyMomentProperty("warrantyDate")},Me.prototype._isDirtyPurchaseDate=function(){return this._isDirtyMomentProperty("purchaseDate")},Me.prototype._isDirtyPurchasePrice=function(){return this._isDirtyProperty("purchasePrice")},Me.prototype._isDirtyResidualValue=function(){return this._isDirtyProperty("residualValue")},Me.prototype._isDirtyLocation=function(){if(this.raw){var e=Pe.location;return this.raw.location&&(e=this.raw.location._id?this.raw.location._id:this.raw.location),this.location!=e}return!1},Me.prototype._isDirtyCategory=function(){if(this.raw){var e=Pe.category;return this.raw.category&&(e=this.raw.category._id?this.raw.category._id:this.raw.category),this.category!=e}return!1},Me.prototype._isDirtyPermissions=function(){if(this.raw){var e=this.raw.allowReserve,t=this.raw.allowOrder,r=this.raw.allowCustody;return this.allowReserve!=e||this.allowCheckout!=t||this.allowCustody!=r}return!1},Me.prototype._isDirtyGeo=function(){if(this.raw){var e=this.raw.address||Pe.address,t=this.raw.geo||Pe.geo.slice();return this.address!=e||this.geo[0]!=t[0]||this.geo[1]!=t[1]}return!1},Me.prototype._isDirtyFlag=function(){return!!this.raw&&this.raw.flag!=this.flag},Me.prototype.getAvailabilities=function(e,t){return this.ds.call(this.id,"getAvailability",{fromDate:e,toDate:t})},Me.prototype.update=function(e){if(this.isEmpty())throw new Error("Cannot update to empty document");if(!this.existsInDb())throw new Error("Cannot update document without id");if(!this.isValid())throw new Error("Cannot update, invalid document");var t,r,i,s,n,o=this;return this._isDirtyCategory()?this.canChangeCategory(this.category).done((function(e){t=e.result?Promise.resolve():Promise.reject(new Error("Unable to change item category"))})):t=Promise.resolve(),t.then((function(){return r=o._isDirtyCategory()?o.changeCategory(o.category):Promise.resolve(),i=o._isDirtyLocation()?o.changeLocation(o.location):Promise.resolve(),s=o._isDirtyFields()?o._updateFields():Promise.resolve(),n=o._isDirtyName()||o._isDirtyBrand()||o._isDirtyModel()||o._isDirtyWarrantyDate()||o._isDirtyPurchaseDate()||o._isDirtyPurchasePrice()||o._isDirtyResidualValue()?o.updateBasicFields(o.name,o.brand,o.model,o.warrantyDate,o.purchaseDate,o.purchasePrice,o.residualValue):Promise.resolve(),o._isDirtyPermissions()?o.updateAllowedActions(o.allowReserve,o.allowCheckout,o.allowCustody):Promise.resolve(),Promise.all(r,i,s,n)}))},Me.prototype.create=function(e){if(this.existsInDb())throw new Error("Cannot create document, already exists in database");if(this.isEmpty())throw new Error("Cannot create empty document");if(!this.isValid())throw new Error("Cannot create, invalid document");var t=this,r=Object.assign(this._toJson(),this._toJsonFields());return delete r.id,this.ds.create(r,this._fields).then((function(r){return 1==e?r:t._fromJson(r)}))},Me.prototype.createMultiple=function(e,t,r,i){if(this.existsInDb())throw new Error("Cannot create document, already exists in database");if(this.isEmpty())throw new Error("Cannot create empty document");if(!this.isValid())throw new Error("Cannot create, invalid document");var s=this,n=Object.assign(this._toJson(),this._toJsonFields(),{times:e||1,autoNumber:t||!1,startFrom:r});return delete n.id,null!=n.model&&(n.brandModel=n.model,delete n.model),this._doApiCall({method:"createMultiple",params:n}).then((function(e){return(1==i?Promise.resolve(e[0]):s._fromJson(e[0])).then((function(){return e}))}))},Me.prototype.duplicate=function(e,t,r,i){return this._doApiCall({method:"duplicate",params:{times:e,location:t,autoNumber:r,startFrom:i},skipRead:!0})},Me.prototype.canGoToCheckout=function(){return V.itemCanGoToCheckout(this)&&!n(this.order)},Me.prototype.canCheckin=function(){return V.itemCanCheckin(this)},Me.prototype.canExpire=function(){return V.itemCanExpire(this)},Me.prototype.canUndoExpire=function(){return V.itemCanUndoExpire(this)},Me.prototype.canDelete=function(){return de.prototype.canDelete.call(this)&&V.itemCanDelete(this)},Me.prototype.expire=function(e,t){return this._doApiCall({method:"expire",params:{message:e||""},skipRead:t})},Me.prototype.undoExpire=function(e){return this._doApiCall({method:"undoExpire",skipRead:e})},Me.prototype.changeLocation=function(e,t){return this._doApiCall({method:"changeLocation",params:{location:e},skipRead:t})},Me.prototype.addCode=function(e,t){return this._doApiCall({method:"addCodes",params:{codes:[e]},skipRead:t})},Me.prototype.removeCode=function(e,t){return this._doApiCall({method:"removeCodes",params:{codes:[e]},skipRead:t})},Me.prototype.updateGeo=function(e,t,r,i){return this._doApiCall({method:"updateGeo",params:{lat:e,lng:t,address:r},skipRead:i})},Me.prototype.getLastNumber=function(){return this.ds.call(null,"getLastItemNumber",{name:this.name})},Me.prototype.updateBasicFields=function(e,t,r,i,s,n,o,a){var c=this,u={};return null!=e&&e!=this.raw.name&&(u.name=e),null!=t&&t!=this.raw.brand&&(u.brand=t),null!=r&&r!=this.raw.model&&(u.model=r),null!=i&&("object"===Ne(i)&&i.isValid()?i.isSame(this.raw.warrantyDate)||(u.warrantyDate=i):u.warrantyDate=""),null!=s&&("object"===Ne(s)&&s.isValid()?s.isSame(this.raw.purchaseDate)||(u.purchaseDate=s):u.purchaseDate=""),null!=n&&n!=this.raw.purchasePrice&&(u.purchasePrice=n),null!=o&&o!=this.raw.residualValue&&(u.residualValue=o),this.ds.update(this.id,u,this._fields).then((function(e){return 1==a?e:c._fromJson(e)}))},Me.prototype.canChangeCategory=function(e){return this._doApiCall({collectionCall:!0,method:"canChangeCategory",params:{pks:[this.id],category:e},skipRead:!0,_fields:"*"})},Me.prototype.changeCategory=function(e,t){var r=this;return this._doApiCall({collectionCall:!0,method:"changeCategory",params:{pks:[this.id],category:e},skipRead:!0}).then((function(e){return 1==t?e:r._fromJson(e[0])}))},Me.prototype.updateAllowedActions=function(e,t,r,i){return this._doApiCall({method:"setAllowedActions",params:{reserve:e,order:t,custody:r},skipRead:i})},Me.prototype.canReserve=function(){return V.itemCanReserve(this.raw)},Me.prototype.canCheckout=function(){return V.itemCanCheckout(this.raw)},Me.prototype.canTakeCustody=function(){return V.itemCanTakeCustody(this.raw)},Me.prototype.canReleaseCustody=function(){return V.itemCanReleaseCustody(this.raw)},Me.prototype.canTransferCustody=function(){return V.itemCanTransferCustody(this.raw)},Me.prototype.takeCustody=function(e,t){return this._doApiCall({method:"takeCustody",params:{customer:e},skipRead:t})},Me.prototype.releaseCustody=function(e,t){return this._doApiCall({method:"releaseCustody",params:{location:e},skipRead:t})},Me.prototype.transferCustody=function(e,t){return this._doApiCall({method:"transferCustody",params:{customer:e},skipRead:t})},Me.prototype.getDepreciation=function(e){return this.ds.call(this.id,"getDepreciation",{frequency:e||"quarterly"})};var Fe=Me,Le={name:"",description:"",items:[],itemSummary:"",status:"unknown",cover:"",canReserve:"available",canOrder:"available",canCustody:"available",allowReserve:!0,allowOrder:!0,allowCustody:!0},je=function(){};je.prototype=de.prototype;var Be=function(e){var t=Object.assign({_fields:["*"],crtype:"cheqroom.types.kit"},e);de.call(this,t),this.name=t.name||Le.name,this.description=t.description||Le.description,this.items=t.items||Le.items.slice(),this.itemSummary=t.itemSummary||Le.itemSummary,this.codes=[],this.conflicts=[],this.status=t.status||Le.status,this.cover=t.cover||Le.cover,this.allowReserve=void 0!==t.allowReserve?t.allowReserve:Le.allowReserve,this.allowCheckout=void 0!==t.allowOrder?t.allowOrder:Le.allowOrder,this.allowCustody=void 0!==t.allowCustody?t.allowCustody:Le.allowCustody,this._canReserve=void 0!==t.canReserve?t.canReserve:Le.canReserve,this._canOrder=void 0!==t.canOrder?t.canOrder:Le.canOrder,this._canCustody=void 0!==t.canCustody?t.canCustody:Le.canCustody};(Be.prototype=new je).constructor=Be,Be.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=3},Be.prototype.isNameAvailableAsync=function(){return null!=this.id&&null!=this.raw&&this.name==this.raw.name?Promise.resolve(!0):(this._dfdNameAvailable&&this._dfdNameAvailable.abort(),this._dfdNameAvailable=this.ds.search({name:this.name.trim()},"_id"),this._dfdNameAvailable.then((function(e){return 0==e.count}),(function(e){return!1})))},Be.prototype.isValid=function(){return this.isValidName()},Be.prototype.isEmpty=function(){return de.prototype.isEmpty.call(this)&&this.name==Le.name},Be.prototype.isDirtyItems=function(){var e=function(e){return(e=e||[]).map((function(e){return e._id})).sort().join(",")},t=this.raw||{};return e(this.items)!=e(t.items)},Be.prototype.isDirty=function(){var e=de.prototype.isDirty.call(this);return!e&&this.raw&&(e=this._isDirtyStringProperty("name")),e||this.isDirtyItems()},Be.prototype.canCheckout=function(){return V.kitCanCheckout(this.raw)},Be.prototype.canReserve=function(){return V.kitCanReserve(this.raw)},Be.prototype.addItems=function(e,t){if(!this.existsInDb())throw new Error("Cannot addItems from document without id");return this._doApiCall({method:"addItems",params:{items:e},skipRead:t})},Be.prototype.removeItems=function(e,t){if(!this.existsInDb())throw new Error("Cannot removeItems from document without id");return this._doApiCall({method:"removeItems",params:{items:e},skipRead:t})},Be.prototype.moveItem=function(e,t,r){if(!this.existsInDb())throw new Error("Cannot moveItem from document without id");return this._doApiCall({method:"moveItem",params:{item:e,toPos:t},skipRead:r})},Be.prototype.addCode=function(e,t){return this._doApiCall({method:"addCodes",params:{codes:[e]},skipRead:t})},Be.prototype.removeCode=function(e,t){return this._doApiCall({method:"removeCodes",params:{codes:[e]},skipRead:t})},Be.prototype.duplicate=function(e,t,r){return this._doApiCall({method:"duplicate",params:{times:e,location:t},skipRead:r||!0})},Be.prototype.canTakeCustody=function(){return V.kitCanTakeCustody(this.raw)},Be.prototype.canReleaseCustody=function(){return V.kitCanReleaseCustody(this.raw)},Be.prototype.canTransferCustody=function(){return V.kitCanTransferCustody(this.raw)},Be.prototype.takeCustody=function(e,t){return this._doApiCall({method:"takeCustody",params:{customer:e},skipRead:t})},Be.prototype.releaseCustody=function(e,t){return this._doApiCall({method:"releaseCustody",params:{location:e},skipRead:t})},Be.prototype.transferCustody=function(e,t){return this._doApiCall({method:"transferCustody",params:{customer:e},skipRead:t})},Be.prototype._getDefaults=function(){return Le},Be.prototype._toJson=function(e){var t=de.prototype._toJson.call(this,e);return t.name=this.name||Le.name,t.description=this.description||Le.description,t},Be.prototype._fromJson=function(e,t){var r=this;return de.prototype._fromJson.call(this,e,t).then((function(e){return r.name=e.name||Le.name,r.description=e.description||Le.description,r.items=e.items||Le.items.slice(),r.itemSummary=e.itemSummary||Le.itemSummary,r.codes=e.codes||[],r.status=e.status||Le.status,r.cover=e.cover||Le.cover,r._canReserve=void 0!==e.canReserve?e.canReserve:Le.canReserve,r._canOrder=void 0!==e.canOrder?e.canOrder:Le.canOrder,r._canCustody=void 0!==e.canCustody?e.canCustody:Le.canCustody,r.allowReserve=void 0!==e.allowReserve?e.allowReserve:Le.allowReserve,r.allowCheckout=void 0!==e.allowOrder?e.allowOrder:Le.allowOrder,r.allowCustody=void 0!==e.allowCustody?e.allowCustody:Le.allowCustody,r._loadConflicts(r.items),e}))},Be.prototype.create=function(e){if(this.existsInDb())throw new Error("Cannot create document, already exists in database");var t=this,r={name:this.name,items:this._getIds(this.items)};return Object.assign(r,this._toJsonFields()),delete r.id,this.ds.create(r,this._fields).then((function(r){return 1==e?r:t._fromJson(r)}))},Be.prototype._loadConflicts=function(e){var t=[];"incomplete"==V.getKitStatus(e)&&e.forEach((function(e){switch(e.status){case"await_checkout":t.push({kind:"status",item:e._id,itemName:e.name,itemStatus:e.status,order:e.order});break;case"checkedout":t.push({kind:"order",item:e._id,itemName:e.name,itemStatus:e.status,order:e.order});break;case"expired":t.push({kind:"status",item:e._id,itemName:e.name,itemStatus:e.status});break;case"in_custody":t.push({kind:"custody",item:e._id,itemName:e.name,itemStatus:e.status})}})),this.conflicts=t};var Ve=Be,We={name:"",address:""},He=function(){};He.prototype=de.prototype;var Je=function(e){var t=Object.assign({_fields:["*"]},e);de.call(this,t),this.name=t.name||We.name,this.address=t.address||We.address};(Je.prototype=new He).constructor=Je,Je.prototype.isEmpty=function(){return de.prototype.isEmpty.call(this)&&this.name==We.name&&this.address==We.address},Je.prototype.isDirty=function(){var e=de.prototype.isDirty.call(this);if(!e&&this.raw){var t=this.raw.name||We.name,r=this.raw.address||We.address;return this.name!=t||this.address!=r}return e},Je.prototype._getDefaults=function(){return We},Je.prototype._toJson=function(e){var t=de.prototype._toJson.call(this,e);return t.name=this.name||We.name,t.address=this.address||We.address,t},Je.prototype._fromJson=function(e,t){var r=this;return de.prototype._fromJson.call(this,e,t).then((function(){return r.name=e.name||We.name,r.address=e.address||We.address,e}))};var qe=Je,ze={status:"creating",from:null,to:null,due:null,contact:null,location:null,number:"",items:[],conflicts:[],by:null,archived:null,modified:null,itemSummary:null,name:null},Ke=function(){};Ke.prototype=de.prototype;var Ge=function(e){var t=Object.assign({},e);de.call(this,t),this.dsItems=t.dsItems,this.autoCleanup=null!=t.autoCleanup&&t.autoCleanup,this.dateHelper=t.dateHelper||new be,this.helper=t.helper||new Re,this.unavailableFlagHelper=t.unavailableFlagHelper||function(e){return!1},this.status=t.status||ze.status,this.from=t.from||ze.from,this.to=t.to||ze.to,this.due=t.due||ze.due,this.number=t.number||ze.number,this.contact=t.contact||ze.contact,this.location=t.location||ze.location,this.items=t.items||ze.items.slice(),this.conflicts=t.conflicts||ze.conflicts.slice(),this.by=t.by||ze.by,this.itemSummary=t.itemSummary||ze.itemSummary,this.name=t.name||ze.name};(Ge.prototype=new Ke).constructor=de,Ge.prototype.getNow=function(){return this._getDateHelper().getNow()},Ge.prototype.getNowRounded=function(){return this._getDateHelper().roundTimeFrom(this.getNow())},Ge.prototype.getNextTimeSlot=function(e){e=e||this.getNowRounded();var t=this._getDateHelper(),r=moment(e).add(t.roundMinutes,"minutes");return r.isSame(e)&&(r=r.add(t.roundMinutes,"minutes")),t.getValidBusinessDate(r)},Ge.prototype.getMinDateFrom=function(){return this.getMinDate()},Ge.prototype.getMaxDateFrom=function(){return this.getMaxDate()},Ge.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.getMinDateFrom())},Ge.prototype.getMaxDateTo=function(){return this.getMaxDate()},Ge.prototype.getMinDateDue=function(){return this.getMinDateTo()},Ge.prototype.getMaxDateDue=function(){return this.getMaxDateTo()},Ge.prototype.getMinDate=function(){return this.getNow()},Ge.prototype.getMaxDate=function(){var e=this._getDateHelper(),t=e.getNow();return e.roundTimeTo(t).add(2,"years")},Ge.prototype.suggestEndDate=function(e){var t=this._getDateHelper(),r=t.addAverageDuration(e||t.getNow());return t.roundTimeTo(r)},Ge.prototype.isEmpty=function(){return de.prototype.isEmpty.call(this)&&this.status==ze.status&&("cheqroom.types.order"==this.crtype||this.from==ze.from)&&this.to==ze.to&&this.due==ze.due&&this.number==ze.number&&this.contact==ze.contact&&this.location==ze.location&&0==this.items.length},Ge.prototype.isDirty=function(){return de.prototype.isDirty.call(this)||this._isDirtyBasic()||this._isDirtyDates()||this._isDirtyLocation()||this._isDirtyContact()||this._isDirtyItems()},Ge.prototype._isDirtyBasic=function(){if(this.raw){var e=this.raw.status||ze.status;return this.status!=e}return!1},Ge.prototype._isDirtyDates=function(){if(this.raw){var e=this.raw.from||ze.from,t=this.raw.to||ze.to,r=this.raw.due||ze.due;return this.from!=e||this.to!=t||this.due!=r}return!1},Ge.prototype._isDirtyLocation=function(){if(this.raw){var e=ze.location;return this.raw.location&&(e=this.raw.location._id?this.raw.location._id:this.raw.location),this.location!=e}return!1},Ge.prototype._isDirtyContact=function(){if(this.raw){var e=ze.contact;return this.raw.customer&&(e=this.raw.customer._id?this.raw.customer._id:this.raw.customer),this.contact!=e}return!1},Ge.prototype._isDirtyItems=function(){return!!this.raw&&(ze.items.slice(),this.raw.items,!1)},Ge.prototype._getDefaults=function(){return ze},Ge.prototype._toJson=function(e){var t=de.prototype._toJson.call(this,e);return this.location&&(t.location=this._getId(this.location)),this.contact&&(t.customer=this._getId(this.contact)),t},Ge.prototype._fromJson=function(e,t){var r=this;return de.prototype._fromJson.call(this,e,t).then((function(){return r.cover=null,r.status=e.status||ze.status,r.number=e.number||ze.number,r.location=e.location||ze.location,r.contact=e.customer||ze.contact,r.items=e.items||ze.items.slice(),r.by=e.by||ze.by,r.archived=e.archived||ze.archived,r.itemSummary=e.itemSummary||ze.itemSummary,r.name=e.name||ze.name,r.modified=e.modified||ze.modified,r._getConflicts().then((function(e){r.conflicts=e}))}))},Ge.prototype._toLog=function(e){var t=this._toJson(e);t.minDateFrom=this.getMinDateFrom().toJSONDate(),t.maxDateFrom=this.getMaxDateFrom().toJSONDate(),t.minDateDue=this.getMinDateDue().toJSONDate(),t.maxDateDue=this.getMaxDateDue().toJSONDate(),t.minDateTo=this.getMinDateTo().toJSONDate(),t.maxDateTo=this.getMaxDateTo().toJSONDate(),console.log(t)},Ge.prototype._checkFromDateBetweenMinMax=function(e){return this._checkDateBetweenMinMax(e,this.getMinDateFrom(),this.getMaxDateFrom())},Ge.prototype._checkDueDateBetweenMinMax=function(e){return this._checkDateBetweenMinMax(e,this.getMinDateDue(),this.getMaxDateDue())},Ge.prototype._checkToDateBetweenMinMax=function(e){return this._checkDateBetweenMinMax(e,this.getMinDateTo(),this.getMaxDateTo())},Ge.prototype._getUniqueItemIds=function(e){return(e=e||[]).reduce((function(e,t,r,i){return-1==e.indexOf(t)&&e.push(t),e}),[])},Ge.prototype.clearFromDate=function(e){return this.from=ze.from,this._handleTransaction(e)},Ge.prototype.setFromDate=function(e,t){return this.from=this._getDateHelper().roundTimeFrom(e),this._handleTransaction(t)},Ge.prototype.clearToDate=function(e){return this.to=ze.to,this._handleTransaction(e)},Ge.prototype.setToDate=function(e,t){return this.to=this._getDateHelper().roundTimeTo(e),this._handleTransaction(t)},Ge.prototype.clearDueDate=function(e){return this.due=ze.due,this._handleTransaction(e)},Ge.prototype.setDueDate=function(e,t){return this.due=this._getDateHelper().roundTimeTo(e),this._handleTransaction(t)},Ge.prototype.setLabel=function(e,t){var r=this;return(this.existsInDb()?Promise.resolve():this._createTransaction(t)).then((function(){return de.prototype.setLabel.call(r,e,t)}))},Ge.prototype.setLocation=function(e,t){return this.location=e,this.existsInDb()?this._doApiCall({method:"setLocation",params:{location:e},skipRead:t}):this._createTransaction(t)},Ge.prototype.clearLocation=function(e){var t=this;return this.location=ze.location,this._doApiCall({method:"clearLocation",skipRead:e}).then((function(){return t._ensureTransactionDeleted()}))},Ge.prototype.setContact=function(e,t){return this.contact=e,this.existsInDb()?this._doApiCall({method:"setCustomer",params:{customer:e},skipRead:t}):this._createTransaction(t)},Ge.prototype.clearContact=function(e){var t=this;return this.contact=ze.contact,this._doApiCall({method:"clearCustomer",skipRead:e}).then((function(){return t._ensureTransactionDeleted()}))},Ge.prototype.setName=function(e,t){return this._doApiCall({method:"setName",params:{name:e},skipRead:t})},Ge.prototype.clearName=function(e){return this._doApiCall({method:"clearName",skipRead:e})},Ge.prototype.addItems=function(e,t){var r=this;return e=r._getUniqueItemIds(e),this._ensureTransactionExists(t).then((function(){return r._doApiCall({method:"addItems",params:{items:e},skipRead:t})}))},Ge.prototype.removeItems=function(e,t){var r=this;if(!this.existsInDb())throw new Error("Cannot removeItems from document without id");return e=r._getUniqueItemIds(e),this._doApiCall({method:"removeItems",params:{items:e},skipRead:t}).then((function(e){return r._ensureTransactionDeleted().then((function(){return e}))}))},Ge.prototype.clearItems=function(e){if(!this.existsInDb())throw new Error("Cannot clearItems from document without id");var t=this;return this._doApiCall({method:"clearItems",skipRead:e}).then((function(e){return t._ensureTransactionDeleted().then((function(){return e}))}))},Ge.prototype.swapItem=function(e,t,r){if(!this.existsInDb())throw new Error("Cannot swapItem from document without id");return this._doApiCall({method:"swapItem",params:{fromItem:e,toItem:t},skipRead:r})},Ge.prototype.hasItems=function(e){var t=this.items||[],r=[],i=null;return e.forEach((function(e){t.forEach((function(t,r){if(r._id==e)return i=e,!1})),null!=i&&r.push(i)})),r},Ge.prototype.archive=function(e){if(!this.canArchive())throw new Error("Cannot archive document");return this._doApiCall({method:"archive",params:{},skipRead:e})},Ge.prototype.undoArchive=function(e){if(!this.canUndoArchive())throw new Error("Cannot unarchive document");return this._doApiCall({method:"undoArchive",params:{},skipRead:e})},Ge.prototype.canArchive=function(){return null==this.archived&&("cancelled"==this.status||"closed"==this.status||"closed_manually"==this.status)},Ge.prototype.canUndoArchive=function(){return null!=this.archived&&("cancelled"==this.status||"closed"==this.status||"closed_manually"==this.status)},Ge.prototype.setField=function(e,t,r){var i=this;return this._ensureTransactionExists(r).then((function(){return i._doApiCall({method:"setField",params:{field:e,value:t},skipRead:r})}))},Ge.prototype._getConflicts=function(){return Promise.resolve([])},Ge.prototype._getDateHelper=function(){return this.dateHelper},Ge.prototype._searchItems=function(e,t,r,i,s){if(null==this.dsItems)throw new h.ApiBadRequest(this.crtype+" has no DataSource for items");e=e||{},this.location&&(e.location=this._getId(this.location)),null!=t&&t.length>0&&(e.listName=t);var n=this,o=null;return s&&s.length&&(o=s.slice(0)).forEach((function(e,t){o[t]=n._getId(e)})),1==r?(e.onlyUnbooked=null==i||i,e.fromDate=this.from,e.toDate=this.to||this.due,e._limit=e._limit||20,e._skip=e._skip||0,o&&o.length&&(e.skipItems=o),this.dsItems.call(null,"searchAvailable",e)):(o&&o.length&&(e.pk__nin=o),this.dsItems.search(e))},Ge.prototype._checkDateBetweenMinMax=function(e,t,r){if(t=t||this.getMinDate(),r=r||this.getMaxDate(),e<t||e>r){var i="date "+e.toJSONDate()+" is outside of min max range "+t.toJSONDate()+"->"+r.toJSONDate();throw new h.ApiUnprocessableEntity(i)}return Promise.resolve(e)},Ge.prototype._handleTransaction=function(e){var t=this.isEmpty();return this.existsInDb()?t?this.autoCleanup?this._deleteTransaction():Promise.resolve():this._updateTransaction(e):t?Promise.resolve():this._createTransaction(e)},Ge.prototype._deleteTransaction=function(){return this.delete()},Ge.prototype._updateTransaction=function(e){return this.update(e)},Ge.prototype._createTransaction=function(e){return this.create(e)},Ge.prototype._ensureTransactionExists=function(e){return this.existsInDb()?Promise.resolve():this._createTransaction(e)},Ge.prototype._ensureTransactionDeleted=function(){return this.isEmpty()&&this.autoCleanup?this._deleteTransaction():Promise.resolve()};var Ye=Ge,Ze=function(){};Ze.prototype=Ye.prototype;var $e=function(e){var t=Object.assign({crtype:"cheqroom.types.order",_fields:["*"]},e);Ye.call(this,t),this.dsReservations=t.dsReservations};($e.prototype=new Ze).constructor=$e,$e.prototype.getMinDateFrom=function(){return this.getNowRounded()},$e.prototype.getMinDateDue=function(){return"open"==this.status?this.getNextTimeSlot():Ye.prototype.getMinDateDue.call(this)},$e.prototype._toJson=function(e){var t=Ye.prototype._toJson.call(this,e);return t.due=null!=this.due?this.due.toJSONDate():"null",t},$e.prototype._fromJson=function(e,t){var r=this;return r.from=null==e.started||"null"==e.started?this.getMinDateFrom():e.started,r.to=null==e.finished||"null"==e.finished?null:e.finished,r.due=null==e.due||"null"==e.due?null:e.due,r.reservation=e.reservation||null,Ye.prototype._fromJson.call(this,e,t).then((function(){return e}))},$e.prototype.getDuration=function(){return V.getOrderDuration(this.raw)},$e.prototype.getFriendlyDuration=function(){return V.getFriendlyOrderDuration(this.raw,this._getDateHelper())},$e.prototype.canGenerateAgreement=function(){return"open"==this.status||"closed"==this.status},$e.prototype.canCheckin=function(){return"open"==this.status},$e.prototype.canSpotcheck=function(){return V.canOrderSpotcheck(this.raw)},$e.prototype.canGoToReservation=function(){return null!=this.reservation},$e.prototype.isValidDueDate=function(){var e=this.due,t=this.status,r=this.getNextTimeSlot();return this.getMaxDateDue(),"creating"!=t&&"open"!=t||null!=e&&(e.isSame(r)||e.isAfter(r))},$e.prototype.canCheckout=function(){var e=this;return"creating"==this.status&&null!=this.location&&null!=this.contact&&"active"==this.contact.status&&this.isValidDueDate()&&this.items&&this.items.length>0&&this.items.filter((function(t){return e.id==e.helper.ensureId(t.order)})).length>0},$e.prototype.canCheckoutAgain=function(){return"closed"==this.status&&this.contact&&"active"==this.contact.status&&this.items.filter((function(e){return"available"==e.status})).length==this.items.length},$e.prototype.checkoutAgain=function(e){return this._doApiCall({method:"checkoutAgain",params:{},skipRead:e})},$e.prototype.canUndoCheckout=function(){return"open"==this.status},$e.prototype.canDelete=function(){var e=this;return"creating"==this.status&&this.items.filter((function(t){return t.order&&t.order==e.id})).length==this.items.length},$e.prototype.canAddItems=function(){return"creating"==this.status},$e.prototype.canRemoveItems=function(){return"creating"==this.status},$e.prototype.canRemoveItem=function(e){return"await_checkout"==e.status&&e.order&&e.order==this.id},$e.prototype.canSwapItems=function(){return"creating"==this.status},$e.prototype.canGenerateDocument=function(){return"open"==this.status||"closed"==this.status},$e.prototype.canExtendCheckout=function(e){var t=!0;return("open"!=this.status||e&&e.isBefore(this.getNextTimeSlot()))&&(t=!1),this.contact&&"active"!=this.contact.status&&(t=!1),t},$e.prototype._getConflictsForExtend=function(){var e=[];if("open"==this.status){var t=[],r=this;if(this.items.forEach((function(e){"checkedout"==e.status&&e.order==r.id&&t.push(e)})),this.due)return this._getServerConflicts(this.items,this.from,this.due,this.id,this.helper.ensureId(this.reservation)).then((function(t){var i=r.items.filter((function(e){return r.helper.ensureId(e.order)==r.id})).map((function(e){return e._id}));return e.concat(t.filter((function(e){return-1!=i.indexOf(e.item)})))}))}return Promise.resolve(e)},$e.prototype._getConflicts=function(){var e=this,t=[];return"creating"==this.status&&this.items.length>0&&(t=this._getClientConflicts(),this.due)?this._getServerConflicts(this.items,this.from,this.due,this.id,this.helper.ensureId(this.reservation)).then((function(r){var i=e.items.filter((function(t){return e.helper.ensureId(t.order)==e.id})).map((function(e){return e._id}));return t.concat(r.filter((function(e){return-1!=i.indexOf(e.item)})))})):Promise.resolve(t)},$e.prototype._getServerConflicts=function(e,t,r,i,s){var n=this,o=[],a="",c=null,u=V.getItemIds(e.filter((function(e){return e.order==n.id}))),l=!(null!=this.contact&&"active"==this.contact.status&&"maintenance"==this.contact.kind);return this.dsItems.call(null,"getAvailabilities",{items:u,fromDate:t,toDate:r}).then((function(t){return t.forEach((function(t){if(c=e.find((function(e){return e._id==t.item})),c&&c.length>0&&(c=c[0]),null!=c&&"expired"!=c.status&&"in_custody"!=c.status&&t.order!=i&&t.reservation!=s){if("flag"==(a=(a=(a=(a="")||(t.order?"order":""))||(t.reservation?"reservation":""))||t.kind)&&!l)return!0;o.push(new ge({kind:a,item:c._id,itemName:c.name,fromDate:t.fromDate,toDate:t.toDate,doc:t.order||t.reservation}))}})),o}))},$e.prototype._getClientConflicts=function(){var e=this,t=[],r=this.helper.ensureId(this.location||""),i=!(null!=this.contact&&"active"==this.contact.status&&"maintenance"==this.contact.kind);return this.items.forEach((function(s){if(s.order!=e.id)return!0;e.unavailableFlagHelper(s.flag)&&i?t.push(new ge({kind:"flag",item:s._id,flag:s.flag,doc:s.order})):"unavailable_allow"===s.canOrder?t.push(new ge({kind:"not_allowed_order",item:s._id,itemName:s.name})):"expired"==s.status?t.push(new ge({kind:"expired",item:s._id,itemName:s.name,locationCurrent:s.location,locationDesired:r})):"in_custody"==s.status?t.push(new ge({kind:"custody",item:s._id,itemName:s.name,locationCurrent:s.location,locationDesired:r})):r&&s.location!=r&&t.push(new ge({kind:"location",item:s._id,itemName:s.name,locationCurrent:s.location,locationDesired:r}))})),t},$e.prototype.setFromDueDate=function(e,t,r){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot set order from / due date, status is "+this.status);var i=this,s=this.getMinDateFrom(),n=t?this._getDateHelper().roundTimeTo(t):this._getDateHelper().addAverageDuration(s);return this._checkFromDueDate(s,n).then((function(){return i.from=s,i.due=n,i._handleTransaction(r)}))},$e.prototype.setFromDate=function(e,t){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot set order from date, status is "+this.status);var r=this,i=this._getDateHelper().roundTimeFrom(e);return this._checkFromDueDate(i,this.due).then((function(){return r.from=i,r._handleTransaction(t)}))},$e.prototype.clearFromDate=function(e){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot clear order from date, status is "+this.status);return this.from=null,this._handleTransaction(e)},$e.prototype.setDueDate=function(e,t){if("creating"!=this.status&&"open"!=this.status)throw new h.ApiUnprocessableEntity("Cannot set order due date, status is "+this.status);var r=this,i=this._getDateHelper().roundTimeTo(e);return this.from=this.getMinDateFrom(),this._checkDueDateBetweenMinMax(i).then((function(){return r.due=i,r.existsInDb()?"open"==r.status?r.canExtend(i).then((function(e){return e&&1==e.result?r.extend(i,t):Promise.reject("Cannot extend order to given date because it has conflicts.",e)})):r._doApiCall({method:"setDueDate",params:{due:i},skipRead:t}):r._createTransaction(t)}))},$e.prototype.clearDueDate=function(e){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot clear order due date, status is "+this.status);return this.due=null,this._doApiCall({method:"clearDueDate",skipRead:e})},$e.prototype.setToDate=function(e,t){throw"Order.setToDate not implemented, it is set during order close"},$e.prototype.clearToDate=function(e,t){throw"Order.clearToDate not implemented, it is set during order close"},$e.prototype.searchItems=function(e,t,r,i,s){return this._searchItems(e,null!=s?s:"available",t,r,i||this.items)},$e.prototype.checkin=function(e,t,r,i){var s=this;return this._doApiCall({method:"checkin",params:{items:e,location:t},skipRead:r}).then((function(e){return e}),(function(e){if(!i&&e&&422==e.code){if(e.opt&&-1!=e.opt.detail.indexOf("order has status closed"))return s.get();if(e.opt&&-1!=e.opt.detail.indexOf("already checked in or used somewhere else"))return s.get()}return Promise.reject(e)}))},$e.prototype.checkout=function(e,t){var r=this;return this._doApiCall({method:"checkout",skipRead:e}).then((function(e){return e}),(function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("order has status open")?r.get():Promise.reject(e)}))},$e.prototype.undoCheckout=function(e,t){var r=this;return this._doApiCall({method:"undoCheckout",skipRead:e}).then((function(e){return e}),(function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("order has status creating")?r.get():Promise.reject(e)}))},$e.prototype.canExtend=function(e){return Promise.resolve({result:this.canExtendCheckout(e)})},$e.prototype.extend=function(e,t){var r=this;return this.canExtend(e).then((function(i){return i&&1==i.result?r._doApiCall({method:"extend",params:{due:e},skipRead:t}):Promise.reject("Cannot extend order to given date because it has conflicts.",i)}))},$e.prototype.generateDocument=function(e,t,r){return this._doApiLongCall({method:"generateDocument",params:{template:e,signature:t},skipRead:r})},$e.prototype._fromCommentsJson=function(e,t){var r=this;return r.dsReservations&&e.reservation&&e.reservation.comments&&e.reservation.comments.length>0?de.prototype._fromCommentsJson.call(r,e.reservation,Object.assign(t,{ds:r.dsReservations,fromReservation:!0})).then((function(){var i=r.comments;return de.prototype._fromCommentsJson.call(r,e,t).then((function(){r.comments=r.comments.concat(i).sort((function(e,t){return t.modified>e.modified}))}))})):de.prototype._fromCommentsJson.call(r,e,t)},$e.prototype._fromAttachmentsJson=function(e,t){var r=this;return r.dsReservations&&e.reservation&&e.reservation.attachments&&e.reservation.attachments.length>0?de.prototype._fromAttachmentsJson.call(r,e.reservation,Object.assign(t,{ds:r.dsReservations,fromReservation:!0})).then((function(){var i=r.attachments;return de.prototype._fromAttachmentsJson.call(r,e,t).then((function(){r.attachments=r.attachments.concat(i).sort((function(e,t){return t.modified>e.modified}))}))})):de.prototype._fromAttachmentsJson.call(r,e,t)},$e.prototype._checkFromDueDate=function(e,t){var r=this._getDateHelper(),i=e,s=t;if(i&&s)return Promise.all(this._checkDateBetweenMinMax(i),this._checkDateBetweenMinMax(s)).then((function(e,t){var n=r.roundMinutes;if(s.diff(i,"minutes")<n)throw new new h.ApiUnprocessableEntity("Cannot set order from date, after (or too close to) to date "+s.toJSONDate());if(i.diff(s,"minutes")>n)throw new h.ApiUnprocessableEntity("Cannot set order due date, before (or too close to) from date "+i.toJSONDate())}));if(i)return this._checkDateBetweenMinMax(i);if(s)return this._checkDateBetweenMinMax(s);throw new h.ApiUnprocessableEntity("Cannot from/due date, both are null")};var Xe=$e,Qe=function(e,t,r,i,s){this.user=e,this.profile=t,this.limits=r,this.permissions=i,this.isFeatureEnabled=s||function(){return!1},this._isOwner=e.isOwner,this._isBlockedContact=e.customer&&"blocked"==e.customer.status,this._useWebhooks=r.allowWebhooks&&t.useWebhooks,this._useOrders=r.allowOrders&&t.useOrders,this._useReservations=r.allowReservations&&t.useReservations,this._usePdf=r.allowGeneratePdf,this._useKits=r.allowKits&&t.useKits,this._useCustody=r.allowCustody&&t.useCustody,this._useSelfService=r.allowSelfService&&t.useSelfService,this._useCheckinLocation=this._useOrders&&t.orderCheckinLocation,this._usePublicSelfService=r.allowSelfService&&t.usePublicSelfService,this._useOrderTransfers=r.allowOrderTransfers&&t.useOrderTransfers,this._useSendMessage=r.allowSendMessage&&t.useSendMessage,this._useUserSync=r.allowUserSync&&t.useUserSync,this._useFlags=t.useFlags,this._useGeo=r.allowGeo&&t.useGeo,this._useRestrictLocations=r.allowRestrictLocations&&t.useRestrictLocations,this._useReporting=r.allowReporting&&t.useReporting,this._useDepreciations=r.allowDepreciations&&t.useDepreciations,this._useNotifications=r.allowNotifications&&t.useNotifications,this._useBlockContacts=r.allowBlockContacts&&t.useBlockContacts,this._useReservationsClose=this._useReservations&&t.useReservationsClose,this._useSlack=r.allowIntegrationSlack&&t.useIntegrationSlack,this._useApi=r.allowAPI,this._useReleaseAtLocation=this._useCustody&&(void 0===t.custodyCanChangeLocation||t.custodyCanChangeLocation),this._useSpotcheck=r.allowSpotcheck&&t.useSpotcheck,this._useCustomRoles=r.allowCustomRoles,this._useSSO=r.allowSSO,this._useExport=r.allowExport,this._useImport=r.allowImport,this._useRepeatReservations=r.allowReservationsRepeat,this._useICal=r.allowICal,this._usePublicInventory=r.allowPublicInventory,this._useBookingRestrictions=r.allowBookingRestrictions,this._useEquipmentPicking=r.allowEquipmentPicking&&t.useEquipmentPicking,this._useLocationBusinessHours=r.allowLocationBusinessHours};Qe.prototype.canUseItemCustody=function(){return this.limits.allowCustody},Qe.prototype.canUseItemDepreciation=function(){return this.limits.allowDepreciations},Qe.prototype.canUseReporting=function(){return this.limits.allowReporting},Qe.prototype.canUseWebhooks=function(){return this.limits.allowWebhooks},Qe.prototype.canUseUserSync=function(){return this.limits.allowUserSync},Qe.prototype.canUseRestrictLocations=function(){return this.limits.allowRestrictLocations},Qe.prototype.canUseBlockContacts=function(){return this.limits.allowBlockContacts},Qe.prototype.canUseBusinessHours=function(){return this.limits.allowBusinessHours},Qe.prototype.canUseSlack=function(){return this.limits.allowIntegrationSlack},Qe.prototype.canUseSpotcheck=function(){return this.limits.allowSpotcheck},Qe.prototype.canUseCustomRoles=function(){return this.limits.allowCustomRoles},Qe.prototype.canUseSMSNotifications=function(){return this.limits.allowNotificationsSMS},Qe.prototype.canUsePushNotifications=function(){return this.limits.allowNotificationsPush},Qe.prototype.canUseEmailNotifications=function(){return this.limits.allowNotificationsEmail},Qe.prototype.canUseImport=function(){return this.limits.allowImport},Qe.prototype.canUseBookingRestrictions=function(){return this.limits.allowBookingRestrictions},Qe.prototype.canUseExport=function(){return this.limits.allowExport},Qe.prototype.canUsePdf=function(){return this.limits.allowGeneratePdf},Qe.prototype.canUseGeo=function(){return this.limits.allowGeo},Qe.prototype.canUseCheckouts=function(){return this.limits.allowOrders},Qe.prototype.canUseReservations=function(){return this.limits.allowReservations},Qe.prototype.canUseColoredLabels=function(){return this.canUseCheckouts()&&this.canUseReservations()},Qe.prototype.canUseSupportChat=function(){return this.limits.allowSupportChat},Qe.prototype.canUseEquipmentPicking=function(){return this.limits.allowEquipmentPicking},Qe.prototype.canUseLocationBusinessHours=function(){return this.limits.allowLocationBusinessHours},Qe.prototype.hasUpgradePermission=function(){return this.hasAccountPermission("upgrade")},Qe.prototype.hasAnyAdminPermission=function(){return this.hasPermission("create","locations")||this.hasPermission("create","categories")||this.hasPermission("create","webhooks")||this.hasPermission("create","users")||this.hasPermission("create","templates")||this.hasPermission("create","syncs")||this.hasPermission("changePlan","account")||this.hasPermission("create","notifications")||this.hasPermission("update","settings")},Qe.prototype.hasDashboardPermission=function(e,t,r){return this.hasReservationPermission("read")||this.hasCheckoutPermission("read")},Qe.prototype.hasCalendarPermission=function(e,t,r){return this.hasReservationPermission("read")||this.hasCheckoutPermission("read")},Qe.prototype.hasICalPermission=function(){return this._useICal},Qe.prototype.hasEquipmentPicking=function(){return this._useEquipmentPicking},Qe.prototype.hasLocationBusinessHours=function(){return this._useLocationBusinessHours},Qe.prototype.hasPublicInventoryPermission=function(){return this._usePublicInventory},Qe.prototype.hasBookingRestrictionsPermission=function(){return this._useBookingRestrictions},Qe.prototype.hasItemPermission=function(e,t,r){return this.hasPermission(e||"read","items",t,r)},Qe.prototype.hasItemCustodyPermission=function(){return this._useCustody},Qe.prototype.hasReleaseCustodyAtLocationPermission=function(){return this._useCustody&&this._useReleaseAtLocation},Qe.prototype.hasItemFlagPermission=function(){return this._useFlags},Qe.prototype.hasItemGeoPermission=function(){return this._useGeo},Qe.prototype.hasItemDepreciationPermission=function(){return this._useDepreciations&&this.hasItemPermission("getDepreciation")},Qe.prototype.hasUserSyncPermission=function(){return this.hasAccountUserSyncPermission("read")},Qe.prototype.hasSelfservicePermission=function(){return this._useSelfService},Qe.prototype.hasReportingPermission=function(){return this._useReporting&&-1!=this.permissions.indexOf("ACCOUNT_REPORTER")},Qe.prototype.hasExportPermission=function(){return this._useExport},Qe.prototype.hasImportPermission=function(){return this._useImport},Qe.prototype.hasLabelPermission=function(){return this.hasCheckoutPermission("setLabel")},Qe.prototype.hasSlackPermission=function(){return this._useSlack},Qe.prototype.hasSSOPermission=function(){return this._useSSO},Qe.prototype.hasApiPermission=function(){return this._useApi},Qe.prototype.hasSpotcheckPermission=function(e,t,r){return this.hasPermission(e||"read","spotchecks",t,r)},Qe.prototype.hasKitPermission=function(e,t,r){return this.hasPermission(e||"read","kits",t,r)},Qe.prototype.hasContactPermission=function(e,t,r){return this.hasPermission(e||"read","contacts",t,r)},Qe.prototype.hasContactReadOtherPermission=function(e,t,r){return-1!=this.permissions.indexOf("CUSTOMERS_READER")},Qe.prototype.hasBlockContactsPermission=function(e,t,r){return this._useBlockContacts},Qe.prototype.hasCheckoutPermission=function(e,t,r){return this.hasPermission(e||"read","orders",t,r)},Qe.prototype.hasReservationPermission=function(e,t,r){return this.hasPermission(e||"read","reservations",t,r)},Qe.prototype.hasCategoriesPermission=function(e,t,r){return this.hasPermission(e,"categories",t,r)},Qe.prototype.hasNotificationPermission=function(e,t,r){return this.hasPermission(e,"notifications",t,r)},Qe.prototype.hasUserPermission=function(e,t,r){return this.hasPermission(e,"users",t,r)},Qe.prototype.hasLocationPermission=function(e,t,r){return this.hasPermission(e,"locations",t,r)},Qe.prototype.hasRestrictLocationPermission=function(){return this._useRestrictLocations},Qe.prototype.hasWebhookPermission=function(e,t,r){return this.hasPermission(e,"webhooks",t,r)},Qe.prototype.hasAccountPermission=function(e,t,r){return this.hasPermission(e,"account",t,r)},Qe.prototype.hasAccountInvoicesPermission=function(e,t,r){return this.hasPermission(e,"invoices",t,r)},Qe.prototype.hasAccountSubscriptionPermission=function(e,t,r){return this.hasPermission(e,"subscription",t,r)},Qe.prototype.hasAccountBillingPermission=function(e,t,r){return this.hasPermission(e,"billing",t,r)},Qe.prototype.hasAccountTemplatePermission=function(e,t,r){return this.hasPermission(e,"templates",t,r)},Qe.prototype.hasAccountUserSyncPermission=function(e,t,r){return this.hasPermission(e,"syncs",t,r)},Qe.prototype.hasAssetTagsPermission=function(e,t,r){return this.hasAnyAdminPermission()},Qe.prototype.hasIntegrationsPermission=function(){return this.hasWebhookPermission("read")||this.hasSlackPermission()||this.hasApiPermission()||this.hasPublicInventoryPermission()||this.hasSSOPermission()},Qe.prototype.hasPermission=function(e,t,r,i){r=r||{};var s=this.permissions,n=function(e){return s.some((function(t){return e.includes(t)}))};switch(t){default:return!1;case"items":switch(e){default:return!1;case"read":case"get":case"getAvailabilities":case"getAvailability":case"getByCode":case"getChangeLog":case"getConflicts":case"getImage":case"getLastItemNumber":case"getMultiple":case"getSummary":case"getTransactions":case"list":case"scannedCodeOn":case"search":case"searchAvailable":return n(["ITEMS_READER","ITEMS_READER_RESTRICTED"]);case"create":case"createMultiple":case"duplicate":case"update":case"delete":case"deleteMultiple":case"canDelete":case"changeCategory":case"canChangeCategory":case"getDepreciation":case"updatePermissions":case"addBarcode":case"removeBarcode":case"addCodes":case"removeCodes":case"clearCatalog":case"clearCover":case"expire":case"undoExpire":case"setFields":case"setField":case"clearField":case"setAllowedActions":case"setCatalog":case"setCover":return n(["ITEMS_ADMIN","ITEMS_ADMIN_RESTRICTED"]);case"changeLocation":return n(["ITEMS_LOCATION_ADMIN_RESTRICTED"]);case"updateGeo":return this._useGeo&&n(["ITEMS_GEO_ADMIN","ITEMS_GEO_ADMIN_RESTRICTED"]);case"attach":case"addAttachment":return n(["ITEMS_ATTACHMENTS_OWN_WRITER"]);case"detach":case"removeAttachment":return n(["ITEMS_ATTACHMENTS_DELETER"])||r.own&&n(["ITEMS_ATTACHMENTS_OWN_DELETER"]);case"import":case"importAnalyze":case"importSample":case"importSpreadsheet":case"importValidate":return this._useImport&&n(["ITEMS_IMPORTER","ITEMS_IMPORTER_RESTRICTED"]);case"export":return this._useExport&&n(["ITEMS_EXPORTER","ITEMS_EXPORTER_RESTRICTED"]);case"addComment":return n(["ITEMS_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&n(["ITEMS_COMMENTS_OWN_WRITER"]);case"removeComment":return n(["ITEMS_COMMENTS_DELETER"])||r.own&&n(["ITEMS_COMMENTS_OWN_DELETER"]);case"printLabel":return n(["ITEMS_LABEL_PRINTER","ITEMS_LABEL_PRINTER_RESTRICTED"]);case"setFlag":return this._useFlags&&n(["ITEMS_FLAGGER","ITEMS_FLAGGER_RESTRICTED"]);case"clearFlag":return this._useFlags&&n(["ITEMS_UNFLAGGER","ITEMS_UNFLAGGER_RESTRICTED"]);case"reserve":return this.hasReservationPermission("create");case"checkout":return this.hasCheckoutPermission("create");case"seeOwnCustody":return this._useCustody&&n(["ITEMS_CUSTODY_OWN_READER"]);case"takeCustody":return this._useCustody&&(n(["ITEMS_CUSTODY_TAKER"])||!1!==r.restrict&&n(["ITEMS_CUSTODY_TAKER_RESTRICTED"]));case"releaseCustody":return this._useCustody&&(n(["ITEMS_CUSTODY_RELEASER","ITEMS_CUSTODY_RELEASER_RESTRICTED"])||r.own&&n(["ITEMS_CUSTODY_OWN_RELEASER"]));case"transferCustody":return this._useCustody&&(n(["ITEMS_CUSTODY_TRANSFERER"])||!1!==r.restrict&&n(["ITEMS_CUSTODY_TRANSFERER_RESTRICTED"])||r.own&&n(["ITEMS_CUSTODY_OWN_TRANSFERER"]));case"giveCustody":return this.hasContactReadOtherPermission()&&this.hasItemPermission("takeCustody",r)&&this.hasItemPermission("transferCustody",r);case"releaseCustodyAt":return this.hasItemPermission("releaseCustody",r)&&this._useReleaseAtLocation;case"getReport":return n(["ITEMS_REPORTER","ITEMS_REPORTER_RESTRICTED"])}break;case"kits":if(!this._useKits)return!1;switch(e){default:return!1;case"read":return n(["KITS_READER","KITS_READER_RESTRICTED"]);case"create":case"duplicate":case"update":case"delete":case"setFields":case"setField":case"clearField":case"addItems":case"removeItems":case"moveItem":case"setCover":case"updatePermissions":return n(["KITS_ADMIN","KITS_ADMIN_RESTRICTED"]);case"attach":case"addAttachment":return n(["KITS_ATTACHMENTS_OWN_WRITER"]);case"detach":case"removeAttachment":return n(["KITS_ATTACHMENTS_DELETER"])||r.own&&n(["KITS_ATTACHMENTS_OWN_DELETER"]);case"addComment":return n(["KITS_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&n(["KITS_COMMENTS_OWN_WRITER"]);case"removeComment":return n(["KITS_COMMENTS_DELETER"])||r.own&&n(["KITS_COMMENTS_OWN_DELETER"]);case"import":return this._useImport&&n(["KITS_IMPORTER","KITS_IMPORTER_RESTRICTED"]);case"export":return this._useExport&&n(["KITS_EXPORTER","KITS_EXPORTER_RESTRICTED"]);case"printLabel":return n(["KITS_LABEL_PRINTER","KITS_LABEL_PRINTER_RESTRICTED"]);case"takeApart":return this.hasReservationPermission("create")||this.hasCheckoutPermission("create");case"reserve":return this.hasReservationPermission("create");case"checkout":return this.hasCheckoutPermission("create");case"seeOwnCustody":return this.hasItemPermission("seeOwnCustody",r);case"takeCustody":return this.hasItemPermission("takeCustody",r);case"releaseCustody":case"releaseCustodyAt":return this.hasItemPermission("releaseCustody",r);case"transferCustody":return this.hasItemPermission("transferCustody",r);case"giveCustody":return this.hasItemPermission("giveCustody",r);case"getReport":return this.hasItemPermission("getReport")}break;case"orders":case"checkouts":if(!this._useOrders)return!1;switch(e){default:return!1;case"create":return this.hasCheckoutPermission("update",{own:!0});case"update":case"delete":case"setCustomer":case"clearCustomer":case"setLocation":case"clearLocation":case"addItems":case"removeItems":case"swapItems":case"undoCheckout":case"checkout":case"checkin":case"setFields":case"setField":case"clearField":case"checkoutAgain":return n(["ORDERS_WRITER","ORDERS_WRITER_RESTRICTED"])||r.own&&n(["ORDERS_OWN_WRITER"]);case"extend":return n(["ORDERS_EXTENDER_RESTRICTED"])||r.own&&n(["ORDERS_OWN_EXTENDER"]);case"read":return this.hasCheckoutPermission("readAll")||n(["ORDERS_OWN_READER"]);case"readAll":return n(["ORDERS_READER","ORDERS_READER_RESTRICTED"]);case"attach":case"addAttachment":return n(["ORDERS_ATTACHMENTS_OWN_WRITER"])||r.own&&n(["ORDERS_OWN_ATTACHMENTS_OWN_WRITER"]);case"detach":case"removeAttachment":return n(["ORDERS_ATTACHMENTS_DELETER"])||r.own&&n(["ORDERS_ATTACHMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&n(["ORDERS_OWN_ATTACHMENTS_OWN_DELETER"]);case"addComment":return n(["ORDERS_COMMENTS_OWN_WRITER"])||r.own&&n(["ORDERS_OWN_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&n(["ORDERS_COMMENTS_OWN_WRITER"])||r.own&&r.ownDoc&&n(["ORDERS_OWN_COMMENTS_OWN_WRITER"]);case"removeComment":return n(["ORDERS_COMMENTS_DELETER"])||r.own&&n(["ORDERS_COMMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&n(["ORDERS_OWN_COMMENTS_OWN_DELETER"]);case"setLabel":case"clearLabel":return n(["ORDERS_LABELER","ORDERS_LABELER_RESTRICTED"])||r.own&&n(["ORDERS_OWN_LABELER"]);case"export":return this._useExport&&n(["ORDERS_EXPORTER","ORDERS_EXPORTER_RESTRICTED"]);case"archive":case"undoArchive":return n(["ORDERS_ARCHIVER","ORDERS_ARCHIVER_RESTRICTED"])||r.own&&n(["ORDERS_OWN_ARCHIVER"]);case"generateDocument":return this._usePdf&&(n(["ORDERS_DOCUMENT_GENERATOR","ORDERS_DOCUMENT_GENERATOR_RESTRICTED"])||r.own&&n(["ORDERS_OWN_DOCUMENT_GENERATOR"]));case"checkinAt":return this._useCheckinLocation&&this.hasCheckoutPermission("checkin",r);case"forceCheckListCheckin":return this.profile.forceCheckListCheckin&&this.hasCheckoutPermission("checkin",r);case"ignoreConflicts":return n(["ORDERS_CONFLICT_CREATOR"]);case"getReport":return n(["ORDERS_REPORTER","ORDERS_REPORTER_RESTRICTED","ORDERS_OWN_REPORTER"])}break;case"reservations":if(!this._useReservations)return!1;switch(e){default:return!1;case"create":return this.hasReservationPermission("update",{own:!0});case"update":case"delete":return n(["RESERVATIONS_WRITER","RESERVATIONS_WRITER_RESTRICTED"])||r.own&&n(["RESERVATIONS_OWN_WRITER"]);case"search":case"list":case"read":return this.hasReservationPermission("readAll")||n(["RESERVATIONS_OWN_READER"]);case"readAll":return n(["RESERVATIONS_READER","RESERVATIONS_READER_RESTRICTED"]);case"setCustomer":case"clearCustomer":case"setFromToDate":case"setLocation":case"clearLocation":case"addItems":case"removeItems":case"swapItems":case"reserve":case"undoReserve":case"reserveAgain":case"setFields":case"setField":case"clearField":return this.hasReservationPermission("update",r);case"reserveRepeat":return this._useRepeatReservations&&this.hasReservationPermission("update",r);case"attach":case"addAttachment":return n(["RESERVATIONS_ATTACHMENTS_OWN_WRITER"])||r.own&&n(["RESERVATIONS_OWN_ATTACHMENTS_OWN_WRITER"]);case"detach":case"removeAttachment":return n(["RESERVATIONS_ATTACHMENTS_DELETER"])||r.own&&n(["RESERVATIONS_ATTACHMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&n(["RESERVATIONS_OWN_ATTACHMENTS_OWN_DELETER"]);case"addComment":return n(["RESERVATIONS_COMMENTS_OWN_WRITER"])||r.own&&n(["RESERVATIONS_OWN_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&n(["RESERVATIONS_COMMENTS_OWN_WRITER"])||r.own&&r.ownDoc&&n(["RESERVATIONS_OWN_COMMENTS_OWN_WRITER"]);case"removeComment":return n(["RESERVATIONS_COMMENTS_DELETER"])||r.own&&n(["RESERVATIONS_COMMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&n(["RESERVATIONS_OWN_COMMENTS_OWN_DELETER"]);case"export":return this._useExport&&n(["RESERVATIONS_EXPORTER","RESERVATIONS_EXPORTER_RESTRICTED"]);case"switchToOrder":case"makeOrder":return this.hasCheckoutPermission("create",r);case"cancel":case"undoCancel":return n(["RESERVATIONS_CANCELER","RESERVATIONS_CANCELER_RESTRICTED"])||r.own&&n(["RESERVATIONS_OWN_CANCELER"]);case"archive":case"undoArchive":return n(["RESERVATIONS_ARCHIVER","RESERVATIONS_ARCHIVER_RESTRICTED"])||r.own&&n(["RESERVATIONS_OWN_ARCHIVER"]);case"generateDocument":return this._usePdf&&n(["RESERVATIONS_DOCUMENT_GENERATOR","RESERVATIONS_DOCUMENT_GENERATOR_RESTRICTED","RESERVATIONS_OWN_DOCUMENT_GENERATOR"]);case"ignoreConflicts":return n(["RESERVATIONS_CONFLICT_CREATOR"]);case"close":case"undoClose":return this._useReservationsClose&&(n(["RESERVATIONS_CLOSER","RESERVATIONS_CLOSER_RESTRICTED"])||r.own&&n(["RESERVATIONS_OWN_CLOSER"]));case"getReport":return n(["RESERVATIONS_REPORTER","RESERVATIONS_REPORTER_RESTRICTED","RESERVATIONS_OWN_REPORTER"]);case"setLabel":case"clearLabel":return n(["RESERVATIONS_LABELER","RESERVATIONS_LABELER_RESTRICTED"])||r.own&&n(["RESERVATIONS_OWN_LABELER"])}break;case"customers":case"contacts":switch(e){default:return!1;case"read":case"get":case"list":case"search":return n(["CUSTOMERS_READER"]);case"create":case"update":case"delete":case"archive":case"undoArchive":case"setFields":case"setField":case"clearField":case"setCover":return n(["CUSTOMERS_ADMIN"]);case"attach":case"addAttachment":return n(["CUSTOMERS_ATTACHMENTS_OWN_WRITER","CUSTOMERS_ATTACHMENTS_WRITER"]);case"detach":case"removeAttachment":return n(["CUSTOMERS_ATTACHMENTS_DELETER"])||r.own&&n(["CUSTOMERS_OWN_ATTACHMENTS_OWN_DELETER","CUSTOMERS_ATTACHMENTS_OWN_DELETER"]);case"printLabel":return n(["CUSTOMERS_LABEL_PRINTER","CUSTOMERS_LABEL_PRINTER_RESTRICTED"]);case"addComment":return n(["CUSTOMERS_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&n(["CUSTOMERS_COMMENTS_OWN_WRITER"]);case"removeComment":return n(["CUSTOMERS_COMMENTS_DELETER"])||r.own&&n(["CUSTOMERS_OWN_COMMENTS_OWN_DELETER"]);case"import":case"importAnalyze":case"importSpreadsheet":case"importSample":case"importValidate":return this._useImport&&n(["CUSTOMERS_IMPORTER"]);case"export":return this._useExport&&n(["CUSTOMERS_EXPORTER"]);case"generateDocument":return this._usePdf&&n(["CUSTOMERS_DOCUMENT_GENERATOR","CUSTOMERS_OWN_DOCUMENT_GENERATOR"]);case"block":case"undoBlock":return this._useBlockContacts&&n(["CUSTOMERS_BLOCK_ADMIN"]);case"getReport":return n(["CUSTOMERS_REPORTER"]);case"changeKind":return n(["CUSTOMERS_MAINTENANCE_ADMIN"])}break;case"users":switch(e){default:return!1;case"read":return n(["USERS_READER"]);case"update":case"updateProfile":case"activate":case"deactivate":case"archive":case"undoArchive":return n(["USERS_OWN_PROFILE_ADMIN","USERS_PROFILE_ADMIN","USERS_ADMIN"]);case"updatePassword":return n(["USERS_OWN_PASSWORD_ADMIN"]);case"create":case"delete":case"linkNewCustomer":case"linkCustomer":case"unLinkCustomer":case"inviteUser":case"clearSync":case"restrictLocations":case"referFriend":return n(["USERS_ADMIN"]);case"changeAccountOwner":return this._isOwner;case"getReport":return n(["USERS_REPORTER","USERS_OWN_REPORTER"]);case"addRole":case"deleteRole":case"editRole":return this._useCustomRoles&&n(["USERS_ADMIN"])}break;case"categories":switch(e){default:return!1;case"read":return n(["CATEGORIES_READER"]);case"create":case"update":case"delete":return n(["CATEGORIES_ADMIN"])}case"locations":switch(e){default:return!1;case"read":return n(["LOCATIONS_READER","LOCATIONS_READER_RESTRICTED"]);case"create":case"update":case"delete":case"archive":return n(["LOCATIONS_ADMIN"])}break;case"syncs":if(!this._useUserSync)return!1;switch(e){default:return!1;case"read":return n(["USER_SYNCS_READER"]);case"create":case"update":case"delete":case"clone":case"testConnection":case"syncUsers":return n(["USER_SYNCS_ADMIN"])}break;case"notifications":if(!this._useNotifications)return!1;switch(e){default:return!1;case"read":return n(["NOTIFICATIONS_READER"]);case"create":case"update":case"delete":return n(["NOTIFICATIONS_ADMIN"])}break;case"webhooks":if(!this._useWebhooks)return!1;switch(e){default:return n(["WEBHOOKS_READER"]);case"read":case"create":case"update":case"delete":return n(["WEBHOOKS_ADMIN"])}break;case"account":case"subscription":case"invoices":case"billing":switch(e){default:return n(["ACCOUNT_SUBSCRIPTIONS_READER","ACCOUNT_BILLING_READER"]);case"reset":case"changePlan":case"upgrade":return n(["ACCOUNT_SUBSCRIPTIONS_ADMIN","ACCOUNT_BILLING_ADMIN"]);case"cancelPlan":return this._isOwner}break;case"templates":switch(e){default:return!1;case"read":return n(["TEMPLATES_READER"]);case"create":case"update":case"delete":case"archive":case"undoArchive":case"activate":case"deactivate":case"clone":return n(["TEMPLATES_ADMIN"])}break;case"settings":switch(e){default:return!1;case"read":return n(["ACCOUNT_SETTINGS_READER"]);case"update":return n(["ACCOUNT_SETTINGS_ADMIN"])}case"spotchecks":if(!this._useSpotcheck)return!1;switch(e){case"readAll":return n(["SPOTCHECKS_READER"]);case"read":return n(["SPOTCHECKS_READER"])||n(["SPOTCHECKS_READER_OWN"]);case"delete":return n(["SPOTCHECKS_DELETER"])||r.own&&n(["SPOTCHECKS_DELETER_OWN"]);case"addAttachment":return n(["SPOTCHECKS_ATTACHMENTS_OWN_WRITER"])||r.own&&n(["SPOTCHECKS_OWN_ATTACHMENTS_OWN_WRITER"]);case"removeAttachment":return n(["SPOTCHECKS_ATTACHMENTS_DELETER"])||r.own&&n(["SPOTCHECKS_ATTACHMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&n(["SPOTCHECKS_OWN_ATTACHMENTS_OWN_DELETER"]);case"addComment":return n(["SPOTCHECKS_COMMENTS_OWN_WRITER"])||r.own&&n(["SPOTCHECKS_OWN_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&r.ownDoc&&n(["SPOTCHECKS_OWN_COMMENTS_OWN_WRITER"])||r.own&&n(["SPOTCHECKS_COMMENTS_OWN_WRITER"]);case"removeComment":return n(["SPOTCHECKS_COMMENTS_DELETER"])||r.own&&n(["SPOTCHECKS_COMMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&n(["SPOTCHECKS_OWN_COMMENTS_OWN_DELETER"]);case"archive":case"create":return n(["SPOTCHECKS_WRITER"])||n(["SPOTCHECKS_WRITER_OWN"]);case"update":return n(["SPOTCHECKS_WRITER"])||r.own&&n(["SPOTCHECKS_WRITER_OWN"])}}};var et=Qe,tt=function(){};tt.prototype=Ye.prototype;var rt=function(e){var t=Object.assign({crtype:"cheqroom.types.reservation",_fields:["*"]},e);Ye.call(this,t),this.conflicts=[],this.order=null};(rt.prototype=new tt).constructor=rt,rt.prototype.getMinDateFrom=function(){return this.getNextTimeSlot()},rt.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.from&&this.from.isBefore(this.getNowRounded())?null:this.from)},rt.prototype.getDuration=function(){return V.getReservationDuration(this.raw)},rt.prototype.getFriendlyDuration=function(){return V.getFriendlyReservationDuration(this.raw,this._getDateHelper())},rt.prototype.isValidFromDate=function(){var e=this.from,t=this.status,r=this.getNow();return"creating"!=t&&"open"!=t||null!=e&&e.isAfter(r)},rt.prototype.isValidToDate=function(){var e=this.from,t=this.to,r=this.status,i=this.getNow();return"creating"!=r&&"open"!=r||null!=t&&t.isAfter(e)&&t.isAfter(i)},rt.prototype.canSpotcheck=function(){return V.canReservationSpotcheck(this.raw)},rt.prototype.canReserve=function(){return"creating"==this.status&&this.location&&this.contact&&"active"==this.contact.status&&this.isValidFromDate()&&this.isValidToDate()&&this.items&&this.items.length},rt.prototype.canUndoReserve=function(){return"open"==this.status},rt.prototype.canCancel=function(){return"open"==this.status},rt.prototype.canClose=function(){return"open"==this.status},rt.prototype.canUndoClose=function(){return"closed_manually"==this.status&&this.contact&&"active"==this.contact.status},rt.prototype.canEdit=function(){return"creating"==this.status},rt.prototype.canDelete=function(){return"creating"==this.status},rt.prototype.canAddItems=function(){return"creating"==this.status},rt.prototype.canRemoveItems=function(){return"creating"==this.status},rt.prototype.canSwapItems=function(){return"creating"==this.status||"open"==this.status},rt.prototype.canMakeOrder=function(){return!("open"!=this.status||!this.contact||"active"!=this.contact.status||null==this.to||!this.to.isAfter(this.getNow()))&&0===this._getUnavailableItems().length},rt.prototype.canGoToOrder=function(){return null!=this.order},rt.prototype.canReserveRepeat=function(){return("open"==this.status||"closed"==this.status||"closed_manually"==this.status)&&this.contact&&"active"==this.contact.status},rt.prototype.canGenerateDocument=function(){return"open"==this.status||"closed"==this.status},rt.prototype._toJson=function(e){var t=Ye.prototype._toJson.call(this,e);return t.fromDate=null!=this.from?this.from.toJSONDate():"null",t.toDate=null!=this.to?this.to.toJSONDate():"null",t},rt.prototype._fromJson=function(e,t){var r=this;return r.from=null==e.fromDate||"null"==e.fromDate?null:e.fromDate,r.to=null==e.toDate||"null"==e.toDate?null:e.toDate,r.due=null,r.order=e.order||null,r.repeatId=e.repeatId||null,r.repeatFrequency=e.repeatFrequency||"",Ye.prototype._fromJson.call(this,e,t).then((function(){return e}))},rt.prototype.visibleConflicts=function(e,r){if(0==e.length||!this.from)return e;var i=this.from,s=this.to,n=t()();return r||null!=i&&null!=s&&(n.isBetween(i,s)||i.isBefore(n)||s.isBefore(n))?e:e.filter((function(e){return"order"!=e.kind||"order"==e.kind&&null!=i&&null!=s&&e.fromDate&&e.toDate&&(i.isBetween(e.fromDate,e.toDate,null,"[]")||s.isBetween(e.fromDate,e.toDate,null,"[]"))}))},rt.prototype._getConflicts=function(){var e=this,t=[],r=null;if(-1!=["creating","open"].indexOf(this.status)&&this.items&&this.items.length&&(this.location||this.from&&this.to||this.items.filter((function(e){return"available"!==e.canReserve})))){var i=this.location?this._getId(this.location):null,s=this.from&&this.to&&"open"==this.status,n=null!=i,o=!(null!=this.contact&&"active"==this.contact.status&&"maintenance"==this.contact.kind);return this.ds.call(this.id,"getConflicts").then((function(a){return a=a||[],e.items.forEach((function(c){if((r=a.find((function(e){return e.item==c._id})))&&"flag"==r.kind&&!o&&(r=null),r){var u=r.kind||"";if("flag"==(u=(u=u||(r.order?"order":""))||(r.reservation?"reservation":""))&&!o)return!0;t.push(new ge({kind:u,item:c._id,itemName:c.name,doc:r.conflictsWith,fromDate:r.fromDate,toDate:r.toDate,locationCurrent:r.locationCurrent,locationDesired:r.locationDesired}))}else o&&e.unavailableFlagHelper(c.flag)?t.push(new ge({kind:"flag",item:c._id,flag:c.flag,doc:c.order})):"unavailable_allow"==c.canReserve?t.push(new ge({kind:"not_allowed_reservation",item:c._id,itemName:c.name})):"open"==e.status&&"unavailable_allow"==c.canOrder?t.push(new ge({kind:"not_allowed_order",item:c._id,itemName:c.name})):"expired"==c.status?t.push(new ge({kind:"expired",item:c._id,itemName:c.name,doc:c.order})):"in_custody"==c.status?t.push(new ge({kind:"custody",item:c._id,itemName:c.name,doc:c.order})):s&&"available"!=c.status?t.push(new ge({kind:"order",item:c._id,itemName:c.name,doc:c.order})):n&&c.location!=i&&t.push(new ge({kind:"location",item:c._id,itemName:c.name,locationCurrent:c.location,locationDesired:i,doc:c.order}))})),t}))}return Promise.resolve(t)},rt.prototype.setFromToDate=function(e,t,r){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot set reservation from / to date, status is "+this.status);var i=this,s=this._getDateHelper().roundTimeFrom(e),n=t?this._getDateHelper().roundTimeTo(t):this._getDateHelper().addAverageDuration(s);return this._checkFromToDate(s,n).then((function(){return i.from=s,i.to=n,i._doApiCall({method:"setFromToDate",params:{fromDate:s,toDate:n},skipRead:r})}))},rt.prototype.setFromDate=function(e,t){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot set reservation from date, status is "+this.status);var r=this,i=this._getDateHelper(),s=i.roundMinutes,n=i.roundTimeFrom(e);return this._checkFromDateBetweenMinMax(n).then((function(){if(r.to&&r.to.diff(n,"minutes")<s)throw new h.ApiUnprocessableEntity("Cannot set reservation from date, after (or too close to) to date "+r.to.toJSONDate());return r.from=n,r.existsInDb()?r._doApiCall({method:"setFromDate",params:{fromDate:n},skipRead:t}):r._createTransaction(t)}))},rt.prototype.clearFromDate=function(e){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot clear reservation from date, status is "+this.status);return this.from=null,this._doApiCall({method:"clearFromDate",skipRead:e})},rt.prototype.setToDate=function(e,t){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot set reservation to date, status is "+this.status);var r=this,i=this._getDateHelper(),s=i.roundMinutes,n=i.roundTimeTo(e);return this._checkToDateBetweenMinMax(n).then((function(){if(r.from&&r.from.diff(n,"minutes")>s)throw new h.ApiUnprocessableEntity("Cannot set reservation to date, before (or too close to) to date "+r.from.toJSONDate());return r.to=n,r.existsInDb()?r._doApiCall({method:"setToDate",params:{toDate:n},skipRead:t}):r._createTransaction(t)}))},rt.prototype.clearToDate=function(e){if("creating"!=this.status)throw new h.ApiUnprocessableEntity("Cannot clear reservation to date, status is "+this.status);return this.to=null,this._doApiCall({method:"clearToDate",skipRead:e})},rt.prototype.clearDueDate=function(e){throw"Reservation.clearDueDate not implemented"},rt.prototype.setDueDate=function(e,t){throw"Reservation.setDueDate not implemented"},rt.prototype.searchItems=function(e,t,r,i){return this._searchItems(e,null,!0,r,i||this.items)},rt.prototype.reserve=function(e,t){var r=this;return this._doApiCall({method:"reserve",skipRead:e}).then((function(e){return e}),(function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status open")?r.get():Promise.reject(e)}))},rt.prototype.undoReserve=function(e,t){var r=this;return this._doApiCall({method:"undoReserve",skipRead:e}).then((function(e){return e}),(function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status creating")?r.get():Promise.reject(e)}))},rt.prototype.cancel=function(e,t,r){var i=this;return this._doApiCall({method:"cancel",params:{message:e||""},skipRead:t}).then((function(e){return e}),(function(e){return!r&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status cancelled")?i.get():Promise.reject(e)}))},rt.prototype.cancelRepeat=function(e,t,r){var i=this;return this._doApiCall({method:"cancelRepeat",params:{message:e||""},skipRead:t}).then((function(e){return e}),(function(e){return!r&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status cancelled")?i.get():Promise.reject(e)}))},rt.prototype.close=function(e,t,r){var i=this;return this._doApiCall({method:"close",params:{message:e||""},skipRead:t}).then((function(e){return e}),(function(e){return!r&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status closed_manually")?i.get():Promise.reject(e)}))},rt.prototype.undoClose=function(e,t){var r=this;return this._doApiCall({method:"undoClose",skipRead:e}).then((function(e){return e}),(function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status open")?r.get():Promise.reject(e)}))},rt.prototype.makeOrder=function(e){var t=this;return this._doApiCall({method:"makeOrder",skipRead:!0}).then((function(e){return e}),(function(r){return!e&&r&&422==r.code&&r.opt&&-1!=r.opt.detail.indexOf("reservation has status closed")?t.get().then((function(e){return{_id:t._getId(e.order)}})):Promise.reject(r)}))},rt.prototype.switchToOrder=function(){return this._doApiCall({method:"switchToOrder",skipRead:!0})},rt.prototype.generateDocument=function(e,t,r){return this._doApiLongCall({method:"generateDocument",params:{template:e,signature:t},skipRead:r})},rt.prototype.canReserveAgain=function(){return this._doApiLongCall({method:"canReserveAgain",params:{_fields:"null"},skipRead:!0})},rt.prototype.reserveAgain=function(e,t){return this._doApiLongCall({method:"reserveAgain",params:e,skipRead:t})},rt.prototype.reserveRepeat=function(e,t,r,i){return this._doApiLongCall({method:"reserveRepeat",params:{frequency:e,until:t,customer:r,location:i},skipRead:!0})},rt.prototype._checkFromToDate=function(e,t){var r=this._getDateHelper(),i=e,s=t;if(i&&s)return Promise.all(this._checkFromDateBetweenMinMax(i),this._checkToDateBetweenMinMax(s)).then((function(e,t){var n=r.roundMinutes;if(s.diff(i,"minutes")<n)throw new h.ApiUnprocessableEntity("Cannot set order from date, after (or too close to) to date "+s.toJSONDate());if(i.diff(s,"minutes")>n)throw new h.ApiUnprocessableEntity("Cannot set order due date, before (or too close to) from date "+i.toJSONDate())}));if(i)return this._checkFromDateBetweenMinMax(i);if(s)return this._checkToDateBetweenMinMax(s);throw new h.ApiUnprocessableEntity("Cannot from/due date, both are null")},rt.prototype._getUnavailableItems=function(){var e={};return"open"==this.status&&this.location&&null!=this.items&&this.items.length>0&&this.items.forEach((function(t){"available"!=t.status&&(e.status=e.status||[],e.status.push(t._id))})),e};var it=rt,st={id:"",status:"inactive",name:"",body:"",format:"",kind:"",width:0,height:0,unit:"inch",askSignature:!1,system:!0,archived:null,createdBy:null,createdOn:null,modifiedBy:null,modifiedOn:null},nt=function(){};nt.prototype=K.prototype;var ot=function(e){var t=Object.assign({},e);K.call(this,t),this.name=t.name||st.name,this.status=t.status||st.status,this.body=t.body||st.body,this.format=t.format||st.format,this.kind=t.kind||st.kind,this.askSignature=null!=t.askSignature?1==t.askSignature:st.askSignature,this.width=t.width||st.width,this.height=t.height||st.height,this.unit=t.unit||st.unit,this.system=null!=t.system?1==t.system:st.system,this.archived=t.archived||st.archived,this.createdBy=t.createdBy||st.createdBy,this.createdOn=t.createdOn||st.createdOn,this.modifiedBy=t.modifiedBy||st.modifiedBy,this.modifiedOn=t.modifiedOn||st.modifiedOn};(ot.prototype=new nt).constructor=ot,ot.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=3},ot.prototype.isValid=function(){return this.isValidName()},ot.prototype._getDefaults=function(){return st},ot.prototype.isEmpty=function(){return K.prototype.isEmpty.call(this)&&this.name==st.name},ot.prototype.isArchived=function(){return V.templateIsArchived(this)},ot.prototype.isDirty=function(){var e=K.prototype.isDirty.call(this);return!e&&this.raw&&(e=this.name!=this.raw.name||this.body!=this.raw.body||this.format!=this.raw.format||this.kind!=this.raw.kind||this.askSignature!=this.raw.askSignature||this.width!=this.raw.width||this.height!=this.raw.height||this.unit!=this.raw.unit),e},ot.prototype.clone=function(){return this.ds.call(this.id,"clone")},ot.prototype.archive=function(e){return this._doApiCall({method:"archive",skipRead:e})},ot.prototype.undoArchive=function(e){return this._doApiCall({method:"undoArchive",skipRead:e})},ot.prototype.activate=function(e){return this._doApiCall({method:"activate",skipRead:e})},ot.prototype.deactivate=function(e){return this._doApiCall({method:"deactivate",skipRead:e})},ot.prototype.canDelete=function(){return V.templateCanDelete(this)},ot.prototype.canActivate=function(){return V.templateCanActivate(this)},ot.prototype.canDeactivate=function(){return V.templateCanDeactivate(this)},ot.prototype.canArchive=function(){return V.templateCanArchive(this)},ot.prototype.canUndoArchive=function(){return V.templateCanUndoArchive(this)},ot.prototype._toJson=function(e){var t=K.prototype._toJson.call(this,e);return t.name=this.name,t.body=this.body,t.kind=this.kind,t.askSignature=this.askSignature,t.width=this.width,t.height=this.height,t.unit=this.unit,t},ot.prototype._fromJson=function(e,t){var r=this;return K.prototype._fromJson.call(this,e,t).then((function(){return r.name=e.name||st.name,r.status=e.status||st.status,r.body=e.body||st.body,r.format=e.format||st.format,r.kind=e.kind||st.kind,r.askSignature=null!=e.askSignature?1==e.askSignature:st.askSignature,r.width=e.width||st.width,r.height=e.height||st.height,r.unit=e.unit||st.unit,r.system=null!=e.system?1==e.system:st.system,r.archived=e.archived||st.archived,r.createdBy=e.createdBy||st.createdBy,r.createdOn=e.createdOn||st.createdOn,r.modifiedBy=e.modifiedBy||st.modifiedBy,r.modifiedOn=e.modifiedOn||st.modifiedOn,e}))};var at=ot;function ct(e,t,r,i,s,n,o){try{var a=e[n](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(i,s)}function ut(e){return function(){var t=this,r=arguments;return new Promise((function(i,s){var n=e.apply(t,r);function o(e){ct(n,i,s,o,a,"next",e)}function a(e){ct(n,i,s,o,a,"throw",e)}o(void 0)}))}}var lt={kind:"ldap",name:"",host:"ldap://yourdomain.com",port:389,timeOut:60,login:"",password:"",newUsers:"create",existingUsers:"update",missingUsers:"ignore",overwriteLocalUsers:!0,autoSync:!1,role:"",query:"(cn=*)",base:"ou=team,dc=yourdomain,dc=com",loginField:"uid",nameField:"cn",emailField:"mail",restrictLocations:[],timezone:"Etc/GMT",hostCert:"ldap_tls_demand",caCert:"",report:"always",reportEmail:""},dt=function(){};dt.prototype=de.prototype;var ht=function(e){var t=Object.assign({_fields:["*"]},e);de.call(this,t),this.helper=t.helper,this.kind=t.kind||lt.kind,this.name=t.name||lt.name,this.host=t.host||lt.host,this.port=t.port||lt.port,this.timeOut=t.timeOut||lt.timeOut,this.login=t.login||lt.login,this.password=t.password||lt.password,this.newUsers=t.newUsers||lt.newUsers,this.existingUsers=t.existingUsers||lt.existingUsers,this.missingUsers=t.missingUsers||lt.missingUsers,this.autoSync=null!=t.autoSync?t.autoSync:lt.autoSync,this.overwriteLocalUsers=null!=t.overwriteLocalUsers?t.overwriteLocalUsers:lt.overwriteLocalUsers,this.role=t.role||lt.role,this.query=t.query||lt.query,this.base=t.base||lt.base,this.loginField=t.loginField||lt.loginField,this.nameField=t.nameField||lt.nameField,this.emailField=t.emailField||lt.emailField,this.restrictLocations=t.restrictLocations?t.restrictLocations.slice():lt.restrictLocations.slice(),this.timezone=t.timezone||lt.timezone,this.hostCert=t.hostCert||lt.hostCert,this.caCert=t.caCert||lt.caCert,this.report=t.report||lt.report,this.reportEmail=t.reportEmail||lt.reportEmail};(ht.prototype=new dt).constructor=ht,ht.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=3},ht.prototype.isValid=function(){return this.isValidName()},ht.prototype.isEmpty=function(){return de.prototype.isEmpty.call(this)&&this.kind==lt.kind&&this.name==lt.name&&this.host==lt.host&&this.port==lt.port&&this.timeOut==lt.timeOut&&this.login==lt.login&&this.password==lt.password&&this.newUsers==lt.newUsers&&this.existsingUsers==lt.existingUsers&&this.missingUsers==lt.missingUsers&&this.autoSync==lt.autoSync&&this.overwriteLocalUsers==lt.overwriteLocalUsers&&this.role==lt.role&&this.query==lt.query&&this.base==lt.base&&this.loginField==lt.loginField&&this.nameField==lt.nameField&&this.emailField==lt.emailField&&this.timezone==lt.timezone&&this.hostCert==lt.hostCert&&this.caCert==lt.caCert&&this.report==lt.report&&this.reportEmail==lt.reportEmail&&this.restrictLocations&&0==this.restrictLocations.length},ht.prototype.isDirty=function(){return this._isDirtyInfo()||this._isDirtyRestrictLocations()},ht.prototype._isDirtyInfo=function(){var e=de.prototype.isDirty.call(this);if(!e&&this.raw){var t=this.raw.kind||lt.kind,r=this.raw.name||lt.name,i=this.raw.host||lt.host,s=this.raw.port||lt.port,n=this.raw.timeOut||lt.timeOut,o=this.raw.login||lt.login,a=this.raw.password||lt.password,c=this.raw.newUsers||lt.newUsers,u=this.raw.existingUsers||lt.existingUsers,l=this.raw.missingUsers||lt.missingUsers,d=null!=this.raw.autoSync?this.raw.autoSync:lt.autoSync,h=null!=this.raw.overwriteLocalUsers?this.raw.overwriteLocalUsers:lt.overwriteLocalUsers,p=this.raw.role||lt.role,m=this.raw.query||lt.query,f=this.raw.base||lt.base,y=this.raw.loginField||lt.loginField,g=this.raw.nameField||lt.nameField,v=this.raw.emailField||lt.emailField,_=this.raw.timezone||lt.timezone,w=this.raw.hostCert||lt.hostCert,C=this.raw.caCert||lt.caCert,R=this.raw.report||lt.report,k=this.raw.reportEmail||lt.reportEmail;return this.kind!=t||this.name!=r||this.host!=i||this.port!=s||this.timeOut!=n||this.login!=o||this.password!=a||this.newUsers!=c||this.existingUsers!=u||this.missingUsers!=l||this.autoSync!=d||this.overwriteLocalUsers!=h||this.role!=p||this.query!=m||this.base!=f||this.loginField!=y||this.nameField!=g||this.emailField!=v||this.timezone!=_||this.hostCert!=w||this.caCert!=C||this.report!=R||this.reportEmail!=k||this._isDirtyRestrictLocations()}return e},ht.prototype._isDirtyRestrictLocations=function(){if(this.raw){var e=this,t=this.raw.restrictLocations||lt.restrictLocations;return this.restrictLocations.filter((function(e){return t.indexOf(e)<0})).length>0||t.filter((function(t){return e.restrictLocations.indexOf(t)<0})).length>0}return!1},ht.prototype._getDefaults=function(){return lt},ht.prototype.clone=function(){return this.ds.call(this.id,"clone")},ht.prototype.testConnection=function(){return this.ds.call(this.id,"testConnection")},ht.prototype.syncUsers=function(e){return this.ds.call(this.id,"syncUsers",{wetRun:e})},ht.prototype._toJson=function(e){var t=de.prototype._toJson.call(this,e);return t.kind=this.kind||lt.kind,t.name=this.name||lt.name,t.host=this.host||lt.host,t.port=this.port||lt.port,t.timeOut=this.timeOut||lt.timeOut,t.login=this.login||lt.login,this.password&&(t.password=this.password),t.newUsers=this.newUsers||lt.newUsers,t.existingUsers=this.existingUsers||lt.existingUsers,t.missingUsers=this.missingUsers||lt.missingUsers,t.autoSync=null!=this.autoSync?this.autoSync:lt.autoSync,t.overwriteLocalUsers=null!=this.overwriteLocalUsers?this.overwriteLocalUsers:lt.overwriteLocalUsers,t.role=this.role||lt.role,t.query=this.query||lt.query,t.base=this.base||lt.base,t.loginField=this.loginField||lt.loginField,t.nameField=this.nameField||lt.nameField,t.emailField=this.emailField||lt.emailField,t.timezone=this.timezone||lt.timezone,t.hostCert=this.hostCert||lt.hostCert,t.caCert=this.caCert||lt.caCert,t.report=this.report||lt.report,t.reportEmail=this.reportEmail||lt.reportEmail,t},ht.prototype._fromJson=function(e,t){var r=this;return de.prototype._fromJson.call(this,e,t).then((function(){return r.kind=e.kind||lt.kind,r.name=e.name||lt.name,r.host=e.host||lt.host,r.port=e.port||lt.port,r.timeOut=e.timeOut||lt.timeOut,r.login=e.login||lt.login,r.password=e.password||lt.password,r.newUsers=e.newUsers||lt.newUsers,r.existingUsers=e.existingUsers||lt.existingUsers,r.missingUsers=e.missingUsers||lt.missingUsers,r.autoSync=null!=e.autoSync?e.autoSync:lt.autoSync,r.overwriteLocalUsers=null!=e.overwriteLocalUsers?e.overwriteLocalUsers:lt.overwriteLocalUsers,r.role=e.role||lt.role,r.query=e.query||lt.query,r.base=e.base||lt.base,r.loginField=e.loginField||lt.loginField,r.nameField=e.nameField||lt.nameField,r.emailField=e.emailField||lt.emailField,r.restrictLocations=e.restrictLocations?e.restrictLocations.slice():lt.restrictLocations.slice(),r.timezone=e.timezone||lt.timezone,r.hostCert=e.hostCert||lt.hostCert,r.caCert=e.caCert||lt.caCert,r.report=e.report||lt.report,r.reportEmail=e.reportEmail||lt.reportEmail,e}))},ht.prototype.setRestrictLocations=function(){var e=ut((function*(e,t){if(!this.existsInDb())throw new Error("Usersync does not exist in database");return this._doApiCall({method:"setRestrictLocations",params:{restrictLocations:e},skipRead:t})}));return function(t,r){return e.apply(this,arguments)}}(),ht.prototype.clearRestrictLocations=function(){var e=ut((function*(e){if(!this.existsInDb())throw new Error("Usersync does not exist in database");return this._doApiCall({method:"clearRestrictLocations",skipRead:e})}));return function(t){return e.apply(this,arguments)}}(),ht.prototype.update=function(){var e=ut((function*(e){if(this.isEmpty())throw new Error("Cannot update to empty usersync");if(!this.existsInDb())throw new Error("Cannot update usersync without id");if(!this.isValid())throw new Error("Cannot update, invalid usersync");var t,r,i=this,s=this._toJson();return r=this._isDirtyInfo()?this.ds.update(this.id,s,this._fields).then((function(e){i._fromJson(e)})):Promise.resolve(),t=this._isDirtyRestrictLocations()?0!=this.restrictLocations.length?this.setRestrictLocations(this.restrictLocations,!0):this.clearRestrictLocations(!0):Promise.resolve(),Promise.all(r,t)}));return function(t){return e.apply(this,arguments)}}(),ht.prototype.create=function(e){if(this.existsInDb())throw new Error("Cannot create document, already exists in database");if(this.isEmpty())throw new Error("Cannot create empty document");return this._create(e)};var pt=ht;function mt(e,t,r,i,s,n,o){try{var a=e[n](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(i,s)}function ft(e){return function(){var t=this,r=arguments;return new Promise((function(i,s){var n=e.apply(t,r);function o(e){mt(n,i,s,o,a,"next",e)}function a(e){mt(n,i,s,o,a,"throw",e)}o(void 0)}))}}var yt={id:"",name:"",address:"",topic:"",hookFields:"*, location.*, items.*, customer.*,by.name,by.email",format:"",created:null,modified:null,enabled:!0,log10:[],fails:0,minutes:0},gt=function(){};gt.prototype=K.prototype;var vt=function(e){var t=Object.assign({},e);K.call(this,t),this.name=t.name||yt.name,this.address=t.address||yt.address,this.topic=t.topic||yt.topic,this.hookFields=t.hookFields||yt.hookFields,this.created=t.created||yt.created,this.modified=t.modified||yt.modified,this.enabled=null!=t.enabled?1==t.enabled:yt.enabled,this.log10=t.log10||yt.log10.slice(),this.fails=t.fails||yt.fails,this.minutes=t.minutes||yt.minutes};(vt.prototype=new gt).constructor=vt,vt.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=3},vt.prototype.isValidAddress=function(){return this.address=this.address.trim(),k.isValidURL(this.address)},vt.prototype.isValid=function(){return this.isValidName()&&this.isValidAddress()&&this.topic},vt.prototype._getDefaults=function(){return yt},vt.prototype.isEmpty=function(){return K.prototype.isEmpty.call(this)&&this.name==yt.name&&this.address==yt.address&&this.topic==yt.topic},vt.prototype.isDirty=function(){var e=K.prototype.isDirty.call(this);return!e&&this.raw&&(e=this.name!=this.raw.name||this.address!=this.raw.address||this.topic!=this.raw.topic||this.enabled!=this.raw.enabled||this.minutes!=this.raw.minutes),e},vt.prototype.canDelete=ft((function*(){return!0})),vt.prototype._toJson=function(e){var t=K.prototype._toJson.call(this,e);return t.name=this.name,t.address=this.address,t.topic=this.topic,t.fields=this.hookFields,t.enabled=this.enabled,t.minutes=this.minutes,t},vt.prototype._fromJson=function(e,t){var r=this;return K.prototype._fromJson.call(this,e,t).then((function(){return r.name=e.name||yt.name,r.address=e.address||yt.address,r.topic=e.topic||yt.topic,r.hookFields=e.fields||yt.hookFields,r.created=e.created_at||yt.created,r.modified=e.modified||yt.modified,r.enabled=null!=e.enabled?1==e.enabled:yt.enabled,r.log10=e.log10||yt.log10.slice(),r.fails=e.nr_consecutive_fails||yt.fails,r.minutes=e.minutes||yt.minutes,e}))};var _t=vt,wt={name:"",summary:"",status:"open",numTotal:0,numUnexpected:0,numChecked:0,numUnchecked:0,numIssues:0,by:{},kind:"",docId:null,created:null,closed:null,users:[],note:"",address:"",archived:null,itemFilter:{}},Ct=function(){};Ct.prototype=de.prototype;var Rt=function(e){var t=Object.assign({_fields:["*"],crtype:"cheqroom.types.spotcheck"},e);de.call(this,t),this.name=t.name||wt.name,this.summary=t.summary||wt.summary,this.status=t.status||wt.status,this.numTotal=t.numTotal||wt.numTotal,this.numChecked=t.numChecked||wt.numChecked,this.numUnchecked=t.numUnchecked||wt.numUnchecked,this.numUnexpected=t.numUnexpected||wt.numUnexpected};(Rt.prototype=new Ct).constructor=Rt,Rt.prototype.isValidName=function(){return this.name=this.name.trim(),this.name.length>=3},Rt.prototype.canDelete=function(){return"open"==this.status},Rt.prototype.canArchive=function(){return"closed"==this.status&&!this.archived},Rt.prototype.canUndoArchive=function(){return null!=this.archived},Rt.prototype.canSpotcheckAgain=function(){return"closed"===this.status},Rt.prototype.isValid=function(){return this.isValidName()},Rt.prototype.isDirty=function(){var e=de.prototype.isDirty.call(this);return!e&&this.raw&&(e=this._isDirtyStringProperty("name")),e||this.isDirtyItems()},Rt.prototype.setName=function(e,t){return this._doApiCall({method:"setName",params:{name:e},skipRead:t})},Rt.prototype.clearName=function(e){return this._doApiCall({method:"clearName",skipRead:e})},Rt.prototype.getEntries=function(e){return this._doApiCall({method:"getEntries",params:e,skipRead:!0})},Rt.prototype.create=function(e,t){return this._doApiCall({method:"create",params:e,skipRead:t,usePost:!0})},Rt.prototype.markEntriesAsScanned=function(e,t,r){var i=Object.assign({scanItems:e},t);return this._doApiCall({method:"markEntriesAsScanned",params:i,skipRead:r})},Rt.prototype.unmarkEntriesAsScanned=function(e,t){var r={scanItems:e};return this._doApiCall({method:"unmarkEntriesAsScanned",params:r,skipRead:t})},Rt.prototype.searchEntriesByCodes=function(e){return this._doApiCall({method:"searchEntriesByCodes",params:{codes:e,_fields:"*"},skipRead:!0})},Rt.prototype.close=function(e,t){return this._doApiCall({method:"close",params:{message:e},skipRead:t})},Rt.prototype.archive=function(e){if(!this.canArchive())throw new Error("Cannot archive document");return this._doApiCall({method:"archive",params:{},skipRead:e})},Rt.prototype.undoArchive=function(e){return this._doApiCall({method:"undoArchive",params:{},skipRead:e})},Rt.prototype.spotcheckAgain=function(){return this._doApiCall({method:"spotcheckAgain",params:{name:this.name},skipRead:!0})},Rt.prototype._getDefaults=function(){return wt},Rt.prototype._toJson=function(e){var t=de.prototype._toJson.call(this,e);return t.name=this.name||wt.name,t},Rt.prototype._fromJson=function(e,t){var r=this;return de.prototype._fromJson.call(this,e,t).then((function(e){return r.name=e.name||wt.name,r.summary=e.summary||wt.summary,r.status=e.status||wt.status,r.numTotal=e.numTotal||wt.numTotal,r.numUnexpected=e.numUnexpected||wt.numUnexpected,r.numChecked=e.numChecked||wt.numChecked,r.numUnchecked=e.numUnchecked||wt.numUnchecked,r.numIssues=e.numIssues||wt.numIssues,r.kind=e.kind||wt.kind,r.docId=e.docId||wt.docId,r.created=e.created||wt.created,r.finished=e.closed||wt.closed,r.users=e.users||wt.users,r.note=e.message||wt.note,r.address=e.lastAddress||wt.address,r.archived=e.archived||wt.archived,r.itemFilter=e.itemFilter||wt.itemFilter,r.by=e.by||wt.by,e}))};var kt=Rt,Et={};Et.api=h,Et.common=V,Et.Availability=X,Et.Attachment=re,Et.Base=de,Et.Category=fe,Et.Comment=se,Et.Conflict=ge,Et.Contact=Te,Et.DateHelper=be,Et.Document=K,Et.Group=xe,Et.Item=Fe,Et.Kit=Ve,Et.Location=qe,Et.Order=Xe,Et.PermissionHandler=et,Et.Reservation=it,Et.Template=at,Et.Transaction=Ye,Et.User=Ce,Et.UserSync=pt,Et.WebHook=_t,Et.Helper=Re,Et.ColorLabel=J,Et.Field=ae,Et.Spotcheck=kt;var Dt=Et}(),s}()}));