/*! core 2016-11-24 */
!function(a){"function"==typeof define&&define.amd?define(["jquery","moment","jquery-jsonp","jquery-pubsub"],a):a($,moment,jsonp,pubsub)}(function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa;return e={isCodeValid:function(a){return null!=a.trim().match(/^[a-z0-9]{8}$/i)},isCodeFromScanner:function(a){if(!a||0==a.length)return!1;var b=a.substring(0,23),c="http://cheqroom.com/qr/".indexOf(b);return 0==c},isValidBarcode:function(a){return a&&null!=a.match(/^[0-9\-]{4,}$/i)},isValidQRCode:function(a){return this.isValidItemQRCode(a)||this.isValidTransferQRCode(a)},isValidTransferQRCode:function(a){return null!=a.match(/^http:\/\/cheqroom\.com\/ordertransfer\/[a-zA-Z0-9]{22}$/i)},isValidDocQRCode:function(a){return a&&null!=a.match(/^http:\/\/cheqroom\.com\/qr\/[a-z0-9]{8}$/i)},isValidItemQRCode:function(a){return this.isValidDocQRCode(a)},isValidKitQRCode:function(a){return this.isValidDocQRCode(a)},getCheqRoomRedirectUrl:function(a){return this.isCodeValid(a)?"http://cheqroom.com/qr/"+a.trim():""},getCheqRoomRedirectUrlQR:function(a,b){if(this.isCodeValid(a)){var c=encodeURI(this.getCheqRoomRedirectUrl(a));return"https://chart.googleapis.com/chart?chs="+b+"x"+b+"&cht=qr&choe=UTF-8&chld=L|0&chl="+c}return""}},f=function(a){return{getFriendlyOrderStatus:function(a){switch(a){case"creating":return"Incomplete";case"open":return"Open";case"closed":return"Closed";default:return"Unknown"}},getFriendlyOrderCss:function(a){switch(a){case"creating":return"label-creating";case"open":return"label-open";case"closed":return"label-closed";default:return""}},getFriendlyOrderSize:function(a){if(a.items&&a.items.length>0){var b=a.items.length+" item";return a.items.length>1&&(b+="s"),b}return"No items"},isOrderOverdue:function(b,c){return c=c||a(),"open"==b.status&&c.isAfter(b.due)},isOrderArchived:function(a){return a&&null!=a.archived},getOrderStatus:function(b,c){return c=c||a(),this.isOrderOverdue(b,c)?"Overdue":this.getFriendlyOrderStatus(b.status)},getOrderCss:function(b,c){return c=c||a(),this.isOrderOverdue(b,c)?"label-overdue":this.isOrderArchived(b)?this.getFriendlyOrderCss(b.status)+" label-striped":this.getFriendlyOrderCss(b.status)}}}(b),g={getFriendlyReservationCss:function(a){switch(a){case"creating":return"label-creating";case"open":return"label-open";case"closed":return"label-closed";case"cancelled":return"label-cancelled";default:return""}},getFriendlyReservationStatus:function(a){switch(a){case"creating":return"Incomplete";case"open":return"Open";case"closed":return"Closed";case"cancelled":return"Cancelled";default:return"Unknown"}},isReservationArchived:function(a){return a&&null!=a.archived},getReservationCss:function(a){return this.isOrderArchived(a)?this.getFriendlyReservationCss(a.status)+" label-striped":this.getFriendlyReservationCss(a.status)}},h={getFriendlyItemStatus:function(a){switch(a){case"available":return"Available";case"checkedout":return"Checked out";case"await_checkout":return"Checking out";case"in_transit":return"In transit";case"in_custody":return"In custody";case"maintenance":return"Maintenance";case"repair":return"Repair";case"inspection":return"Inspection";case"expired":return"Expired";default:return"Unknown"}},getItemStatusCss:function(a){switch(a){case"available":return"label-available";case"checkedout":return"label-checkedout";case"await_checkout":return"label-awaitcheckout";case"in_transit":return"label-transit";case"in_custody":return"label-custody";case"maintenance":return"label-maintenance";case"repair":return"label-repair";case"inspection":return"label-inspection";case"expired":return"label-expired";default:return""}},getItemStatusIcon:function(a){switch(a){case"available":return"fa fa-check-circle";case"checkedout":return"fa fa-times-circle";case"await_checkout":return"fa fa-ellipsis-h";case"in_transit":return"fa fa-truck";case"in_custody":return"fa fa-exchange";case"maintenance":return"fa fa-wrench";case"repair":return"fa fa-wrench";case"inspection":return"fa fa-stethoscope";case"expired":return"fa fa-bug";default:return""}},getItemsByStatus:function(a,b){return a?a.filter(function(a){return"string"==typeof b?a.status==b:b(a)}):[]},getAvailableItems:function(a){return this.getItemsByStatus(a,"available")},getActiveItems:function(a){return this.getItemsByStatus(a,function(a){return"expired"!=a.status&&"in_custody"!=a.status})}},i={getFriendlyConflictKind:function(a){switch(a){case"location":return"At wrong location";case"order":return"Checked out";case"reservation":return"Already reserved";case"expired":return"Item is expired";case"custody":return"Item is in custody";default:return""}}},j=function(){var a=function(a){return"string"==typeof a?a:a.name};return{getCategoryKeyFromName:function(a){return"cheqroom.types.item."+a.split(" ").join("_").split(".").join("").toLowerCase()},getCategoryNameFromKey:function(a){var b=new RegExp("_","g");return a.split(".").pop().replace(b," ")},getCategorySummary:function(b){if(b=b||[],0==b.length)return"No items";for(var c=null,d=null,e=null,f={},g="",h=0,i=0,j=b.length;i<j;i++)c=b[i],e=c.category?a(c.category):"",d=e?this.getCategoryNameFromKey(e):"",f[d]?f[d]+=1:f[d]=1,f[d]>h&&(g=d,h=f[d]);var k=f[g]+" ";if(k+=1==h&&String.prototype.singularize?g.singularize():g,b.length>f[g]){var l=b.length-f[g];k+=" +"+l+" other"}return k},getItemSummary:function(a){if(a=a||[],0==a.length)return"No items";for(var b=", ",c=null,d=0,e={},f=[],g=0,h=a.length;g<h;g++)c=a[g],c.kit&&c.kit.name?e[c.kit.name]?e[c.kit.name].push(c):(e[c.kit.name]=[c],d+=1):f.push(c);if(0==d)return this.getCategorySummary(a);var i=$.map(e,function(a,b){return b});if(0==f.length){var j=30;return i.joinOther(j,b,"other kits")}return 1==d?i[0]+b+this.getCategorySummary(f):h(i)+" kits"+b+this.getCategorySummary(f)}}}(),k=function(a){return{getAvatarInitial:function(b,c){var d={XS:32,S:64,M:128,L:256,XL:512},e=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7"],f=b.split(" "),g=2==f.length?f[0].charAt(0).toUpperCase()+f[1].charAt(0).toUpperCase():f[0].charAt(0).toUpperCase(),h=g.charCodeAt(0)-65,i=h%e.length,j=d[c],k=d[c],l=j,m=k,n=a("<canvas />").attr({width:j,height:k}),o=n.get(0).getContext("2d");return window.devicePixelRatio&&(n.attr("width",j*window.devicePixelRatio),n.attr("height",k*window.devicePixelRatio),n.css("width",l),n.css("height",m),o.scale(window.devicePixelRatio,window.devicePixelRatio)),o.fillStyle=e[i],o.fillRect(0,0,j,k),o.font=j/2+"px Arial",o.textAlign="center",o.fillStyle="#FFF",o.fillText(g,l/2,m/1.5),n.get(0).toDataURL()},getMaintenanceAvatar:function(b){var c={XS:32,S:64,M:128,L:256,XL:512},d=c[b],e=c[b],f=d,g=e,h=a("<canvas />").attr({width:d,height:e}),i=h.get(0).getContext("2d");return window.devicePixelRatio&&(h.attr("width",d*window.devicePixelRatio),h.attr("height",e*window.devicePixelRatio),h.css("width",f),h.css("height",g),i.scale(window.devicePixelRatio,window.devicePixelRatio)),i.fillStyle="#f5f5f5",i.fillRect(0,0,d,e),i.font=d/2+"px FontAwesome",i.textAlign="center",i.fillStyle="#aaa",i.fillText(String.fromCharCode("0xf0ad"),f/2,g/1.5),h.get(0).toDataURL()},getTextImage:function(b,c,d,e){var f={XS:32,S:64,M:128,L:256,XL:512};d||(d="#aaa"),e||(e="#e5e5e5");var g=f[c],h=f[c],i=g,j=h,k=a("<canvas />").attr({width:g,height:h}),l=k.get(0).getContext("2d");return window.devicePixelRatio&&(k.attr("width",g*window.devicePixelRatio),k.attr("height",h*window.devicePixelRatio),k.css("width",i),k.css("height",j),l.scale(window.devicePixelRatio,window.devicePixelRatio)),l.fillStyle=e,l.fillRect(0,0,g,h),l.font=g/2.7+"px Arial",l.textAlign="center",l.fillStyle=d,l.fillText(b,i/2,j/1.5),k.get(0).toDataURL()},getImageUrl:function(a,b,c,d){var e=a.getBaseUrl()+b+"?mimeType=image/jpeg";return c&&(e+="&size="+c),d&&(e+="&_bust="+(new Date).getTime()),e},getImageCDNUrl:function(a,b,c,d){var e="https://cheqroom-cdn.s3.amazonaws.com/"+a.amazonBucket+"/groups/"+b+"/"+c;if(d&&d.length>0){var f=e.split(".");f.pop();e=f.join(".")+"-"+d+".jpg"}return e}}}(a),l=function(a){return{getImgFileNameFromName:function(b){return null!=b&&b.length>0?b.split(" ").join("_").split(".").join("_")+".jpg":"upload "+a().format("YYYY-MM-DD at hh:mm:ss a")+".jpg"},makeFileNameJpg:function(a){return a.indexOf(".")>=0?a.substr(0,a.lastIndexOf("."))+".jpg":a},getFileNameFromUrl:function(a){if(a){var b=a.toString().match(/.*\/(.+?)\./);if(b&&b.length>1)return b[1]}return""}}}(b),m=function(){String.prototype.pluralize=function(a,b){return"is"==this&&1!=a?"are":"this"==this?1==a?this:"these":this.endsWith("s")?(b=b||"es",1==a?this:this+b):this.endsWith("y")?(b=b||"ies",1==a?this:this.substr(0,this.length-1)+b):(b=b||"s",1==a?this:this+b)},String.prototype.capitalize=function(a){return(a?this.toLowerCase():this).replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},String.prototype.startsWith||(String.prototype.startsWith=function(a){return 0==this.indexOf(a)}),String.prototype.endsWith||(String.prototype.endsWith=function(a){return!(this.length<a.length)&&this.lastIndexOf(a)==this.length-a.length}),String.prototype.truncate||(String.prototype.truncate=function(a){a=null!=a?a:25;var b=this.match(RegExp("^.{0,"+a+"}[S]*")),c=b[0].length;return b=b[0].replace(/\s$/,""),c<this.length&&(b+="&hellip;"),b}),String.prototype.isValidUrl||(String.prototype.isValidUrl=function(){var a=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return!!a.test(this)}),String.prototype.hashCode||(String.prototype.hashCode=function(){var a,b,c,d=0;if(0==this.length)return d;for(a=0,c=this.length;a<c;a++)b=this.charCodeAt(a),d=(d<<5)-d+b,d|=0;return d});var a={};a.latin_map={"Á":"A","Ă":"A","Ắ":"A","Ặ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ǎ":"A","Â":"A","Ấ":"A","Ậ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ä":"A","Ǟ":"A","Ȧ":"A","Ǡ":"A","Ạ":"A","Ȁ":"A","À":"A","Ả":"A","Ȃ":"A","Ā":"A","Ą":"A","Å":"A","Ǻ":"A","Ḁ":"A","Ⱥ":"A","Ã":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ḃ":"B","Ḅ":"B","Ɓ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ć":"C","Č":"C","Ç":"C","Ḉ":"C","Ĉ":"C","Ċ":"C","Ƈ":"C","Ȼ":"C","Ď":"D","Ḑ":"D","Ḓ":"D","Ḋ":"D","Ḍ":"D","Ɗ":"D","Ḏ":"D","ǲ":"D","ǅ":"D","Đ":"D","Ƌ":"D","Ǳ":"DZ","Ǆ":"DZ","É":"E","Ĕ":"E","Ě":"E","Ȩ":"E","Ḝ":"E","Ê":"E","Ế":"E","Ệ":"E","Ề":"E","Ể":"E","Ễ":"E","Ḙ":"E","Ë":"E","Ė":"E","Ẹ":"E","Ȅ":"E","È":"E","Ẻ":"E","Ȇ":"E","Ē":"E","Ḗ":"E","Ḕ":"E","Ę":"E","Ɇ":"E","Ẽ":"E","Ḛ":"E","Ꝫ":"ET","Ḟ":"F","Ƒ":"F","Ǵ":"G","Ğ":"G","Ǧ":"G","Ģ":"G","Ĝ":"G","Ġ":"G","Ɠ":"G","Ḡ":"G","Ǥ":"G","Ḫ":"H","Ȟ":"H","Ḩ":"H","Ĥ":"H","Ⱨ":"H","Ḧ":"H","Ḣ":"H","Ḥ":"H","Ħ":"H","Í":"I","Ĭ":"I","Ǐ":"I","Î":"I","Ï":"I","Ḯ":"I","İ":"I","Ị":"I","Ȉ":"I","Ì":"I","Ỉ":"I","Ȋ":"I","Ī":"I","Į":"I","Ɨ":"I","Ĩ":"I","Ḭ":"I","Ꝺ":"D","Ꝼ":"F","Ᵹ":"G","Ꞃ":"R","Ꞅ":"S","Ꞇ":"T","Ꝭ":"IS","Ĵ":"J","Ɉ":"J","Ḱ":"K","Ǩ":"K","Ķ":"K","Ⱪ":"K","Ꝃ":"K","Ḳ":"K","Ƙ":"K","Ḵ":"K","Ꝁ":"K","Ꝅ":"K","Ĺ":"L","Ƚ":"L","Ľ":"L","Ļ":"L","Ḽ":"L","Ḷ":"L","Ḹ":"L","Ⱡ":"L","Ꝉ":"L","Ḻ":"L","Ŀ":"L","Ɫ":"L","ǈ":"L","Ł":"L","Ǉ":"LJ","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ń":"N","Ň":"N","Ņ":"N","Ṋ":"N","Ṅ":"N","Ṇ":"N","Ǹ":"N","Ɲ":"N","Ṉ":"N","Ƞ":"N","ǋ":"N","Ñ":"N","Ǌ":"NJ","Ó":"O","Ŏ":"O","Ǒ":"O","Ô":"O","Ố":"O","Ộ":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ö":"O","Ȫ":"O","Ȯ":"O","Ȱ":"O","Ọ":"O","Ő":"O","Ȍ":"O","Ò":"O","Ỏ":"O","Ơ":"O","Ớ":"O","Ợ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ȏ":"O","Ꝋ":"O","Ꝍ":"O","Ō":"O","Ṓ":"O","Ṑ":"O","Ɵ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Õ":"O","Ṍ":"O","Ṏ":"O","Ȭ":"O","Ƣ":"OI","Ꝏ":"OO","Ɛ":"E","Ɔ":"O","Ȣ":"OU","Ṕ":"P","Ṗ":"P","Ꝓ":"P","Ƥ":"P","Ꝕ":"P","Ᵽ":"P","Ꝑ":"P","Ꝙ":"Q","Ꝗ":"Q","Ŕ":"R","Ř":"R","Ŗ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ȑ":"R","Ȓ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꜿ":"C","Ǝ":"E","Ś":"S","Ṥ":"S","Š":"S","Ṧ":"S","Ş":"S","Ŝ":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṩ":"S","Ť":"T","Ţ":"T","Ṱ":"T","Ț":"T","Ⱦ":"T","Ṫ":"T","Ṭ":"T","Ƭ":"T","Ṯ":"T","Ʈ":"T","Ŧ":"T","Ɐ":"A","Ꞁ":"L","Ɯ":"M","Ʌ":"V","Ꜩ":"TZ","Ú":"U","Ŭ":"U","Ǔ":"U","Û":"U","Ṷ":"U","Ü":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ǖ":"U","Ṳ":"U","Ụ":"U","Ű":"U","Ȕ":"U","Ù":"U","Ủ":"U","Ư":"U","Ứ":"U","Ự":"U","Ừ":"U","Ử":"U","Ữ":"U","Ȗ":"U","Ū":"U","Ṻ":"U","Ų":"U","Ů":"U","Ũ":"U","Ṹ":"U","Ṵ":"U","Ꝟ":"V","Ṿ":"V","Ʋ":"V","Ṽ":"V","Ꝡ":"VY","Ẃ":"W","Ŵ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẁ":"W","Ⱳ":"W","Ẍ":"X","Ẋ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ẏ":"Y","Ỵ":"Y","Ỳ":"Y","Ƴ":"Y","Ỷ":"Y","Ỿ":"Y","Ȳ":"Y","Ɏ":"Y","Ỹ":"Y","Ź":"Z","Ž":"Z","Ẑ":"Z","Ⱬ":"Z","Ż":"Z","Ẓ":"Z","Ȥ":"Z","Ẕ":"Z","Ƶ":"Z","Ĳ":"IJ","Œ":"OE","ᴀ":"A","ᴁ":"AE","ʙ":"B","ᴃ":"B","ᴄ":"C","ᴅ":"D","ᴇ":"E","ꜰ":"F","ɢ":"G","ʛ":"G","ʜ":"H","ɪ":"I","ʁ":"R","ᴊ":"J","ᴋ":"K","ʟ":"L","ᴌ":"L","ᴍ":"M","ɴ":"N","ᴏ":"O","ɶ":"OE","ᴐ":"O","ᴕ":"OU","ᴘ":"P","ʀ":"R","ᴎ":"N","ᴙ":"R","ꜱ":"S","ᴛ":"T","ⱻ":"E","ᴚ":"R","ᴜ":"U","ᴠ":"V","ᴡ":"W","ʏ":"Y","ᴢ":"Z","á":"a","ă":"a","ắ":"a","ặ":"a","ằ":"a","ẳ":"a","ẵ":"a","ǎ":"a","â":"a","ấ":"a","ậ":"a","ầ":"a","ẩ":"a","ẫ":"a","ä":"a","ǟ":"a","ȧ":"a","ǡ":"a","ạ":"a","ȁ":"a","à":"a","ả":"a","ȃ":"a","ā":"a","ą":"a","ᶏ":"a","ẚ":"a","å":"a","ǻ":"a","ḁ":"a","ⱥ":"a","ã":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ḃ":"b","ḅ":"b","ɓ":"b","ḇ":"b","ᵬ":"b","ᶀ":"b","ƀ":"b","ƃ":"b","ɵ":"o","ć":"c","č":"c","ç":"c","ḉ":"c","ĉ":"c","ɕ":"c","ċ":"c","ƈ":"c","ȼ":"c","ď":"d","ḑ":"d","ḓ":"d","ȡ":"d","ḋ":"d","ḍ":"d","ɗ":"d","ᶑ":"d","ḏ":"d","ᵭ":"d","ᶁ":"d","đ":"d","ɖ":"d","ƌ":"d","ı":"i","ȷ":"j","ɟ":"j","ʄ":"j","ǳ":"dz","ǆ":"dz","é":"e","ĕ":"e","ě":"e","ȩ":"e","ḝ":"e","ê":"e","ế":"e","ệ":"e","ề":"e","ể":"e","ễ":"e","ḙ":"e","ë":"e","ė":"e","ẹ":"e","ȅ":"e","è":"e","ẻ":"e","ȇ":"e","ē":"e","ḗ":"e","ḕ":"e","ⱸ":"e","ę":"e","ᶒ":"e","ɇ":"e","ẽ":"e","ḛ":"e","ꝫ":"et","ḟ":"f","ƒ":"f","ᵮ":"f","ᶂ":"f","ǵ":"g","ğ":"g","ǧ":"g","ģ":"g","ĝ":"g","ġ":"g","ɠ":"g","ḡ":"g","ᶃ":"g","ǥ":"g","ḫ":"h","ȟ":"h","ḩ":"h","ĥ":"h","ⱨ":"h","ḧ":"h","ḣ":"h","ḥ":"h","ɦ":"h","ẖ":"h","ħ":"h","ƕ":"hv","í":"i","ĭ":"i","ǐ":"i","î":"i","ï":"i","ḯ":"i","ị":"i","ȉ":"i","ì":"i","ỉ":"i","ȋ":"i","ī":"i","į":"i","ᶖ":"i","ɨ":"i","ĩ":"i","ḭ":"i","ꝺ":"d","ꝼ":"f","ᵹ":"g","ꞃ":"r","ꞅ":"s","ꞇ":"t","ꝭ":"is","ǰ":"j","ĵ":"j","ʝ":"j","ɉ":"j","ḱ":"k","ǩ":"k","ķ":"k","ⱪ":"k","ꝃ":"k","ḳ":"k","ƙ":"k","ḵ":"k","ᶄ":"k","ꝁ":"k","ꝅ":"k","ĺ":"l","ƚ":"l","ɬ":"l","ľ":"l","ļ":"l","ḽ":"l","ȴ":"l","ḷ":"l","ḹ":"l","ⱡ":"l","ꝉ":"l","ḻ":"l","ŀ":"l","ɫ":"l","ᶅ":"l","ɭ":"l","ł":"l","ǉ":"lj","ſ":"s","ẜ":"s","ẛ":"s","ẝ":"s","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ᵯ":"m","ᶆ":"m","ń":"n","ň":"n","ņ":"n","ṋ":"n","ȵ":"n","ṅ":"n","ṇ":"n","ǹ":"n","ɲ":"n","ṉ":"n","ƞ":"n","ᵰ":"n","ᶇ":"n","ɳ":"n","ñ":"n","ǌ":"nj","ó":"o","ŏ":"o","ǒ":"o","ô":"o","ố":"o","ộ":"o","ồ":"o","ổ":"o","ỗ":"o","ö":"o","ȫ":"o","ȯ":"o","ȱ":"o","ọ":"o","ő":"o","ȍ":"o","ò":"o","ỏ":"o","ơ":"o","ớ":"o","ợ":"o","ờ":"o","ở":"o","ỡ":"o","ȏ":"o","ꝋ":"o","ꝍ":"o","ⱺ":"o","ō":"o","ṓ":"o","ṑ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","õ":"o","ṍ":"o","ṏ":"o","ȭ":"o","ƣ":"oi","ꝏ":"oo","ɛ":"e","ᶓ":"e","ɔ":"o","ᶗ":"o","ȣ":"ou","ṕ":"p","ṗ":"p","ꝓ":"p","ƥ":"p","ᵱ":"p","ᶈ":"p","ꝕ":"p","ᵽ":"p","ꝑ":"p","ꝙ":"q","ʠ":"q","ɋ":"q","ꝗ":"q","ŕ":"r","ř":"r","ŗ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ȑ":"r","ɾ":"r","ᵳ":"r","ȓ":"r","ṟ":"r","ɼ":"r","ᵲ":"r","ᶉ":"r","ɍ":"r","ɽ":"r","ↄ":"c","ꜿ":"c","ɘ":"e","ɿ":"r","ś":"s","ṥ":"s","š":"s","ṧ":"s","ş":"s","ŝ":"s","ș":"s","ṡ":"s","ṣ":"s","ṩ":"s","ʂ":"s","ᵴ":"s","ᶊ":"s","ȿ":"s","ɡ":"g","ᴑ":"o","ᴓ":"o","ᴝ":"u","ť":"t","ţ":"t","ṱ":"t","ț":"t","ȶ":"t","ẗ":"t","ⱦ":"t","ṫ":"t","ṭ":"t","ƭ":"t","ṯ":"t","ᵵ":"t","ƫ":"t","ʈ":"t","ŧ":"t","ᵺ":"th","ɐ":"a","ᴂ":"ae","ǝ":"e","ᵷ":"g","ɥ":"h","ʮ":"h","ʯ":"h","ᴉ":"i","ʞ":"k","ꞁ":"l","ɯ":"m","ɰ":"m","ᴔ":"oe","ɹ":"r","ɻ":"r","ɺ":"r","ⱹ":"r","ʇ":"t","ʌ":"v","ʍ":"w","ʎ":"y","ꜩ":"tz","ú":"u","ŭ":"u","ǔ":"u","û":"u","ṷ":"u","ü":"u","ǘ":"u","ǚ":"u","ǜ":"u","ǖ":"u","ṳ":"u","ụ":"u","ű":"u","ȕ":"u","ù":"u","ủ":"u","ư":"u","ứ":"u","ự":"u","ừ":"u","ử":"u","ữ":"u","ȗ":"u","ū":"u","ṻ":"u","ų":"u","ᶙ":"u","ů":"u","ũ":"u","ṹ":"u","ṵ":"u","ᵫ":"ue","ꝸ":"um","ⱴ":"v","ꝟ":"v","ṿ":"v","ʋ":"v","ᶌ":"v","ⱱ":"v","ṽ":"v","ꝡ":"vy","ẃ":"w","ŵ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẁ":"w","ⱳ":"w","ẘ":"w","ẍ":"x","ẋ":"x","ᶍ":"x","ý":"y","ŷ":"y","ÿ":"y","ẏ":"y","ỵ":"y","ỳ":"y","ƴ":"y","ỷ":"y","ỿ":"y","ȳ":"y","ẙ":"y","ɏ":"y","ỹ":"y","ź":"z","ž":"z","ẑ":"z","ʑ":"z","ⱬ":"z","ż":"z","ẓ":"z","ȥ":"z","ẕ":"z","ᵶ":"z","ᶎ":"z","ʐ":"z","ƶ":"z","ɀ":"z","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ĳ":"ij","œ":"oe","ﬆ":"st","ₐ":"a","ₑ":"e","ᵢ":"i","ⱼ":"j","ₒ":"o","ᵣ":"r","ᵤ":"u","ᵥ":"v","ₓ":"x"},String.prototype.latinise=function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,function(b){return a.latin_map[b]||b})},String.prototype.latinize=String.prototype.latinise,String.prototype.isLatin=function(){return this==this.latinise()},String.prototype.OnlyAlphaNumSpaceAndUnderscore=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[\W]/g,"")},String.prototype.OnlyAlphaNumSpaceUnderscoreAndDot=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[^a-z0-9_\.]/g,"")},String.prototype.addLeadingZero||(String.prototype.addLeadingZero=function(a){var b=this.toString();return b.length<a?("0"+b).addLeadingZero(a):b}),String.prototype.lpad=function(a,b){for(var c=this;c.length<b;)c=a+c;return c},Number.prototype.between||(Number.prototype.between=function(a,b){var c=Math.min(a,b),d=Math.max(a,b);return this>=c&&this<=d}),Array.prototype.joinOther||(Array.prototype.joinOther=function(a,b,c){if(this.length<2)return this.join(b);b=b||", ",c=c||"other",(!a||a<0)&&(a=1);for(var d=this.slice(0),e=d.join(b);d.length>1&&e.length>a;)d.pop(),e=d.join(b);var f=this.length-d.length;return f>0&&(e+=" +"+f+" "+c),e},Array.prototype.find||(Array.prototype.find=function(a){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return b}))}(),n={isValidEmail:function(a){var b=/^([\w-\+]+(?:\.[\w-\+]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)},isValidPhone:function(a){var b=/^\d{9,}$/.test(a);if(b)return!0;var c=a.match(/^[\s()+-]*([0-9][\s()+-]*){10,20}(( x| ext)\d{1,5}){0,1}$/);return null!=c&&c.length>0},isValidURL:function(a){var b=/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)}},o=function(a){var b={};return b.sortFields=function(b,c,d,e){var f=[],g=null,h=null;c=c.slice(),null!=d&&(c=c.filter(function(a){return a.form==d}));for(var i=0;i<c.length&&(g=c[i],h=b[g.name],f.push(a.extend({value:h},g)),!(null!=e&&f.length>=e));i++);return f},b.stringifyOrdered=function(a){if(keys=[],a)for(var b in a)keys.push(b);keys.sort();var b,c={};for(var d in keys)b=keys[d],c[b]=a[b];return JSON.stringify(c)},b.areEqual=function(a,c){return b.stringifyOrdered(a||{})==b.stringifyOrdered(c||{})},b.badgeify=function(a){return a>100?"100+":a>10?"10+":a>0?""+a:""},b.getLoginName=function(a,b){var c=/[\s-]*/gim;return a.latinise().toLowerCase().replace(c,"")+"."+b.latinise().toLowerCase().replace(c,"")},b.getUrlParam=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return d?decodeURIComponent(d[1].replace(/\+/g," ")):null},b.getParsedLines=function(b){if(b&&b.length>0){var c=b.split(/\s*([,;\r\n]+|\s\s)\s*/);return c.filter(function(b,c,d){return b.length>0&&b.indexOf(",")<0&&b.indexOf(";")<0&&a.trim(b).length>0&&d.indexOf(b)>=c})}return[]},b}(a),p=function(){var a=function(){function a(a,b){var c=b.trim();return/^<\/?(ul|ol|li|h|p|bl)/i.test(c)?"\n"+b+"\n":"\n<p>"+c+"</p>\n"}function b(a,b){return"\n<ul>\n\t<li>"+b.trim()+"</li>\n</ul>"}function c(a,b){return"\n<ol>\n\t<li>"+b.trim()+"</li>\n</ol>"}function d(a,b,c){return"\n<blockquote>"+c.trim()+"</blockquote>"}function e(a,b,c){var d=b.length;return"<h"+d+">"+c.trim()+"</h"+d+">"}this.rules=[{regex:/(#+)(.*)/g,replacement:e},{regex:/!\[([^\[]+)\]\(([^\)]+)\)/g,replacement:"<img src='$2' alt='$1'>"},{regex:/\[([^\[]+)\]\(([^\)]+)\)/g,replacement:"<a href='$2'>$1</a>"},{regex:/(\*\*|__)(.*?)\1/g,replacement:"<strong>$2</strong>"},{regex:/(\*|_)(.*?)\1/g,replacement:"<em>$2</em>"},{regex:/\~\~(.*?)\~\~/g,replacement:"<del>$1</del>"},{regex:/\:\"(.*?)\"\:/g,replacement:"<q>$1</q>"},{regex:/`(.*?)`/g,replacement:"<code>$1</code>"},{regex:/\n\*(.*)/g,replacement:b},{regex:/\n[0-9]+\.(.*)/g,replacement:c},{regex:/\n(&gt;|\>)(.*)/g,replacement:d},{regex:/\n-{5,}/g,replacement:"\n<hr />"},{regex:/\n([^\n]+)\n/g,replacement:a},{regex:/<\/ul>\s?<ul>/g,replacement:""},{regex:/<\/ol>\s?<ol>/g,replacement:""},{regex:/<\/blockquote><blockquote>/g,replacement:"\n"}],this.addRule=function(a,b){a.global=!0,a.multiline=!1,this.rules.push({regex:a,replacement:b})},this.render=function(a){return a="\n"+a+"\n",this.rules.forEach(function(b){a=a.replace(b.regex,b.replacement)}),a.trim()}};window.Slimdown=a}(),q=function(a,b){return{getKitStatus:function(b){var c={},d=[],e={},f=[];return a.each(b,function(a,b){c[b.status]||(c[b.status]=!0,d.push(b.status)),e[b.order]||(e[b.order]=!0,f.push(b.order))}),1==d.length&&f.length<=1?d[0]:"incomplete"},getFriendlyKitStatus:function(a){return"incomplete"==a?"Incomplete":b.getFriendlyItemStatus(a)},getKitStatusCss:function(a){return"incomplete"==a?"label-incomplete":b.getItemStatusCss(a)},getKitIds:function(b){var c={},d=[];return a.each(b,function(a,b){if(b.kit){var e="string"==typeof b.kit?b.kit:b.kit._id;c[e]||(c[e]=!0,d.push(e))}}),d}}}(a,h),r=function(a){return{getContactImageUrl:function(b,c,d,e){return"maintenance"==c.kind?a.getMaintenanceAvatar(d):c.user&&c.user.picture?a.getImageUrl(b,c.user.picture,d,e):a.getAvatarInitial(c.name,d)}}}(k),s=function(a){return{getUserImageUrl:function(b,c,d,e){return c&&c.picture?a.getImageUrl(b,c.picture,d,e):a.getAvatarInitial(c.name,d)}}}(k),t=function(){var a=localStorage.setItem,b=localStorage.getItem,c=localStorage.removeItem;Storage.prototype.setItem=function(b,c){try{a.apply(this,[b,c])}catch(a){return!1}return!0},Storage.prototype.getItem=function(a){try{return b.apply(this,[a])}catch(a){}return null},Storage.prototype.removeItem=function(a){try{c.apply(this,[a])}catch(a){return!1}return!0}}(),u=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a.extend({},b,c,d,e,f,g,h,i,k,l,n,o,p)}(a,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t),v=function(a,b,c,d){var e=2048;a.ajaxSetup({cache:!1});var f={};return f.NetworkNotConnected=function(a,b){this.code=999,this.message=a||"Connection interrupted",this.opt=b},f.NetworkNotConnected.prototype=new Error,f.NetworkTimeout=function(a,b){this.code=408,this.message=a||"Could not reach the server in time",this.opt=b},f.NetworkTimeout.prototype=new Error,f.ApiError=function(a,b){this.code=500,this.message=a||"Something went wrong on the server",this.opt=b},f.ApiError.prototype=new Error,f.ApiNotFound=function(a,b){this.code=404,this.message=a||"Could not find what you're looking for",this.opt=b},f.ApiNotFound.prototype=new Error,f.ApiBadRequest=function(a,b){this.code=400,this.message=a||"The server did not understand your request",this.opt=b},f.ApiBadRequest.prototype=new Error,f.ApiUnauthorized=function(a,b){this.code=401,this.message=a||"Your session has expired",this.opt=b},f.ApiUnauthorized.prototype=new Error,f.ApiForbidden=function(a,b){this.code=403,this.message=a||"You don't have sufficient rights",this.opt=b},f.ApiForbidden.prototype=new Error,f.ApiUnprocessableEntity=function(a,b){this.code=422,this.message=a||"Some data is invalid",this.opt=b},f.ApiUnprocessableEntity.prototype=new Error,f.ApiPaymentRequired=function(a,b){this.code=402,this.message=a||"Your subscription has expired",this.opt=b},f.ApiPaymentRequired.prototype=new Error,f.ApiServerCapicity=function(a,b){this.code=503,this.message=a||"Back-end server is at capacity",this.opt=b},f.ApiServerCapicity.prototype=new Error,f.ApiAjax=function(a){a=a||{},this.useJsonp=null==a.useJsonp||a.useJsonp,this.timeOut=a.timeOut||1e4,this.responseInTz=!0},f.ApiAjax.prototype.get=function(a,b){return this.useJsonp?this._getJsonp(a,b):this._getAjax(a,b)},f.ApiAjax.prototype.post=function(a,b,c){if(this.useJsonp)throw"ApiAjax cannot post while useJsonp is true";return this._postAjax(a,b,c)},f.ApiAjax.prototype._handleAjaxSuccess=function(a,b,c){return this.responseInTz&&(b=this._fixDates(b)),a.resolve(b)},f.ApiAjax.prototype._handleAjaxError=function(a,b,c,d,e){if("abort"!=c){var g=null;if("timeout"===d)a.reject(new f.NetworkTimeout(g,e));else switch(b&&(b.statusText&&b.statusText.indexOf("Notify user:")>-1&&(g=b.statusText.slice(b.statusText.indexOf("Notify user:")+13)),422==b.status&&b.responseText&&b.responseText.match(/HTTPError: \(.+\)/g).length>0&&(e={detail:b.responseText.match(/HTTPError: \(.+\)/g)[0]})),b.status){case 400:a.reject(new f.ApiBadRequest(g,e));break;case 401:a.reject(new f.ApiUnauthorized(g,e));break;case 402:a.reject(new f.ApiPaymentRequired(g,e));break;case 403:a.reject(new f.ApiForbidden(g,e));break;case 404:a.reject(new f.ApiNotFound(g,e));break;case 408:a.reject(new f.NetworkTimeout(g,e));break;case 422:a.reject(new f.ApiUnprocessableEntity(g,e));break;case 503:a.reject(new f.ApiServerCapicity(g,e));break;case 500:default:a.reject(new f.ApiError(g,e))}}},f.ApiAjax.prototype._postAjax=function(b,c,d,e){var f=a.Deferred(),g=this,h=a.ajax({type:"POST",url:b,data:JSON.stringify(this._prepareDict(c)),contentType:"application/json; charset=utf-8",timeout:d||this.timeOut,success:function(a){return g._handleAjaxSuccess(f,a,e)},error:function(a,b,c){return g._handleAjaxError(f,a,b,c,e)}}),i=f.promise();return i.abort=function(){h.abort()},i},f.ApiAjax.prototype._getAjax=function(b,c,d){var e=a.Deferred(),f=this,g=a.ajax({url:b,timeout:c||this.timeOut,success:function(a){return f._handleAjaxSuccess(e,a,d)},error:function(a,b,c){return f._handleAjaxError(e,a,b,c,d)}}),h=e.promise();return h.abort=function(){g.abort()},h},f.ApiAjax.prototype._getJsonp=function(b,c,d){var e=a.Deferred(),g=this,h=a.jsonp({url:b,type:"GET",timeout:c||this.timeOut,dataType:" jsonp",callbackParameter:"callback",success:function(a,b,c){return g._handleAjaxSuccess(e,a)},error:function(a,b){e.reject(new f.ApiError(null,d))}}),i=e.promise();return i.abort=function(){h.abort()},i},f.ApiAjax.prototype._prepareDict=function(b){return b?(a.each(b,function(a,d){c.isMoment(d)&&(b[a]=d.toJSONDate())}),b):{}},f.ApiAjax.prototype._fixDates=function(b){if("string"==typeof b||b instanceof String){if(b.endsWith("+00:00")){var d=b.length;if(25==d)return c(b.substring(0,d-6));if(32==d)return c(b.substring(0,d-6).split(".")[0])}}else if(b instanceof Object||a.isArray(b)){var e=this;a.each(b,function(a,c){b[a]=e._fixDates(c)})}return b},f.ApiUser=function(a){a=a||{},this.userId=a.userId||"",this.userToken=a.userToken||"",this.tokenType=a.tokenType||""},f.ApiUser.prototype.fromStorage=function(){this.userId=window.localStorage.getItem("userId")||"",this.userToken=window.localStorage.getItem("userToken")||"",this.tokenType=window.localStorage.getItem("tokenType")||""},f.ApiUser.prototype.toStorage=function(){window.localStorage.setItem("userId",this.userId),window.localStorage.setItem("userToken",this.userToken),window.localStorage.setItem("tokenType",this.tokenType)},f.ApiUser.prototype.removeFromStorage=function(){window.localStorage.removeItem("userId"),window.localStorage.removeItem("userToken"),window.localStorage.removeItem("tokenType")},f.ApiUser.prototype.clearToken=function(){window.localStorage.setItem("userToken",null),window.localStorage.setItem("tokenType",null)},f.ApiUser.prototype.isValid=function(){return this.userId&&this.userId.length>0&&this.userToken&&this.userToken.length>0},f.ApiUser.prototype._reset=function(){this.userId="",this.userToken="",this.tokenType=""},f.ApiAuth=function(a){a=a||{},this.urlAuth=a.urlAuth||"",this.ajax=a.ajax,this.version=a.version},f.ApiAuth.prototype.authenticate=function(b,c){var d=this.urlAuth+"?"+a.param({user:b,password:c,auth_v:2,_v:this.version}),e=a.Deferred();return this.ajax.get(d,3e4).done(function(a){"OK"==a.status?e.resolve(a.data):e.reject(a)}).fail(function(a){e.reject(a)}),e.promise()},f.ApiAuthV2=function(a){a=a||{},this.urlAuth=a.urlAuth||"",this.ajax=a.ajax,this.version=a.version},f.ApiAuthV2.prototype.authenticate=function(b,c){var d=this.urlAuth+"?"+a.param({user:b,password:c,auth_v:2,_v:this.version}),e=a.Deferred();return this.ajax.get(d,3e4).done(function(a){if("OK"==a.status)e.resolve(a.data);else{var b=null;b=a.message&&a.message.indexOf("expired")>0?new f.ApiPaymentRequired(a.message):new Error("Your username or password is not correct"),e.reject(b)}}).fail(function(a){e.reject(a)}),e.promise()},f.ApiAnonymous=function(a){a=a||{},this.ajax=a.ajax,this.urlApi=a.urlApi||"",this.version=a.version},f.ApiAnonymous.prototype.call=function(b,c,d,e){this.version&&(c=c||{},c._v=this.version);var f=this.urlApi+"/"+b+"?"+a.param(this.ajax._prepareDict(c));return this.ajax.get(f,d,e)},f.ApiAnonymous.prototype.longCall=function(a,b,c){return this.call(a,b,3e4,c)},f.ApiDataSource=function(a){a=a||{},this.collection=a.collection||"",this.urlApi=a.urlApi||"",this.user=a.user,this.ajax=a.ajax,this.version=a.version;var b=null!=this.user.tokenType&&this.user.tokenType.length>0?this.user.tokenType:"null";this._baseUrl=this.urlApi+"/"+this.user.userId+"/"+this.user.userToken+"/"+b+"/"+this.collection+"/"},f.ApiDataSource.prototype.exists=function(b,c){var d="exists",e=a.Deferred(),g=this,h=this.getBaseUrl()+b,i=this.getParams(c);return a.isEmptyObject(i)||(h+="?"+this.getParams(i)),this._ajaxGet(d,h).done(function(a){e.resolve(a)}).fail(function(a){g.ajax.useJsonp?e.resolve(null):a instanceof f.ApiNotFound?e.resolve(null):e.reject(a)}),e.promise()},f.ApiDataSource.prototype.get=function(b,c){var d="get",e=this.getBaseUrl()+b,f=this.getParamsDict(c);return a.isEmptyObject(f)||(e+="?"+this.getParams(f)),this._ajaxGet(d,e)},f.ApiDataSource.prototype.getIgnore404=function(b,c){var d=this,e=a.Deferred();return this.get(b,c).done(function(a){e.resolve(a)}).fail(function(a){d.ajax.useJsonp?e.resolve(null):a instanceof f.ApiNotFound?e.resolve(null):e.reject(a)}),e.promise()},f.ApiDataSource.prototype.getMultiple=function(b,c){var d="getMultiple",e=this.getBaseUrl()+b.join(",")+",",f=this.getParamsDict(c);return a.isEmptyObject(f)||(e+="?"+this.getParams(f)),this._ajaxGet(d,e)},f.ApiDataSource.prototype.delete=function(a){var b="delete",c=this.getBaseUrl()+a+"/delete";return this._ajaxGet(b,c)},f.ApiDataSource.prototype.update=function(b,c,d){var e="update",f=this.getBaseUrl()+b+"/update",g=a.extend({},c);return null!=d&&d.length>0&&(g._fields=a.isArray(d)?d.join(","):d),f+="?"+this.getParams(g),this._ajaxGet(e,f)},f.ApiDataSource.prototype.create=function(b,c){var d="create",e=this.getBaseUrl()+"create",f=a.extend({},b);return null!=c&&c.length>0&&(f._fields=a.isArray(c)?c.join(","):c),e+="?"+this.getParams(f),this._ajaxGet(d,e)},f.ApiDataSource.prototype.createMultiple=function(b,c){var d=a.Deferred(),e=this,f=b.slice(0),g=[],h=function(a){if(a.length>0){var b=a.pop();e.create(b,c).done(function(b){return g.push(b._id),h(a)}).fail(function(a){d.reject(a)})}else d.resolve(g)};return h(f),d.promise()},f.ApiDataSource.prototype.list=function(b,c,d,e,f){b=b||"";var g="list."+b,h=this.getBaseUrl();null!=b&&b.length>0&&(h+="list/"+b+"/");var i=this.getParamsDict(c,d,e,f);return a.isEmptyObject(i)||(h+="?"+this.getParams(i)),this._ajaxGet(g,h)},f.ApiDataSource.prototype.search=function(a,b,c,d,e,f){var g="search",h=this.searchUrl(a,b,c,d,e,f);return this._ajaxGet(g,h)},f.ApiDataSource.prototype.searchUrl=function(b,c,d,e,f,g){
var h=this.getBaseUrl()+"search",i=a.extend(this.getParamsDict(c,d,e,f),b);return null!=g&&g.length>0&&(i.mimeType=g),h+="?"+this.getParams(i)},f.ApiDataSource.prototype.call=function(b,c,d,f,g,h){var i="call."+c,j=null!=b&&b.length>0?this.getBaseUrl()+b+"/call/"+c:this.getBaseUrl()+"call/"+c,k=a.extend({},this.getParamsDict(f,null,null,null),d),l=j+"?"+this.getParams(k);return h||l.length>=e?this._ajaxPost(i,j,k,g):this._ajaxGet(i,l,g)},f.ApiDataSource.prototype.longCall=function(a,b,c,d,e){return this.call(a,b,c,d,3e4,e)},f.ApiDataSource.prototype.getBaseUrl=function(){return this._baseUrl},f.ApiDataSource.prototype.getParams=function(b){return a.param(this.ajax._prepareDict(b))},f.ApiDataSource.prototype.getParamsDict=function(b,c,d,e){var f={};return b&&(f._fields=a.isArray(b)?b.join(","):b.replace(/\s/g,"")),c&&(f._limit=c),d&&(f._skip=d),e&&(f._sort=e),this.version&&(f._v=this.version),f},f.ApiDataSource.prototype._ajaxGet=function(a,b,c){return this.ajax.get(b,c,{coll:this.collection,cmd:a})},f.ApiDataSource.prototype._ajaxPost=function(a,b,c,d){return this.ajax.post(b,c,d,{coll:this.collection,cmd:a})},f}(a,c,b,u),w=function(a,b,c){var d={id:""},e=function(a){this.raw=null,this.id=a.id||d.id,this.ds=a.ds,this._fields=a._fields};return e.prototype.reset=function(){return this._fromJson(this._getDefaults(),null)},e.prototype.existsInDb=function(){return null!=this.id&&this.id.length>0},e.prototype.isEmpty=function(){return!0},e.prototype.isDirty=function(){return!1},e.prototype.isValid=function(){return!0},e.prototype.discardChanges=function(){return this.raw?this._fromJson(this.raw,null):this.reset()},e.prototype.reload=function(b){return this.existsInDb()?this.get(b):a.Deferred().reject(new c.ApiError("Cannot reload document, id is empty or null"))},e.prototype.get=function(b){if(this.existsInDb()){var d=this;return this.ds.get(this.id,b||this._fields).then(function(a){return d._fromJson(a)})}return a.Deferred().reject(new c.ApiError("Cannot get document, id is empty or null"))},e.prototype.create=function(b){return this.existsInDb()?a.Deferred().reject(new Error("Cannot create document, already exists in database")):this.isEmpty()?a.Deferred().reject(new Error("Cannot create empty document")):this.isValid()?this._create(b):a.Deferred().reject(new Error("Cannot create, invalid document"))},e.prototype.update=function(b){return this.existsInDb()?this.isEmpty()?a.Deferred().reject(new Error("Cannot update to empty document")):this.isValid()?this._update(b):a.Deferred().reject(new Error("Cannot update, invalid document")):a.Deferred().reject(new Error("Cannot update document without id"))},e.prototype.delete=function(){return this.existsInDb()?this._delete():a.Deferred().reject(new Error("Document does not exist"))},e.prototype._getDefaults=function(){return d},e.prototype._toJson=function(a){return{id:this.id}},e.prototype._fromJson=function(b,c){return this.raw=b,this.id=b._id||d.id,a.Deferred().resolve(b)},e.prototype._create=function(a){var b=this,c=this._toJson();return delete c.id,this.ds.create(c,this._fields).then(function(c){return 1==a?c:b._fromJson(c)})},e.prototype._update=function(a){var b=this,c=this._toJson();return delete c.id,this.ds.update(this.id,c,this._fields).then(function(c){return 1==a?c:b._fromJson(c)})},e.prototype._delete=function(){var a=this;return this.ds.delete(this.id).then(function(){return a.reset()})},e.prototype._isDirtyProperty=function(a){return!!this.raw&&this[a]!=this.raw[a]},e.prototype._isDirtyMomentProperty=function(a){if(this.raw){var b=this[a],c=this.raw[a];return(null!=b||null!=c)&&(!b||!c||!b.isSame(c))}return!1},e.prototype._getId=function(a,b){return"string"==typeof a?a:a[b||"_id"]},e.prototype._getIds=function(a,b){return a.map(function(a){return"string"==typeof a?a:a[b||"_id"]})},e.prototype._doApiCall=function(a){var b=this;return this.ds.call(1==a.collectionCall?null:a.pk||this.id,a.method,a.params,a._fields||this._fields,a.timeOut,a.usePost).then(function(c){return 1==a.skipRead?c:b._fromJson(c)})},e}(a,u,v),x=function(a,b,c,d){var e={id:"",planning:"",item:"",from:null,to:null,order:"",reservation:""},f=function(){};f.prototype=d.prototype;var g=function(b){var c=a.extend({},b);d.call(this,c),this.planning=c.planning||e.planning,this.item=c.item||e.item,this.from=c.from||e.from,this.to=c.to||e.to,this.order=c.order||e.order,this.reservation=c.reservation||e.reservation};return g.prototype=new f,g.prototype.constructor=g,g.prototype._getDefaults=function(){return e},g.prototype.isEmpty=function(){return!1},g.prototype.canDelete=function(){return a.Deferred().resolve(!1)},g.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.planning=this.planning,b.item=this.item,b.fromDate=this.from,b.toDate=this.to,b.order=this.order,b.reservation=this.reservation,b},g.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.planning=a.planning||e.planning,c.item=a.item||e.item,c.from=a.fromDate||e.from,c.to=a.toDate||e.to,c.order=a.order||e.order,c.reservation=a.reservation||e.reservation,a})},g}(a,u,v,w),y=function(a){var b=/(?:\.([^.]+))?$/,c=["jpg","jpeg","png"],d=["jpg","jpeg","png","doc","docx","pdf"],e={fileName:"",fileSize:0,isCover:!1,canBeCover:!0},f=function(a){a=a||{},this.ds=a.ds,this.raw=null,this.fileName=a.fileName||e.fileName,this.fileSize=a.fileSize||e.fileSize,this.value=a.value||e.value,this.created=a.created||e.created,this.by=a.by||e.by,this.isCover=null!=a.isCover?a.isCover:e.isCover,this.canBeCover=null!=a.canBeCover?a.canBeCover:e.canBeCover};return f.prototype.getThumbnailUrl=function(a){return this.hasPreview()?this.helper.getImageUrl(this.ds,this.value,a||"S"):""},f.prototype.getDownloadUrl=function(){return this.ds.getBaseUrl()+this.value+"?download=True"},f.prototype.getExt=function(a){return a=a||this.fileName,b.exec(a)[1]||""},f.prototype.isImage=function(){var b=this.getExt(this.fileName);return a.inArray(b,c)>=0},f.prototype.hasPreview=function(){var b=this.getExt(this.fileName);return a.inArray(b,d)>=0},f.prototype._toJson=function(a){return{fileName:this.fileName,fileSize:this.fileSize,value:this.value,created:this.created,by:this.by}},f.prototype._fromJson=function(b,c){return this.raw=b,this.fileName=b.fileName||e.fileName,this.fileSize=b.fileSize||e.fileSize,this.value=b.value||e.value,this.created=b.created||e.created,this.by=b.by||e.by,a.Deferred().resolve(b)},f}(a),z=function(a){var b={id:"",value:null,created:null,modified:null,by:null},c=function(a){a=a||{},this.ds=a.ds,this.raw=null,this.id=a.id||b.id,this.value=a.value||b.value,this.created=a.created||b.created,this.modified=a.modified||b.modified,this.by=a.by||b.by};return c.prototype._toJson=function(a){return{id:this.id,value:this.value,created:this.created,modified:this.modified,by:this.by}},c.prototype._fromJson=function(c,d){return this.raw=c,this.id=c.id||b.id,this.value=c.value||b.value,this.created=c.created||b.created,this.modified=c.modified||b.modified,this.by=c.by||b.by,a.Deferred().resolve(c)},c}(a),A=function(a){var b=/(?:\.([^.]+))?$/,c=["jpg","jpeg","png"],d=["jpg","jpeg","png","doc","docx","pdf"],e={fileName:"",fileSize:0,isCover:!1,canBeCover:!0},f=function(a){a=a||{},this.ds=a.ds,this.raw=null,this.fileName=a.fileName||e.fileName,this.fileSize=a.fileSize||e.fileSize,this.value=a.value||e.value,this.created=a.created||e.created,this.by=a.by||e.by,this.isCover=null!=a.isCover?a.isCover:e.isCover,this.canBeCover=null!=a.canBeCover?a.canBeCover:e.canBeCover};return f.prototype.getThumbnailUrl=function(a){return this.hasPreview()?this.helper.getImageUrl(this.ds,this.value,a||"S"):""},f.prototype.getDownloadUrl=function(){return this.ds.getBaseUrl()+this.value+"?download=True"},f.prototype.getExt=function(a){return a=a||this.fileName,b.exec(a)[1]||""},f.prototype.isImage=function(){var b=this.getExt(this.fileName);return a.inArray(b,c)>=0},f.prototype.hasPreview=function(){var b=this.getExt(this.fileName);return a.inArray(b,d)>=0},f.prototype._toJson=function(a){return{fileName:this.fileName,fileSize:this.fileSize,value:this.value,created:this.created,by:this.by}},f.prototype._fromJson=function(b,c){return this.raw=b,this.fileName=b.fileName||e.fileName,this.fileSize=b.fileSize||e.fileSize,this.value=b.value||e.value,this.created=b.created||e.created,this.by=b.by||e.by,a.Deferred().resolve(b)},f}(a),B=function(a){var b={name:null,value:null,required:!1,unit:"",kind:"string",form:!1,editor:null,description:""},c=function(a){a=a||{},this.raw=a,this.name=a.name||b.name,this.value=a.value||b.value,this.required=a.required||b.required,this.unit=a.unit||b.unit,this.kind=a.kind||b.kind,this.form=a.form||b.form,this.editor=a.editor||b.editor,this.description=a.description||b.description};return c.prototype.isValid=function(){return!this.required||""!=a.trim(this.value)},c.prototype.isDirty=function(){return this.raw.value!=this.value},c.prototype.isEmpty=function(){return""==a.trim(this.value)},c}(a),C=function(a,b,c,d,e,f,g){var h={id:"",modified:null,cover:null,flag:null,fields:{},comments:[],attachments:[]},i=function(){};i.prototype=d.prototype;var j=function(b){var c=a.extend({},b);d.call(this,c),this.dsAttachments=c.dsAttachments,this.crtype=c.crtype,this.modified=c.modified||h.modified,this.flag=c.flag||h.flag,this.fields=c.fields||a.extend({},h.fields),this.comments=c.comments||h.comments.slice(),this.attachments=c.attachments||h.attachments.slice(),this.cover=c.cover||h.cover};return j.prototype=new i,j.prototype.constructor=j,j.prototype._getDefaults=function(){return h},j.prototype.isEmpty=function(){return!(this.flag!=h.flag||null!=this.fields&&0!=Object.keys(this.fields).length||null!=this.comments&&0!=this.comments.length||null!=this.attachments&&0!=this.attachments.length)},j.prototype.isDirty=function(){return this._isDirtyFlag()||this._isDirtyFields()},j.prototype.canDelete=function(){return this.existsInDb()?this.ds.call(this.id,"canDelete"):a.Deferred().resolve({result:!1,message:""})},j.prototype.addComment=function(a,b){return this._doApiCall({method:"addComment",params:{comment:a},skipRead:b})},j.prototype.updateComment=function(a,b,c){return this._doApiCall({method:"updateComment",params:{commentId:a,comment:b},skipRead:c})},j.prototype.deleteComment=function(a,b){return this._doApiCall({method:"removeComment",params:{commentId:a},skipRead:b})},j.prototype.setField=function(a,b,c){return this._doApiCall({method:"setField",params:{field:a,value:b},skipRead:c})},j.prototype.clearField=function(a,b){return this._doApiCall({method:"clearField",params:{field:a},skipRead:b})},j.prototype.getImageUrl=function(a,b,c,d){var e=c||this.cover;return null!=e&&e.length>0?this.helper.getImageCDNUrl(b,e,a):this.helper.getImageUrl(this.ds,this.id,a,d)},j.prototype.setCover=function(a,b){return this._doApiCall({method:"setCover",params:{attachmentId:a._id},skipRead:b})},j.prototype.clearCover=function(a){return this._doApiCall({method:"clearCover",params:{},skipRead:a})},j.prototype.attach=function(b,d){return this.existsInDb()?this._doApiCall({method:"attach",params:{attachments:[b]},skipRead:d}):a.Deferred().reject(new c.ApiError("Cannot attach attachment, id is empty or null"))},j.prototype.detach=function(b,d){return this.existsInDb()?this._doApiCall({method:"detach",params:{attachments:[b]},skipRead:d}):a.Deferred().reject(new c.ApiError("Cannot detach attachment, id is empty or null"))},j.prototype.setFlag=function(a,b){return this._doApiCall({method:"setFlag",params:{flag:a},skipRead:b})},j.prototype.clearFlag=function(a){return this._doApiCall({method:"clearFlag",params:{},skipRead:a})},j.prototype.getSortedFields=function(b,c,d){var e=this,f=[],g=null,h=null;b=b.slice(),b=b.filter(function(a){return 1!=c||a.form});for(var i=0;i<b.length;i++)g=b[i],h=e.fields[g.name],(null==d||d>f.length)&&f.push(e._getField(a.extend({value:h},g)));return f},j.prototype.setSortedFields=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.isEmpty()?delete this.fields[c.name]:this.fields[c.name]=c.value}},j.prototype.validateSortedFields=function(a){for(var b=0;b<a.length;b++)if(!a[b].isValid())return!1;return!0},j.prototype._isDirtyFlag=function(){return!!this.raw&&this.flag!=this.raw.flag},j.prototype._isDirtyFields=function(){return!!this.raw&&!b.areEqual(this.fields,this.raw.fields)},j.prototype._updateFields=function(){var b=[];if(this.raw)for(var c in this.fields)this.fields[c]!=this.raw.fields[c]&&b.push(this.setField(c,this.fields[c],!0));return b.length>0?a.when(b):a.Deferred().resolve(this)},j.prototype._toJson=function(a){return d.prototype._toJson.call(this,a)},j.prototype._fromJson=function(b,c){var e=this;return d.prototype._fromJson.call(this,b,c).then(function(){return e.flag=b.flag||h.flag,e.fields=null!=b.fields?a.extend({},b.fields):a.extend({},h.fields),e.modified=b.modified||h.modified,e._fromCommentsJson(b,c).then(function(){return e._fromAttachmentsJson(b,c)})})},j.prototype._toJsonFields=function(a){var b={};if(this.fields)for(var c in this.fields)b["fields__"+c]=this.fields[c];return b},j.prototype._fromCommentsJson=function(b,c){var d=null,e=this;return this.comments=h.comments.slice(),b.comments&&b.comments.length>0&&a.each(b.comments,function(a,b){d=e._getComment(b,c),d&&e.comments.push(d)}),a.Deferred().resolve(b)},j.prototype._fromAttachmentsJson=function(b,c){var d=null,e=this;return this.attachments=h.attachments.slice(),b.attachments&&b.attachments.length>0&&a.each(b.attachments,function(a,b){d=e._getAttachment(b,c),d&&e.attachments.push(d)}),a.Deferred().resolve(b)},j.prototype._getComment=function(b,c){var d=a.extend({ds:this.ds},c||{},b);return new e(d)},j.prototype._getAttachment=function(b,c){var d=a.extend({ds:this.ds},c||{},b);return new f(d)},j.prototype._getField=function(b,c){var d=a.extend({},c||{},b);return new g(d)},j}(a,u,v,w,z,A,B),D=function(a){var b={id:"",value:null,created:null,modified:null,by:null},c=function(a){a=a||{},this.ds=a.ds,this.raw=null,this.id=a.id||b.id,this.value=a.value||b.value,this.created=a.created||b.created,this.modified=a.modified||b.modified,this.by=a.by||b.by};return c.prototype._toJson=function(a){return{id:this.id,value:this.value,created:this.created,modified:this.modified,by:this.by}},c.prototype._fromJson=function(c,d){return this.raw=c,this.id=c.id||b.id,this.value=c.value||b.value,this.created=c.created||b.created,this.modified=c.modified||b.modified,this.by=c.by||b.by,a.Deferred().resolve(c)},c}(a),E=function(a){var b={kind:"",doc:"",item:"",itemName:"",locationCurrent:"",locationDesired:"",fromDate:null,toDate:null},c=function(a){this.ds=a.ds,this._fields=a._fields,this.raw=null,this.kind=a.kind||b.kind,this.doc=a.doc||b.doc,this.item=a.item||b.item,this.itemName=a.itemName||b.itemName,this.locationCurrent=a.locationCurrent||b.locationCurrent,this.locationDesired=a.locationDesired||b.locationDesired,this.fromDate=a.fromDate||b.fromDate,this.toDate=a.toDate||b.toDate};return c.prototype._toJson=function(a){return{kind:this.kind,doc:this.doc,item:this.item,itemName:this.itemName,locationCurrent:this.locationCurrent,locationDesired:this.locationDesired,fromDate:this.fromDate,toDate:this.toDate}},c.prototype._fromJson=function(c,d){return this.raw=c,this.kind=c.kind||b.kind,this.item=c.item||b.item,this.itemName=c.itemName||b.itemName,this.fromDate=c.fromDate||b.fromDate,this.toDate=c.toDate||b.toDate,a.Deferred().resolve(c)},c}(a),F=function(a,b,c,d,e,f,g){var h={id:"",modified:null,cover:null,flag:null,fields:{},comments:[],attachments:[]},i=function(){};i.prototype=d.prototype;var j=function(b){var c=a.extend({},b);d.call(this,c),this.dsAttachments=c.dsAttachments,this.crtype=c.crtype,this.modified=c.modified||h.modified,this.flag=c.flag||h.flag,this.fields=c.fields||a.extend({},h.fields),this.comments=c.comments||h.comments.slice(),this.attachments=c.attachments||h.attachments.slice(),this.cover=c.cover||h.cover};return j.prototype=new i,j.prototype.constructor=j,j.prototype._getDefaults=function(){return h},j.prototype.isEmpty=function(){return!(this.flag!=h.flag||null!=this.fields&&0!=Object.keys(this.fields).length||null!=this.comments&&0!=this.comments.length||null!=this.attachments&&0!=this.attachments.length)},j.prototype.isDirty=function(){return this._isDirtyFlag()||this._isDirtyFields()},j.prototype.canDelete=function(){return this.existsInDb()?this.ds.call(this.id,"canDelete"):a.Deferred().resolve({result:!1,message:""})},j.prototype.addComment=function(a,b){return this._doApiCall({method:"addComment",params:{comment:a},skipRead:b})},j.prototype.updateComment=function(a,b,c){return this._doApiCall({method:"updateComment",params:{commentId:a,comment:b},skipRead:c})},j.prototype.deleteComment=function(a,b){return this._doApiCall({method:"removeComment",params:{commentId:a},skipRead:b})},j.prototype.setField=function(a,b,c){return this._doApiCall({method:"setField",params:{field:a,value:b},skipRead:c})},j.prototype.clearField=function(a,b){return this._doApiCall({method:"clearField",params:{field:a},skipRead:b})},j.prototype.getImageUrl=function(a,b,c,d){var e=c||this.cover;return null!=e&&e.length>0?this.helper.getImageCDNUrl(b,e,a):this.helper.getImageUrl(this.ds,this.id,a,d)},j.prototype.setCover=function(a,b){return this._doApiCall({method:"setCover",params:{attachmentId:a._id},skipRead:b})},j.prototype.clearCover=function(a){return this._doApiCall({method:"clearCover",params:{},skipRead:a})},j.prototype.attach=function(b,d){return this.existsInDb()?this._doApiCall({method:"attach",params:{attachments:[b]},skipRead:d}):a.Deferred().reject(new c.ApiError("Cannot attach attachment, id is empty or null"))},j.prototype.detach=function(b,d){return this.existsInDb()?this._doApiCall({method:"detach",params:{attachments:[b]},skipRead:d}):a.Deferred().reject(new c.ApiError("Cannot detach attachment, id is empty or null"))},j.prototype.setFlag=function(a,b){return this._doApiCall({method:"setFlag",params:{flag:a},skipRead:b})},j.prototype.clearFlag=function(a){return this._doApiCall({method:"clearFlag",params:{},skipRead:a})},j.prototype.getSortedFields=function(b,c,d){var e=this,f=[],g=null,h=null;b=b.slice(),b=b.filter(function(a){return 1!=c||a.form});for(var i=0;i<b.length;i++)g=b[i],h=e.fields[g.name],(null==d||d>f.length)&&f.push(e._getField(a.extend({value:h},g)));return f},j.prototype.setSortedFields=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.isEmpty()?delete this.fields[c.name]:this.fields[c.name]=c.value}},j.prototype.validateSortedFields=function(a){for(var b=0;b<a.length;b++)if(!a[b].isValid())return!1;return!0},j.prototype._isDirtyFlag=function(){return!!this.raw&&this.flag!=this.raw.flag},j.prototype._isDirtyFields=function(){return!!this.raw&&!b.areEqual(this.fields,this.raw.fields)},j.prototype._updateFields=function(){var b=[];if(this.raw)for(var c in this.fields)this.fields[c]!=this.raw.fields[c]&&b.push(this.setField(c,this.fields[c],!0));return b.length>0?a.when(b):a.Deferred().resolve(this)},j.prototype._toJson=function(a){return d.prototype._toJson.call(this,a)},j.prototype._fromJson=function(b,c){var e=this;return d.prototype._fromJson.call(this,b,c).then(function(){return e.flag=b.flag||h.flag,e.fields=null!=b.fields?a.extend({},b.fields):a.extend({},h.fields),e.modified=b.modified||h.modified,e._fromCommentsJson(b,c).then(function(){return e._fromAttachmentsJson(b,c)})})},j.prototype._toJsonFields=function(a){var b={};if(this.fields)for(var c in this.fields)b["fields__"+c]=this.fields[c];return b},j.prototype._fromCommentsJson=function(b,c){var d=null,e=this;return this.comments=h.comments.slice(),b.comments&&b.comments.length>0&&a.each(b.comments,function(a,b){d=e._getComment(b,c),d&&e.comments.push(d)}),a.Deferred().resolve(b)},j.prototype._fromAttachmentsJson=function(b,c){var d=null,e=this;return this.attachments=h.attachments.slice(),b.attachments&&b.attachments.length>0&&a.each(b.attachments,function(a,b){d=e._getAttachment(b,c),d&&e.attachments.push(d)}),a.Deferred().resolve(b)},j.prototype._getComment=function(b,c){var d=a.extend({ds:this.ds},c||{},b);return new e(d)},j.prototype._getAttachment=function(b,c){var d=a.extend({ds:this.ds},c||{},b);return new f(d)},j.prototype._getField=function(b,c){var d=a.extend({},c||{},b);return new g(d)},j}(a,u,v,w,z,A,B),G=function(a,b,c){var d={name:"",email:"",group:"",picture:"",role:"user",active:!0},e=function(){};e.prototype=b.prototype;var f=function(c){var e=a.extend({_fields:["*","group","picture"]},c);b.call(this,e),this.helper=e.helper,this.name=e.name||d.name,this.picture=e.picture||d.picture,this.email=e.email||d.email,this.role=e.role||d.role,this.group=e.group||d.group,this.active=null!=e.active?e.active:d.active};return f.prototype=new e,f.prototype.constructor=f,f.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=4},f.prototype.isValidEmail=function(){return this.email=a.trim(this.email),c.isValidEmail(this.email)},f.prototype.isValidRole=function(){switch(this.role){case"user":case"admin":case"root":case"selfservice":return!0;default:return!1}},f.prototype.isValidPassword=function(){this.password=a.trim(this.password);var b=this.password.length,c=this.password.match(/[0-9]/);return b>=4&&c},f.prototype.isValid=function(){return this.isValidName()&&this.isValidEmail()&&this.isValidRole()},f.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==d.name&&this.email==d.email&&this.role==d.role},f.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);if(!a&&this.raw){var c=this.raw.name||d.name,e=this.raw.role||d.role,f=this.raw.email||d.email,g=null!=this.raw.active?this.raw.active:d.active;return this.name!=c||this.email!=f||this.role!=e||this.active!=g}return a},f.prototype.getImageUrl=function(a,b){return null!=this.picture&&this.picture.length>0?this.helper.getImageCDNUrl(this.group,this.picture,a,b):this.helper.getImageUrl(this.ds,this.id,a,b)},f.prototype._getDefaults=function(){return d},f.prototype.addKeyValue=function(b,c,d,e){return a.Deferred().reject("Not implemented for User, use setPicture instead?")},f.prototype.addKeyValue=function(b,c,d,e,f){return a.Deferred().reject("Not implemented for User, use setPicture instead?")},f.prototype.removeKeyValue=function(b,c){return a.Deferred().reject("Not implemented for User, use clearPicture instead?")},f.prototype.setPicture=function(b,c){return this.existsInDb()?(this.picture=b,this._doApiCall({method:"setPicture",params:{attachment:b},skipRead:c})):a.Deferred().reject("User does not exist in database")},f.prototype.clearPicture=function(b){return this.existsInDb()?this._doApiCall({method:"clearPicture",skipRead:b}):a.Deferred().reject("User does not exist in database")},f.prototype._toJson=function(a){var c=b.prototype._toJson.call(this,a);return c.name=this.name||d.name,c.email=this.email||d.email,c.group=this.group||d.group,c.role=this.role||d.role,c.active=this.active||d.active,c},f.prototype._fromJson=function(c,e){var f=this;return b.prototype._fromJson.call(this,c,e).then(function(){return f.group=c.group&&null!=c.group._id?c.group._id:c.group||d.group,f.name=c.name||d.name,f.picture=c.picture||d.picture,f.email=c.email||d.email,f.role=c.role||d.role,f.active=null!=c.active?c.active:d.active,a.publish("user.fromJson",c),c})},f}(a,F,u),H=function(a,b,c,d){var e={name:"",email:"",status:"active",user:{},kind:"contact"},f=function(){};f.prototype=b.prototype;var g=function(c){var d=a.extend({_fields:["*"],crtype:"cheqroom.types.customer"},c);b.call(this,d),this.name=d.name||e.name,this.company=d.company||e.company,this.status=d.status||e.status,this.user=d.user||e.user,this.kind=d.kind||e.kind};return g.prototype=new f,g.prototype.constructor=g,g.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=3},g.prototype.isValidEmail=function(){return this.email=a.trim(this.email),c.isValidEmail(this.email)},g.prototype.archive=function(a){return this.ds.call(this.id,"archive",{},a)},g.prototype.undoArchive=function(a){return this.ds.call(this.id,"undoArchive",{},a)},g.prototype.isValid=function(){return this.isValidName()&&this.isValidEmail()},g.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==e.name&&this.email==e.email},g.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);return!a&&this.raw&&(a=this.name!=this.raw.name||this.email!=this.raw.email),a},g.prototype._getDefaults=function(){return e},g.prototype._toJson=function(a){var c=b.prototype._toJson.call(this,a);return c.name=this.name||e.name,c.email=this.email||e.email,c},g.prototype._fromJson=function(c,d){var f=this;return b.prototype._fromJson.call(this,c,d).then(function(b){return f.name=b.name||e.name,f.email=b.email||e.email,f.status=b.status||e.status,f.user=b.user||e.user,f.kind=b.kind||e.kind,a.publish("contact.fromJson",b),b})},g.prototype._create=function(b){var c=this,d=a.extend({},this._toJson(),this._toJsonFields());return delete d.id,this.ds.create(d,this._fields).then(function(a){return 1==b?a:c._fromJson(a)})},g}(a,F,u,G),I=function(a,b){b.fn.toJSONDate=function(){return this.format("YYYY-MM-DD[T]HH:mm:ss.000[Z]")},b.fn.roundTo=function(a,c,d){a=b.normalizeUnits(a),c=c||1;var e=function(a){switch(d){case"up":a=Math.ceil(a/c);break;case"down":a=Math.floor(a/c);break;default:a=Math.round(a/c)}return a*c};switch(a){case"year":this.year(e(this.year()));break;case"month":this.month(e(this.month()));break;case"week":this.weekday(e(this.weekday()));break;case"isoWeek":this.isoWeekday(e(this.isoWeekday()));break;case"day":this.day(e(this.day()));break;case"hour":this.hour(e(this.hour()));break;case"minute":this.minute(e(this.minute()));break;case"second":this.second(e(this.second()));break;default:this.millisecond(e(this.millisecond()))}return this};var c=15,d=function(a){a=a||{},this.roundType=a.roundType||"nearest",this.roundMinutes=a.roundMinutes||c};return d.prototype.getNow=function(){return b()},d.prototype.getFriendlyDuration=function(a){return a.humanize()},d.prototype.getFriendlyDateParts=function(a,b,c){b=b||this.getNow(),c=c||"MMM D [at] h:mm a";var d=b.diff(a,"days"),e=Math.abs(d)<7?a.calendar():a.format(c);return e.replace("AM","am").replace("PM","pm").split(" at ")},d.prototype.getFriendlyFromTo=function(a,b,c,d,e,f){d=d||this.getNow();var g=e||" - ",h=this.getFriendlyDateParts(a,d,f),i=this.getFriendlyDateParts(b,d,f),j={dayDiff:a.diff(b,"days"),fromDate:h[0],fromTime:c?h[1]:"",toDate:i[0],toTime:c?i[1]:""};return j.fromText=j.fromDate,j.toText=j.toDate,c&&(j.fromTime&&(j.fromText+=" "+j.fromTime),j.toTime&&(j.toText+=" "+j.toTime)),0==j.dayDiff?c?j.text=j.fromText+g+j.toTime:j.text=j.fromText:j.text=j.fromText+g+j.toText,j},d.prototype.getFriendlyFromToOld=function(a,c,d){var e=this.roundFromTime(a,d),f=this.roundToTime(c,d);return{from:e,to:f,daysBetween:f.clone().startOf("day").diff(e.clone().startOf("day"),"days"),duration:b.duration(e-f).humanize(),fromText:e.calendar().replace(" at "," "),toText:f.calendar().replace(" at "," ")}},d.prototype.getFriendlyDateText=function(a,b,c,d){if(null==a)return"Not set";var e=this.getFriendlyDateParts(a,c,d);return b?e.join(" "):e[0]},d.prototype.addAverageDuration=function(a){return a.clone().add(1,"day")},d.prototype.roundTimeFrom=function(a){return this.roundMinutes<=1?a:this.roundTime(a,this.roundMinutes,this._typeToDirection(this.roundType,"from"))},d.prototype.roundTimeTo=function(a){return this.roundMinutes<=1?a:this.roundTime(a,this.roundMinutes,this._typeToDirection(this.roundType,"to"))},d.prototype.roundTime=function(a,d,e){var f=b.isMoment(a)?a:b(a);return f.seconds(0).milliseconds(0),f.roundTo("minute",d||c,e)},d.prototype.roundTimeUp=function(a,d){var e=b.isMoment(a)?a:b(a);return e.seconds(0).milliseconds(0),e.roundTo("minute",d||c,"up")},d.prototype.roundTimeDown=function(a,d){var e=b.isMoment(a)?a:b(a);return e.seconds(0).milliseconds(0),e.roundTo("minute",d||c,"down")},d.prototype._typeToDirection=function(a,b){switch(a){case"longer":switch(b){case"from":return"down";case"to":return"up"}break;case"shorter":switch(b){case"from":return"up";case"to":return"down"}}},d}(a,b),J=function(a,b,c){var d={id:""},e=function(a){this.raw=null,this.id=a.id||d.id,this.ds=a.ds,this._fields=a._fields};return e.prototype.reset=function(){return this._fromJson(this._getDefaults(),null)},e.prototype.existsInDb=function(){return null!=this.id&&this.id.length>0},e.prototype.isEmpty=function(){return!0},e.prototype.isDirty=function(){return!1},e.prototype.isValid=function(){return!0},e.prototype.discardChanges=function(){return this.raw?this._fromJson(this.raw,null):this.reset()},e.prototype.reload=function(b){return this.existsInDb()?this.get(b):a.Deferred().reject(new c.ApiError("Cannot reload document, id is empty or null"))},e.prototype.get=function(b){if(this.existsInDb()){var d=this;return this.ds.get(this.id,b||this._fields).then(function(a){return d._fromJson(a)})}return a.Deferred().reject(new c.ApiError("Cannot get document, id is empty or null"))},e.prototype.create=function(b){return this.existsInDb()?a.Deferred().reject(new Error("Cannot create document, already exists in database")):this.isEmpty()?a.Deferred().reject(new Error("Cannot create empty document")):this.isValid()?this._create(b):a.Deferred().reject(new Error("Cannot create, invalid document"))},e.prototype.update=function(b){return this.existsInDb()?this.isEmpty()?a.Deferred().reject(new Error("Cannot update to empty document")):this.isValid()?this._update(b):a.Deferred().reject(new Error("Cannot update, invalid document")):a.Deferred().reject(new Error("Cannot update document without id"))},e.prototype.delete=function(){return this.existsInDb()?this._delete():a.Deferred().reject(new Error("Document does not exist"))},e.prototype._getDefaults=function(){return d},e.prototype._toJson=function(a){return{id:this.id}},e.prototype._fromJson=function(b,c){return this.raw=b,this.id=b._id||d.id,a.Deferred().resolve(b)},e.prototype._create=function(a){var b=this,c=this._toJson();return delete c.id,this.ds.create(c,this._fields).then(function(c){return 1==a?c:b._fromJson(c)})},e.prototype._update=function(a){var b=this,c=this._toJson();return delete c.id,this.ds.update(this.id,c,this._fields).then(function(c){return 1==a?c:b._fromJson(c)})},e.prototype._delete=function(){var a=this;return this.ds.delete(this.id).then(function(){return a.reset()})},e.prototype._isDirtyProperty=function(a){return!!this.raw&&this[a]!=this.raw[a]},e.prototype._isDirtyMomentProperty=function(a){if(this.raw){var b=this[a],c=this.raw[a];return(null!=b||null!=c)&&(!b||!c||!b.isSame(c))}return!1},e.prototype._getId=function(a,b){return"string"==typeof a?a:a[b||"_id"]},e.prototype._getIds=function(a,b){return a.map(function(a){return"string"==typeof a?a:a[b||"_id"]})},e.prototype._doApiCall=function(a){var b=this;return this.ds.call(1==a.collectionCall?null:a.pk||this.id,a.method,a.params,a._fields||this._fields,a.timeOut,a.usePost).then(function(c){return 1==a.skipRead?c:b._fromJson(c)})},e}(a,u,v),K=function(a,b,c,d){var e={id:"",name:"",itemFlags:[],kitFlags:[],customerFlags:[],orderFlags:[],reservationFlags:[],itemFields:[],kitFields:[],customerFields:[],orderFields:[],reservationFields:[]},f=function(){};f.prototype=d.prototype;var g=function(b){var c=a.extend({},b);d.call(this,c),this.name=c.name||e.name,this.itemFlags=c.itemFlags||e.itemFlags.slice(),this.kitFlags=c.kitFlags||e.kitFlags.slice(),this.customerFlags=c.customerFlags||e.customerFlags.slice(),this.orderFlags=c.orderFlags||e.orderFlags.slice(),this.reservationFlags=c.reservationFlags||e.reservationFlags.slice(),this.itemFields=c.itemFields||e.itemFields.slice(),this.kitFields=c.kitFields||e.kitFields.slice(),this.customerFields=c.customerFields||e.customerFields.slice(),this.reservationFields=c.reservationFields||e.reservationFields.slice(),this.orderFields=c.orderFields||e.orderFields.slice()};return g.prototype=new f,g.prototype.constructor=g,g.prototype.getStats=function(a){
return this._doApiCall({pk:this.id,method:"getStats",location:a})},g.prototype.updateFlags=function(a,b,c){return this._doApiCall({pk:this.id,method:"updateFlags",collection:a,flags:b,skipRead:c})},g.prototype.createField=function(a,b,c,d,e,f,g,h,i){return this._doApiCall({pk:this.id,method:"createField",skipRead:i,params:{collection:a,name:b,kind:c,required:d,form:e,unit:f,editor:g,description:h}})},g.prototype.updateField=function(a,b,c,d,e,f,g,h,i,j){return this._doApiCall({pk:this.id,method:"updateField",skipRead:j,params:{collection:a,name:b,newName:c,kind:d,required:e,form:f,unit:g,editor:h,description:i}})},g.prototype.deleteField=function(a,b,c){return this._doApiCall({pk:this.id,method:"deleteField",skipRead:c,params:{collection:a,name:b}})},g.prototype.moveField=function(a,b,c,d){return this._doApiCall({pk:this.id,method:"moveField",skipRead:d,params:{collection:a,oldPos:b,newPos:c}})},g.prototype.getFieldsForCollection=function(b,c){var d=[];switch(b){case"items":d=this.itemFields;break;case"kits":d=this.kitFields;break;case"contacts":case"customers":d=this.customerFields;break;case"reservations":d=this.reservationFields;break;case"checkouts":case"orders":d=this.orderFields}return null!=c&&(d=a.grep(d,function(a,b){return a.form==c})),d},g.prototype.getFlagsForCollection=function(a){switch(a){case"items":return this.itemFlags;case"kits":return this.kitFlags;case"contacts":case"customers":return this.customerFlags;case"reservations":return this.reservationFlags;case"checkouts":case"orders":return this.orderFlags;default:return[]}},g.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.name=this.name,b},g.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.name=a.name||e.name,c.itemFlags=a.itemFlags||e.itemFlags.slice(),c.kitFlags=a.kitFlags||e.kitFlags.slice(),c.customerFlags=a.customerFlags||e.customerFlags.slice(),c.orderFlags=a.orderFlags||e.orderFlags.slice(),c.reservationFlags=a.reservationFlags||e.reservationFlags.slice(),c.itemFields=a.itemFields||e.itemFields.slice(),c.kitFields=a.kitFields||e.kitFields.slice(),c.customerFields=a.customerFields||e.customerFields.slice(),c.reservationFields=a.reservationFields||e.reservationFields.slice(),c.orderFields=a.orderFields||e.orderFields.slice(),a})},g}(a,u,v,w),L=function(a,b){var c="cheqroom.prop.Custom",d=0,e=0,f={name:"",status:"",codes:[],brand:"",model:"",warrantyDate:null,purchaseDate:null,purchasePrice:null,location:"",category:"",geo:[d,e],address:"",order:null,kit:null,custody:null,cover:"",catalog:null},g=function(){};g.prototype=b.prototype;var h=function(c){var d=a.extend({_fields:["*"],crtype:"cheqroom.types.item"},c);b.call(this,d),this.name=d.name||f.name,this.status=d.status||f.status,this.brand=d.brand||f.brand,this.model=d.model||f.model,this.warrantyDate=d.warrantyDate||f.warrantyDate,this.purchaseDate=d.purchaseDate||f.purchaseDate,this.purchasePrice=d.purchasePrice||f.purchasePrice,this.codes=d.codes||f.codes,this.location=d.location||f.location,this.category=d.category||f.category,this.geo=d.geo||f.geo.slice(),this.address=d.address||f.address,this.order=d.order||f.order,this.kit=d.kit||f.kit,this.custody=d.custody||f.custody,this.cover=d.cover||f.cover,this.catalog=d.catalog||f.catalog};return h.prototype=new g,h.prototype.constructor=h,h.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=3},h.prototype.isValidCategory=function(){return a.trim(this.category).length>0},h.prototype.isValidLocation=function(){return a.trim(this.location).length>0},h.prototype.isValid=function(){return this.isValidName()&&this.isValidCategory()&&("in_custody"==this.status||this.isValidLocation())},h.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==f.name&&this.status==f.status&&this.brand==f.brand&&this.model==f.model&&this.warrantyDate==f.warrantyDate&&this.purchaseDate==f.purchaseDate&&this.purchasePrice==f.purchasePrice&&0==this.codes.length&&this.location==f.location&&this.category==f.category},h.prototype.isDirty=function(){return b.prototype.isDirty.call(this)||this._isDirtyName()||this._isDirtyBrand()||this._isDirtyModel()||this._isDirtyWarrantyDate()||this._isDirtyPurchaseDate()||this._isDirtyPurchasePrice()||this._isDirtyCategory()||this._isDirtyLocation()||this._isDirtyGeo()},h.prototype._getDefaults=function(){return f},h.prototype._toJson=function(a){var c=b.prototype._toJson.call(this,a);c.name=this.name||f.name,c.brand=this.brand||f.brand,c.model=this.model||f.model,c.warrantyDate=this.warrantyDate||f.warrantyDate,c.purchaseDate=this.purchaseDate||f.purchaseDate,c.purchasePrice=this.purchasePrice||f.purchasePrice,c.category=this.category||f.category,c.location=this.location||f.location,c.catalog=this.catalog||f.catalog;for(var d in c)null==c[d]&&delete c[d];return c},h.prototype._fromJson=function(c,d){var e=this;return b.prototype._fromJson.call(this,c,d).then(function(){e.name=c.name||f.name,e.status=c.status||f.status,e.brand=c.brand||f.brand,e.model=c.model||f.model,e.warrantyDate=c.warrantyDate||f.warrantyDate,e.purchaseDate=c.purchaseDate||f.purchaseDate,e.purchasePrice=c.purchasePrice||f.purchasePrice,e.codes=c.codes||f.codes,e.address=c.address||f.address,e.geo=c.geo||f.geo.slice(),e.cover=c.cover||f.cover,e.catalog=c.catalog||f.catalog;var b=f.location;c.location&&(b=c.location._id?c.location._id:c.location),e.location=b;var d=f.category;c.category&&(d=c.category._id?c.category._id:c.category),e.category=d;var g=f.order;c.order&&(g=c.order._id?c.order._id:c.order),e.order=g;var h=f.kit;c.kit&&(h=c.kit._id?c.kit._id:c.kit),e.kit=h;var i=f.custody;return c.custody&&(i=c.custody._id?c.custody._id:c.custody),e.custody=i,a.publish("item.fromJson",c),c})},h.prototype._toJsonKeyValues=function(){var b={};return null!=this.keyValues&&this.keyValues.length>0&&a.each(this.keyValues,function(a,c){var d="keyValues__"+c.key;b[d+"__kind"]=c.kind,b[d+"__value"]=c.value}),b},h.prototype._getKeyValue=function(a,d){return a.key==c?null:b.prototype._getKeyValue(a,d)},h.prototype._isDirtyName=function(){return this._isDirtyProperty("name")},h.prototype._isDirtyBrand=function(){return this._isDirtyProperty("brand")},h.prototype._isDirtyModel=function(){return this._isDirtyProperty("model")},h.prototype._isDirtyWarrantyDate=function(){return this._isDirtyMomentProperty("warrantyDate")},h.prototype._isDirtyPurchaseDate=function(){return this._isDirtyMomentProperty("purchaseDate")},h.prototype._isDirtyPurchasePrice=function(){return this._isDirtyProperty("purchasePrice")},h.prototype._isDirtyLocation=function(){if(this.raw){var a=f.location;return this.raw.location&&(a=this.raw.location._id?this.raw.location._id:this.raw.location),this.location!=a}return!1},h.prototype._isDirtyCategory=function(){if(this.raw){var a=f.category;return this.raw.category&&(a=this.raw.category._id?this.raw.category._id:this.raw.category),this.category!=a}return!1},h.prototype._isDirtyGeo=function(){if(this.raw){var a=this.raw.address||f.address,b=this.raw.geo||f.geo.slice();return this.address!=a||this.geo[0]!=b[0]||this.geo[1]!=b[1]}return!1},h.prototype.getAvailabilities=function(a,b){return this.ds.call(this.id,"getAvailability",{fromDate:a,toDate:b})},h.prototype.update=function(b){if(this.isEmpty())return a.Deferred().reject(new Error("Cannot update to empty document"));if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot update document without id"));if(!this.isValid())return a.Deferred().reject(new Error("Cannot update, invalid document"));var c=this,d=a.Deferred(),e=a.Deferred(),f=a.Deferred(),g=a.Deferred(),h=a.Deferred();return this._isDirtyCategory()?this.canChangeCategory(this.category).done(function(a){a.result?d.resolve():d.reject(new Error("Unable to change item category"))}):d.resolve(),d.then(function(){return c._isDirtyCategory()?e=c.changeCategory(c.category):e.resolve(),c._isDirtyLocation()?f=c.changeLocation(c.location):f.resolve(),c._isDirtyFields()?g=c._updateFields():g.resolve(),c._isDirtyName()||c._isDirtyBrand()||c._isDirtyModel()||c._isDirtyWarrantyDate()||c._isDirtyPurchaseDate()||c._isDirtyPurchasePrice()?h=c.updateBasicFields(c.name,c.brand,c.model,c.warrantyDate,c.purchaseDate,c.purchasePrice):h.resolve(),a.when(e,f,g,h)})},h.prototype.create=function(b){if(this.existsInDb())return a.Deferred().reject(new Error("Cannot create document, already exists in database"));if(this.isEmpty())return a.Deferred().reject(new Error("Cannot create empty document"));if(!this.isValid())return a.Deferred().reject(new Error("Cannot create, invalid document"));var c=this,d=a.extend(this._toJson(),this._toJsonFields());return delete d.id,this.ds.create(d,this._fields).then(function(a){return 1==b?a:c._fromJson(a)})},h.prototype.createMultiple=function(b,c,d,e){if(this.existsInDb())return a.Deferred().reject(new Error("Cannot create document, already exists in database"));if(this.isEmpty())return a.Deferred().reject(new Error("Cannot create empty document"));if(!this.isValid())return a.Deferred().reject(new Error("Cannot create, invalid document"));var f=this,g=a.extend(this._toJson(),this._toJsonFields(),{times:b||1,autoNumber:c||!1,startFrom:d});return delete g.id,g.model&&""!=a.trim(g.model)||(g.brandModel=g.model,delete g.model),this._doApiCall({method:"createMultiple",params:g}).then(function(b){var c=1==e?a.Deferred().resolve(b[0]):f._fromJson(b[0]);return c.then(function(){return b})})},h.prototype.duplicate=function(a,b,c,d){return this._doApiCall({method:"duplicate",params:{times:a,location:b,autoNumber:c,startFrom:d},skipRead:!0})},h.prototype.expire=function(a){return this._doApiCall({method:"expire",skipRead:a})},h.prototype.undoExpire=function(a){return this._doApiCall({method:"undoExpire",skipRead:a})},h.prototype.changeLocation=function(a,b){return this._doApiCall({method:"changeLocation",params:{location:a},skipRead:b})},h.prototype.addCode=function(a,b){return this._doApiCall({method:"addCodes",params:{codes:[a]},skipRead:b})},h.prototype.removeCode=function(a,b){return this._doApiCall({method:"removeCodes",params:{codes:[a]},skipRead:b})},h.prototype.updateGeo=function(a,b,c,d){return this._doApiCall({method:"updateGeo",params:{lat:a,lng:b,address:c},skipRead:d})},h.prototype.updateBasicFields=function(a,b,c,d,e,f,g){var h=this,i={name:a,brand:b,model:c,warrantyDate:d,purchaseDate:e,purchasePrice:f};for(var j in i)null==i[j]&&delete i[j];return this.ds.update(this.id,i,this._fields).then(function(a){return 1==g?a:h._fromJson(a)})},h.prototype.canChangeCategory=function(a){return this._doApiCall({collectionCall:!0,method:"canChangeCategory",params:{pks:[this.id],category:a},skipRead:!0})},h.prototype.changeCategory=function(a,b){var c=this;return this._doApiCall({collectionCall:!0,method:"changeCategory",params:{pks:[this.id],category:a},skipRead:!0}).then(function(a){return 1==b?a:c._fromJson(a[0])})},h.prototype.takeCustody=function(a,b){return this._doApiCall({method:"takeCustody",params:{customer:a},skipRead:b})},h.prototype.releaseCustody=function(a,b){return this._doApiCall({method:"releaseCustody",params:{location:a},skipRead:b})},h.prototype.transferCustody=function(a,b){return this._doApiCall({method:"transferCustody",params:{customer:a},skipRead:b})},h}(a,F),M=function(a,b,c){var d={name:"",items:[],status:"unknown",cover:""},e=function(){};e.prototype=b.prototype;var f=function(c){var e=a.extend({_fields:["*"],crtype:"cheqroom.types.kit"},c);b.call(this,e),this.name=e.name||d.name,this.items=e.items||d.items.slice(),this.codes=[],this.conflicts=[],this.status=e.status||d.status,this.cover=e.cover||d.cover};return f.prototype=new e,f.prototype.constructor=f,f.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=3},f.prototype.isNameAvailableAsync=function(){return null!=this.id&&null!=this.raw&&this.name==this.raw.name?a.Deferred().resolve(!0):(this._dfdNameAvailable&&this._dfdNameAvailable.abort(),this._dfdNameAvailable=this.ds.search({name:a.trim(this.name)},"_id"),this._dfdNameAvailable.then(function(a){return 0==a.count},function(a){return!1}))},f.prototype.isValid=function(){return this.isValidName()},f.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==d.name},f.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);return!a&&this.raw&&(a=this.name!=this.raw.name),a},f.prototype.addItems=function(b,c){return this.existsInDb()?this._doApiCall({method:"addItems",params:{items:b},skipRead:c}):a.Deferred().reject(new Error("Cannot addItems from document without id"))},f.prototype.removeItems=function(b,c){return this.existsInDb()?this._doApiCall({method:"removeItems",params:{items:b},skipRead:c}):a.Deferred().reject(new Error("Cannot removeItems from document without id"))},f.prototype.addCode=function(a,b){return this._doApiCall({method:"addCodes",params:{codes:[a]},skipRead:b})},f.prototype.removeCode=function(a,b){return this._doApiCall({method:"removeCodes",params:{codes:[a]},skipRead:b})},f.prototype.duplicate=function(a,b,c){return this._doApiCall({method:"duplicate",params:{times:a,location:b},skipRead:c||!0})},f.prototype._getDefaults=function(){return d},f.prototype._toJson=function(a){var c=b.prototype._toJson.call(this,a);return c.name=this.name||d.name,c},f.prototype._fromJson=function(c,e){var f=this;return b.prototype._fromJson.call(this,c,e).then(function(b){return f.name=b.name||d.name,f.items=b.items||d.items.slice(),f.codes=b.codes||[],f.status=b.status||d.status,f.cover=b.cover||d.cover,f._loadConflicts(f.items),a.publish("Kit.fromJson",b),b})},f.prototype.create=function(b){if(this.existsInDb())return a.Deferred().reject(new Error("Cannot create document, already exists in database"));var c=this,d={name:this.name,items:this._getIds(this.items)};return a.extend(d,this._toJsonFields()),delete d.id,this.ds.create(d,this._fields).then(function(a){return 1==b?a:c._fromJson(a)})},f.prototype._loadConflicts=function(b){var d=[],e=c.getKitStatus(b);"incomplete"==e&&a.each(b,function(a,b){switch(b.status){case"await_checkout":d.push({kind:"status",item:b._id,itemName:b.name,itemStatus:b.status,order:b.order});break;case"checkedout":d.push({kind:"order",item:b._id,itemName:b.name,itemStatus:b.status,order:b.order});break;case"expired":d.push({kind:"status",item:b._id,itemName:b.name,itemStatus:b.status})}}),this.conflicts=d},f}(a,F,u),N=function(a,b){var c={name:"",address:""},d=function(){};d.prototype=b.prototype;var e=function(d){var e=a.extend({_fields:["*"]},d);b.call(this,e),this.name=e.name||c.name,this.address=e.address||c.address};return e.prototype=new d,e.prototype.constructor=e,e.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==c.name&&this.address==c.address},e.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);if(!a&&this.raw){var d=this.raw.name||c.name,e=this.raw.address||c.address;return this.name!=d||this.address!=e}return a},e.prototype._getDefaults=function(){return c},e.prototype._toJson=function(a){var d=b.prototype._toJson.call(this,a);return d.name=this.name||c.name,d.address=this.address||c.address,d},e.prototype._fromJson=function(d,e){var f=this;return b.prototype._fromJson.call(this,d,e).then(function(){return f.name=d.name||c.name,f.address=d.address||c.address,a.publish("location.fromJson",d),d})},e}(a,F),O=function(a,b){var c={name:"",address:""},d=function(){};d.prototype=b.prototype;var e=function(d){var e=a.extend({_fields:["*"]},d);b.call(this,e),this.name=e.name||c.name,this.address=e.address||c.address};return e.prototype=new d,e.prototype.constructor=e,e.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==c.name&&this.address==c.address},e.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);if(!a&&this.raw){var d=this.raw.name||c.name,e=this.raw.address||c.address;return this.name!=d||this.address!=e}return a},e.prototype._getDefaults=function(){return c},e.prototype._toJson=function(a){var d=b.prototype._toJson.call(this,a);return d.name=this.name||c.name,d.address=this.address||c.address,d},e.prototype._fromJson=function(d,e){var f=this;return b.prototype._fromJson.call(this,d,e).then(function(){return f.name=d.name||c.name,f.address=d.address||c.address,a.publish("location.fromJson",d),d})},e}(a,F),P=function(a,b){b.fn.toJSONDate=function(){return this.format("YYYY-MM-DD[T]HH:mm:ss.000[Z]")},b.fn.roundTo=function(a,c,d){a=b.normalizeUnits(a),c=c||1;var e=function(a){switch(d){case"up":a=Math.ceil(a/c);break;case"down":a=Math.floor(a/c);break;default:a=Math.round(a/c)}return a*c};switch(a){case"year":this.year(e(this.year()));break;case"month":this.month(e(this.month()));break;case"week":this.weekday(e(this.weekday()));break;case"isoWeek":this.isoWeekday(e(this.isoWeekday()));break;case"day":this.day(e(this.day()));break;case"hour":this.hour(e(this.hour()));break;case"minute":this.minute(e(this.minute()));break;case"second":this.second(e(this.second()));break;default:this.millisecond(e(this.millisecond()))}return this};var c=15,d=function(a){a=a||{},this.roundType=a.roundType||"nearest",this.roundMinutes=a.roundMinutes||c};return d.prototype.getNow=function(){return b()},d.prototype.getFriendlyDuration=function(a){return a.humanize()},d.prototype.getFriendlyDateParts=function(a,b,c){b=b||this.getNow(),c=c||"MMM D [at] h:mm a";var d=b.diff(a,"days"),e=Math.abs(d)<7?a.calendar():a.format(c);return e.replace("AM","am").replace("PM","pm").split(" at ")},d.prototype.getFriendlyFromTo=function(a,b,c,d,e,f){d=d||this.getNow();var g=e||" - ",h=this.getFriendlyDateParts(a,d,f),i=this.getFriendlyDateParts(b,d,f),j={dayDiff:a.diff(b,"days"),fromDate:h[0],fromTime:c?h[1]:"",toDate:i[0],toTime:c?i[1]:""};return j.fromText=j.fromDate,j.toText=j.toDate,c&&(j.fromTime&&(j.fromText+=" "+j.fromTime),j.toTime&&(j.toText+=" "+j.toTime)),0==j.dayDiff?c?j.text=j.fromText+g+j.toTime:j.text=j.fromText:j.text=j.fromText+g+j.toText,j},d.prototype.getFriendlyFromToOld=function(a,c,d){var e=this.roundFromTime(a,d),f=this.roundToTime(c,d);return{from:e,to:f,daysBetween:f.clone().startOf("day").diff(e.clone().startOf("day"),"days"),duration:b.duration(e-f).humanize(),fromText:e.calendar().replace(" at "," "),toText:f.calendar().replace(" at "," ")}},d.prototype.getFriendlyDateText=function(a,b,c,d){if(null==a)return"Not set";var e=this.getFriendlyDateParts(a,c,d);return b?e.join(" "):e[0]},d.prototype.addAverageDuration=function(a){return a.clone().add(1,"day")},d.prototype.roundTimeFrom=function(a){return this.roundMinutes<=1?a:this.roundTime(a,this.roundMinutes,this._typeToDirection(this.roundType,"from"))},d.prototype.roundTimeTo=function(a){return this.roundMinutes<=1?a:this.roundTime(a,this.roundMinutes,this._typeToDirection(this.roundType,"to"))},d.prototype.roundTime=function(a,d,e){var f=b.isMoment(a)?a:b(a);return f.seconds(0).milliseconds(0),f.roundTo("minute",d||c,e)},d.prototype.roundTimeUp=function(a,d){var e=b.isMoment(a)?a:b(a);return e.seconds(0).milliseconds(0),e.roundTo("minute",d||c,"up")},d.prototype.roundTimeDown=function(a,d){var e=b.isMoment(a)?a:b(a);return e.seconds(0).milliseconds(0),e.roundTo("minute",d||c,"down")},d.prototype._typeToDirection=function(a,b){switch(a){case"longer":switch(b){case"from":return"down";case"to":return"up"}break;case"shorter":switch(b){case"from":return"up";case"to":return"down"}}},d}(a,b),Q={amazonBucket:"app"},R=function(a,b,c){return function(a){return a=a||b,{getSettings:function(){return a},getImageCDNUrl:function(b,d,e){return c.getImageCDNUrl(a,b,d,e)},getImageUrl:function(a,b,c,d){var e=a.getBaseUrl()+b+"?mimeType=image/jpeg";return c&&(e+="&size="+c),d&&(e+="&_bust="+(new Date).getTime()),e},getNumItemsLeft:function(a,b){var c=this.getStat(b,"items","status");return a.maxItems-this.getStat(b,"items","total")+c.expired},getNumUsersLeft:function(a,b){var c=this.getStat(b,"users","status");return a.maxUsers-c.active},getStat:function(a,b,c,d,e){if(a=a||{},a=a[d&&"null"!=d?d:"all"]||a.all,void 0===a)throw"Invalid stats";a=a[e||"production"];var f=a[b];if(void 0===f)throw"Stat doesn't exist";if(!c)return f;var g=f[c];if(void 0===g)throw"Stat value doesn't exist";return g},getAccessRights:function(a,b,c){var d="root"==a||"admin"==a,e="root"==a||"admin"==a||"user"==a,f=c.allowOrders&&b.useOrders,g=c.allowReservations&&b.useReservations,h=c.allowGeneratePdf&&b.useOrderAgreements,i=c.allowWebHooks,j=(c.allowKits&&b.useKits,c.allowCustody&&b.useCustody,c.allowOrderTransfers&&b.useOrderTransfers);return{contacts:{create:e,remove:e,update:!0,archive:e},items:{create:d,remove:d,update:d,updateFlag:d,updateLocation:d,updateGeo:!0},orders:{create:f,remove:f,update:f,updateContact:"selfservice"!=a,updateLocation:f,generatePdf:f&&h&&e,transferOrder:f&&j,archive:f&&e},reservations:{create:g,remove:g,update:g,updateContact:g&&"selfservice"!=a,updateLocation:g,archive:g&&e},locations:{create:d,remove:d,update:d},users:{create:d,remove:d,update:d,updateOther:d,updateOwn:!0},webHooks:{create:i&&d,remove:i&&d,update:i&&d},stickers:{print:d,buy:d},categories:{create:d,update:d},account:{update:d}}},ensureValue:function(a,b){return"string"==typeof a?a:a&&a.hasOwnProperty(b)?a[b]:a},ensureId:function(a){return this.ensureValue(a,"_id")}}}}(a,Q,u),S=function(a,c,d,e,f,g){var h={status:"creating",from:null,to:null,due:null,contact:"",location:"",number:"",items:[],conflicts:[],by:null,archived:null},i=function(){};i.prototype=d.prototype;var j=function(b){var c=a.extend({},b);d.call(this,c),this.dsItems=c.dsItems,this.autoCleanup=null!=c.autoCleanup&&c.autoCleanup,this.dateHelper=c.dateHelper||new f,this.helper=c.helper||new g,this.status=c.status||h.status,this.from=c.from||h.from,this.to=c.to||h.to,this.due=c.due||h.due,this.number=c.number||h.number,this.contact=c.contact||h.contact,this.location=c.location||h.location,this.items=c.items||h.items.slice(),this.conflicts=c.conflicts||h.conflicts.slice(),this.by=c.by||h.by};return j.prototype=new i,j.prototype.constructor=d,j.prototype.getNow=function(){return this._getDateHelper().getNow()},j.prototype.getNowRounded=function(){return this._getDateHelper().roundTimeFrom(this.getNow())},j.prototype.getNextTimeSlot=function(a){a=a||this.getNowRounded();var c=b(a).add(this._getDateHelper().roundMinutes,"minutes");return c.isSame(a)&&(c=c.add(this._getDateHelper().roundMinutes,"minutes")),c},j.prototype.getMinDateFrom=function(){return this.getMinDate()},j.prototype.getMaxDateFrom=function(){return this.getMaxDate()},j.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.getMinDateFrom())},j.prototype.getMaxDateTo=function(){return this.getMaxDate()},j.prototype.getMinDateDue=function(){return this.getMinDateTo()},j.prototype.getMaxDateDue=function(){return this.getMaxDateTo()},j.prototype.getMinDate=function(){return this.getNow()},j.prototype.getMaxDate=function(){var a=this._getDateHelper(),b=a.getNow(),c=a.roundTimeTo(b);return c.add(365,"day")},j.prototype.suggestEndDate=function(a){var b=this._getDateHelper(),c=b.addAverageDuration(a||b.getNow());return b.roundTimeTo(c)},j.prototype.isEmpty=function(){return d.prototype.isEmpty.call(this)&&this.status==h.status&&this.from==h.from&&this.to==h.to&&this.due==h.due&&this.number==h.number&&this.contact==h.contact&&this.location==h.location&&0==this.items.length},j.prototype.isDirty=function(){return d.prototype.isDirty.call(this)||this._isDirtyBasic()||this._isDirtyDates()||this._isDirtyLocation()||this._isDirtyContact()||this._isDirtyItems()},j.prototype._isDirtyBasic=function(){if(this.raw){var a=this.raw.status||h.status;return this.status!=a}return!1},j.prototype._isDirtyDates=function(){if(this.raw){var a=this.raw.from||h.from,b=this.raw.to||h.to,c=this.raw.due||h.due;return this.from!=a||this.to!=b||this.due!=c}return!1},j.prototype._isDirtyLocation=function(){if(this.raw){var a=h.location;return this.raw.location&&(a=this.raw.location._id?this.raw.location._id:this.raw.location),this.location!=a}return!1},j.prototype._isDirtyContact=function(){if(this.raw){var a=h.contact;return this.raw.customer&&(a=this.raw.customer._id?this.raw.customer._id:this.raw.customer),this.contact!=a}return!1},j.prototype._isDirtyItems=function(){if(this.raw){h.items.slice();return this.raw.items,!1}return!1},j.prototype._getDefaults=function(){return h},j.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.due=this.due,this.location&&(b.location=this._getId(this.location)),this.contact&&(b.customer=this._getId(this.contact)),b},j.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.cover=null,c.status=a.status||h.status,c.number=a.number||h.number,c.location=a.location||h.location,c.contact=a.customer||h.contact,c.items=a.items||h.items.slice(),c.by=a.by||h.by,c.archived=a.archived||h.archived,c._getConflicts().then(function(a){c.conflicts=a})})},j.prototype._toLog=function(a){var b=this._toJson(a);b.minDateFrom=this.getMinDateFrom().toJSONDate(),b.maxDateFrom=this.getMaxDateFrom().toJSONDate(),b.minDateDue=this.getMinDateDue().toJSONDate(),b.maxDateDue=this.getMaxDateDue().toJSONDate(),b.minDateTo=this.getMinDateTo().toJSONDate(),b.maxDateTo=this.getMaxDateTo().toJSONDate()},j.prototype._checkFromDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateFrom(),this.getMaxDateFrom())},j.prototype._checkDueDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateDue(),this.getMaxDateDue())},j.prototype._checkToDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateTo(),this.getMaxDateTo())},j.prototype.clearFromDate=function(a){return this.from=h.from,this._handleTransaction(a)},j.prototype.setFromDate=function(a,b){return this.from=this._getDateHelper().roundTimeFrom(a),this._handleTransaction(b)},j.prototype.clearToDate=function(a){return this.to=h.to,this._handleTransaction(a)},j.prototype.setToDate=function(a,b){return this.to=this._getDateHelper().roundTimeTo(a),this._handleTransaction(b)},j.prototype.clearDueDate=function(a){return this.due=h.due,this._handleTransaction(a)},j.prototype.setDueDate=function(a,b){return this.due=this._getDateHelper().roundTimeTo(a),this._handleTransaction(b)},j.prototype.setLocation=function(a,b){return this.location=a,this.existsInDb()?this._doApiCall({method:"setLocation",params:{location:a},skipRead:b}):this._createTransaction(b)},j.prototype.clearLocation=function(a){var b=this;return this.location=h.location,this._doApiCall({method:"clearLocation",skipRead:a}).then(function(){return b._ensureTransactionDeleted()})},j.prototype.setContact=function(a,b){return this.contact=a,this.existsInDb()?this._doApiCall({method:"setCustomer",params:{customer:a},skipRead:b}):this._createTransaction(b)},j.prototype.clearContact=function(a){var b=this;return this.contact=h.contact,this._doApiCall({method:"clearCustomer",skipRead:a}).then(function(){return b._ensureTransactionDeleted()})},j.prototype.setName=function(a,b){return this._doApiCall({method:"setName",params:{name:a},skipRead:b})},j.prototype.clearName=function(a){return this._doApiCall({method:"clearName",skipRead:a})},j.prototype.addItems=function(a,b){var c=this;return this._ensureTransactionExists(b).then(function(){return c._doApiCall({method:"addItems",params:{items:a},skipRead:b})})},j.prototype.removeItems=function(b,c){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot removeItems from document without id"));var d=this;return this._doApiCall({method:"removeItems",params:{items:b},skipRead:c}).then(function(){return d._ensureTransactionDeleted()})},j.prototype.clearItems=function(b){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot clearItems from document without id"));var c=this;return this._doApiCall({method:"clearItems",skipRead:b}).then(function(){return c._ensureTransactionDeleted()})},j.prototype.swapItem=function(b,c,d){return this.existsInDb()?this._doApiCall({method:"swapItem",params:{fromItem:b,toItem:c},skipRead:d}):a.Deferred().reject(new Error("Cannot clearItems from document without id"))},j.prototype.hasItems=function(b){var c=this.items||[],d=[],e=null;return a.each(b,function(b,f){a.each(c,function(a,b){if(b._id==f)return e=f,!1}),null!=e&&d.push(e)}),d},j.prototype.archive=function(b){return"closed"!=this.status?a.Deferred().reject(new Error("Cannot archive document that isn't closed")):this._doApiCall({method:"archive",params:{},skipRead:b})},j.prototype.undoArchive=function(b){return"archived"==this.status?a.Deferred().reject(new Error("Cannot unarchive document that isn't archived")):this._doApiCall({method:"undoArchive",params:{},skipRead:b})},j.prototype._getConflicts=function(){return a.Deferred().resolve([])},j.prototype._getDateHelper=function(){return this.dateHelper},j.prototype._searchItems=function(b,d,e,f,g){if(null==this.dsItems)return a.Deferred().reject(new c.ApiBadRequest(this.crtype+" has no DataSource for items"));b=b||{},b.location=this._getId(this.location),null!=d&&d.length>0&&(b.listName=d);var h=this,i=null;return g&&g.length&&(i=g.slice(0),a.each(i,function(a,b){i[a]=h._getId(b)})),1==e?(b.onlyUnbooked=null==f||f,b.fromDate=this.from,b.toDate=this.to,b._limit=b._limit||20,b._skip=b._skip||0,i&&i.length&&(b.skipItems=i),this.dsItems.call(null,"searchAvailable",b)):(i&&i.length&&(b.pk__nin=i),this.dsItems.search(b))},j.prototype._checkDateBetweenMinMax=function(b,d,e){if(d=d||this.getMinDate(),e=e||this.getMaxDate(),b<d||b>e){var f="date "+b.toJSONDate()+" is outside of min max range "+d.toJSONDate()+"->"+e.toJSONDate();return a.Deferred().reject(new c.ApiUnprocessableEntity(f))}return a.Deferred().resolve(b)},j.prototype._handleTransaction=function(b){var c=this.isEmpty();return this.existsInDb()?c?this.autoCleanup?this._deleteTransaction():a.Deferred().resolve():this._updateTransaction(b):c?a.Deferred().resolve():this._createTransaction(b)},j.prototype._deleteTransaction=function(){return this.delete()},j.prototype._updateTransaction=function(a){return this.update(a)},j.prototype._createTransaction=function(a){return this.create(a)},j.prototype._ensureTransactionExists=function(b){return this.existsInDb()?a.Deferred().resolve():this._createTransaction(b)},j.prototype._ensureTransactionDeleted=function(){return this.isEmpty()&&this.autoCleanup?this._deleteTransaction():a.Deferred().resolve()},j}(a,v,F,O,P,R),T=function(a){var b={kind:"",doc:"",item:"",itemName:"",locationCurrent:"",locationDesired:"",fromDate:null,toDate:null},c=function(a){this.ds=a.ds,this._fields=a._fields,this.raw=null,this.kind=a.kind||b.kind,this.doc=a.doc||b.doc,this.item=a.item||b.item,this.itemName=a.itemName||b.itemName,this.locationCurrent=a.locationCurrent||b.locationCurrent,this.locationDesired=a.locationDesired||b.locationDesired,this.fromDate=a.fromDate||b.fromDate,this.toDate=a.toDate||b.toDate};return c.prototype._toJson=function(a){return{kind:this.kind,doc:this.doc,item:this.item,itemName:this.itemName,locationCurrent:this.locationCurrent,locationDesired:this.locationDesired,fromDate:this.fromDate,toDate:this.toDate}},c.prototype._fromJson=function(c,d){return this.raw=c,this.kind=c.kind||b.kind,this.item=c.item||b.item,this.itemName=c.itemName||b.itemName,this.fromDate=c.fromDate||b.fromDate,this.toDate=c.toDate||b.toDate,a.Deferred().resolve(c)},c}(a),U=function(a,c,d,e,f){var g=function(){};g.prototype=d.prototype;var h=function(b){var c=a.extend({crtype:"cheqroom.types.order",_fields:["*"]},b);d.call(this,c),this.dsReservations=c.dsReservations};return h.prototype=new g,h.prototype.constructor=h,h.prototype.getMinDateFrom=function(){return this.getNowRounded()},h.prototype.getMinDateDue=function(){return"open"==this.status?this.getNextTimeSlot():d.prototype.getMinDateDue.call(this)},h.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.fromDate=null!=this.fromDate?this.fromDate.toJSONDate():"null",
b.toDate=null!=this.toDate?this.toDate.toJSONDate():"null",b.due=null!=this.due?this.due.toJSONDate():"null",b},h.prototype._fromJson=function(b,c){var e=this;return e.from=null==b.started||"null"==b.started?null:b.started,e.to=null==b.finished||"null"==b.finished?null:b.finished,e.due=null==b.due||"null"==b.due?null:b.due,e.reservation=b.reservation||null,d.prototype._fromJson.call(this,b,c).then(function(){return a.publish("order.fromJson",b),b})},h.prototype._fromKeyValuesJson=function(b,c){var e=this;return e.dsReservations&&b.reservation&&b.reservation.keyValues&&b.reservation.keyValues.length>0?d.prototype._fromKeyValuesJson.call(e,b.reservation,a.extend(c,{ds:e.dsReservations})).then(function(){var a=e.comments,f=e.attachments;return d.prototype._fromKeyValuesJson.call(e,b,c).then(function(){e.comments=e.comments.concat(a).sort(function(a,b){return b.modified>a.modified}),e.attachments=e.attachments.concat(f).sort(function(a,b){return b.modified>a.modified})})}):d.prototype._fromKeyValuesJson.call(e,b,c)},h.prototype.getFriendlyDuration=function(){var a=this.getDuration();return null!=a?this._getDateHelper().getFriendlyDuration(a):""},h.prototype.getDuration=function(){if(null!=this.from){var a="closed"==this.status?this.to:this.due;if(a)return b.duration(a-this.from)}return null},h.prototype.canGenerateAgreement=function(){return"open"==this.status||"closed"==this.status},h.prototype.canCheckin=function(){return"open"==this.status},h.prototype.canCheckout=function(){var a=this;return"creating"==this.status&&this.location&&this.contact&&"active"==this.contact.status&&this.due&&this.due.isAfter(this._getDateHelper().getNow())&&this.items&&this.items.length&&f.getItemsByStatus(this.items,function(b){return a.id==a.helper.ensureId(b.order)}).length==this.items.length},h.prototype.canUndoCheckout=function(){return"open"==this.status},h.prototype._getConflicts=function(){var b=[];if("creating"==this.status&&this.items.length>0){var c=this._getId(this.location);if(a.each(this.items,function(a,d){"expired"==d.status?b.push(new e({kind:"expired",item:d._id,itemName:d.name,locationCurrent:d.location,locationDesired:c})):c&&d.location!=c&&b.push(new e({kind:"location",item:d._id,itemName:d.name,locationCurrent:d.location,locationDesired:c}))}),this.due){var d=this,f="",g=null;return this.dsItems.call(null,"getAvailabilities",{items:a.map(this.items,function(a){return a._id}),fromDate:this.from,toDate:this.due}).then(function(c){return a.each(c,function(c,h){g=a.grep(d.items,function(a){return a._id==h.item}),g&&g.length>0&&(g=g[0]),null!=g&&"expired"!=g.status&&h.order!=d.id&&h.reservation!=d.helper.ensureId(d.reservation)&&(f="",f=f||(h.order?"order":""),f=f||(h.reservation?"reservation":""),b.push(new e({kind:f,item:g._id,itemName:g.name,fromDate:h.fromDate,toDate:h.toDate,doc:h.order||h.reservation})))}),b})}}return a.Deferred().resolve(b)},h.prototype.setFromDueDate=function(b,d,e){if("creating"!=this.status)return a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order from / due date, status is "+this.status));var f=this,g=this.getMinDateFrom(),h=d?this._getDateHelper().roundTimeTo(d):this._getDateHelper().addAverageDuration(g);return this._checkFromDueDate(g,h).then(function(){return f.from=g,f.due=h,f._handleTransaction(e)})},h.prototype.setFromDate=function(b,d){if("creating"!=this.status)return a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order from date, status is "+this.status));var e=this,f=this._getDateHelper().roundTimeFrom(b);return this._checkFromDueDate(f,this.due).then(function(){return e.from=f,e._handleTransaction(d)})},h.prototype.clearFromDate=function(b){return"creating"!=this.status?a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot clear order from date, status is "+this.status)):(this.from=null,this._handleTransaction(b))},h.prototype.setDueDate=function(b,d){if("creating"!=this.status&&"open"!=this.status)return a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order due date, status is "+this.status));var e=this,f=this._getDateHelper().roundTimeTo(b);return this.from=this.getMinDateFrom(),this._checkDueDateBetweenMinMax(f).then(function(){return e.due=f,e.existsInDb()?"open"==e.status?e.canExtend(f).then(function(b){return b&&1==b.result?e.extend(f,d):a.Deferred().reject("Cannot extend order to given date because it has conflicts.",b)}):e._doApiCall({method:"setDueDate",params:{due:f},skipRead:d}):e._createTransaction(d)})},h.prototype.clearDueDate=function(b){return"creating"!=this.status?a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot clear order due date, status is "+this.status)):(this.due=null,this._doApiCall({method:"clearDueDate",skipRead:b}))},h.prototype.setToDate=function(a,b){throw"Order.setToDate not implemented, it is set during order close"},h.prototype.clearToDate=function(a,b){throw"Order.clearToDate not implemented, it is set during order close"},h.prototype.searchItems=function(a,b,c,d,e){return this._searchItems(a,null!=e?e:"available",b,c,d||this.items)},h.prototype.checkin=function(a,b,c){return this._doApiCall({method:"checkin",params:{items:a,location:b},skipRead:c})},h.prototype.checkout=function(a){return this._doApiCall({method:"checkout",skipRead:a})},h.prototype.undoCheckout=function(a){return this._doApiCall({method:"undoCheckout",skipRead:a})},h.prototype.canExtend=function(b){return a.Deferred().resolve({result:!0})},h.prototype.extend=function(a,b){return this._doApiCall({method:"extend",params:{due:a},skipRead:b})},h.prototype.generateAgreement=function(a){return this._doApiCall({method:"generateAgreement",skipRead:a})},h.prototype._checkFromDueDate=function(b,d){var e=this._getDateHelper(),f=b,g=d;return f&&g?a.when(this._checkDateBetweenMinMax(f),this._checkDateBetweenMinMax(g)).then(function(b,d){var h=e.roundMinutes;return g.diff(f,"minutes")<h?a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order from date, after (or too close to) to date "+g.toJSONDate())):f.diff(g,"minutes")>h?a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order due date, before (or too close to) from date "+f.toJSONDate())):void 0}):f?this._checkDateBetweenMinMax(f):g?this._checkDateBetweenMinMax(g):a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot from/due date, both are null"))},h}(a,v,S,T,u),V=function(){var a=function(a,b,c){this.user=a,this.profile=b,this.limits=c,this._isOwner=a.isOwner,this._isRootOrAdmin="root"==a.role||"admin"==a.role,this._isRootOrAdminOrUser="root"==a.role||"admin"==a.role||"user"==a.role,this._isSelfService="selfservice"==a.role,this._useWebHooks=c.allowWebHooks,this._useOrders=c.allowOrders&&b.useOrders,this._useReservations=c.allowReservations&&b.useReservations,this._useOrderAgreements=c.allowGeneratePdf&&b.useOrderAgreements,this._useKits=c.allowKits&&b.useKits,this._useCustody=c.allowCustody&&b.useCustody,this._useGeo=b.useGeo,this._useSelfService=c.allowSelfService&&b.useSelfService,this._useCheckinLocation=this._useOrders&&b.orderCheckinLocation,this._usePublicSelfService=c.allowSelfService&&b.usePublicSelfService,this._useOrderTransfers=c.allowOrderTransfers&&b.useOrderTransfers,this._useSendMessage=c.allowSendMessage&&b.useSendMessage,this._useFlags=b.useCustom,this._useGeo=b.useGeo,this._isSelfService&&(this._useOrders=this._useOrders&&this._useSelfService&&b.selfServiceCanOrder,this._useReservations=this._useReservations&&this._useSelfService&&b.selfServiceCanReserve,this._useCustody=this._useCustody&&this._useSelfService&&b.selfServiceCanCustody)};return a.prototype.hasAnyAdminPermission=function(){return this.hasPermission("create","locations")||this.hasPermission("create","categories")||this.hasPermission("create","webhooks")||this.hasPermission("create","users")},a.prototype.hasDashboardPermission=function(a,b,c){return this._isRootOrAdminOrUser},a.prototype.hasCalendarPermission=function(a,b,c){return!0},a.prototype.hasItemPermission=function(a,b,c){return this.hasPermission(a,"items",b,c)},a.prototype.hasItemCustodyPermission=function(){return this._useCustody},a.prototype.hasItemFlagPermission=function(){return this._useFlags},a.prototype.hasItemGeoPermission=function(){return this._useGeo},a.prototype.hasItemGeoPermission=function(){return this._useGeo},a.prototype.hasKitPermission=function(a,b,c){return this.hasPermission(a,"kits",b,c)},a.prototype.hasContactPermission=function(a,b,c){return this.hasPermission(a,"contacts",b,c)},a.prototype.hasContactReadOtherPermission=function(a,b,c){return!this._isSelfService},a.prototype.hasCheckoutPermission=function(a,b,c){return this.hasPermission(a,"orders",b,c)},a.prototype.hasReservationPermission=function(a,b,c){return this.hasPermission(a,"reservations",b,c)},a.prototype.hasCategoriesPermission=function(a,b,c){return this.hasPermission(a,"categories",b,c)},a.prototype.hasWebhooksPermission=function(a,b,c){return this.hasPermission(a,"webhooks",b,c)},a.prototype.hasUserPermission=function(a,b,c){return this.hasPermission(a,"users",b,c)},a.prototype.hasLocationPermission=function(a,b,c){return this.hasPermission(a,"locations",b,c)},a.prototype.hasWebhookPermission=function(a,b,c){return this.hasPermission(a,"webhooks",b,c)},a.prototype.hasAccountPermission=function(a,b,c){return this.hasPermission(a,"account",b,c)},a.prototype.hasAccountInvoicesPermission=function(a,b,c){return this.hasPermission(a,"invoices",b,c)},a.prototype.hasAccountSubscriptionPermission=function(a,b,c){return this.hasPermission(a,"subscription",b,c)},a.prototype.hasAccountBillingPermission=function(a,b,c){return this.hasPermission(a,"billing",b,c)},a.prototype.hasAccountTemplatePermission=function(a,b,c){return this.hasPermission(a,"template",b,c)},a.prototype.hasAssetTagsPermission=function(a,b,c){return this.hasAnyAdminPermission()},a.prototype.hasPermission=function(a,b,c,d){if(this._isSelfService&&!this._useSelfService)return!1;switch(b){default:return!1;case"items":switch(a){default:return!1;case"read":return!0;case"create":case"update":case"delete":case"expire":case"undoExpire":case"setFlag":case"clearFlag":case"setField":case"clearField":case"addAttachment":case"addComment":case"updateComment":case"removeComment":case"import":case"export":case"updateGeo":return this._isRootOrAdmin;case"takeCustody":case"releaseCustody":return this._useCustody;case"transferCustody":return this._useCustody&&this._isRootOrAdmin}break;case"kits":switch(a){default:return!1;case"read":return this._useKits;case"create":case"update":case"delete":case"setField":case"clearField":case"setFlag":case"clearFlag":case"addAttachment":case"addComment":case"updateComment":case"removeComment":return this._useKits&&this._isRootOrAdmin}break;case"orders":case"checkouts":switch(a){default:return!1;case"read":case"create":case"update":case"delete":case"setField":case"clearField":case"setFlag":case"clearFlag":case"addAttachment":case"addComment":case"updateComment":case"removeComment":return this._useOrders;case"generateAgreement":return this._useOrderAgreements}break;case"reservations":switch(a){default:return!1;case"read":case"create":case"update":case"delete":case"setField":case"clearField":case"setFlag":case"clearFlag":case"addAttachment":case"addComment":case"updateComment":case"removeComment":return this._useReservations}break;case"customers":case"contacts":switch(a){default:return!1;case"read":return!0;case"create":case"update":case"delete":case"archive":case"undoArchive":case"setField":case"clearField":case"setFlag":case"clearFlag":case"addAttachment":case"addComment":case"updateComment":case"removeComment":case"import":case"export":return this._isRootOrAdminOrUser}break;case"categories":case"users":case"locations":switch(a){default:return!1;case"read":return!0;case"create":case"update":case"delete":return this._isRootOrAdmin}break;case"webhooks":switch(a){default:return!1;case"read":case"create":case"update":case"delete":return this._useWebHooks&&this._isRootOrAdmin}break;case"account":case"subscription":case"invoices":case"billing":case"template":switch(a){default:return!1;case"read":return this._isRootOrAdmin}break;case"asset-tags":switch(a){default:return this._isRootOrAdmin}}},a}(),W=function(a,b,c,d){var e=function(){};e.prototype=c.prototype;var f=function(b){var d=a.extend({crtype:"cheqroom.types.reservation",_fields:["*"]},b);c.call(this,d),this.conflicts=[]};return f.prototype=new e,f.prototype.constructor=f,f.prototype.getMinDateFrom=function(){return this.getNextTimeSlot()},f.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.from)},f.prototype.canReserve=function(){return"creating"==this.status&&this.location&&this.contact&&"active"==this.contact.status&&this.from&&this.to&&this.items&&this.items.length},f.prototype.canCancel=function(){return"open"==this.status},f.prototype.canEdit=function(){return"creating"==this.status},f.prototype.canDelete=function(){return"creating"==this.status},f.prototype.canMakeOrder=function(){if("open"==this.status&&null!=this.to&&this.to.isAfter(this.getNow())){var b=this._getUnavailableItems(),c=a.map(b,function(a,b){return b}).length;return 0==c}return!1},f.prototype._toJson=function(a){var b=c.prototype._toJson.call(this,a);return b.fromDate=null!=this.from?this.from.toJSONDate():"null",b.toDate=null!=this.to?this.to.toJSONDate():"null",b},f.prototype._fromJson=function(b,d){var e=this;return e.from=null==b.fromDate||"null"==b.fromDate?null:b.fromDate,e.to=null==b.toDate||"null"==b.toDate?null:b.toDate,e.due=null,c.prototype._fromJson.call(this,b,d).then(function(){a.publish("reservation.fromJson",b)})},f.prototype._getConflicts=function(){var b=[],c=null;if(this.items&&this.items.length&&(this.location||this.from&&this.to))if("open"==this.status){var e=this._getId(this.location);a.each(this.items,function(a,c){"expired"==c.status?b.push(new d({kind:"expired",item:c._id,itemName:c.name,doc:c.order})):"available"!=c.status?b.push(new d({kind:"status",item:c._id,itemName:c.name,doc:c.order})):c.location!=e&&b.push(new d({kind:"location",item:c._id,itemName:c.name,locationCurrent:c.location,locationDesired:e,doc:c.order}))})}else if("creating"==this.status){var f=this;return this.ds.call(this.id,"getConflicts").then(function(e){return e&&e.length&&a.each(f.items,function(a,f){if(c=e.find(function(a){return a.item==f._id})){var g=c.kind||"";g=g||c.order?"order":"",g=g||c.reservation?"reservation":"",b.push(new d({kind:g,item:f._id,itemName:f.name,doc:c.conflictsWith}))}}),b})}return a.Deferred().resolve(b)},f.prototype.setFromToDate=function(c,d,e){if("creating"!=this.status)return a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation from / to date, status is "+this.status));var f=this,g=this._getDateHelper().roundTimeFrom(c),h=d?this._getDateHelper().roundTimeTo(d):this._getDateHelper().addAverageDuration(g);return this._checkFromToDate(g,h).then(function(){return f.from=g,f.to=h,f._handleTransaction(e)})},f.prototype.setFromDate=function(c,d){if("creating"!=this.status)return a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation from date, status is "+this.status));var e=this,f=this._getDateHelper(),g=f.roundMinutes,h=f.roundTimeFrom(c);return this._checkFromDateBetweenMinMax(h).then(function(){return e.to&&e.to.diff(h,"minutes")<g?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation from date, after (or too close to) to date "+e.to.toJSONDate())):(e.from=h,e._handleTransaction(d))})},f.prototype.clearFromDate=function(c){return"creating"!=this.status?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot clear reservation from date, status is "+this.status)):(this.from=null,this._handleTransaction(c))},f.prototype.setToDate=function(c,d){if("creating"!=this.status)return a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation to date, status is "+this.status));var e=this,f=this._getDateHelper(),g=f.roundMinutes,h=f.roundTimeTo(c);return this._checkToDateBetweenMinMax(h).then(function(){return e.from&&e.from.diff(h,"minutes")>g?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation to date, before (or too close to) to date "+e.from.toJSONDate())):(e.to=h,e._handleTransaction(d))})},f.prototype.clearToDate=function(c){return"creating"!=this.status?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot clear reservation to date, status is "+this.status)):(this.to=null,this._handleTransaction(c))},f.prototype.clearDueDate=function(a){throw"Reservation.clearDueDate not implemented"},f.prototype.setDueDate=function(a,b){throw"Reservation.setDueDate not implemented"},f.prototype.searchItems=function(a,b,c,d){return this._searchItems(a,null,!0,c,d||this.items)},f.prototype.reserve=function(a){return this._doApiCall({method:"reserve",skipRead:a})},f.prototype.undoReserve=function(a){return this._doApiCall({method:"undoReserve",skipRead:a})},f.prototype.cancel=function(a){return this._doApiCall({method:"cancel",skipRead:a})},f.prototype.makeOrder=function(){return this._doApiCall({method:"makeOrder",skipRead:!0})},f.prototype.switchToOrder=function(){return this._doApiCall({method:"switchToOrder",skipRead:!0})},f.prototype._checkFromToDate=function(c,d){var e=this._getDateHelper(),f=c,g=d;return f&&g?a.when(this._checkFromDateBetweenMinMax(f),this._checkToDateBetweenMinMax(g)).then(function(c,d){var h=e.roundMinutes;return g.diff(f,"minutes")<h?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set order from date, after (or too close to) to date "+g.toJSONDate())):f.diff(g,"minutes")>h?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set order due date, before (or too close to) from date "+f.toJSONDate())):void 0}):f?this._checkFromDateBetweenMinMax(f):g?this._checkToDateBetweenMinMax(g):a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot from/due date, both are null"))},f.prototype._getUnavailableItems=function(){var b={};if("open"==this.status&&this.location&&null!=this.items&&this.items.length>0){var c=this,d=c._getId(c.location);a.each(this.items,function(a,c){"available"!=c.status?(b.status=b.status||[],b.status.push(c._id)):c.location!=d&&(b.location=b.location||[],b.location.push(c._id))})}return b},f}(a,v,S,T),X=function(a,c,d,e,f,g){var h={status:"creating",from:null,to:null,due:null,contact:"",location:"",number:"",items:[],conflicts:[],by:null,archived:null},i=function(){};i.prototype=d.prototype;var j=function(b){var c=a.extend({},b);d.call(this,c),this.dsItems=c.dsItems,this.autoCleanup=null!=c.autoCleanup&&c.autoCleanup,this.dateHelper=c.dateHelper||new f,this.helper=c.helper||new g,this.status=c.status||h.status,this.from=c.from||h.from,this.to=c.to||h.to,this.due=c.due||h.due,this.number=c.number||h.number,this.contact=c.contact||h.contact,this.location=c.location||h.location,this.items=c.items||h.items.slice(),this.conflicts=c.conflicts||h.conflicts.slice(),this.by=c.by||h.by};return j.prototype=new i,j.prototype.constructor=d,j.prototype.getNow=function(){return this._getDateHelper().getNow()},j.prototype.getNowRounded=function(){return this._getDateHelper().roundTimeFrom(this.getNow())},j.prototype.getNextTimeSlot=function(a){a=a||this.getNowRounded();var c=b(a).add(this._getDateHelper().roundMinutes,"minutes");return c.isSame(a)&&(c=c.add(this._getDateHelper().roundMinutes,"minutes")),c},j.prototype.getMinDateFrom=function(){return this.getMinDate()},j.prototype.getMaxDateFrom=function(){return this.getMaxDate()},j.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.getMinDateFrom())},j.prototype.getMaxDateTo=function(){return this.getMaxDate()},j.prototype.getMinDateDue=function(){return this.getMinDateTo()},j.prototype.getMaxDateDue=function(){return this.getMaxDateTo()},j.prototype.getMinDate=function(){return this.getNow()},j.prototype.getMaxDate=function(){var a=this._getDateHelper(),b=a.getNow(),c=a.roundTimeTo(b);return c.add(365,"day")},j.prototype.suggestEndDate=function(a){var b=this._getDateHelper(),c=b.addAverageDuration(a||b.getNow());return b.roundTimeTo(c)},j.prototype.isEmpty=function(){return d.prototype.isEmpty.call(this)&&this.status==h.status&&this.from==h.from&&this.to==h.to&&this.due==h.due&&this.number==h.number&&this.contact==h.contact&&this.location==h.location&&0==this.items.length},j.prototype.isDirty=function(){return d.prototype.isDirty.call(this)||this._isDirtyBasic()||this._isDirtyDates()||this._isDirtyLocation()||this._isDirtyContact()||this._isDirtyItems()},j.prototype._isDirtyBasic=function(){if(this.raw){var a=this.raw.status||h.status;return this.status!=a}return!1},j.prototype._isDirtyDates=function(){if(this.raw){var a=this.raw.from||h.from,b=this.raw.to||h.to,c=this.raw.due||h.due;return this.from!=a||this.to!=b||this.due!=c}return!1},j.prototype._isDirtyLocation=function(){if(this.raw){var a=h.location;return this.raw.location&&(a=this.raw.location._id?this.raw.location._id:this.raw.location),this.location!=a}return!1},j.prototype._isDirtyContact=function(){if(this.raw){var a=h.contact;return this.raw.customer&&(a=this.raw.customer._id?this.raw.customer._id:this.raw.customer),this.contact!=a}return!1},j.prototype._isDirtyItems=function(){if(this.raw){h.items.slice();return this.raw.items,!1}return!1},j.prototype._getDefaults=function(){return h},j.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.due=this.due,this.location&&(b.location=this._getId(this.location)),this.contact&&(b.customer=this._getId(this.contact)),b},j.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.cover=null,c.status=a.status||h.status,c.number=a.number||h.number,c.location=a.location||h.location,c.contact=a.customer||h.contact,c.items=a.items||h.items.slice(),c.by=a.by||h.by,c.archived=a.archived||h.archived,c._getConflicts().then(function(a){c.conflicts=a})})},j.prototype._toLog=function(a){var b=this._toJson(a);b.minDateFrom=this.getMinDateFrom().toJSONDate(),b.maxDateFrom=this.getMaxDateFrom().toJSONDate(),b.minDateDue=this.getMinDateDue().toJSONDate(),b.maxDateDue=this.getMaxDateDue().toJSONDate(),b.minDateTo=this.getMinDateTo().toJSONDate(),b.maxDateTo=this.getMaxDateTo().toJSONDate()},j.prototype._checkFromDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateFrom(),this.getMaxDateFrom())},j.prototype._checkDueDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateDue(),this.getMaxDateDue())},j.prototype._checkToDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateTo(),this.getMaxDateTo())},j.prototype.clearFromDate=function(a){return this.from=h.from,this._handleTransaction(a)},j.prototype.setFromDate=function(a,b){return this.from=this._getDateHelper().roundTimeFrom(a),this._handleTransaction(b)},j.prototype.clearToDate=function(a){return this.to=h.to,this._handleTransaction(a)},j.prototype.setToDate=function(a,b){return this.to=this._getDateHelper().roundTimeTo(a),this._handleTransaction(b)},j.prototype.clearDueDate=function(a){return this.due=h.due,this._handleTransaction(a)},j.prototype.setDueDate=function(a,b){return this.due=this._getDateHelper().roundTimeTo(a),this._handleTransaction(b)},j.prototype.setLocation=function(a,b){return this.location=a,this.existsInDb()?this._doApiCall({method:"setLocation",params:{location:a},skipRead:b}):this._createTransaction(b)},j.prototype.clearLocation=function(a){var b=this;return this.location=h.location,this._doApiCall({method:"clearLocation",skipRead:a}).then(function(){return b._ensureTransactionDeleted()})},j.prototype.setContact=function(a,b){return this.contact=a,this.existsInDb()?this._doApiCall({method:"setCustomer",params:{customer:a},skipRead:b}):this._createTransaction(b)},j.prototype.clearContact=function(a){var b=this;return this.contact=h.contact,this._doApiCall({method:"clearCustomer",skipRead:a}).then(function(){return b._ensureTransactionDeleted()})},j.prototype.setName=function(a,b){return this._doApiCall({method:"setName",params:{name:a},skipRead:b})},j.prototype.clearName=function(a){return this._doApiCall({method:"clearName",skipRead:a})},j.prototype.addItems=function(a,b){var c=this;return this._ensureTransactionExists(b).then(function(){return c._doApiCall({method:"addItems",params:{items:a},skipRead:b})})},j.prototype.removeItems=function(b,c){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot removeItems from document without id"));var d=this;return this._doApiCall({method:"removeItems",params:{items:b},skipRead:c}).then(function(){return d._ensureTransactionDeleted()})},j.prototype.clearItems=function(b){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot clearItems from document without id"));var c=this;return this._doApiCall({method:"clearItems",skipRead:b}).then(function(){return c._ensureTransactionDeleted()})},j.prototype.swapItem=function(b,c,d){return this.existsInDb()?this._doApiCall({method:"swapItem",params:{fromItem:b,toItem:c},skipRead:d}):a.Deferred().reject(new Error("Cannot clearItems from document without id"))},j.prototype.hasItems=function(b){var c=this.items||[],d=[],e=null;return a.each(b,function(b,f){a.each(c,function(a,b){if(b._id==f)return e=f,!1}),null!=e&&d.push(e)}),d},j.prototype.archive=function(b){return"closed"!=this.status?a.Deferred().reject(new Error("Cannot archive document that isn't closed")):this._doApiCall({method:"archive",params:{},skipRead:b})},j.prototype.undoArchive=function(b){return"archived"==this.status?a.Deferred().reject(new Error("Cannot unarchive document that isn't archived")):this._doApiCall({method:"undoArchive",params:{},skipRead:b})},j.prototype._getConflicts=function(){return a.Deferred().resolve([])},j.prototype._getDateHelper=function(){return this.dateHelper},j.prototype._searchItems=function(b,d,e,f,g){if(null==this.dsItems)return a.Deferred().reject(new c.ApiBadRequest(this.crtype+" has no DataSource for items"));b=b||{},b.location=this._getId(this.location),null!=d&&d.length>0&&(b.listName=d);var h=this,i=null;return g&&g.length&&(i=g.slice(0),a.each(i,function(a,b){i[a]=h._getId(b)})),1==e?(b.onlyUnbooked=null==f||f,b.fromDate=this.from,b.toDate=this.to,b._limit=b._limit||20,b._skip=b._skip||0,i&&i.length&&(b.skipItems=i),this.dsItems.call(null,"searchAvailable",b)):(i&&i.length&&(b.pk__nin=i),this.dsItems.search(b))},j.prototype._checkDateBetweenMinMax=function(b,d,e){if(d=d||this.getMinDate(),e=e||this.getMaxDate(),b<d||b>e){var f="date "+b.toJSONDate()+" is outside of min max range "+d.toJSONDate()+"->"+e.toJSONDate();return a.Deferred().reject(new c.ApiUnprocessableEntity(f))}return a.Deferred().resolve(b)},j.prototype._handleTransaction=function(b){var c=this.isEmpty();return this.existsInDb()?c?this.autoCleanup?this._deleteTransaction():a.Deferred().resolve():this._updateTransaction(b):c?a.Deferred().resolve():this._createTransaction(b)},j.prototype._deleteTransaction=function(){return this.delete()},j.prototype._updateTransaction=function(a){return this.update(a)},j.prototype._createTransaction=function(a){return this.create(a)},j.prototype._ensureTransactionExists=function(b){return this.existsInDb()?a.Deferred().resolve():this._createTransaction(b)},j.prototype._ensureTransactionDeleted=function(){return this.isEmpty()&&this.autoCleanup?this._deleteTransaction():a.Deferred().resolve()},j}(a,v,F,O,P,R),Y=function(a,b,c){var d={name:"",email:"",group:"",picture:"",role:"user",active:!0},e=function(){};e.prototype=b.prototype;var f=function(c){var e=a.extend({_fields:["*","group","picture"]},c);b.call(this,e),this.helper=e.helper,this.name=e.name||d.name,this.picture=e.picture||d.picture,this.email=e.email||d.email,this.role=e.role||d.role,this.group=e.group||d.group,this.active=null!=e.active?e.active:d.active};return f.prototype=new e,f.prototype.constructor=f,f.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=4},f.prototype.isValidEmail=function(){return this.email=a.trim(this.email),c.isValidEmail(this.email)},f.prototype.isValidRole=function(){switch(this.role){case"user":case"admin":case"root":case"selfservice":return!0;default:return!1}},f.prototype.isValidPassword=function(){this.password=a.trim(this.password);var b=this.password.length,c=this.password.match(/[0-9]/);return b>=4&&c},f.prototype.isValid=function(){return this.isValidName()&&this.isValidEmail()&&this.isValidRole()},f.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==d.name&&this.email==d.email&&this.role==d.role},f.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);if(!a&&this.raw){var c=this.raw.name||d.name,e=this.raw.role||d.role,f=this.raw.email||d.email,g=null!=this.raw.active?this.raw.active:d.active;return this.name!=c||this.email!=f||this.role!=e||this.active!=g}return a},f.prototype.getImageUrl=function(a,b){return null!=this.picture&&this.picture.length>0?this.helper.getImageCDNUrl(this.group,this.picture,a,b):this.helper.getImageUrl(this.ds,this.id,a,b)},f.prototype._getDefaults=function(){return d},f.prototype.addKeyValue=function(b,c,d,e){return a.Deferred().reject("Not implemented for User, use setPicture instead?")},f.prototype.addKeyValue=function(b,c,d,e,f){return a.Deferred().reject("Not implemented for User, use setPicture instead?")},f.prototype.removeKeyValue=function(b,c){return a.Deferred().reject("Not implemented for User, use clearPicture instead?")},f.prototype.setPicture=function(b,c){return this.existsInDb()?(this.picture=b,this._doApiCall({method:"setPicture",params:{attachment:b},skipRead:c})):a.Deferred().reject("User does not exist in database")},f.prototype.clearPicture=function(b){return this.existsInDb()?this._doApiCall({method:"clearPicture",skipRead:b}):a.Deferred().reject("User does not exist in database")},f.prototype._toJson=function(a){var c=b.prototype._toJson.call(this,a);return c.name=this.name||d.name,c.email=this.email||d.email,c.group=this.group||d.group,c.role=this.role||d.role,c.active=this.active||d.active,c},f.prototype._fromJson=function(c,e){var f=this;return b.prototype._fromJson.call(this,c,e).then(function(){return f.group=c.group&&null!=c.group._id?c.group._id:c.group||d.group,f.name=c.name||d.name,f.picture=c.picture||d.picture,f.email=c.email||d.email,f.role=c.role||d.role,f.active=null!=c.active?c.active:d.active,a.publish("user.fromJson",c),c})},f}(a,F,u),Z=function(a,b,c,d){var e={id:"",name:"",address:"",topic:"",hookFields:"*, location.*, items.*, customer.*",format:"",created:null,modified:null,enabled:!0,log10:[],fails:0},f=function(){};f.prototype=d.prototype;var g=function(b){var c=a.extend({},b);d.call(this,c),this.name=c.name||e.name,this.address=c.address||e.address,this.topic=c.topic||e.topic,this.hookFields=c.hookFields||e.hookFields,this.created=c.created||e.created,this.modified=c.modified||e.modified,this.enabled=null!=c.enabled?1==c.enabled:e.enabled,this.log10=c.log10||e.log10.slice(),this.fails=c.fails||e.fails};return g.prototype=new f,g.prototype.constructor=g,g.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=3},g.prototype.isValidAddress=function(){return this.address=a.trim(this.address),b.isValidURL(this.address)},g.prototype.isValid=function(){return this.isValidName()&&this.isValidAddress()&&this.topic},g.prototype._getDefaults=function(){return e},g.prototype.isEmpty=function(){return d.prototype.isEmpty.call(this)&&this.name==e.name&&this.address==e.address&&this.topic==e.topic},g.prototype.isDirty=function(){var a=d.prototype.isDirty.call(this);return!a&&this.raw&&(a=this.name!=this.raw.name||this.address!=this.raw.address||this.topic!=this.raw.topic||this.enabled!=this.raw.enabled),a},g.prototype.canDelete=function(){return a.Deferred().resolve(!0)},g.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.name=this.name,b.address=this.address,b.topic=this.topic,b.fields=this.hookFields,b.modified=this.modified,b.enabled=this.enabled,b},g.prototype._fromJson=function(a,b){
var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.name=a.name||e.name,c.address=a.address||e.address,c.topic=a.topic||e.topic,c.hookFields=a.fields||e.hookFields,c.created=a.created_at||e.created,c.modified=a.modified||e.modified,c.enabled=null!=a.enabled?1==a.enabled:e.enabled,c.log10=a.log10||e.log10.slice(),c.fails=a.nr_consecutive_fails||e.fails,a})},g}(a,u,v,w),_=function(a,b){var c={by:null,created:null,modified:null,status:"creating",items:[],started:null,accepted:null,fromOrder:null,toOrder:null,startedBy:null},d=function(){};d.prototype=b.prototype;var e=function(d){var e=a.extend({_fields:["*"],crtype:"cheqroom.types.reservation.ordertransfer"},d);b.call(this,e),this.by=e.by||c.by,this.created=e.created||c.created,this.modified=e.modified||c.modified,this.status=e.status||c.status,this.items=e.items||c.items,this.started=e.started||c.started,this.accepted=e.accepted||c.accepted,this.fromOrder=e.fromOrder||c.fromOrder,this.toOrder=e.toOrder||c.toOrder,this.startedBy=e.startedBy||c.startedBy};return e.prototype=new d,e.prototype.constructor=e,e.prototype.isEmpty=function(){return!1},e.prototype._toJson=function(a){var d=b.prototype._toJson.call(this,a);return d.items=this.items||c.items,d},e.prototype._fromJson=function(a,d){var e=this;return b.prototype._fromJson.call(this,a,d).then(function(){return e.by=a.by||c.by,e.created=a.created||c.created,e.modified=a.modified||c.modified,e.items=a.items||c.items,e.status=a.status||c.status,e.started=a.started||c.started,e.accepted=a.accepted||c.accepted,e.fromOrder=a.fromOrder||c.fromOrder,e.toOrder=a.toOrder||c.toOrder,e.startedBy=a.startedBy||c.startedBy,a})},e.prototype.addItems=function(a,b){return this._doApiCall({method:"addItems",params:{items:a},skipRead:b})},e.prototype.removeItems=function(a,b){return this._doApiCall({method:"removeItems",params:{items:a},skipRead:b})},e.prototype.start=function(a){return this._doApiCall({method:"start",params:{},skipRead:a})},e.prototype.undoStart=function(a){return this._doApiCall({method:"undoStart",params:{},skipRead:a})},e.prototype.accept=function(a,b){return this._doApiCall({method:"accept",params:a,skipRead:b})},e.prototype.getQRUrl=function(a){return this.ds._baseUrl+"/"+this.id+"/call/qr?size="+(a||300)},e}(a,F),aa=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w={};return w.api=a,w.common=u,w.Availability=b,w.Attachment=c,w.Base=d,w.Comment=e,w.Conflict=f,w.Contact=g,w.DateHelper=h,w.Document=i,w.Group=j,w.Item=k,w.Kit=l,w.Location=m,w.Order=n,w.PermissionHandler=p,w.Reservation=q,w.Transaction=r,w.User=s,w.WebHook=t,w.OrderTransfer=v,w.Helper=o,w}(v,x,y,C,D,E,H,I,J,K,L,M,N,U,R,V,W,X,Y,Z,u,_)});