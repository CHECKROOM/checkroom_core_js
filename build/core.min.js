/*! cheqroom-core 2022-01-11 */

!function(e,t){"function"==typeof define&&define.amd?define(["jquery","moment"],t):e.cheqroomCore=t($,moment)}(this,function(e,o){var t,i,r,c,s,E,T,S,l,n,a,u,A,b,O,I,x,d,h,p,m,f,y,g,_,v,C,D,me,fe,ye,ge,_e,ve,Ce,De,k,R,w,N,U,M,F,P,L,j,B,V,W,H,J,q,z,K,G,Y,Z,X,Q,ee,te,re,ie,se,ne,oe,ae,ce,ue,le,de,he,pe,ke,Re,we,Ee,Te,Se,Ae;function be(){this.rules=[{regex:/(#{1,6})\s(.*)/g,replacement:function(e,t,r){t=t.length;return"<h"+t+">"+r.trim()+"</h"+t+">"}},{regex:/!\[([^\[]+)\]\(([^\)]+)\)/g,replacement:"<img src='$2' alt='$1'>"},{regex:/\[([^\[]+)\]\(([^\)]+)\)/g,replacement:"<a href='$2'>$1</a>"},{regex:/(\*\*|__)(.*?)\1/g,replacement:"<strong>$2</strong>"},{regex:/(\*|_)(.*?)\1/g,replacement:"<em>$2</em>"},{regex:/\~\~(.*?)\~\~/g,replacement:"<del>$1</del>"},{regex:/\:\"(.*?)\"\:/g,replacement:"<q>$1</q>"},{regex:/`(.*?)`/g,replacement:"<code>$1</code>"},{regex:/\n\*(.*)/g,replacement:function(e,t){return"\n<ul>\n\t<li>"+t.trim()+"</li>\n</ul>"}},{regex:/\n[0-9]+\.\s(.*)/g,replacement:function(e,t){return"\n<ol>\n\t<li>"+t.trim()+"</li>\n</ol>"}},{regex:/\n(&gt;|\>)(.*)/g,replacement:function(e,t,r){return"\n<blockquote>"+r.trim()+"</blockquote>"}},{regex:/\n-{5,}/g,replacement:"\n<hr />"},{regex:/<\/ul>\s?<ul>/g,replacement:""},{regex:/<\/ol>\s?<ol>/g,replacement:""},{regex:/(?:[^\n]|(?:<[^>].*>)\n(?! *\n))+/g,replacement:function(e,t){e=(""+e).trim();if(/^<\/?(ul|ol|li|h|p|bl)/i.test(e))return e;return"<p>"+(e=e.replace(/\n/g,"<br />"))+"</p>"}},{regex:/<\/blockquote><blockquote>/g,replacement:"\n"}],this.addRule=function(e,t){e.global=!0,e.multiline=!1,this.rules.push({regex:e,replacement:t})},this.render=function(t){return t=function(e){var t=e.match(/(\(?https?:\/\/[-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#\/%=~_()|])(">|<\/a>|\)|\])?/gm);if(null==t)return e;for(var r={},i=0;i<t.length;i++){var s=t[i];if(-1!=s.lastIndexOf("]")||-1!=s.lastIndexOf(")"))break;if(r[s])break;r[s]=s,e=e.replace(s,"["+s+"]("+s+")")}return e}(t="\n"+t+"\n"),this.rules.forEach(function(e){t=t.replace(e.regex,e.replacement)}),t.trim()}}function Oe(e){this.raw=R.extend({},w,e=e||{}),this.id=e.id||w.id,this.name=e.name||w.name,this.color=e.color||w.color,this.readonly=e.readonly||w.readonly,this.selected=e.selected||w.selected,this.default=e.default||w.default}function Ie(e){this.raw=null,this.id=e.id||F.id,this.ds=e.ds,this._fields=e._fields}function xe(e){this.ds=(e=e||{}).ds,this.raw=null,this.fileName=e.fileName||B.fileName,this.fileSize=e.fileSize||B.fileSize,this.value=e.value||B.value,this.value_url=e.value_url||B.value_url,this.created=e.created||B.created,this.by=e.by||B.by,this.isCover=(null!=e.isCover?e:B).isCover,this.canBeCover=(null!=e.canBeCover?e:B).canBeCover,this.forKind=e.forKind}function Ne(e){this.raw=e=e||{},this.name=e.name||H.name,this.value=e.value||H.value,this.required=e.required||H.required,this.unit=e.unit||H.unit,this.kind=e.kind||H.kind,this.form=e.form||H.form,this.editor=e.editor||H.editor,this.description=e.description||H.description,this.select=e.select||H.select}function Ue(e,t,r,i,s){this.user=e,this.profile=t,this.limits=r,this.permissions=i,this.isFeatureEnabled=s||function(){return!1},this._isOwner=e.isOwner,this._isBlockedContact=e.customer&&"blocked"==e.customer.status,this._useWebhooks=r.allowWebhooks&&t.useWebhooks,this._useOrders=r.allowOrders&&t.useOrders,this._useReservations=r.allowReservations&&t.useReservations,this._usePdf=r.allowGeneratePdf,this._useKits=r.allowKits&&t.useKits,this._useCustody=r.allowCustody&&t.useCustody,this._useSelfService=r.allowSelfService&&t.useSelfService,this._useCheckinLocation=this._useOrders&&t.orderCheckinLocation,this._usePublicSelfService=r.allowSelfService&&t.usePublicSelfService,this._useOrderTransfers=r.allowOrderTransfers&&t.useOrderTransfers,this._useSendMessage=r.allowSendMessage&&t.useSendMessage,this._useUserSync=r.allowUserSync&&t.useUserSync,this._useFlags=t.useFlags,this._useGeo=r.allowGeo&&t.useGeo,this._useRestrictLocations=r.allowRestrictLocations&&t.useRestrictLocations,this._useReporting=r.allowReporting&&t.useReporting,this._useDepreciations=r.allowDepreciations&&t.useDepreciations,this._useNotifications=r.allowNotifications&&t.useNotifications,this._useBlockContacts=r.allowBlockContacts&&t.useBlockContacts,this._useReservationsClose=this._useReservations&&t.useReservationsClose,this._useSlack=r.allowIntegrationSlack&&t.useIntegrationSlack,this._useApi=r.allowAPI,this._useReleaseAtLocation=this._useCustody&&(void 0===t.custodyCanChangeLocation||t.custodyCanChangeLocation),this._useSpotcheck=r.allowSpotcheck&&t.useSpotcheck,this._useCustomRoles=r.allowCustomRoles,this._useSSO=r.allowSSO,this._useExport=r.allowExport,this._useImport=r.allowImport,this._useRepeatReservations=r.allowReservationsRepeat,this._useICal=r.allowICal,this._usePublicInventory=r.allowPublicInventory,this._useBookingRestrictions=r.allowBookingRestrictions,this._useEquipmentPicking=r.allowEquipmentPicking&&t.useEquipmentPicking,this._useLocationBusinessHours=r.allowLocationBusinessHours,this._useClosedDays=r.allowHolidays}return(i=e).fn.ajaxQueue=function(){var r=(new i.Deferred).resolve();return function(e,t){if("function"!=typeof e)throw"must be a function";return r=r.then(e,t||e)}},t=function(u,s){var c=2048,l=function(){};u.ajaxSetup({beforeSend:function(e,t){"GET"==t.type?t.url+=(-1==t.url.indexOf("?")?"?":"&")+"_="+(new Date).getTime():t.data._=(new Date).getTime()}});var o={NetworkNotConnected:function(e,t){this.code=999,this.message=e||"Connection interrupted",this.opt=t}};return o.NetworkNotConnected.prototype=new Error,o.NetworkTimeout=function(e,t){this.code=408,this.message=e||"Could not reach the server in time",this.opt=t},o.NetworkTimeout.prototype=new Error,o.ApiError=function(e,t){this.code=500,this.message=e||"Something went wrong on the server",this.opt=t},o.ApiError.prototype=new Error,o.ApiNotFound=function(e,t){this.code=404,this.message=e||"Could not find what you're looking for",this.opt=t},o.ApiNotFound.prototype=new Error,o.ApiBadRequest=function(e,t){this.code=400,this.message=e||"The server did not understand your request",this.opt=t},o.ApiBadRequest.prototype=new Error,o.ApiUnauthorized=function(e,t){this.code=401,this.message=e||"Your session has expired",this.opt=t},o.ApiUnauthorized.prototype=new Error,o.ApiForbidden=function(e,t){this.code=403,this.message=e||"You don't have sufficient rights",this.opt=t},o.ApiForbidden.prototype=new Error,o.ApiUnprocessableEntity=function(e,t){this.code=422,this.message=e||"Some data is invalid",this.opt=t},o.ApiUnprocessableEntity.prototype=new Error,o.ApiSubscriptionLimit=function(e,t){this.code=422,this.message=e||"You have reached your subscription limit",this.opt=t},o.ApiSubscriptionLimit.prototype=new Error,o.ApiPaymentRequired=function(e,t){this.code=402,this.message=e||"Your subscription has expired",this.opt=t},o.ApiPaymentRequired.prototype=new Error,o.ApiServerCapicity=function(e,t){this.code=503,this.message=e||"Back-end server is at capacity",this.opt=t},o.ApiServerCapicity.prototype=new Error,o.ApiAjax=function(e){this.timeOut=(e=e||{}).timeOut||1e4,this.responseInTz=!0,this.beforeSend=e.beforeSend||function(){}},o.ApiAjax.prototype.get=function(e,t){return l("ApiAjax: get "+e),this._getAjax(e,t)},o.ApiAjax.prototype.post=function(e,t,r){return l("ApiAjax: post "+e),this._postAjax(e,t,r)},o.ApiAjax.prototype._handleAjaxSuccess=function(e,t,r){return this.responseInTz&&(t=this._fixDates(t)),e.resolve(t)},o.ApiAjax.prototype._handleAjaxError=function(e,t,r,i,s){if("abort"!=r){var n="";if("timeout"===i)e.reject(new o.NetworkTimeout(n,s));else{if(t){i={};try{i=JSON.parse(t.responseText)}catch(e){}t.statusText&&-1<t.statusText.indexOf("Notify user:")&&(n=i.message),422==t.status&&(n=i.message,s={detail:i.message,status:i.status})}switch(t.status){case 400:e.reject(new o.ApiBadRequest(n,s));break;case 401:e.reject(new o.ApiUnauthorized(n,s));break;case 402:e.reject(new o.ApiPaymentRequired(n,s));break;case 403:e.reject(new o.ApiForbidden(n,s));break;case 404:e.reject(new o.ApiNotFound(n,s));break;case 408:e.reject(new o.NetworkTimeout(n,s));break;case 422:n&&0<=n.indexOf("limit")&&0<=n.indexOf("reach")?e.reject(new o.ApiSubscriptionLimit(n,s)):e.reject(new o.ApiUnprocessableEntity(n,s));break;case 503:e.reject(new o.ApiServerCapicity(n,s));break;default:e.reject(new o.ApiError(n,s))}}}},o.ApiAjax.prototype._postAjax=function(e,t,r,i){var s=u.Deferred(),n=this,o=u.ajax({type:"POST",url:e,beforeSend:n.beforeSend,data:JSON.stringify(this._prepareDict(t)),contentType:"application/json; charset=utf-8",timeout:r||this.timeOut,success:function(e){return n._handleAjaxSuccess(s,e,i)},error:function(e,t,r){return n._handleAjaxError(s,e,t,r,i)}}),r=s.promise();return r.abort=function(){o.abort()},r},o.ApiAjax.prototype._getAjax=function(e,t,i){var s=u.Deferred(),n=this,r=u.ajax({url:e,beforeSend:n.beforeSend,timeout:t||this.timeOut,success:function(e){return n._handleAjaxSuccess(s,e,i)},error:function(e,t,r){return n._handleAjaxError(s,e,t,r,i)}}),t=s.promise();return t.abort=function(){r.abort()},t},o.ApiAjax.prototype._prepareDict=function(r){return r?(u.each(r,function(e,t){s.isMoment(t)&&(r[e]=t.toJSONDate())}),r):{}},o.ApiAjax.prototype._fixDates=function(r){var i;if("string"==typeof r||r instanceof String){if(r.endsWith("+00:00")){var e=r.length;if(25==e)return s(r.substring(0,e-6));if(32==e)return s(r.substring(0,e-6).split(".")[0])}}else(r instanceof Object||u.isArray(r))&&(i=this,u.each(r,function(e,t){r[e]=i._fixDates(t)}));return r},o.ApiUser=function(e){this.userId=(e=e||{}).userId||"",this.userEmail=e.userEmail||"",this.userToken=e.userToken||"",this.userJwt=e.jwt||"",this.tokenType=e.tokenType||"",this.impersonated=e.impersonated||!1},o.ApiUser.prototype.fromStorage=function(){this.userId=window.localStorage.getItem("userId")||"",this.userEmail=window.localStorage.getItem("userEmail")||"",this.userToken=window.localStorage.getItem("userToken")||"",this.userJwt=window.localStorage.getItem("userJwt")||"",this.tokenType=window.localStorage.getItem("tokenType")||"",this.impersonated="true"===window.localStorage.getItem("impersonated")},o.ApiUser.prototype.toStorage=function(){window.localStorage.setItem("userId",this.userId),window.localStorage.setItem("userEmail",this.userEmail),window.localStorage.setItem("userToken",this.userToken),window.localStorage.setItem("userJwt",this.userJwt),window.localStorage.setItem("tokenType",this.tokenType),window.localStorage.setItem("impersonated",this.impersonated)},o.ApiUser.prototype.removeFromStorage=function(){window.localStorage.removeItem("userId"),window.localStorage.removeItem("userEmail"),window.localStorage.removeItem("userToken"),window.localStorage.removeItem("userJwt"),window.localStorage.removeItem("tokenType"),window.localStorage.removeItem("impersonated")},o.ApiUser.prototype.clearToken=function(){window.localStorage.setItem("userToken",null),window.localStorage.setItem("userJwt",null),window.localStorage.setItem("tokenType",null)},o.ApiUser.prototype.isValid=function(){return l("ApiUser: isValid"),null!=this.userId&&0<this.userId.length&&null!=this.userToken&&0<this.userToken.length},o.ApiUser.prototype._reset=function(){this.userId="",this.userToken="",this.userJwt="",this.tokenType="",this.userEmail="",this.impersonated=!1},o.ApiAuth=function(e){this.urlAuth=(e=e||{}).urlAuth||"",this.ajax=e.ajax,this.version=e.version,this.platform=e.platform,this.device=e.device,this.sso=e.sso,this.allowAccountOwner=void 0===e.allowAccountOwner||e.allowAccountOwner},o.ApiAuth.prototype.authenticate=function(e,t){l("ApiAuth: authenticate "+e);var r=this,t={user:e,password:t,_v:this.version};this.platform&&(t.platform=this.platform),this.device&&(t.device=this.device),this.sso&&(t.sso=this.sso);var i=u.Deferred();return this.ajax.post(this.urlAuth,t,3e4).done(function(e){"OK"!=e.status||-1!=["expired","cancelled_expired","archived"].indexOf(e.subscription)&&!r.allowAccountOwner?i.reject(e):i.resolve(e.data,!0===e.is_impersonated)}).fail(function(e){i.reject(e)}),i.promise()},o.ApiAuthV2=o.ApiAuth,o.ApiAnonymous=function(e){this.ajax=(e=e||{}).ajax,this.urlApi=e.urlApi||"",this.version=e.version},o.ApiAnonymous.prototype.call=function(e,t,r,i){l("ApiAnonymous: call "+e),this.version&&((t=t||{})._v=this.version);var s=this.urlApi+"/"+e,e=s+"?"+u.param(this.ajax._prepareDict(t));return i||c<=e.length?this.ajax.post(s,t,r):this.ajax.get(e,r)},o.ApiAnonymous.prototype.longCall=function(e,t,r){return l("ApiAnonymous: longCall "+e),this.call(e,t,6e4,r)},o.ApiDataSource=function(e){this.collection=(e=e||{}).collection||"",this.urlApi=e.urlApi||"",this.user=e.user,this.ajax=e.ajax,this.version=e.version},o.ApiDataSource.prototype.exists=function(e,t){l("ApiDataSource: "+this.collection+": exists "+e);var r=u.Deferred(),e=this.getBaseUrl()+e,t=this.getParams(t);return u.isEmptyObject(t)||(e+="?"+this.getParams(t)),this._ajaxGet("exists",e).done(function(e){r.resolve(e)}).fail(function(e){e instanceof o.ApiNotFound?r.resolve(null):r.reject(e)}),r.promise()},o.ApiDataSource.prototype.get=function(e,t){l("ApiDataSource: "+this.collection+": get "+e);e=this.getBaseUrl()+e,t=this.getParamsDict(t);return u.isEmptyObject(t)||(e+="?"+this.getParams(t)),this._ajaxGet("get",e)},o.ApiDataSource.prototype.getIgnore404=function(e,t){l("ApiDataSource: "+this.collection+": getIgnore404 "+e);var r=u.Deferred();return this.get(e,t).done(function(e){r.resolve(e)}).fail(function(e){e instanceof o.ApiNotFound?r.resolve(null):r.reject(e)}),r.promise()},o.ApiDataSource.prototype.getMultiple=function(r,i){l("ApiDataSource: "+this.collection+": getMultiple "+r);var e=r.map(function(e,t){return t%100==0?r.slice(t,t+100):null}).filter(function(e){return e}),s=this,n=[],o=new u.fn.ajaxQueue,t=u.Deferred(),a=[],c=t.promise();return c.abort=function(){u.each(a,function(e,t){t.abort()})},u.each(e,function(e,t){var r=s.getBaseUrl()+t.join(","),t=s.getParamsDict(i);u.isEmptyObject(t)||(r+="?"+s.getParams(t)),o(function(){var e=s._ajaxGet("getMultiple",r);return e.then(function(e){e=u.isArray(e)?e:[e],n=n.concat(e)}),a.push(e),e})}),o(function(){return t.resolve(n)}),c},o.ApiDataSource.prototype.delete=function(e){l("ApiDataSource: "+this.collection+": delete "+e);e=this.getBaseUrl()+e+"/delete";return this._ajaxGet("delete",e)},o.ApiDataSource.prototype.deleteMultiple=function(e,t){l("ApiDataSource: "+this.collection+": deleteMultiple "+e);var r="deleteMultiple",i=this.getBaseUrl()+"delete",s={pk:e},e=i+"?"+this.getParams(s);return t||c<=e.length?this._ajaxPost(r,i,s):this._ajaxGet(r,e)},o.ApiDataSource.prototype.update=function(e,t,r,i,s){l("ApiDataSource: "+this.collection+": update "+e);e=this.getBaseUrl()+e+"/update",t=u.extend({},t);null!=r&&0<r.length&&(t._fields=u.isArray(r)?r.join(","):r);r=e+"?"+this.getParams(t);return s||c<=r.length?this._ajaxPost("update",e,t,i):this._ajaxGet("update",r,i)},o.ApiDataSource.prototype.create=function(e,t,r,i){l("ApiDataSource: "+this.collection+": create");var s=this.getBaseUrl()+"create",e=u.extend({},e);null!=t&&0<t.length&&(e._fields=u.isArray(t)?t.join(","):t);t=s+"?"+this.getParams(e);return i||c<=t.length?this._ajaxPost("create",s,e,r):this._ajaxGet("create",t,r)},o.ApiDataSource.prototype.createMultiple=function(e,r){l("ApiDataSource: "+this.collection+": createMultiple ("+e.length+")");var i=u.Deferred(),s=this,e=e.slice(0),n=[],o=function(t){var e;0<t.length?(e=t.pop(),s.create(e,r).done(function(e){return n.push(e._id),o(t)}).fail(function(e){i.reject(e)})):i.resolve(n)};return o(e),i.promise()},o.ApiDataSource.prototype.list=function(e,t,r,i,s){l("ApiDataSource: "+this.collection+": list "+(e=e||""));var n="list."+e,o=this.getBaseUrl();null!=e&&0<e.length&&(o+="list/"+e+"/");s=this.getParamsDict(t,r,i,s);return u.isEmptyObject(s)||(o+="?"+this.getParams(s)),this._ajaxGet(n,o)},o.ApiDataSource.prototype.search=function(e,t,r,i,s,n){l("ApiDataSource: "+this.collection+": search "+e);var o=this.getBaseUrl()+"search",a=this.searchUrl(e,t,r,i,s,n);if(a.length>=c){n=this.searchParams(e,t,r,i,s,n);return this._ajaxPost("search",o,n)}return this._ajaxGet("search",a)},o.ApiDataSource.prototype.searchUrl=function(e,t,r,i,s,n){var o=this.getBaseUrl()+"search",e=u.extend(this.getParamsDict(t,r,i,s),e);return null!=n&&0<n.length&&(e.mimeType=n),o+="?"+this.getParams(e)},o.ApiDataSource.prototype.searchParams=function(e,t,r,i,s,n){this.getBaseUrl();e=u.extend(this.getParamsDict(t,r,i,s),e);return null!=n&&0<n.length&&(e.mimeType=n),e},o.ApiDataSource.prototype.export=function(e,t,r,i,s,n){l("ApiDataSource: "+this.collection+": export "+e);n=this.exportUrl(e,t,r,i,s,n);return this._ajaxGet("export",n)},o.ApiDataSource.prototype.exportUrl=function(e,t,r,i,s,n){var o=this.getBaseUrl()+"call/export",e=u.extend(this.getParamsDict(t,r,i,s),e);return null!=n&&0<n.length&&(e.mimeType=n),o+="?"+this.getParams(e)},o.ApiDataSource.prototype.call=function(e,t,r,i,s,n){l("ApiDataSource: "+this.collection+": call "+t);var o="call."+t,t=null!=e&&0<e.length?this.getBaseUrl()+e+"/call/"+t:this.getBaseUrl()+"call/"+t,i=u.extend({},this.getParamsDict(i,null,null,null),r),r=t+"?"+this.getParams(i);return n||c<=r.length?this._ajaxPost(o,t,i,s):this._ajaxGet(o,r,s)},o.ApiDataSource.prototype.callMultiple=function(e,t,r,i,s,n){l("ApiDataSource: "+this.collection+": call "+t);var o="call."+t,t=this.getBaseUrl()+e.join(",")+"/call/"+t,i=u.extend({},this.getParamsDict(i,null,null,null),r),r=t+"?"+this.getParams(i);return n||c<=r.length?this._ajaxPost(o,t,i,s):this._ajaxGet(o,r,s)},o.ApiDataSource.prototype.longCall=function(e,t,r,i,s){return this.call(e,t,r,i,6e4,s)},o.ApiDataSource.prototype.getBaseUrl=function(e){var t=null!=this.user.tokenType&&0<this.user.tokenType.length?this.user.tokenType:"null";return this.urlApi+"/"+this.user.userId+"/"+("jwt"!==t||e?this.user.userToken:"null")+"/"+(e?"null":t)+"/"+this.collection+"/"},o.ApiDataSource.prototype.getParams=function(e){return u.param(this.ajax._prepareDict(e))},o.ApiDataSource.prototype.getParamsDict=function(e,t,r,i){var s={};return e&&(s._fields=u.isArray(e)?e.join(","):e.replace(/\s/g,"")),t&&(s._limit=t),r&&(s._skip=r),i&&(s._sort=i),this.version&&(s._v=this.version),s},o.ApiDataSource.prototype._ajaxGet=function(e,t,r){return this.ajax.get(t,r,{coll:this.collection,cmd:e})},o.ApiDataSource.prototype._ajaxPost=function(e,t,r,i){return this.ajax.post(t,r,i,{coll:this.collection,cmd:e})},o}(e,o),Ae={amazonBucket:"app"},Q={isCodeValid:function(e){return null!=e.trim().match(/^[a-z0-9]{8}$/i)},isCodeFromScanner:function(e){if(!e||0==e.length)return!1;e=e.substring(0,23);return 0=="http://cheqroom.com/qr/".indexOf(e)},isValidBarcode:function(e){return e&&null!=e.match(/^([A-Z0-9\s\-]{3,43})$/i)},isValidQRCode:function(e){return this.isValidItemQRCode(e)||this.isValidTransferQRCode(e)},isValidTransferQRCode:function(e){return null!=e.match(/^http:\/\/cheqroom\.com\/ordertransfer\/[a-zA-Z0-9]{22}$/i)},isValidDocQRCode:function(e){return e&&(null!=e.match(/^http:\/\/cheqroom\.com\/qr\/[a-z0-9]{8}$/i)||null!=e.match(/^[a-z0-9]{8}$/i))},isValidItemQRCode:function(e){return this.isValidDocQRCode(e)},isValidKitQRCode:function(e){return this.isValidDocQRCode(e)},getCheqRoomRedirectUrl:function(e){return this.isCodeValid(e)?"http://cheqroom.com/qr/"+e.trim():""},getCheqRoomRedirectUrlQR:function(e,t){return this.isCodeValid(e)?"https://chart.googleapis.com/chart?chs="+t+"x"+t+"&cht=qr&choe=UTF-8&chld=L|0&chl="+encodeURI(this.getCheqRoomRedirectUrl(e)):""},getQRCodeUrl:function(e,t,r){return e+"?code="+t+"&scale="+{XS:1,S:2,M:3,L:4,XL:5}[r]},getBarcodeUrl:function(e,t,r,i){return e+"?code="+t+"&width="+r+(i?"&height="+i:"")}},r=o,pe={getFriendlyOrderStatus:function(e){switch(e){case"creating":return"Draft";case"open":return"Open";case"closed":return"Completed";default:return"Unknown"}},getFriendlyOrderCss:function(e){switch(e){case"creating":return"label-creating";case"open":return"label-open";case"closed":return"label-closed";default:return""}},getFriendlyOrderSize:function(e){if(e.items&&0<e.items.length){var t=e.items.length+" item";return 1<e.items.length&&(t+="s"),t}return"No items"},isOrderOverdue:function(e,t){return t=t||r(),"open"==e.status&&t.isAfter(e.due)},isOrderArchived:function(e){return e&&null!=e.archived},getOrderStatus:function(e,t){return t=t||r(),this.isOrderOverdue(e,t)?"Overdue":this.isOrderArchived(e)?"Archived":this.getFriendlyOrderStatus(e.status)},getOrderCss:function(e,t){return t=t||r(),this.isOrderOverdue(e,t)?"label-overdue":this.isOrderArchived(e)?"label-archived":this.getFriendlyOrderCss(e.status)},canOrderSpotcheck:function(e){return null==e.archived&&-1==["closed"].indexOf(e.status)}},ce={getFriendlyReservationCss:function(e){switch(e){case"creating":return"label-creating";case"open":return"label-open";case"closed":return"label-converted";case"closed_manually":return"label-closed";case"cancelled":return"label-cancelled";default:return""}},getFriendlyReservationStatus:function(e){switch(e){case"creating":return"Draft";case"open":return"Booked";case"closed":return"Converted";case"closed_manually":return"Closed";case"cancelled":return"Cancelled";default:return"Unknown"}},getFriendlyReservationFrequency:function(e){switch(e){case"every_day":return"Repeats every day";case"every_weekday":return"Repeats every weekday";case"every_week":return"Repeats every week";case"every_2_weeks":return"Repeats every 2 weeks";case"every_month":return"Repeats every month";case"every_2_months":return"Repeats every 2 months";case"every_3_months":return"Repeats every 3 months";case"every_6_months":return"Repeats every 6 months";default:return"Repeating reservation"}},isReservationOverdue:function(e,t){return t=t||o(),"open"==e.status&&t.isAfter(e.fromDate||e.from)},isReservationInThePast:function(e,t){return t=t||o(),"open"==e.status&&t.isAfter(e.fromDate)&&t.isAfter(e.toDate)},isReservationArchived:function(e){return e&&null!=e.archived},getReservationCss:function(e){return this.isReservationArchived(e)?"label-archived":this.getFriendlyReservationCss(e.status)},getReservationStatus:function(e){return this.isReservationArchived(e)?"Archived":this.getFriendlyReservationStatus(e.status)},canReservationSpotcheck:function(e){return null==e.archived&&-1==["cancelled","closed"].indexOf(e.status)}},s={sortFields:function(e,t,r,i){var s,n,o=[];t=t.slice(),null!=r&&(t=t.filter(function(e){return e.form==r}));for(var a=0;a<t.length&&(n=e[(s=t[a]).name],o.push(c.extend({value:n},s)),!(null!=i&&o.length>=i));a++);return o},stringifyOrdered:function(e){if(keys=[],e)for(var t in e)keys.push(t);keys.sort();var r,i={};for(r in keys)i[t=keys[r]]=e[t];return JSON.stringify(i)},areEqual:function(e,t){return s.stringifyOrdered(e||{})==s.stringifyOrdered(t||{})},badgeify:function(e){return 100<e?"99+":10<e?"10+":0<e?""+e:""},getLoginName:function(e,t){var r=/[\s-]*/gim,i=[];return e&&i.push(e.latinise().toLowerCase().replace(r,"")),t&&i.push(t.latinise().toLowerCase().replace(r,"")),i.join(".")},getUrlParam:function(e,t,r){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(r||window.location.href);return r?decodeURIComponent(r[1].replace(/\+/g," ")):t}},(c=e).urlParam=s.getUrlParam,s.getParsedLines=function(e){return e&&0<e.length?e.split(/\s*([,;\r\n]+|\s\s)\s*/).filter(function(e,t,r){return 0<e.length&&e.indexOf(",")<0&&e.indexOf(";")<0&&0<c.trim(e).length&&r.indexOf(e)>=t}).map(function(e){return c.trim(e)}):[]},s.getFriendlyFileName=function(e){return e.replace(/[^a-z0-9]/gi,"_").toLowerCase()},s.getFriendlyKind=function(e){return"number"==e?"numeric":"select"==e?"dropdown list":"text"==e?"multi line text":"string"==e?"single line text":e},s.arrayToCSV=function(e,t){var r=new Blob([e],{type:"text/csv;charset=utf-8;"});window.navigator&&window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(r,t):((e=window.document.createElement("a")).download=t,e.href=window.URL.createObjectURL(r),e.style.display="none",window.document.body.appendChild(e),e.click())},s.kFormatter=function(e){return 999<Math.abs(e)?Math.sign(e)*(Math.abs(e)/1e3).toFixed(0)+"k":Math.sign(e)*Math.abs(e)},s.sanitizeHtml=function(e){return c("<div />").text(e).html().replace(/&nbsp;/g," ").replace(/&amp;/g,"&")},s.removeHtmlTags=function(e){return e.replace(/(<([^>]+)>)/gi,"")},E=o,T=pe,X={},S=(ne=s).sanitizeHtml,X.itemCanTakeCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"available"==e.status},X.itemCanReleaseCustody=function(e){return"in_custody"==e.status},X.itemCanTransferCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"in_custody"==e.status},X.itemCanReserve=function(e){return void 0===e.canReserve||"available"===e.canReserve},X.itemCanCheckout=function(e){return void 0===e.canOrder||"available"===e.canOrder},X.itemCanGoToCheckout=function(e){return"checkedout"==e.status||"await_checkout"==e.status},X.itemCanCheckin=function(e){return"checkedout"==e.status},X.itemCanExpire=function(e){return"available"==e.status},X.itemCanUndoExpire=function(e){return"expired"==e.status},X.itemCanDelete=function(e){return"available"==e.status||"expired"==e.status},X.getFriendlyItemStatus=function(e){switch(e){case"available":return"Available";case"checkedout":return"Checked out";case"await_checkout":return"Checking out";case"in_transit":return"In transit";case"in_custody":return"In custody";case"maintenance":return"Maintenance";case"repair":return"Repair";case"inspection":return"Inspection";case"expired":return"Retired";default:return"Unknown"}},X.getItemStatusCss=function(e){switch(e){case"available":return"label-available";case"checkedout":return"label-checkedout";case"await_checkout":return"label-awaitcheckout";case"in_transit":return"label-transit";case"in_custody":return"label-custody";case"maintenance":return"label-maintenance";case"repair":return"label-repair";case"inspection":return"label-inspection";case"expired":return"label-expired";default:return""}},X.getItemStatusIcon=function(e){switch(e){case"available":return"fa fa-check-circle";case"checkedout":return"fa fa-times-circle";case"await_checkout":return"fa fa-ellipsis-h";case"in_transit":return"fa fa-truck";case"in_custody":return"fa fa-exchange";case"maintenance":case"repair":return"fa fa-wrench";case"inspection":return"fa fa-stethoscope";case"expired":return"fa fa-bug";default:return""}},X.getItemsByStatus=function(e,t){return e?e.filter(function(e){return"string"==typeof t?e.status==t:t(e)}):[]},X.getAvailableItems=function(e){return this.getItemsByStatus(e,"available").filter(function(e){return"available"===e.canOrder})},X.getActiveItems=function(e){return this.getItemsByStatus(e,function(e){return"expired"!=e.status&&"in_custody"!=e.status}).filter(function(e){return"available"===e.canReserve})},X.getItemIds=function(e){return e.map(function(e){return"string"==typeof e?e:e._id})},X.getItemMessages=function(r,e,t,i,s,n){function o(e){return e.format("MMMM Do"+(e.year()==E().year()?"":" YYYY"))}function a(e){return e="string"!=typeof e?e||{}:{_id:e},(s=s||{}).customer||(s.customer={}),e._id==s.customer._id}var c,u=[],l=0,d=1,h=2,p=3,m=t,f=!m.hasContactReadOtherPermission(),y=$.Deferred(),g=$.Deferred(),_=$.Deferred();!m.hasCheckoutPermission("read")||"checkedout"!=r.status&&"await_checkout"!=r.status?y.resolve():(C="",c=$.Deferred(),e("orders").search({_fields:"name,itemSummary,status,started,due,finished,customer.name,customer.user.picture,customer.cover,customer.kind",_restrict:!f,_sort:"started",status:"checkedout"==r.status?"open":"creating",pk:"string"!=typeof r.order?r.order._id:r.order,_limit:1,_skip:0,items__contains:r.id}).then(function(e){e&&0<e.count&&c.resolve(e.docs[0])}),c.then(function(e){var t;a((e=e||{}).customer)&&(e.customer=s.customer,e.customer.user=s),C="await_checkout"==r.status?"Item is currently <strong>awaiting checkout</strong>":(t=S("string"!=typeof e.customer?e.customer.name:""),e&&T.isOrderOverdue(e)?"Item was <strong>due back</strong> "+e.due.fromNow()+(t?" from "+t:""):"Item is <strong>checked out</strong>"+(t?" to "+t:"")+" until "+o(e.due)),u.push({kind:"checkout",priority:l,message:C,checkout:!a(e.customer)&&f?{}:e}),y.resolve()})),m.hasReservationPermission("read")?e("reservations").search({status:"open",fromDate__gte:E(),_fields:"name,status,itemSummary,fromDate,toDate,customer.name,customer.user.picture,customer.cover,customer.kind",_restrict:!f||!m.hasReservationPermission("read"),_sort:"fromDate",_limit:1,_skip:0,items__contains:r.id}).then(function(e){e&&0<e.count&&(e=e.docs[0],C="Next <strong>reservation</strong> is "+e.fromDate.fromNow()+" <span class='text-muted'>on "+o(e.fromDate)+"</span>",u.push({kind:"reservation",priority:d,reservation:e,isOwn:a(e.customer),message:C})),g.resolve()}):g.resolve(),"in_custody"==r.status?(c=$.Deferred(),f?c.resolve(null):e("items").call(r.id,"getChangeLog",{action__in:["takeCustody","transferCustody"],limit:1,skip:0}).then(function(t){e("contacts").get(t[0].obj,"name,cover,user.picture,kind").then(function(e){c.resolve(e,t[0].created)})}),c.then(function(e,t){t="Item is <strong>in "+(a(r.custody)?"your":"")+" custody</strong>"+(e&&!a(r.custody)?" of "+S(e.name)+" <span class='text-muted'>since "+o(t)+"</span>":"");u.push({kind:"custody",priority:d,by:e||{},message:t}),_.resolve()})):_.resolve();var v,C,D=m.hasItemPermission("reserve")&&r.allowReserve,k=m.hasItemPermission("checkout")&&r.allowCheckout,R=m.hasItemPermission("takeCustody")&&r.allowCustody,w=n.itemFlags.find(function(e){return e.id==r.flag}),t=w&&!w.available;return r.allowReserve&&r.allowCheckout&&r.allowCustody||t||(v=[],n=[],m.hasReservationPermission("read")&&m.hasCheckoutPermission("read")&&(!D&&!k||D&&k)?D&&k?n.push("Bookings"):m.hasCheckoutPermission("read")&&m.hasReservationPermission("read")&&v.push("Bookings"):(D?n.push("Reservation"):m.hasReservationPermission("read")&&v.push("Reservation"),k?n.push("Check-out"):m.hasCheckoutPermission("read")&&v.push("Check-out")),R?n.push("Custody"):m.hasItemPermission("takeCustody")&&v.push("Custody"),C="",C=!D&&!k&&!R?"Item is <strong>unavailable</strong> for "+v.joinAdvanced(", "," and "):"Item is <strong>available</strong> for "+n.joinAdvanced(", "," and ")+"<span class='text-muted'>, not for "+v.joinAdvanced(", "," and ")+"</span>",u.push({kind:"permission",priority:h,message:C})),w&&(v=S(w.name),C="Item was <strong>flagged</strong> as "+v+(r.flagged?" <span class='text-muted'>"+r.flagged.fromNow()+"</span>":""),t&&(C="Item is <strong>unavailable</strong> because of flag "+v+(r.flagged?" <span class='text-muted'>"+r.flagged.fromNow()+"</span>":"")),u.push({kind:"flag",priority:t?d:h,message:C,flag:w})),r.warrantyDate&&(C="",w=0<=Math.round(E().diff(r.warrantyDate,"days")),C=w?"Went <strong>out of warranty</strong> "+r.warrantyDate.fromNow()+" <span class='text-muted'>on "+o(r.warrantyDate)+"</span>":"Warranty <strong>expires</strong> "+r.warrantyDate.fromNow()+" <span class='text-muted'>on "+o(r.warrantyDate)+"</span>",u.push({kind:"warranty",priority:p,message:C,inWarranty:w})),"expired"==r.status&&(C="Item was <strong>retired</strong> "+(r.expired?"<span class='text-muted'>"+r.expired.fromNow()+"</span>":""),u.push({kind:"expired",priority:l,message:C})),$.when(y,g,_).then(function(){return u.sort(function(e,t){return e.priority-t.priority})})},ee=X,te={getFriendlyConflictKind:function(e){switch(e){case"location":return"At wrong location";case"order":return"Checked out";case"reservation":return"Already reserved";case"expired":return"Item is retired";case"in_custody":case"custody":return"Item is in custody";case"not_allowed_reservation":return"Item cannot be reserved";case"not_allowed_order":return"Item cannot be checked out";case"flag":return"Item is flagged";default:return""}}},ie={getCategoryKeyFromName:function(e){return"cheqroom.types.item."+e.split(" ").join("_").split(".").join("").toLowerCase()},getCategoryNameFromKey:function(e){var t=new RegExp("_","g");return e.split(".").pop().replace(t," ")},getCategorySummary:function(e){if(0==(e=e||[]).length)return"No items";for(var t,r,i={},s="",n=0,o=0,a=e.length;o<a;o++)i[r=(r=(t=e[o]).category?"string"==typeof(r=t.category)?r:r.name:"")?this.getCategoryNameFromKey(r):""]?i[r]+=1:i[r]=1,i[r]>n&&(n=i[s=r]);var c=i[s]+" ";return 1==n&&String.prototype.singularize?c+=s.singularize():c+=s,e.length>i[s]&&(c+=" +"+(e.length-i[s])+" other"),c},getItemSummary:function(e){if(0==(e=e||[]).length)return"No items";for(var t,r=0,i={},s=[],n=0,o=e.length;n<o;n++)(t=e[n]).kit&&t.kit.name?i[t.kit.name]?i[t.kit.name].push(t):(i[t.kit.name]=[t],r+=1):s.push(t);if(0==r)return this.getCategorySummary(e);var a=$.map(i,function(e,t){return t});if(0!=s.length)return 1==r?a[0]+", "+this.getCategorySummary(s):o(a)+" kits, "+this.getCategorySummary(s);return a.joinOther(30,", ","other kits")}},l=e,se={getAvatarInitial:function(e,t){var r={XS:32,S:64,M:128,L:256,XL:512},i=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7"],s=(e=e||"Unknown").split(" "),n=2==s.length?s[0].charAt(0).toUpperCase()+s[1].charAt(0).toUpperCase():s[0].charAt(0).toUpperCase(),o=(n.charCodeAt(0)-65)%i.length,a=r[t],c=r[t],e=a,s=c,r=l("<canvas />").attr({width:a,height:c}),t=r.get(0).getContext("2d");return window.devicePixelRatio&&(r.attr("width",a*window.devicePixelRatio),r.attr("height",c*window.devicePixelRatio),r.css("width",e),r.css("height",s),t.scale(window.devicePixelRatio,window.devicePixelRatio)),t.fillStyle=i[o],t.fillRect(0,0,a,c),t.font=a/2+"px Arial",t.textAlign="center",t.fillStyle="#FFF",t.fillText(n,e/2,s/1.5),r.get(0).toDataURL()},getMaintenanceAvatar:function(e){return this.getIconAvatar(e,"f0ad")},getIconAvatar:function(e,t,r,i,s){var n={XS:32,S:64,M:128,L:256,XL:512},o=n[e],a=n[e],c=o,u=a;r=r||"#aaa",i=i||"#f5f5f5",s=s||o/2;n=l("<canvas />").attr({width:o,height:a}),e=n.get(0).getContext("2d");return window.devicePixelRatio&&(n.attr("width",o*window.devicePixelRatio),n.attr("height",a*window.devicePixelRatio),n.css("width",c),n.css("height",u),e.scale(window.devicePixelRatio,window.devicePixelRatio)),e.fillStyle=i,e.fillRect(0,0,o,a),e.font=s+"px FontAwesome",e.textAlign="center",e.fillStyle=r,e.fillText(String.fromCharCode("0x"+t),c/2,u/1.5),n.get(0).toDataURL()},getTextImage:function(e,t,r,i){var s={XS:32,S:64,M:128,L:256,XL:512};r=r||"#aaa",i=i||"#e5e5e5";var n=s[t],o=s[t],a=n,c=o,s=l("<canvas />").attr({width:n,height:o}),t=s.get(0).getContext("2d");return window.devicePixelRatio&&(s.attr("width",n*window.devicePixelRatio),s.attr("height",o*window.devicePixelRatio),s.css("width",a),s.css("height",c),t.scale(window.devicePixelRatio,window.devicePixelRatio)),t.fillStyle=i,t.fillRect(0,0,n,o),t.font=n/2.7+"px Arial",t.textAlign="center",t.fillStyle=r,t.fillText(e,a/2,c/1.5),s.get(0).toDataURL()},getImageUrl:function(e,t,r,i){"production"!==environment&&console.warn("[Deprecation] Getting CDN url through getImageUrl is deprecated",t);t=e.getBaseUrl(!0)+t+"?mimeType=image/jpeg";return r&&"orig"!=r&&(t+="&size="+r),i&&(t+="&_bust="+(new Date).getTime()),t},getImageCDNUrl:function(e,t,r,i){"production"!==environment&&console.warn("[Deprecation] Getting CDN url through getImageCDNUrl is deprecated",r);var e="https://assets.cheqroomcdn.com/"+e.amazonBucket+"/groups/"+t+"/"+r;return i&&0<i.length&&(t=e.split("."),-1!=r.indexOf(".")&&t.pop(),e=t.join(".")+"-"+i+".jpg"),e},getNoImage:function(e){return{XS:"https://app.cheqroom.com/image-XS.png",S:"https://app.cheqroom.com/image-S.png",M:"https://app.cheqroom.com/image-M.png",L:"https://app.cheqroom.com/image-L.png",XL:"https://app.cheqroom.com/image-XL.png"}[e||"S"]}},n=o,a=["jpg","jpeg","png","gif"],Re={getImgFileNameFromName:function(e){return null!=e&&0<e.length?e.split(" ").join("_").split(".").join("_")+".jpg":"upload "+n().format("YYYY-MM-DD at hh:mm:ss a")+".jpg"},makeFileNameJpg:function(e){return 0<=e.indexOf(".")?e.substr(0,e.lastIndexOf("."))+".jpg":e},getFileNameFromUrl:function(e){if(e){e=e.toString().match(/.*\/(.+?)\./);if(e&&1<e.length)return e[1]}return""},isImage:function(e){e=this.getExt(e);return 0<=$.inArray(e,a)},getExt:function(e){return(/(?:\.([^.]+))?$/.exec(e)[1]||"").toLowerCase()}},function(){String.prototype.pluralize=function(e,t){return"is"==this&&1!=e?"are":"this"==this?1==e?this:"these":this.endsWith("s")?(t=t||"es",1==e?this:this+t):this.endsWith("y")?(t=t||"ies",1==e?this:this.substr(0,this.length-1)+t):(t=t||"s",1==e?this:this+t)},String.prototype.capitalize=function(e){return(e?this.toLowerCase():this).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},String.prototype.truncate||(String.prototype.truncate=function(e){e=null!=e?e:25;var e=(t=this.match(RegExp("^.{0,"+e+"}[S]*")))[0].length,t=t[0].replace(/\s$/,"");return e<this.length&&(t+="&hellip;"),t}),String.prototype.isValidUrl||(String.prototype.isValidUrl=function(){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(this)}),String.prototype.hashCode||(String.prototype.hashCode=function(){var e,t,r=0;if(0==this.length)return r;for(e=0,t=this.length;e<t;e++)r=(r<<5)-r+this.charCodeAt(e),r|=0;return r});var t={latin_map:{"Á":"A","Ă":"A","Ắ":"A","Ặ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ǎ":"A","Â":"A","Ấ":"A","Ậ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ä":"A","Ǟ":"A","Ȧ":"A","Ǡ":"A","Ạ":"A","Ȁ":"A","À":"A","Ả":"A","Ȃ":"A","Ā":"A","Ą":"A","Å":"A","Ǻ":"A","Ḁ":"A","Ⱥ":"A","Ã":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ḃ":"B","Ḅ":"B","Ɓ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ć":"C","Č":"C","Ç":"C","Ḉ":"C","Ĉ":"C","Ċ":"C","Ƈ":"C","Ȼ":"C","Ď":"D","Ḑ":"D","Ḓ":"D","Ḋ":"D","Ḍ":"D","Ɗ":"D","Ḏ":"D","ǲ":"D","ǅ":"D","Đ":"D","Ƌ":"D","Ǳ":"DZ","Ǆ":"DZ","É":"E","Ĕ":"E","Ě":"E","Ȩ":"E","Ḝ":"E","Ê":"E","Ế":"E","Ệ":"E","Ề":"E","Ể":"E","Ễ":"E","Ḙ":"E","Ë":"E","Ė":"E","Ẹ":"E","Ȅ":"E","È":"E","Ẻ":"E","Ȇ":"E","Ē":"E","Ḗ":"E","Ḕ":"E","Ę":"E","Ɇ":"E","Ẽ":"E","Ḛ":"E","Ꝫ":"ET","Ḟ":"F","Ƒ":"F","Ǵ":"G","Ğ":"G","Ǧ":"G","Ģ":"G","Ĝ":"G","Ġ":"G","Ɠ":"G","Ḡ":"G","Ǥ":"G","Ḫ":"H","Ȟ":"H","Ḩ":"H","Ĥ":"H","Ⱨ":"H","Ḧ":"H","Ḣ":"H","Ḥ":"H","Ħ":"H","Í":"I","Ĭ":"I","Ǐ":"I","Î":"I","Ï":"I","Ḯ":"I","İ":"I","Ị":"I","Ȉ":"I","Ì":"I","Ỉ":"I","Ȋ":"I","Ī":"I","Į":"I","Ɨ":"I","Ĩ":"I","Ḭ":"I","Ꝺ":"D","Ꝼ":"F","Ᵹ":"G","Ꞃ":"R","Ꞅ":"S","Ꞇ":"T","Ꝭ":"IS","Ĵ":"J","Ɉ":"J","Ḱ":"K","Ǩ":"K","Ķ":"K","Ⱪ":"K","Ꝃ":"K","Ḳ":"K","Ƙ":"K","Ḵ":"K","Ꝁ":"K","Ꝅ":"K","Ĺ":"L","Ƚ":"L","Ľ":"L","Ļ":"L","Ḽ":"L","Ḷ":"L","Ḹ":"L","Ⱡ":"L","Ꝉ":"L","Ḻ":"L","Ŀ":"L","Ɫ":"L","ǈ":"L","Ł":"L","Ǉ":"LJ","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ń":"N","Ň":"N","Ņ":"N","Ṋ":"N","Ṅ":"N","Ṇ":"N","Ǹ":"N","Ɲ":"N","Ṉ":"N","Ƞ":"N","ǋ":"N","Ñ":"N","Ǌ":"NJ","Ó":"O","Ŏ":"O","Ǒ":"O","Ô":"O","Ố":"O","Ộ":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ö":"O","Ȫ":"O","Ȯ":"O","Ȱ":"O","Ọ":"O","Ő":"O","Ȍ":"O","Ò":"O","Ỏ":"O","Ơ":"O","Ớ":"O","Ợ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ȏ":"O","Ꝋ":"O","Ꝍ":"O","Ō":"O","Ṓ":"O","Ṑ":"O","Ɵ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Õ":"O","Ṍ":"O","Ṏ":"O","Ȭ":"O","Ƣ":"OI","Ꝏ":"OO","Ɛ":"E","Ɔ":"O","Ȣ":"OU","Ṕ":"P","Ṗ":"P","Ꝓ":"P","Ƥ":"P","Ꝕ":"P","Ᵽ":"P","Ꝑ":"P","Ꝙ":"Q","Ꝗ":"Q","Ŕ":"R","Ř":"R","Ŗ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ȑ":"R","Ȓ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꜿ":"C","Ǝ":"E","Ś":"S","Ṥ":"S","Š":"S","Ṧ":"S","Ş":"S","Ŝ":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṩ":"S","Ť":"T","Ţ":"T","Ṱ":"T","Ț":"T","Ⱦ":"T","Ṫ":"T","Ṭ":"T","Ƭ":"T","Ṯ":"T","Ʈ":"T","Ŧ":"T","Ɐ":"A","Ꞁ":"L","Ɯ":"M","Ʌ":"V","Ꜩ":"TZ","Ú":"U","Ŭ":"U","Ǔ":"U","Û":"U","Ṷ":"U","Ü":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ǖ":"U","Ṳ":"U","Ụ":"U","Ű":"U","Ȕ":"U","Ù":"U","Ủ":"U","Ư":"U","Ứ":"U","Ự":"U","Ừ":"U","Ử":"U","Ữ":"U","Ȗ":"U","Ū":"U","Ṻ":"U","Ų":"U","Ů":"U","Ũ":"U","Ṹ":"U","Ṵ":"U","Ꝟ":"V","Ṿ":"V","Ʋ":"V","Ṽ":"V","Ꝡ":"VY","Ẃ":"W","Ŵ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẁ":"W","Ⱳ":"W","Ẍ":"X","Ẋ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ẏ":"Y","Ỵ":"Y","Ỳ":"Y","Ƴ":"Y","Ỷ":"Y","Ỿ":"Y","Ȳ":"Y","Ɏ":"Y","Ỹ":"Y","Ź":"Z","Ž":"Z","Ẑ":"Z","Ⱬ":"Z","Ż":"Z","Ẓ":"Z","Ȥ":"Z","Ẕ":"Z","Ƶ":"Z","Ĳ":"IJ","Œ":"OE","ᴀ":"A","ᴁ":"AE","ʙ":"B","ᴃ":"B","ᴄ":"C","ᴅ":"D","ᴇ":"E","ꜰ":"F","ɢ":"G","ʛ":"G","ʜ":"H","ɪ":"I","ʁ":"R","ᴊ":"J","ᴋ":"K","ʟ":"L","ᴌ":"L","ᴍ":"M","ɴ":"N","ᴏ":"O","ɶ":"OE","ᴐ":"O","ᴕ":"OU","ᴘ":"P","ʀ":"R","ᴎ":"N","ᴙ":"R","ꜱ":"S","ᴛ":"T","ⱻ":"E","ᴚ":"R","ᴜ":"U","ᴠ":"V","ᴡ":"W","ʏ":"Y","ᴢ":"Z","á":"a","ă":"a","ắ":"a","ặ":"a","ằ":"a","ẳ":"a","ẵ":"a","ǎ":"a","â":"a","ấ":"a","ậ":"a","ầ":"a","ẩ":"a","ẫ":"a","ä":"a","ǟ":"a","ȧ":"a","ǡ":"a","ạ":"a","ȁ":"a","à":"a","ả":"a","ȃ":"a","ā":"a","ą":"a","ᶏ":"a","ẚ":"a","å":"a","ǻ":"a","ḁ":"a","ⱥ":"a","ã":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ḃ":"b","ḅ":"b","ɓ":"b","ḇ":"b","ᵬ":"b","ᶀ":"b","ƀ":"b","ƃ":"b","ɵ":"o","ć":"c","č":"c","ç":"c","ḉ":"c","ĉ":"c","ɕ":"c","ċ":"c","ƈ":"c","ȼ":"c","ď":"d","ḑ":"d","ḓ":"d","ȡ":"d","ḋ":"d","ḍ":"d","ɗ":"d","ᶑ":"d","ḏ":"d","ᵭ":"d","ᶁ":"d","đ":"d","ɖ":"d","ƌ":"d","ı":"i","ȷ":"j","ɟ":"j","ʄ":"j","ǳ":"dz","ǆ":"dz","é":"e","ĕ":"e","ě":"e","ȩ":"e","ḝ":"e","ê":"e","ế":"e","ệ":"e","ề":"e","ể":"e","ễ":"e","ḙ":"e","ë":"e","ė":"e","ẹ":"e","ȅ":"e","è":"e","ẻ":"e","ȇ":"e","ē":"e","ḗ":"e","ḕ":"e","ⱸ":"e","ę":"e","ᶒ":"e","ɇ":"e","ẽ":"e","ḛ":"e","ꝫ":"et","ḟ":"f","ƒ":"f","ᵮ":"f","ᶂ":"f","ǵ":"g","ğ":"g","ǧ":"g","ģ":"g","ĝ":"g","ġ":"g","ɠ":"g","ḡ":"g","ᶃ":"g","ǥ":"g","ḫ":"h","ȟ":"h","ḩ":"h","ĥ":"h","ⱨ":"h","ḧ":"h","ḣ":"h","ḥ":"h","ɦ":"h","ẖ":"h","ħ":"h","ƕ":"hv","í":"i","ĭ":"i","ǐ":"i","î":"i","ï":"i","ḯ":"i","ị":"i","ȉ":"i","ì":"i","ỉ":"i","ȋ":"i","ī":"i","į":"i","ᶖ":"i","ɨ":"i","ĩ":"i","ḭ":"i","ꝺ":"d","ꝼ":"f","ᵹ":"g","ꞃ":"r","ꞅ":"s","ꞇ":"t","ꝭ":"is","ǰ":"j","ĵ":"j","ʝ":"j","ɉ":"j","ḱ":"k","ǩ":"k","ķ":"k","ⱪ":"k","ꝃ":"k","ḳ":"k","ƙ":"k","ḵ":"k","ᶄ":"k","ꝁ":"k","ꝅ":"k","ĺ":"l","ƚ":"l","ɬ":"l","ľ":"l","ļ":"l","ḽ":"l","ȴ":"l","ḷ":"l","ḹ":"l","ⱡ":"l","ꝉ":"l","ḻ":"l","ŀ":"l","ɫ":"l","ᶅ":"l","ɭ":"l","ł":"l","ǉ":"lj","ſ":"s","ẜ":"s","ẛ":"s","ẝ":"s","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ᵯ":"m","ᶆ":"m","ń":"n","ň":"n","ņ":"n","ṋ":"n","ȵ":"n","ṅ":"n","ṇ":"n","ǹ":"n","ɲ":"n","ṉ":"n","ƞ":"n","ᵰ":"n","ᶇ":"n","ɳ":"n","ñ":"n","ǌ":"nj","ó":"o","ŏ":"o","ǒ":"o","ô":"o","ố":"o","ộ":"o","ồ":"o","ổ":"o","ỗ":"o","ö":"o","ȫ":"o","ȯ":"o","ȱ":"o","ọ":"o","ő":"o","ȍ":"o","ò":"o","ỏ":"o","ơ":"o","ớ":"o","ợ":"o","ờ":"o","ở":"o","ỡ":"o","ȏ":"o","ꝋ":"o","ꝍ":"o","ⱺ":"o","ō":"o","ṓ":"o","ṑ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","õ":"o","ṍ":"o","ṏ":"o","ȭ":"o","ƣ":"oi","ꝏ":"oo","ɛ":"e","ᶓ":"e","ɔ":"o","ᶗ":"o","ȣ":"ou","ṕ":"p","ṗ":"p","ꝓ":"p","ƥ":"p","ᵱ":"p","ᶈ":"p","ꝕ":"p","ᵽ":"p","ꝑ":"p","ꝙ":"q","ʠ":"q","ɋ":"q","ꝗ":"q","ŕ":"r","ř":"r","ŗ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ȑ":"r","ɾ":"r","ᵳ":"r","ȓ":"r","ṟ":"r","ɼ":"r","ᵲ":"r","ᶉ":"r","ɍ":"r","ɽ":"r","ↄ":"c","ꜿ":"c","ɘ":"e","ɿ":"r","ś":"s","ṥ":"s","š":"s","ṧ":"s","ş":"s","ŝ":"s","ș":"s","ṡ":"s","ṣ":"s","ṩ":"s","ʂ":"s","ᵴ":"s","ᶊ":"s","ȿ":"s","ɡ":"g","ᴑ":"o","ᴓ":"o","ᴝ":"u","ť":"t","ţ":"t","ṱ":"t","ț":"t","ȶ":"t","ẗ":"t","ⱦ":"t","ṫ":"t","ṭ":"t","ƭ":"t","ṯ":"t","ᵵ":"t","ƫ":"t","ʈ":"t","ŧ":"t","ᵺ":"th","ɐ":"a","ᴂ":"ae","ǝ":"e","ᵷ":"g","ɥ":"h","ʮ":"h","ʯ":"h","ᴉ":"i","ʞ":"k","ꞁ":"l","ɯ":"m","ɰ":"m","ᴔ":"oe","ɹ":"r","ɻ":"r","ɺ":"r","ⱹ":"r","ʇ":"t","ʌ":"v","ʍ":"w","ʎ":"y","ꜩ":"tz","ú":"u","ŭ":"u","ǔ":"u","û":"u","ṷ":"u","ü":"u","ǘ":"u","ǚ":"u","ǜ":"u","ǖ":"u","ṳ":"u","ụ":"u","ű":"u","ȕ":"u","ù":"u","ủ":"u","ư":"u","ứ":"u","ự":"u","ừ":"u","ử":"u","ữ":"u","ȗ":"u","ū":"u","ṻ":"u","ų":"u","ᶙ":"u","ů":"u","ũ":"u","ṹ":"u","ṵ":"u","ᵫ":"ue","ꝸ":"um","ⱴ":"v","ꝟ":"v","ṿ":"v","ʋ":"v","ᶌ":"v","ⱱ":"v","ṽ":"v","ꝡ":"vy","ẃ":"w","ŵ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẁ":"w","ⱳ":"w","ẘ":"w","ẍ":"x","ẋ":"x","ᶍ":"x","ý":"y","ŷ":"y","ÿ":"y","ẏ":"y","ỵ":"y","ỳ":"y","ƴ":"y","ỷ":"y","ỿ":"y","ȳ":"y","ẙ":"y","ɏ":"y","ỹ":"y","ź":"z","ž":"z","ẑ":"z","ʑ":"z","ⱬ":"z","ż":"z","ẓ":"z","ȥ":"z","ẕ":"z","ᵶ":"z","ᶎ":"z","ʐ":"z","ƶ":"z","ɀ":"z","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ĳ":"ij","œ":"oe","ﬆ":"st","ₐ":"a","ₑ":"e","ᵢ":"i","ⱼ":"j","ₒ":"o","ᵣ":"r","ᵤ":"u","ᵥ":"v","ₓ":"x"}};String.prototype.latinise=function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,function(e){return t.latin_map[e]||e})},String.prototype.latinize=String.prototype.latinise,String.prototype.isLatin=function(){return this==this.latinise()},String.prototype.OnlyAlphaNumSpaceAndUnderscore=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[\W]/g,"")},String.prototype.OnlyAlphaNumSpaceUnderscoreAndDot=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[^a-z0-9_\.]/g,"")},String.prototype.NoWhiteSpaceInWord||(String.prototype.NoWhiteSpaceInWord=function(){return this.replace(/[\s]+/g,"")}),String.prototype.addLeadingZero||(String.prototype.addLeadingZero=function(e){var t=this.toString();return t.length<e?("0"+t).addLeadingZero(e):t}),String.prototype.lpad=function(e,t){for(var r=this;r.length<t;)r=e+r;return r},Number.prototype.between||(Number.prototype.between=function(e,t){var r=Math.min(e,t),t=Math.max(e,t);return r<=this&&this<=t}),Array.prototype.joinOther||(Array.prototype.joinOther=function(e,t,r){if(this.length<2)return this.join(t);t=t||", ",r=r||"other",(!e||e<0)&&(e=1);for(var i=this.slice(0),s=i.join(t);1<i.length&&s.length>e;)i.pop(),s=i.join(t);var n=this.length-i.length;return 0<n&&(s+=" +"+n+" "+r),s}),Array.prototype.joinAdvanced||(Array.prototype.joinAdvanced=function(e,t){var r=this.slice(0),i="";return 1===r.length?i=r[0]:2===r.length?i=r.join(t):2<r.length&&(i=r.slice(0,-1).join(e)+t+r.slice(-1)),i}),CanvasRenderingContext2D.prototype.roundRect=function(e,t,r,i,s,n,o){var a={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};if(void 0===o&&(o=!0),"object"==typeof s)for(var c in s)a[c]=s[c];this.beginPath(),this.moveTo(e+a.upperLeft,t),this.lineTo(e+r-a.upperRight,t),this.quadraticCurveTo(e+r,t,e+r,t+a.upperRight),this.lineTo(e+r,t+i-a.lowerRight),this.quadraticCurveTo(e+r,t+i,e+r-a.lowerRight,t+i),this.lineTo(e+a.lowerLeft,t+i),this.quadraticCurveTo(e,t+i,e,t+i-a.lowerLeft),this.lineTo(e,t+a.upperLeft),this.quadraticCurveTo(e,t,e+a.upperLeft,t),this.closePath(),o&&this.stroke(),n&&this.fill()}}(),u=o,Ee={isValidEmail:function(e){e=e.match(/^([\w-\+']+(?:\.[\w-\+']+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,}(?:\.[a-z]{2})?)$/i);return null!=e&&0<e.length},isValidPhone:function(e){if(e=e.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,""),$.isNumeric(e))return!0;e=e.match(/^[\s()+-]*([0-9][\s()+-]*){7,20}(( x| ext)\d{1,5}){0,1}$/);return null!=e&&0<e.length},isValidURL:function(e){e=e.match(/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{1,}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_@\!-]+))*$/);return null!=e&&0<e.length},isValidPassword:function(e){var t=e.match(/[0-9]/);return 4<=e.length&&t},isNumeric:function(e,t){$.isNumeric(e);return t?(0^e)===Number(e):$.isNumeric(e)},isValidDate:function(e){return isNaN(e)||(e=parseInt(e)),u(e).isValid()}},Z=window.Slimdown=be,A=e,b=ee,O=o,I=pe,Se={},x=ne.sanitizeHtml,Se.kitCanCheckout=function(e){return void 0===e.canOrder||("available"===e.canOrder||"available_partially"===e.canOrder)},Se.kitCanReserve=function(e){return void 0===e.canReserve||("available"===e.canReserve||"available_partially"===e.canReserve)},Se.kitCanTakeCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"available"==e.status},Se.kitCanReleaseCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"in_custody"==e.status},Se.kitCanTransferCustody=function(e){return(void 0===e.canCustody||"available"===e.canCustody)&&"in_custody"==e.status},Se.getKitStatus=function(e){var r={},i=[],s={},n=[];return A.each(e,function(e,t){r[t.status]||(r[t.status]=!0,i.push(t.status)),s[t.order]||(s[t.order]=!0,n.push(t.order))}),1==i.length&&n.length<=1?i[0]:"incomplete"},Se.getFriendlyKitStatus=function(e){return"incomplete"==e?"Incomplete":b.getFriendlyItemStatus(e)},Se.getKitStatusCss=function(e){return"incomplete"==e?"label-incomplete":b.getItemStatusCss(e)},Se.getKitStatusIcon=function(e){switch(e){case"available":return"fa fa-check-circle";case"checkedout":return"fa fa-times-circle";case"await_checkout":return"fa fa-ellipsis-h";case"incomplete":return"fa fa-warning";case"empty":return"fa fa-ellipsis-h";case"in_transit":return"fa fa-truck";case"in_custody":return"fa fa-exchange";case"maintenance":case"repair":return"fa fa-wrench";case"inspection":return"fa fa-stethoscope";case"expired":return"fa fa-bug";default:return""}},Se.getKitIds=function(e){var r={},i=[];return A.each(e,function(e,t){t.kit&&(t="string"==typeof t.kit?t.kit:t.kit._id,r[t]||(r[t]=!0,i.push(t)))}),i},Se.getKitMessages=function(r,i,e,t,s){function n(e){return e.format("MMMM Do"+(e.year()==O().year()?"":" YYYY"))}function o(e){return e="string"!=typeof e?e||{}:{_id:e},(s=s||{}).customer||(s.customer={}),e._id==s.customer._id}var a,c=[],u=0,l=1,d=2,h=3,p=e,m=!p.hasContactReadOtherPermission(),f=A.Deferred(),y=A.Deferred(),g=A.Deferred();!p.hasCheckoutPermission("read")||"checkedout"!=r.status&&"await_checkout"!=r.status?f.resolve():(D="",a=A.Deferred(),i("orders").search({_fields:"name,itemSummary,status,started,due,finished,customer.name,customer.user.picture,customer.cover,customer.kind",_restrict:!m||!p.hasCheckoutPermission("read"),_sort:"started",status:"checkedout"==r.status?"open":"creating",_limit:1,_skip:0,items__in:b.getItemIds(r.items)}).then(function(e){e&&0<e.count&&a.resolve(e.docs[0])}),a.then(function(e){var t;o((e=e||{}).customer)&&(e.customer=s.customer,e.customer.user=s),D="await_checkout"==r.status?"Kit is currently <strong>awaiting checkout</strong>":(t=x("string"!=typeof e.customer?e.customer.name:""),e&&I.isOrderOverdue(e)?"Kit was <strong>due back</strong> "+e.due.fromNow()+(t?" from "+t:""):"Kit is <strong>checked out</strong>"+(t?" to "+t:"")+" until "+n(e.due)),c.push({kind:"checkout",priority:u,message:D,checkout:!o(e.customer)&&m?{}:e}),f.resolve()})),p.hasReservationPermission("read")&&0<r.items.length?i("reservations").search({status:"open",fromDate__gte:O(),_fields:"name,status,itemSummary,fromDate,toDate,customer.name,customer.user.picture,customer.cover,customer.kind",_restrict:!m,_sort:"fromDate",_limit:1,_skip:0,items__in:b.getItemIds(r.items)}).then(function(e){e&&0<e.count&&(e=e.docs[0],D="Next <strong>reservation</strong> is "+e.fromDate.fromNow()+" <span class='text-muted'>on "+n(e.fromDate)+"</span>",c.push({kind:"reservation",priority:l,reservation:e,isOwn:o(e.customer),message:D})),y.resolve()}):y.resolve(),"in_custody"==r.status?(a=A.Deferred(),m?a.resolve(null):i("kits").call(r.id,"getChangeLog",{action__in:["takeCustody","transferCustody"],limit:1,skip:0}).then(function(e){var t=A.Deferred();0==e.length?i("items").call(r.items[0]._id,"getChangeLog",{action__in:["takeCustody","transferCustody"],limit:1,skip:0}).then(function(e){t.resolve(e)}):t.resolve(e),t.then(function(t){i("contacts").get(t[0].obj,"name,cover,user.picture,kind").then(function(e){a.resolve(e,t[0].created)})})}),a.then(function(e,t){t="Kit is <strong>in custody</strong>"+(e?" of "+x(e.name)+" <span class='text-muted'>since "+n(t)+"</span>":"");c.push({kind:"custody",priority:l,by:e||{},message:t}),g.resolve()})):g.resolve();var _,v,C,D,k=p.hasKitPermission("reserve")&&(r._canReserve||r.canReserve),R=p.hasKitPermission("checkout")&&(r._canOrder||r.canOrder),w="available"===k||"available_partially"===k,E="available"===R||"available_partially"===R,e="available"===(p.hasKitPermission("takeCustody")&&(r._canCustody||r.canCustody));return(w||E||e)&&(C=[],v=[],p.hasReservationPermission("read")&&p.hasCheckoutPermission("read")&&w&&E||!w&&!E?w&&E?v.push("Bookings"):p.hasCheckoutPermission("read")&&p.hasReservationPermission("read")&&C.push("Bookings"):(w?v.push("Reservation"):p.hasReservationPermission("read")&&C.push("Reservation"),E?v.push("Check-out"):p.hasCheckoutPermission("read")&&C.push("Check-out")),e?v.push("Custody"):p.hasItemPermission("takeCustody")&&C.push("Custody"),D="",D=!w&&!e&&!E?"Kit is <strong>unavailable</strong> for "+C.joinAdvanced(", "," and "):"Kit is <strong>"+("available_partially"==k||"available_partially"==R?"partially ":"")+"available</strong> for "+v.joinAdvanced(", "," and ")+(0<C.length?"<span class='text-muted'>, not for "+C.joinAdvanced(", "," and ")+"</span>":""),c.push({kind:"permission",priority:d,message:D})),"empty"==r.status&&(D="Kit is <strong>empty</strong>",c.push({kind:"empty",priority:h,message:D})),"incomplete"==r.status&&(D="Kit is <strong>incomplete</strong>",e=r.items,_={},A.each(e,function(e,t){var r,i=t.status;"available"==t.status&&(r=t.canReserve,s=t.canOrder,"available"!==r&&"unavailable_status"!==r&&"available"!==s&&"unavailable_status"!==s&&(i="unavailable"));var s=_[i]||0;_[i]=s+1}),E=_.unavailable||0,k=_.checkedout||0,R=_.await_checkout||0,v=_.expired||0,C=_.available||0,d=_.in_custody||0,e.length," item".pluralize(e.length),C==e.length||k==e.length||R==e.length||v==e.length||d==e.length||(e=[],0<E&&e.push(E+" unavailable"),0<C&&e.push(C+" available"),0<k&&e.push(k+" checked out"),0<R&&e.push(R+" awaiting checkout"),0<v&&e.push(v+" retired"),0<d&&e.push(d+" in custody"),D+=" <span class='text-muted'>("+e.joinAdvanced(", "," and ")+")</span>"),c.push({kind:"incomplete",priority:h,message:D})),"expired"==r.status&&(D="Kit is <strong>retired</strong>",c.push({kind:"expired",priority:u,message:D})),A.when(f,y,g).then(function(){return c.sort(function(e,t){return e.priority-t.priority})})},oe=Se,h=Re,he=p={contactGetUserId:function(e){if(e.user)return"string"==typeof e.user?e.user:e.user.hasOwnProperty("_id")?e._id:void 0},contactGetUserSync:function(e){if(e.user&&e.user.sync)return e.user.sync},contactCanReserve:function(e){return"active"==e.status},contactCanCheckout:function(e){return"active"==e.status},contactCanGenerateDocument:function(e){return"active"==e.status},contactCanArchive:function(e){return"active"==e.status&&!p.contactGetUserSync(e)},contactCanUndoArchive:function(e){return"archived"==e.status&&!p.contactGetUserSync(e)},contactCanDelete:function(e){return!p.contactGetUserSync(e)},contactCanBlock:function(e){return"active"==e.status},contactCanUndoBlock:function(e){return"blocked"==e.status},getContactImageUrl:function(e,t,r,i){if(t.cover){if(-1!=t.cover.indexOf("data:image")||-1!=t.cover.indexOf("file:"))return t.cover;if(h.isImage(t.cover))return d.getImageUrl(e,t.cover,r,i)}return t.user&&t.user.picture?d.getImageUrl(e,t.user.picture,r,i):d.getAvatarInitial(t.name,r)},getContactImageCDNUrl:function(e,t,r,i,s){return r.cover?d.getImageCDNUrl(e,t,r.cover,i,s):r.user&&r.user.picture?d.getImageCDNUrl(e,t,r.user.picture,i,s):d.getAvatarInitial(r.name,i)},getContactMessages:function(e,t,r,i,s,n){var o,a=$.Deferred(),c=[],u=1,l=3;return"maintenance"==e.kind&&c.push({kind:"maintenance",priority:l,message:o="Contact can <strong>maintenance / repair</strong>",contact:{kind:"maintenance",name:""}}),"blocked"==e.status&&(o="Contact was <strong>blocked</strong> "+(e.blocked?"<span class='text-muted'>"+e.blocked.fromNow()+"</span>":""),c.push({kind:"blocked",priority:u,message:o})),a.resolve(),a.then(function(){return c.sort(function(e,t){return e.priority-t.priority})})}},m=d=se,ae={getUserImageUrl:function(e,t,r,i){return t&&t.picture?m.getImageUrl(e,t.picture,r,i):m.getAvatarInitial(t.name,r)},getUserImageCDNUrl:function(e,t,r,i,s){return r&&r.picture?m.getImageCDNUrl(e,t,r.picture,i,s):m.getAvatarInitial(r.name,i)}},ue={templateIsArchived:function(e){return!(null==e.archived)},templateCanDelete:function(e){return!e.system},templateCanActivate:function(e){return"inactive"==e.status&&null==e.archived},templateCanDeactivate:function(e){return"active"==e.status&&null==e.archived},templateCanArchive:function(e){return null==e.archived},templateCanUndoArchive:function(e){return null!=e.archived},getFriendlyTemplateStatus:function(e){switch(e){case"inactive":return"Inactive";case"active":return"Active";case"archived":return"Archived";default:return"Unknown"}},getFriendlyTemplateCss:function(e){switch(e){case"inactive":return"label-inactive";case"active":return"label-active";case"archived":return"label-archived";default:return""}},getFriendlyTemplateSize:function(e,t,r){if(0==e||0==t)return"";if("inch"==r&&(8.5==e&&11==t||11==e&&8.5==t))return"US Letter";if("inch"==r&&(11==e&&17==t||17==e&&11==t))return"US Tabloid";if("mm"==r&&(210==e&&297==t||297==e&&210==t))return"A4";if("cm"==r&&(21==e&&29.7==t||29.7==e&&21==t))return"A4";r="inch"==r?'"':r;return e+r+" x "+t+r},getPageSizes:function(){return[{id:"letter",name:"US Letter",width:8.5,height:11,unit:"inch",layout:"portrait",px:{width:816,height:1056}},{id:"a4",name:"A4",width:210,height:297,unit:"mm",layout:"portrait",px:{width:793,height:1122}},{id:"tabloid",name:"US Tabloid",width:11,height:17,unit:"inch",layout:"portrait",px:{width:1056,height:1632}},{id:"label4x6",name:'4" x 6" Shipping Label',width:4,height:6,unit:"inch",layout:"portrait",px:{width:384,height:576}}]},getPageSize:function(t,r,i){var e=this.getPageSizes(),s=null;return(s=e.find(function(e){return e.unit==t&&e.width==r&&e.height==i}))?s:(s=e.find(function(e){return e.unit==t&&e.width==i&&e.height==r}))?(s.layout="landscape",s):null}},f=localStorage.setItem,y=localStorage.getItem,g=localStorage.removeItem,_={},Storage.prototype.setItem=function(t,r){try{f.apply(this,[t,r])}catch(e){_[t]=String(r)}return!0},Storage.prototype.getItem=function(t){try{return y.apply(this,[t])}catch(e){return _.hasOwnProperty(t)?_[t]:void 0}return null},Storage.prototype.removeItem=function(t){try{g.apply(this,[t])}catch(e){delete _[t]}return!0},le={containsValue:function(e,t,r){if(e=e||{},r=r||["name","fields","codes","barcodes"],t=$.trim(t).toLowerCase(),-1!=r.indexOf("name")&&e.name&&-1!=e.name.toLowerCase().indexOf(t))return!0;if(-1!=r.indexOf("fields")&&(e.fields&&Object.values(e.fields).find(function(e){return-1!=e.toString().toLowerCase().indexOf(t)})))return!0;if(-1!=r.indexOf("codes")&&(e.codes&&e.codes.find(function(e){return-1!=e.toLowerCase().indexOf(t)})))return!0;if(-1!=r.indexOf("barcodes")&&(e.barcodes&&e.barcodes.find(function(e){return-1!=e.toLowerCase().indexOf(t)})))return!0;return!1},getDocumentIds:function(e){return e.map(function(e){return"string"==typeof e?e:e._id})}},v=o,de=C={getTransactionSummary:function(e,t){return(e=e||{}).name?e.name:e.itemSummary&&"No items"!=e.itemSummary?e.itemSummary:t||"No items"},getOrderDuration:function(e){var t=e.started||v(),e="closed"==e.status?e.finished:e.due;return e?v.duration(e-t):null},getFriendlyOrderDuration:function(e,t){e=C.getOrderDuration(e);return null!=e?t.getFriendlyDuration(e):""},getReservationDuration:function(e){if(e)return null!=e.fromDate&&null!=e.toDate?v.duration(e.toDate-e.fromDate):null},getFriendlyReservationDuration:function(e,t){e=C.getReservationDuration(e);return null!=e?t.getFriendlyDuration(e):""},getMessages:function(e,t,r,i,s,n){var o=$.Deferred();return messages=[],MessagePriority={Critical:0,High:1,Medium:2,Low:3},n=n.raw||n,perm=r,"creating"!=e.status||0<(r=(n.cleanup||{}).deleteReservationsCreating)&&(n=e.modified.clone().add(r,"minutes"),e=v(),r=n.isBefore(e),e="Reservation will be deleted <strong>"+n.fromNow()+"</strong>",r&&(e="Reservation will be deleted <strong>in a few seconds</strong>"),messages.push({kind:"cleanup",priority:MessagePriority.Critical,message:e,deleteTime:n,isPassed:r})),o.resolve(),o.then(function(){return messages.sort(function(e,t){return e.priority-t.priority})})}},D=(Y=e)({}),Y.subscribe=function(){D.on.apply(D,arguments)},Y.unsubscribe=function(){D.off.apply(D,arguments)},Y.publish=function(){D.trigger.apply(D,arguments)},me=Q,fe=se,ye=Re,ge=ie,_e=ne,ve=o,ke={},Ce=new Z,De=_e.sanitizeHtml,ke.getChangeLogEvent=function(r,e,t,o,i,s,n,a,c,u,l){var d="Unknown",h=s.timeFormat24?"H:mm":"h:mma";r.friendlyText=r.action,r.by=r.by||{},r.by.name=r.by.name||"CHEQROOM";var p=r.arg||{},m={by:r.by,kind:r.kind};p.customerName&&r.by.name!=p.customerName&&(m.contact={id:p.customerId,name:De(p.customerName||d)});function f(t){return i[{"check-out":"orderFields",reservation:"reservationFields",item:"itemFields",contact:"customerFields",kit:"kitFields"}[r.kind]].find(function(e){return e.name==t})}function y(e,t){return t=De(t),b.hasCheckoutPermission("read")?"<a href='#check-outs/"+e+"' class='transaction-link' data-kind='order' data-id='"+e+"'>"+t+"</a>":t}function g(e,t){return t=De(t),b.hasReservationPermission("read")?"<a href='#reservations/"+e+"' class='transaction-link' data-kind='reservation' data-id='"+e+"'>"+t+"</a>":t}function _(e,t){return"<a href='"+e+"'>"+De(t)+"</a>"}function v(e,t){return b.hasContactReadOtherPermission()?_("#contacts/"+e,t):De(t)}function C(e,t){return b.hasKitPermission()?_("#kits/"+e,t):De(t)}function D(e){return 0==e.length?"":"<ul class='list-group field-group'>"+e.map(function(e){return"<li class='list-group-item'>"+e+"</li>"}).join("")+"</ul>"}function k(e){return e?D([e]):""}var R,w,E=o.find(function(e){return e._id==(p.location||p.locationId)})||{},T=o.filter(function(e){return"active"==e.status}),S=De(1<T.length?" at "+(E.name||d):""),A=De(r.by.name),b=c(),O=l||function(e,t){if("string"==typeof e&&0==e.indexOf("http"))return e;e="string"==typeof e?e:e._id||e.id||e.attachmentId;return fe.getImageCDNUrl(n,i.id,t?ye.makeFileNameJpg(e):e,t)},I=u||function(e,t){return fe.getImageCDNUrl(n,i.id,"string"==typeof e?e:e.cover||e._id||e.id,t)};switch(r.action){case"changeCategory":var x=De(p.category?p.category.split(".").pop().replace(/_/gim," ").capitalize():d);r.friendlyText=A+" updated category to "+x;break;case"addCodes":case"removeCodes":var N=p.codes&&0<p.codes.length?p.codes[0]:d;switch(r.action){case"addCodes":r.friendlyText=A+" added qr code "+N+" <img class='qrcode' title='"+N+"' src='"+me.getQRCodeUrl(n.qrCodeUtilsApi,N,"S")+"' />";break;case"removeCodes":r.friendlyText=A+" removed qr code "+N}break;case"addBarcode":case"removeBarcode":var U=p.barcode||d;switch(r.action){case"addBarcode":r.friendlyText=A+" added barcode "+U+" <img class='barcode' title='"+U+"' src='"+me.getQRCodeUrl(n.barcodeUtilsApi,U,"S")+"' />";break;case"removeBarcode":r.friendlyText=A+" removed barcode "+U}break;case"archive":x=!m.by._id;r.friendlyText=A+(x?" auto-":" ")+"archived "+r.kind;break;case"undoArchive":r.friendlyText=A+" unarchived "+r.kind;break;case"takeCustody":case"item.takeCustody":case"kit.takeCustody":var M=r.obj,F=p.custodyName||d;"takeCustody"==r.action?r.friendlyText=A+" placed "+r.kind+" in custody of "+v(r.obj,F):"item.takeCustody"==r.action?r.friendlyText=A+" took "+_("#items/"+M,"item")+" custody":r.friendlyText=A+" took "+_("#kits/"+M,"kit")+" custody";break;case"transferCustody":case"item.transferCustody":case"kit.transferCustody":M=r.obj;r.by!=p.hadCustodyName?(F=p.hadCustodyName||d,"transferCustody"==r.action?r.friendlyText=A+" transfered "+r.kind+" custody from "+v(p.hadCustody,F):"item.transferCustody"==r.action?r.friendlyText=A+" transfered "+_("#items/"+M,"item")+" custody from "+v(p.hadCustody,F):r.friendlyText=A+" transfered "+_("#kits/"+M,"kit")+" custody from "+v(p.hadCustody,F)):(F=p.custodyName||d,"transferCustody"==r.action?r.friendlyText=A+" transfered "+r.kind+" custody to "+v(p.custody,F):"item.transferCustody"==r.action?r.friendlyText=A+" transfered "+_("#items/"+M,"item")+" custody to "+v(p.custody,F):r.friendlyText=A+" transfered "+_("#kits/"+M,"kit")+" custody to "+v(p.custody,F));break;case"releaseCustody":case"item.releaseCustody":case"kit.releaseCustody":M=r.obj,F=p.hadCustodyName||d;"releaseCustody"==r.action?r.friendlyText=A+" released "+r.kind+" custody of "+v(p.hadCustody,F)+S:"item.releaseCustody"==r.action?r.friendlyText=A+" released "+_("#items/"+M,"item")+" custody":r.friendlyText=A+" released "+_("#kits/"+M,"kit")+" custody";break;case"setFlag":case"clearFlag":var P=(w="setFlag"==r.action?p.flag:p.oldFlag,i.itemFlags.find(function(e){return e.id==w})||{}),L=De(P.name||d),j=P.color||"orange",B=De(p&&p.message?p.message:""),V=p&&p.attachments_url&&0<p.attachments_url.length,W=p&&p.attachments_url?p.attachments_url.map(function(e,t){return{id:p.attachments[t],url:e.XS}}):[];switch(r.by={kind:"flag",name:r.by.name,color:"setFlag"==r.action?j:"gray"},r.action){case"setFlag":r.friendlyText=A+" set flag <span class='text-"+j.toLowerCase()+"'><svg class='inline-svg'><use href='#flag-icon' /></svg> "+L+"</span>"+(B?"<ul class='list-group field-group'><li class='list-group-item'><small class='text-muted'>Message</small><br />"+B+"</li>"+(V?"<li class='list-group-item'><small class='text-muted'>Attachments</small><div>"+W.map(function(e){return"<img class='flag-attachment' data-id='"+e.id+"' src='"+e.url+"' style='display:inline-block;margin-right:5px;' />"}).join("")+"</div></li>":"")+"</ul>":"");break;case"clearFlag":r.friendlyText=A+" cleared flag <span style='text-decoration:line-through;'><svg class='inline-svg'><use href='#flag-icon' /></svg> "+L+"</span>"+(B?"<ul class='list-group field-group'><li class='list-group-item'><small class='text-muted'>Message</small><br />"+B+"</li>"+(V?"<li class='list-group-item'><small class='text-muted'>Attachments</small><div>"+W.map(function(e){return"<img class='flag-attachment' data-id='"+e.id+"' src='"+e.url+"' style='display:inline-block;margin-right:5px;' />"}).join("")+"</div></li>":"")+"</ul>":"")}break;case"sendMessage":r.by={kind:"email",name:"CHEQROOM"};var M=r.id,H=De("text"===p.request.dialect?p.request.body:_e.removeHtmlTags(/<td.*class=.container-padding.*[\n]+([\s\S]*)<\/td>/gim.exec(p.request.body)[1])),J=p.request.to,P=De(p.request.subject);r.friendlyText="Sent mail to "+J+" <ul class='list-group field-group'><li class='list-group-item'><div class='mail-subject'>"+P+"</div><div class='mail-body multiline-text-truncate'>"+H+"</div><div><a href='javascript:void(0)' class='open-email' data-id='"+M+"'>View email</a></div></li></ul>";break;case"sendSMS":r.by={kind:"sms",name:"CHEQROOM"};M=r.id,H=De(p.request.sms_body),J=p.request.sms_to_number;r.friendlyText="Sent sms to "+J+" <ul class='list-group field-group'><li class='list-group-item'><div class='mail-body multiline-text-truncate'>"+H+"</div></li></ul>";break;case"block":case"undoBlock":var B=De(p?p.message:null),q="block"==r.action?"blocked":"unblocked";r.friendlyText=A+" "+q+" contact "+k(B);break;case"import":r.friendlyText=A+" created "+r.kind+" from import";break;case"attach":var z=p&&0<p.attachments.length&&p.attachments[0],H="string"==typeof z?z:z.attachmentId,q=-1!=H.indexOf(".pdf"),K=p&&0<p.attachments.length?O(z,q?"S":"XS"):null,z=p&&0<p.attachments.length?a("attachments").getBaseUrl()+H+"?download=true":"javascript:void(0);";r.friendlyText=A+" added attachment "+(z?"<a class='open-attachment' data-id='"+H+"' href='"+z+"' target='_blank'>":"")+(K?"<img "+(q?"class='pdf'":"")+" src='"+K+"' />":"")+(z?"</a>":"");break;case"detach":r.friendlyText=A+" removed attachment";break;case"order.checkout":case"checkout":case"checkoutAgain":var M=r.obj,G=m.contact;if("order.checkout"==r.action)switch(r.kind){case"item":r.friendlyText=A+" "+y(M,"checked out")+" item "+(G?"to "+v(G.id,G.name):"")+S;break;case"contact":r.friendlyText=A+" "+y(M,"checked out")+" equipment"+S}else r.friendlyText=A+" checked out equipment";break;case"order.checkin":case"checkin":var M=r.obj,G=m.contact,K=e.due||r.arg.due,J=r.created,Y="";if(K&&(z=ve.duration(K.diff(r.created)),J.isAfter(K)?Y=z.humanize(!0).replace(" ago","").replace("in ","")+" late":J.isBefore(K)&&(Y=z.humanize(!0).replace(" ago","").replace("in ","")+" early")),"order.checkin"==r.action)switch(r.kind){case"item":r.friendlyText=A+" "+y(M,"checked in")+" item "+Y+(G?" from "+v(G.id,G.name):"")+S;break;case"contact":r.friendlyText=A+" "+y(M,"checked in")+" equipment "+Y+S}else{var Z=p.items||[],X=(Z.length,K?K.format("D MMM "+h):"Unknown"),Q=e.items.filter(function(e){return e.imageUrl=I(e,"XS"),-1!=Z.indexOf(e._id)});r.friendlyText=A+" checked in equipment "+Y+D(Q.map(function(e){return"<div class='media'><div class='media-left'><img class='item-image' src='"+e.imageUrl+"' /></div><div class='media-body'><a href='#items/"+e._id+"'>"+De(e.name)+"</a><br /><small class='text-muted text-truncate item-info'>"+e.codes.map(function(e){return"<i class='fa fa-qrcode'></i> "+e})+e.barcodes.map(function(e){return"<i class='fa fa-barcode'></i> "+e})+"</small></div></div>"}))}break;case"order.undoCheckout":case"undoCheckout":M=r.obj,G=m.contact;if("undoCheckout"==r.action)r.friendlyText=A+" undid check-out";else switch(r.kind){case"item":r.friendlyText=A+" undid item "+y(M,"check out")+(G?" for "+v(G.id,G.name):"");break;case"contact":r.friendlyText=A+" undid equipment "+y(M,"check out")}break;case"order.extend":case"extend":M=r.obj,G=m.contact,X=p.due.format("MMM DD");"extend"==r.action?r.friendlyText=A+" extended check-out until "+X:("contact"==r.kind&&(G=null),r.friendlyText=A+" extended "+y(M,"check out")+(G?" from "+v(G.id,G.name):"")+" until "+X);break;case"reservation.makeOrder":case"makeOrder":"makeOrder"==r.action?r.friendlyText=A+" converted reservation to "+y(r.obj,"check-out"):r.friendlyText=A+" created check-out from "+g(r.obj,"reservation");break;case"reserve":case"reservation.reserve":var M=r.obj,G=m.contact;"reserve"==r.action?r.friendlyText=A+" reserved equipment":(ie="item"==r.kind?" item ":" equipment ","contact"==r.kind&&(G=null),r.friendlyText=A+" "+g(M,"reserved")+ie+(G?"for "+v(G.id,G.name):"")+S);break;case"cancel":case"reservation.cancel":M=r.obj,G=m.contact,B=De(p?p.message:null);"cancel"==r.action?r.friendlyText=A+" cancelled reservation"+k(B):("contact"==r.kind&&(G=null),r.friendlyText=A+" cancelled "+g(M,"reservation")+(G?" for "+v(G.id,G.name):"")+S);break;case"undoReserve":case"reservation.undoReserve":M=r.obj,G=m.contact;"undoReserve"==r.action?r.friendlyText=A+" undid reservation":("contact"==r.kind&&(G=null),r.friendlyText=A+" undid "+g(M,"reservation")+(G?" from "+v(G.id,G.name):"")+S);break;case"close":case"reservation.close":M=r.obj,B=De(p?p.message:null),G=m.contact;"close"==r.action?r.friendlyText=A+" closed reservation"+k(B):("contact"==r.kind&&(G=null),r.friendlyText=A+" closed "+g(M,"reservation")+(G?" for "+v(G.id,G.name):"")+S);break;case"undoClose":case"reservation.undoClose":M=r.obj,G=m.contact;"undoClose"==r.action?r.friendlyText=A+" undid close reservation":("contact"==r.kind&&(G=null),r.friendlyText=A+" undid close "+g(M,"reservation")+(G?" from "+v(G.id,G.name):"")+S);break;case"kit.addItems":case"addItems":var M=r.obj,ee=(Q=p&&p.items?p.items:[]).length;"addItems"==r.action?r.friendlyText=A+" added "+ee+" item".pluralize(-1!=Q.length):r.friendlyText=A+" added item to "+C(M,"kit");break;case"kit.removeItems":case"removeItems":M=r.obj,ee=(Q=p&&p.items?p.items:[]).length;"removeItems"==r.action?r.friendlyText=A+" removed "+ee+" item".pluralize(-1!=Q.length):r.friendlyText=A+" removed item from "+C(M,"kit");break;case"kit.duplicate":r.friendlyText=A+" created kit from duplicate";break;case"setName":var te=De(p.name||d);r.friendlyText=A+" updated "+r.kind+" name to "+te;break;case"addComment":case"updateComment":var re=De(p.comment).replace(/\n/gim,"<br />");r.friendlyText=A+" wrote comment <div class='card comment-card'><div class='card-block'><span class='gu-truncate'>"+re+"</span></div></div>";break;case"removeComment":r.friendlyText=A+" removed comment";break;case"setAllowedActions":var ie=p.allowCustody!=p.oldAllowCustody,ee=p.allowReserve!=p.oldAllowReserve,se=p.allowOrder!=p.oldAllowOrder,Q=[],re=[];ie&&(p.allowCustody?Q:re).push("Custody"),ee&&(p.allowReserve?Q:re).push("Reservations"),se&&(p.allowOrder?Q:re).push("Check-outs");se=[];0<Q.length&&se.push("<small>Available for</small><br />"+Q.joinAdvanced(","," and ")),0<re.length&&se.push("<small>Unavailable for</small><br />"+re.joinAdvanced(","," and ")),r.friendlyText=A+" changed "+r.kind+" permission to"+D(se);break;case"setField":case"clearField":case"renameField":var ne=De(p.field||d),oe=f(ne)||{};switch(r.action){case"setField":var ae=De(p.value),te=ve(ae.toString().split(" (")[0],"ddd MMM DD YYYY HH:mm:ss [GMT]ZZ",!0).isValid()?ve(ae).format("MMM DD YYYY"+("datetime"==oe.editor?" [at] "+h:"")):Ce.render(ae);r.friendlyText=A+" set "+r.kind+" field "+k("<small class='text-muted'>"+ne+"</small><br />"+te);break;case"clearField":r.friendlyText=A+" cleared "+ne+" field";break;case"renameField":r.friendlyText=A+" renamed field "+De(p.oldName)+" to "+De(p.newName)}break;case"setFields":var ce=Object.keys(p).map(function(e){var t=p[e]||"",r=f(e)||{},t=ve(t.toString().split(" (")[0],"ddd MMM DD YYYY HH:mm:ss [GMT]ZZ",!0).isValid();return{name:De(e),value:t?ve(p[e]).format("MMM DD YYYY"+("datetime"==r.editor?" [at] "+h:"")):Ce.render(De(p[e]))}});r.friendlyText=A+" set "+r.kind+" field".pluralize(1<ce.length)+D(ce.map(function(e){return"<small class='text-muted'>"+e.name+"</small><br />"+e.value}));break;case"create":p.fields&&(Object.entries(p.fields).forEach(function(e){p[e[0]]=e[1]}),delete p.fields);ce=Object.keys(p).filter(function(e){return!!p[e]&&("item"!=r.kind?-1==["check-out","reservation"].indexOf(r.kind)&&("contact"==r.kind?-1==["category","user","kind"].indexOf(e):-1==["category","kind"].indexOf(e)):1!=T.length||"location"!=e)}).map(function(e){var t,r=De(p[e]||""),i=ve(r.toString().split(" (")[0],"ddd MMM DD YYYY HH:mm:ss [GMT]ZZ",!0).isValid(),s="",n=f(e)||{};return s=i?ve(p[e]).format("MMM DD YYYY"+("datetime"==n.editor?" [at] "+h:"")):"category"==e?De(ge.getCategoryNameFromKey(p[e]).capitalize()):"location"==e?(t=r,n=o.find(function(e){return e._id==t})||{},De(n.name||d)):Ce.render(r),{name:De("residualValue"==(e=e)?"Residual value":"warrantyDate"==e?"Warranty date":e.capitalize()),value:s}});r.friendlyText=A+" created "+r.kind+D(ce.map(function(e){return"<small class='text-muted'>"+e.name+"</small><br />"+e.value}));break;case"update":if(p.hasOwnProperty("name"))r.friendlyText=A+" updated "+r.kind+" name to "+De(p.name);else if(p.hasOwnProperty("kind")&&"importer"==p.kind)r.friendlyText=A+" updated "+r.kind+" from import";else switch(r.kind){case"item":p.hasOwnProperty("purchasePrice")?(p.field="Purchase price",p.purchasePrice&&(p.value=p.purchasePrice+" "+s.currency)):p.hasOwnProperty("warrantyDate")?(p.field="Warranty date",p.warrantyDate&&(p.value=p.warrantyDate.format("MMM DD YYYY"))):p.hasOwnProperty("purchaseDate")?(p.field="Purchase date",p.purchaseDate&&(p.value=p.purchaseDate.format("MMM DD YYYY"))):p.hasOwnProperty("brand")?(p.field="Brand",p.brand&&(p.value=p.brand)):p.hasOwnProperty("model")&&(p.field="Model",p.model&&(p.value=p.model)),p.value?r.friendlyText=A+" set "+r.kind+" field"+k("<small class='text-muted'>"+De(p.field)+"</small><br />"+De(p.value)):r.friendlyText=A+" cleared "+De(p.field)+" field";break;case"contact":p.hasOwnProperty("email")?r.friendlyText=A+" updated contact email to "+De(p.email):r.friendlyText=A+" updated contact";break;case"kit":r.friendlyText=A+" updated kit name to "+De(p.name)}break;case"duplicate":r.friendlyText=A+" duplicated item "+p.times+" times";break;case"expire":B=De(p?p.message:null);r.friendlyText=A+" retired item"+k(B);break;case"undoExpire":r.friendlyText=A+" unretired item";break;case"setCover":r.friendlyText=A+" updated cover image";break;case"scanCode":N=p.code||d;switch(p.kind){case"qrcode":r.friendlyText=A+" scanned QR code "+N;break;case"barcode":r.friendlyText=A+" scanned barcode "+N}break;case"item.duplicate":M=r.obj;r.friendlyText=A+" created "+_("#items/"+M,"item")+" from duplicate";break;case"setCatalog":ce=Object.keys(p).map(function(e){return{name:e,value:De(p[e])}});r.friendlyText=A+" set catalog"+D(ce.map(function(e){return"<small class='text-muted'>"+e.name+"</small><br />"+e.value}));break;case"setLabel":case"clearLabel":var ue=p.labelId,le=(he={"cheqroom.types.order":"orderLabels","cheqroom.types.reservation":"reservationLabels","cheqroom.types.item":"itemLabels","cheqroom.types.customer":"customerLabels","cheqroom.types.kit":"kitLabels"}[e.crtype],R=ue,i[he].find(function(e){return e.id==R})||{name:p.labelName,color:p.labelColor});r.friendlyText=A+" set <span class='label-tag label-"+le.color.toLowerCase()+"'></span> "+De(le.name);break;case"spotchecks.close":var de,M=r.obj,se=p.numChecked,ce=p.numUnchecked+p.numUnexpected,ue=p.items?p.items.checked_scanner&&p.items.checked_scanner.slice(0,2).map(function(e){return fe.getTextImage("","S")}).concat(2<p.numChecked?fe.getTextImage("+"+(p.numChecked-2),"S"):[]):[],he=p.items&&p.items.unchecked?p.items.unchecked:[],le=p.items&&p.items.unexpected?p.items.unexpected:[],le=he.concat(le).slice(0,2).map(function(e){return fe.getTextImage("","S")}).concat(2<ce?fe.getTextImage("+"+(ce-2),"S"):[]);"item"==r.kind?r.friendlyText=A+" scanned item in a <a href='#spotchecks/"+M+"' class='spotcheck'>spotcheck</a>":(de=function(e){var i=[];return e.forEach(function(e){var t={_id:e.item_id};e.cover_id&&(t.cover=e.cover_id),e.cover_id_url&&(t.cover_url=e.cover_id_url);for(var r=0;r<e.count;r++)i.push(t)}),i.slice(0,2).map(function(e){return"<img class='item-image' src='"+I(e,"S")+"' />"}).concat(2<i.length?"<img class='item-image' src='"+fe.getTextImage("+"+(i.length-2),"S")+"' />":"").join("")},a("spotchecks").call(M,"getThumbnails").then(function(e){e.checked&&$("#checkedImg_"+M).html(de(e.checked));e=e.unchecked.concat(e.unexpected);0<e.length&&$("#issuesImg_"+M).html(de(e))}),r.friendlyText=A+" finished a <a href='#spotchecks/"+M+"' class='spotcheck'>spotcheck</a> <ul class='list-group field-group spotcheck' data-id='"+M+"'><li class='list-group-item'>"+(se?"<div class='media legend-item'><div class='media-left'><span class='legend-color success'></span></div><div class='media-body'><div class='item-images' id='checkedImg_"+M+"'>"+ue.map(function(e){return"<img class='item-image' src='"+e+"' />"}).join("")+"</div><div>Checked</div><div class='text-muted'>"+se+" "+"item".pluralize(se)+"</div></div></div>":"")+(ce?"<div class='media legend-item'><div class='media-left'><span class='legend-color warning'></span></div><div class='media-body'><div class='item-images' id='issuesImg_"+M+"'>"+le.map(function(e){return"<img class='item-image' src='"+e+"' />"}).join("")+"</div><div>Issues</div><div class='text-muted'>"+ce+" "+"item".pluralize(ce)+"</div></div></div>":"")+"</li></ul>");break;case"changeLocation":var pe=De(p.name||d);r.friendlyText=A+" updated location to "+pe;break;case"updateGeo":pe=De(p.address||d).split(",").map(function(e){return $.trim(e)});r.friendlyText=A+" updated geo position to "+k("<address>"+pe.map(function(e){return"<span>"+e+"</span>"}).join("")+"</address>");break;case"changeKind":r.friendlyText=A+" changed kind to "+p.kind}return r},k={getFriendlySpotcheckCss:function(e){switch((e=e||{}).status){case"open":return"status-progress";case"closed":return e.numUnexpected||e.numUnchecked?"status-exclamation":"status-success";case"cancelled":return"status-cancelled";default:return""}},getFriendlySpotcheckStatus:function(e){switch((e=e||{}).status){case"open":return"In progress";case"closed":return e.numUnexpected||e.numUnchecked?"Finished with issues ("+(e.numUnexpected+e.numUnchecked)+")":"Finished";case"cancelled":return"Cancelled";default:return""}},getSpotcheckProgressMessage:function(e){if("open"===e.status)return e.numUnchecked?e.numUnchecked+" item".pluralize(e.numUnchecked)+" left to scan":"<i class='fa fa-check-circle color-green'></i> All "+e.numChecked+" item".pluralize(e.numChecked)+" have been scanned";if(e.numUnchecked+e.numUnexpected){if(0===e.numChecked)return"<i class='fa fa-exclamation-circle color-orange'></i> No items scanned";var t="<i class='fa fa-exclamation-circle color-orange'></i> ",r=[];return e.numUnchecked&&r.push(e.numUnchecked+" unscanned "+"issue".pluralize(e.numUnchecked)),e.numUnexpected&&r.push(e.numUnexpected+" scanned "+"exception".pluralize(e.numUnexpected)+" issue".pluralize(e.numUnexpected)),t+=r.joinAdvanced(", "," and ")}return"<i class='fa fa-check-circle color-green'></i> All "+e.numChecked+" item".pluralize(e.numChecked)+" scanned"},getSpotcheckMessages:function(e){var t=[];"open"===e.status&&t.push({kind:"progress",spotcheck:e,priority:0,message:k.getSpotcheckProgressMessage(e)});e=$.Deferred();return e.resolve(),e.then(function(){return t.sort(function(e,t){return e.priority-t.priority})})}},we=e.extend({},Q,pe,ce,ee,te,ie,se,Re,Ee,ne,oe,he,ae,ue,le,de,ke,k),R=e,w={id:null,name:"",color:"Gold",readonly:!1,selected:!1,default:!1},Oe.prototype.isDirty=function(){return this.raw.name!=this.name||this.raw.color!=this.color},Oe.prototype.isValid=function(){return this.name&&0<this.name.length},Oe.prototype._fromJson=function(e){return this.id=e.id||w.id,this.name=e.name||w.name,this.color=e.color||w.color,this.selected=e.selected||w.selected,this.readonly=e.readonly||w.readonly,this.default=e.default||w.default,R.Deferred().resolve()},Oe.prototype._toJson=function(){return{id:this.id,name:this.name,color:this.color,selected:this.selected,readonly:this.readonly,default:this.default}},N=e,U=t,M=Te=Oe,F={id:""},Ie.prototype.reset=function(){return this._fromJson(this._getDefaults(),null)},Ie.prototype.existsInDb=function(){return null!=this.id&&0<this.id.length},Ie.prototype.isEmpty=function(){return!0},Ie.prototype.isDirty=function(){return!1},Ie.prototype.isValid=function(){return!0},Ie.prototype.discardChanges=function(){return this.raw?this._fromJson(this.raw,null):this.reset()},Ie.prototype.reload=function(e){return this.existsInDb()?this.get(e):N.Deferred().reject(new U.ApiError("Cannot reload document, id is empty or null"))},Ie.prototype.get=function(e){if(this.existsInDb()){var t=this;return this.ds.get(this.id,e||this._fields).then(function(e){return t._fromJson(e)})}return N.Deferred().reject(new U.ApiError("Cannot get document, id is empty or null"))},Ie.prototype.create=function(e){return this.existsInDb()?N.Deferred().reject(new Error("Cannot create document, already exists in database")):this.isValid()?this._create(e):N.Deferred().reject(new Error("Cannot create, invalid document"))},Ie.prototype.update=function(e){return this.existsInDb()?this.isEmpty()?N.Deferred().reject(new Error("Cannot update to empty document")):this.isValid()?this._update(e):N.Deferred().reject(new Error("Cannot update, invalid document")):N.Deferred().reject(new Error("Cannot update document without id"))},Ie.prototype.delete=function(){return this.existsInDb()?this._delete():N.Deferred().reject(new Error("Document does not exist"))},Ie.prototype._getDefaults=function(){return F},Ie.prototype._toJson=function(e){return{id:this.id}},Ie.prototype._fromJson=function(e,t){return this.raw=e,this.id=e._id||F.id,N.Deferred().resolve(e)},Ie.prototype._create=function(t){var r=this,e=this._toJson();return delete e.id,this.ds.create(e,this._fields).then(function(e){return 1==t?e:r._fromJson(e)})},Ie.prototype._update=function(t){var r=this,e=this._toJson();return delete e.id,this.ds.update(this.id,e,this._fields).then(function(e){return 1==t?e:r._fromJson(e)})},Ie.prototype._delete=function(){var e=this;return this.ds.delete(this.id).then(function(){return e.reset()})},Ie.prototype._isDirtyProperty=function(e){return!!this.raw&&this[e]!=this.raw[e]},Ie.prototype._isDirtyStringProperty=function(e){return!!this.raw&&!(this[e]==this.raw[e]||""==this[e]&&null==this.raw[e])},Ie.prototype._isDirtyMomentProperty=function(e){if(this.raw){var t=this[e],e=this.raw[e];return(null!=t||null!=e)&&(!t||!e||!t.isSame(e))}return!1},Ie.prototype._getId=function(e,t){return"string"==typeof e?e:e[t||"_id"]},Ie.prototype._getIds=function(e,t){return e.map(function(e){return"string"==typeof e?e:e[t||"_id"]})},Ie.prototype._doApiCall=function(t){var r=this,i=N.Deferred(),e=this.ds.call(1==t.collectionCall?null:t.pk||this.id,t.method,t.params,t._fields||this._fields,t.timeOut,t.usePost);return i.abort=e.abort,e.then(function(e){1==t.skipRead?i.resolve(e):r._fromJson(e).done(function(e){i.resolve(e)})}).fail(function(e){i.reject(e)}),i},Ie.prototype._doApiLongCall=function(e){return e.timeOut=e.timeOut||6e4,this._doApiCall(e)},Ie.prototype._getColorLabel=function(e,t){e=N.extend({},t||{},e);return new M(e)},K=function(t,i){function e(){}var s={id:"",planning:"",item:"",from:null,to:null,order:"",reservation:""};e.prototype=i.prototype;function r(e){e=t.extend({},e),i.call(this,e),this.planning=e.planning||s.planning,this.item=e.item||s.item,this.from=e.from||s.from,this.to=e.to||s.to,this.order=e.order||s.order,this.reservation=e.reservation||s.reservation}return((r.prototype=new e).constructor=r).prototype._getDefaults=function(){return s},r.prototype.isEmpty=function(){return!1},r.prototype.canDelete=function(){return t.Deferred().resolve(!1)},r.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.planning=this.planning,e.item=this.item,e.fromDate=this.from,e.toDate=this.to,e.order=this.order,e.reservation=this.reservation,e},r.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.planning=e.planning||s.planning,r.item=e.item||s.item,r.from=e.fromDate||s.from,r.to=e.toDate||s.to,r.order=e.order||s.order,r.reservation=e.reservation||s.reservation,e})},r}(e,re=Ie),P=e,L=Re,B={fileName:"",fileSize:0,isCover:!(j=["jpg","jpeg","png","gif","pdf"]),canBeCover:!0,value_url:null},xe.prototype.getThumbnailUrl=function(e){return this.hasPreview()?this.helper.getImageUrl(this.ds,this.value,e||"S"):""},xe.prototype.getDownloadUrl=function(){return this.ds.getBaseUrl(!0)+this.value+"?download=True"},xe.prototype.getExt=function(e){return L.getExt(e||this.fileName)},xe.prototype.getFriendlyFileSize=function(){var e=this.fileSize;return(e=isNaN(e)?0:e)<1024?e+" Bytes":(e/=1024)<1024?e.toFixed(2)+" Kb":(e/=1024)<1024?e.toFixed(2)+" Mb":(e/=1024)<1024?e.toFixed(2)+" Gb":(e/=1024).toFixed(2)+" Tb"},xe.prototype.isImage=function(){return L.isImage(this.fileName)},xe.prototype.hasPreview=function(){var e=this.getExt(this.fileName);return 0<=P.inArray(e,j)},xe.prototype._toJson=function(e){return{fileName:this.fileName,fileSize:this.fileSize,value:this.value,created:this.created,by:this.by}},xe.prototype._fromJson=function(e,t){return this.raw=e,this.fileName=e.fileName||B.fileName,this.fileSize=e.fileSize||B.fileSize,this.value=e.value||B.value,this.value_url=e.value_url||B.value_url,this.created=e.created||B.created,this.by=e.by||B.by,P.Deferred().resolve(e)},G=xe,X=function(r){function e(e){this.ds=(e=e||{}).ds,this.raw=null,this.id=e.id||i,this.value=e.value||s,this.created=e.created||n,this.modified=e.modified||o,this.by=e.by||a,this.fromReservation=e.fromReservation||!1}var i="",s=null,n=null,o=null,a=null;return e.prototype._toJson=function(e){return{id:this.id,value:this.value,created:this.created,modified:this.modified,by:this.by}},e.prototype._fromJson=function(e,t){return this.raw=e,this.id=e.id||i,this.value=e.value||s,this.created=e.created||n,this.modified=e.modified||o,this.by=e.by||a,r.Deferred().resolve(e)},e}(e),V=e,W=Ee,H={name:null,value:null,required:!1,unit:"",kind:"string",form:!1,editor:null,description:"",select:[]},Ne.prototype.isValid=function(e){var t=V.trim(this.value);if(!this.required&&""==t)return!0;switch(this.kind){case"float":case"decimal":case"currency":return W.isNumeric(t);case"int":return W.isNumeric(t,!0);case"date":case"datetime":return W.isValidDate(t);case"string":case"select":return"phone"==this.editor?W.isValidPhone(t):"email"==this.editor?W.isValidEmail(t):"url"==this.editor?W.isValidURL(t):"number"==this.editor?W.isNumeric(t):""!=t;default:return!0}},Ne.prototype.isDirty=function(){return this.raw.value!=this.value},Ne.prototype.isEmpty=function(){return""==V.trim(this.value)},Y=function(a,e,r,i,s,n,o){function t(){}var c={id:"",modified:null,cover:null,cover_url:null,flag:null,label:null,fields:{},comments:[],attachments:[],barcodes:[]};t.prototype=i.prototype;function u(e){e=a.extend({},e),i.call(this,e),this.dsAttachments=e.dsAttachments,this.crtype=e.crtype,this.modified=e.modified||c.modified,this.flag=e.flag||c.flag,this.fields=e.fields||a.extend({},c.fields),this.comments=e.comments||c.comments.slice(),this.attachments=e.attachments||c.attachments.slice(),this.cover=e.cover||c.cover,this.cover_url=e.cover_url||c.cover_url,this.barcodes=e.barcodes||c.barcodes.slice(),this.label=e.label||c.label}return((u.prototype=new t).constructor=u).prototype._getDefaults=function(){return c},u.prototype.isEmpty=function(){return!(this.flag!=c.flag||null!=this.fields&&0!=Object.keys(this.fields).length||null!=this.comments&&0!=this.comments.length||null!=this.attachments&&0!=this.attachments.length)},u.prototype.isDirty=function(){return this._isDirtyFlag()||this._isDirtyFields()},u.prototype.canDelete=function(){return this.existsInDb()?this.ds.call(this.id,"canDelete"):a.Deferred().resolve({result:!1,message:""})},u.prototype.addComment=function(e,t){return this._doApiCall({method:"addComment",params:{comment:e},skipRead:t})},u.prototype.updateComment=function(e,t,r){return this._doApiCall({method:"updateComment",params:{commentId:e,comment:t},skipRead:r})},u.prototype.deleteComment=function(e,t){return this._doApiCall({method:"removeComment",params:{commentId:e},skipRead:t})},u.prototype.setFields=function(r,e){var i=this,s={};return a.each(r,function(e,t){i.raw.fields[e]!=r[e]&&(s[e]=t)}),this._doApiCall({method:"setFields",params:s,skipRead:e,usePost:!0})},u.prototype.setField=function(e,t,r){return t?this._doApiCall({method:"setField",params:{field:e,value:t},skipRead:r}):this.clearField(e,r)},u.prototype.clearField=function(e,t){return this._doApiCall({method:"clearField",params:{field:e},skipRead:t})},u.prototype.addBarcode=function(e,t){return this._doApiCall({method:"addBarcode",params:{barcode:e},skipRead:t})},u.prototype.removeBarcode=function(e,t){return this._doApiCall({method:"removeBarcode",params:{barcode:e},skipRead:t})},u.prototype.getImageUrl=function(e,t,r,i){r=r||this.cover;return null!=r&&0<r.length?this.helper.getImageCDNUrl(t,r,e):this.helper.getImageUrl(this.ds,this.id,e,i)},u.prototype.setCover=function(e,t){return this._doApiCall({method:"setCover",params:{attachmentId:e._id},skipRead:t})},u.prototype.clearCover=function(e){return this._doApiCall({method:"clearCover",params:{},skipRead:e})},u.prototype.attach=function(e,t){return this.existsInDb()?this._doApiCall({method:"attach",params:{attachments:[e]},skipRead:t}):a.Deferred().reject(new r.ApiError("Cannot attach attachment, id is empty or null"))},u.prototype.detach=function(e,t){return this.existsInDb()?this._doApiCall({method:"detach",params:{attachments:[e]},skipRead:t}):a.Deferred().reject(new r.ApiError("Cannot detach attachment, id is empty or null"))},u.prototype.setFlag=function(e,t,r,i){return this._doApiCall({method:"setFlag",params:{flag:e,message:t,attachments:r},skipRead:i})},u.prototype.clearFlag=function(e,t,r){return this._doApiCall({method:"clearFlag",params:{message:e,attachments:t},skipRead:r})},u.prototype.setLabel=function(e,t){return this._doApiCall({method:"setLabel",params:{labelId:e},skipRead:t})},u.prototype.clearLabel=function(e){return this._doApiCall({method:"clearLabel",params:{},skipRead:e})},u.prototype.getSortedFields=function(e,t,r){var i,s,n=[];e=(e=e.slice()).filter(function(e){return 1!=t||e.form});for(var o=0;o<e.length;o++)i=e[o],s=this.fields[i.name]||"",(null==r||r>n.length)&&n.push(this._getField(a.extend({value:s},i)));return n},u.prototype.setSortedFields=function(e,t){for(var r=0;r<e.length;r++){var i=e[r];i.isEmpty()?t?this.fields[i.name]=null:delete this.fields[i.name]:this.fields[i.name]=i.value}},u.prototype.validateSortedFields=function(e){for(var t=0;t<e.length;t++)if(!e[t].isValid())return!1;return!0},u.prototype.updateFields=function(){return this._updateFields()},u.prototype._isDirtyFlag=function(){return!!this.raw&&this.flag!=this.raw.flag},u.prototype._isDirtyFields=function(){return!!this.raw&&!e.areEqual(this.fields,this.raw.fields)},u.prototype._updateFields=function(){var e=[];if(this.raw)for(var t in this.fields)this.fields[t]!=this.raw.fields[t]&&e.push(this.setField(t,this.fields[t],!0));return 0<e.length?a.when(e):a.Deferred().resolve(this)},u.prototype._toJson=function(e){return i.prototype._toJson.call(this,e)},u.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.flag=e.flag||c.flag,r.fields=null!=e.fields?a.extend({},e.fields):a.extend({},c.fields),r.modified=e.modified||c.modified,r.barcodes=e.barcodes||c.barcodes,r.label=e.label||c.label,r.cover_url=e.cover_url||c.cover_url,r.cover=e.cover||c.cover,r._fromCommentsJson(e,t).then(function(){return r._fromAttachmentsJson(e,t)})})},u.prototype._toJsonFields=function(e){var t={};if(this.fields)for(var r in this.fields)t["fields__"+r]=this.fields[r];return t},u.prototype._fromCommentsJson=function(e,r){var i,s=this;return this.comments=c.comments.slice(),e.comments&&0<e.comments.length&&a.each(e.comments,function(e,t){(i=s._getComment(t,r))&&s.comments.push(i)}),a.Deferred().resolve(e)},u.prototype._fromAttachmentsJson=function(e,r){var i,s=this;return this.attachments=c.attachments.slice(),e.attachments&&0<e.attachments.length&&a.each(e.attachments,function(e,t){(i=s._getAttachment(t,a.extend(r,{forKind:s.crtype})))&&s.attachments.push(i)}),a.Deferred().resolve(e)},u.prototype._getComment=function(e,t){e=a.extend({ds:this.ds},t||{},e);return new s(e)},u.prototype._getAttachment=function(e,t){e=a.extend({ds:this.ds},t||{},e);return new n(e)},u.prototype._getField=function(e,t){e=a.extend({},t||{},e);return new o(e)},u}(e,we,t,re,X,G,Se=Ne),Z=function(t,i){function e(){}var s={id:"",name:"",count:0,defs:[],parent:"",modified:null};e.prototype=i.prototype;function r(e){e=t.extend({},e),i.call(this,e),this.name=e.name||s.name,this.count=e.count||s.count,this.defs=e.defs||s.defs.slice(),this.parent=e.parent||s.parent,this.modified=e.modified||s.modified}return((r.prototype=new e).constructor=r).prototype.isValidName=function(){if(this.name=t.trim(this.name),3<=this.name.length){var e=this.name.latinise().replace(/[`~!@#$%^&*()_|+\-=?;:'",.<\{\}\[\]\\\/]/gi,"");return this.name==e}return!1},r.prototype.isValid=function(){return this.isValidName()},r.prototype._getDefaults=function(){return s},r.prototype.isEmpty=function(){return i.prototype.isEmpty.call(this)&&this.name==s.name},r.prototype.isDirty=function(){var e=i.prototype.isDirty.call(this);return e=!e&&this.raw?this.name!=this.raw.name:e},r.prototype.canDelete=function(){return this.ds.call(this.id,"canDeleteCategory",{omitFields:!0})},r.prototype.canChangeName=function(e){return this.ds.call(this.id,"canChangeName",{name:e})},r.prototype.changeName=function(e){return this._doApiCall({pk:this.id,method:"changeName",params:{name:e}})},r.prototype.canChangeParent=function(e){return this.ds.call(this.id,"canChangeParent",{parent:e,omitFields:!0})},r.prototype.changeParent=function(e){return this._doApiCall({pk:this.id,method:"changeParent",params:{parent:e,omitFields:!0}})},r.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.name=this.name,e},r.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.name=e.name||s.name,r.count=e.count||s.count,r.defs=e.defs||s.defs.slice(),r.parent=e.parent||s.parent,r.modified=e.modified||s.modified,e})},r}(e,re),Q=function(r){function e(e){this.ds=e.ds,this._fields=e._fields,this.raw=null,this.kind=e.kind||i,this.doc=e.doc||t,this.item=e.item||s,this.itemName=e.itemName||n,this.locationCurrent=e.locationCurrent||o,this.locationDesired=e.locationDesired||a,this.fromDate=e.fromDate||c,this.toDate=e.toDate||u}var i="",t="",s="",n="",o="",a="",c=null,u=null;return e.prototype._toJson=function(e){return{kind:this.kind,doc:this.doc,item:this.item,itemName:this.itemName,locationCurrent:this.locationCurrent,locationDesired:this.locationDesired,fromDate:this.fromDate,toDate:this.toDate}},e.prototype._fromJson=function(e,t){return this.raw=e,this.kind=e.kind||i,this.item=e.item||s,this.itemName=e.itemName||n,this.fromDate=e.fromDate||c,this.toDate=e.toDate||u,r.Deferred().resolve(e)},e}(e),pe=function(n,i,e){function t(){}var s={name:"",email:"",group:"",picture:"",role:"user",active:!0,isOwner:!1,archived:null};t.prototype=i.prototype;function r(e){e=n.extend({_fields:["*","group","picture"]},e),i.call(this,e),this.helper=e.helper,this.name=e.name||s.name,this.picture=e.picture||s.picture,this.email=e.email||s.email,this.role=e.role||s.role,this.group=e.group||s.group,this.active=(null!=e.active?e:s).active,this.isOwner=(null!=e.isOwner?e:s).isOwner,this.archived=e.archived||s.archived,this.dsAnonymous=e.dsAnonymous}return((r.prototype=new t).constructor=r).prototype.isValidName=function(){return this.name=n.trim(this.name),4<=this.name.length},r.prototype.isValidEmail=function(){return this.email=n.trim(this.email),e.isValidEmail(this.email)},r.prototype.emailExists=function(){return!this.isValidEmail()||null!=this.id&&this.email==this.raw.email?n.Deferred().resolve(!1):this.dsAnonymous.call("emailExists",{email:this.email}).then(function(e){return e.result})},r.prototype.isValidPassword=function(){return this.password=n.trim(this.password),e.isValidPassword(this.password)},r.prototype.isValid=function(){return this.isValidName()&&this.isValidEmail()},r.prototype.isEmpty=function(){return i.prototype.isEmpty.call(this)&&this.name==s.name&&this.email==s.email&&this.role==s.role},r.prototype._isDirtyInfo=function(){if(this.raw){var e=this.raw.name||s.name,t=this.raw.email||s.email,r=(null!=this.raw.active?this.raw:s).active;return this.name!=e||this.email!=t||this.active!=r}return!1},r.prototype._isDirtyRole=function(){if(this.raw){var e=this.raw.role||s.role;return this.role!=e}return!1},r.prototype.isDirty=function(){return i.prototype.isDirty.call(this)||this._isDirtyInfo()||this._isDirtyRole()},r.prototype.getImageUrl=function(e,t){return null!=this.picture&&0<this.picture.length?this.helper.getImageCDNUrl(this.group,this.picture,e,t):this.helper.getImageUrl(this.ds,this.id,e,t)},r.prototype._getDefaults=function(){return s},r.prototype.addKeyValue=function(e,t,r,i){return n.Deferred().reject("Not implemented for User, use setPicture instead?")},r.prototype.addKeyValue=function(e,t,r,i,s){return n.Deferred().reject("Not implemented for User, use setPicture instead?")},r.prototype.removeKeyValue=function(e,t){return n.Deferred().reject("Not implemented for User, use clearPicture instead?")},r.prototype.setPicture=function(e,t){return this.existsInDb()?(this.picture=e,this._doApiCall({method:"setPicture",params:{attachment:e},skipRead:t})):n.Deferred().reject("User does not exist in database")},r.prototype.clearPicture=function(e){return this.existsInDb()?this._doApiCall({method:"clearPicture",skipRead:e}):n.Deferred().reject("User does not exist in database")},r.prototype.canActivate=function(){return!this.active&&null==this.archived},r.prototype.canDeactivate=function(){return this.active&&null==this.archived&&!this.isOwner},r.prototype.canArchive=function(){return null==this.archived&&!this.isOwner},r.prototype.canUndoArchive=function(){return null!=this.archived},r.prototype.canBeOwner=function(){return null==this.archived&&this.active&&!this.isOwner&&"admin"==this.role},r.prototype.activate=function(e){return this.existsInDb()?this._doApiCall({method:"activate",skipRead:e}):n.Deferred().reject("User does not exist in database")},r.prototype.deactivate=function(e){return this.existsInDb()?this._doApiCall({method:"deactivate",skipRead:e}):n.Deferred().reject("User does not exist in database")},r.prototype.archive=function(e){return this.existsInDb()?this._doApiCall({method:"archive",skipRead:e}):n.Deferred().reject("User does not exist in database")},r.prototype.undoArchive=function(e){return this.existsInDb()?this._doApiCall({method:"undoArchive",skipRead:e}):n.Deferred().reject("User does not exist in database")},r.prototype.update=function(e){if(this.isEmpty())return n.Deferred().reject(new Error("Cannot update to empty user"));if(!this.existsInDb())return n.Deferred().reject(new Error("Cannot update user without id"));if(!this.isValid())return n.Deferred().reject(new Error("Cannot update, invalid user"));var t,r=n.Deferred(),i=n.Deferred();return this._isDirtyInfo()?(delete(t=this._toJson()).id,r=this.ds.update(this.id,t,this._fields)):r.resolve(),this._isDirtyRole()?i=this._doApiCall({method:"updateUserRole",params:{role:this.role},skipRead:!0}):i.resolve(),n.when(r,i)},r.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.name=this.name||s.name,e.email=this.email||s.email,e},r.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.group=e.group&&null!=e.group._id?e.group._id:e.group||s.group,r.name=e.name||s.name,r.picture=e.picture||s.picture,r.email=e.email||s.email,r.role=e.role||s.role,r.active=(null!=e.active?e:s).active,r.isOwner=(null!=e.isOwner?e:s).isOwner,r.archived=e.archived||s.archived,n.publish("user.fromJson",e),e})},r}(e,Y,we),q=Ae,ee=function(s,i,n,t){function e(){}var o={name:"",email:"",status:"active",user:{},kind:"contact",cover:"",blocked:null};e.prototype=i.prototype;function r(e){e=s.extend({_fields:["*"],crtype:"cheqroom.types.customer"},e),i.call(this,e),this.helper=e.helper||new t,this.name=e.name||o.name,this.email=e.email||o.email,this.status=e.status||o.status,this.user=e.user||o.user,this.kind=e.kind||o.kind,this.cover=e.cover||o.cover,this.blocked=e.blocked||o.blocked}return((r.prototype=new e).constructor=r).prototype.isValidName=function(){return this.name=s.trim(this.name),3<=this.name.length},r.prototype.isValidEmail=function(){return this.email=s.trim(this.email),n.isValidEmail(this.email)},r.prototype.getUserId=function(){return this.helper.ensureId(this.user)},r.prototype.getUserSync=function(){return null!=this.user&&null!=this.user.sync?this.user.sync:""},r.prototype.canReserve=function(){return n.contactCanReserve(this)},r.prototype.canCheckout=function(){return n.contactCanCheckout(this)},r.prototype.canGenerateDocument=function(){return n.contactCanGenerateDocument(this)},r.prototype.canArchive=function(){return n.contactCanArchive(this)},r.prototype.canUndoArchive=function(){return n.contactCanUndoArchive(this)},r.prototype.canBlock=function(){return n.contactCanBlock(this)},r.prototype.canUndoBlock=function(){return n.contactCanUndoBlock(this)},r.prototype.canDelete=function(){return n.contactCanDelete(this)},r.prototype.changeKind=function(e,t){return this._doApiCall({method:"changeKind",params:{kind:e},skipRead:t})},r.prototype.archive=function(e){return this._doApiCall({method:"archive",params:{},skipRead:e})},r.prototype.undoArchive=function(e){return this._doApiCall({method:"undoArchive",params:{},skipRead:e})},r.prototype.block=function(e,t){return this._doApiCall({method:"block",params:{message:e},skipRead:t})},r.prototype.undoBlock=function(e,t){return this._doApiCall({method:"undoBlock",params:{message:e},skipRead:t})},r.prototype.generateDocument=function(e,t,r){return this._doApiLongCall({method:"generateDocument",params:{template:e,signature:t},skipRead:r})},r.prototype.isValid=function(){return this.isValidName()&&this.isValidEmail()},r.prototype.isEmpty=function(){return i.prototype.isEmpty.call(this)&&this.name==o.name&&this.email==o.email},r.prototype.isDirty=function(){var e=i.prototype.isDirty.call(this);return e=!e&&this.raw?this._isDirtyStringProperty("name")||this._isDirtyStringProperty("email")||this._isDirtyStringProperty("kind"):e},r.prototype._getDefaults=function(){return o},r.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.name=this.name||o.name,e.email=this.email||o.email,e.kind=this.kind||o.kind,e},r.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(e){r.name=e.name||o.name,r.email=e.email||o.email,r.status=e.status||o.status,r.user=e.user||o.user,r.kind=e.kind||o.kind,r.blocked=e.blocked||o.blocked;var t=e.cover||o.cover;return r.cover=n.isImage(t)?t:"",s.publish("contact.fromJson",e),e})},r.prototype._create=function(t){var r=this,e=s.extend({},this._toJson(),this._toJsonFields());return delete e.id,this.ds.create(e,this._fields).then(function(e){return 1==t?e:r._fromJson(e)})},r.prototype._update=function(t){var r,i=this,e={};return this._isDirtyStringProperty("name")&&(e.name=i.name),this._isDirtyStringProperty("email")&&(e.email=i.email),r=this._isDirtyStringProperty("kind")?this.changeKind(i.kind,!0):s.Deferred().resolve(),this.ds.update(this.id,e,this._fields).then(function(e){return r.then(function(){return 1==t?e:i._fromJson(e)})})},r}(J=e,Y,z=we,ce=function(i){return i=i||q,{getSettings:function(){return i},getImageCDNUrl:function(e,t,r){return z.getImageCDNUrl(i,e,t,r)},getImageUrl:function(e,t,r,i){t=e.getBaseUrl(!0)+t+"?mimeType=image/jpeg";return r&&"orig"!=r&&(t+="&size="+r),i&&(t+="&_bust="+(new Date).getTime()),t},getICalUrl:function(e,t,r,i,s,n,o,a){i=i||[],s=s||[];t=e+"/ical/"+t+"/"+r+"/public/"+((a=a||[])&&0<a.length?"items":"locations")+"/call/ical",r=[];o&&r.push("locations[]="+o),n&&r.push("customer="+n),0<a.length&&r.push(J.param({items:a}));a=s.filter(function(e){return e.selected}).map(function(e){return e.id||""});0==a.length?r.push("skipOpenReservations=true"):a.length!=s.length&&r.push(J.param({rlab:a}));a=i.filter(function(e){return e.selected}).map(function(e){return e.id||""});return 0==a.length?r.push("skipOpenOrders=true"):a.length!=i.length&&r.push(J.param({olab:a})),0<r.length?t+"?"+r.join("&"):t},getQRCodeUrl:function(e,t){return z.getQRCodeUrl(i.qrCodeUtilsApi,e,t)},getBarcodeUrl:function(e,t,r){return z.getBarcodeUrl(i.barcodeUtilsApi,e,t,r)},getNumItemsLeft:function(e,t){var r=this.getStat(t,"items","status");return e.maxItems-this.getStat(t,"items","total")+r.expired},getNumUsersLeft:function(e,t){t=this.getStat(t,"users","status");return e.maxUsers-t.active},getStat:function(e,t,r,i,s){if(void 0===(e=(e=e||{})[i&&"null"!=i?i:"all"]||e.all))throw"Invalid stats";t=(e=e[s||"production"])[t];if(!t)return{};if(!r)return t;r=t[r];return void 0===r?{}:r},ensureValue:function(e,t){return"string"!=typeof e&&e&&e.hasOwnProperty(t)?e[t]:e},ensureId:function(e){return e&&e.hasOwnProperty("id")?this.ensureValue(e,"id"):this.ensureValue(e,"_id")}}}),te=function(e,p){p.fn.toJSONDate=function(){return this.format("YYYY-MM-DD[T]HH:mm:ss.000[Z]")},p.fn.roundTo=function(e,t,r){e=p.normalizeUnits(e),t=t||1;function i(e){switch(r){case"up":e=Math.ceil(e/t);break;case"down":e=Math.floor(e/t);break;default:e=Math.round(e/t)}return e*t}switch(e){case"year":this.year(i(this.year()));break;case"month":this.month(i(this.month()));break;case"week":this.weekday(i(this.weekday()));break;case"isoWeek":this.isoWeekday(i(this.isoWeekday()));break;case"day":this.day(i(this.day()));break;case"hour":this.hour(i(this.hour()));break;case"minute":this.minute(i(this.minute()));break;case"second":this.second(i(this.second()));break;default:this.millisecond(i(this.millisecond()))}return this};function t(e){this.roundType=(e=e||{}).roundType||"nearest",this.roundMinutes=e.roundMinutes||15,this.timeFormat24=e.timeFormat24||!1,this._momentFormat=this.timeFormat24?"MMM D [at] H:mm":"MMM D [at] h:mm a",this.startOfDayHours=null!=e.startOfDayHours?startOfDayHours:9,this.endOfDayHours=null!=e.endOfDayHours?endOfDayHours:17,this.businessHours=e.businessHours||[],this.weekStart=e.weekStart||1}return t.prototype.parseDate=function(e){if(("string"==typeof e||e instanceof String)&&e.endsWith("+00:00")){var t=e.length;return 25==t?p(e.substring(0,t-6)):32==t?p(e.substring(0,t-6).split(".")[0]):void 0}},t.prototype.getNow=function(){return p()},t.prototype.getFriendlyDuration=function(e){return e.humanize()},t.prototype.getFriendlyDateParts=function(e,t,r){return p.isMoment(e)||(e=p(e)),t=t||this.getNow(),e.calendar().replace("AM","am").replace("PM","pm").split(" at ")},t.prototype.getDateRanges=function(e,t,r,i){r&&!p.isMoment(r)&&(r=p(r)),i=i||{year:"year",years:"years",month:"month",months:"months",week:"week",weeks:"weeks",day:"day",days:"days",hour:"hour",hours:"hours"};for(var s,n,o,a=["years","months","weeks","days","hours"],c=[8760,720,168,24,1],u=null,l=-1,d=[],h=0;h<a.length;h++)if(u=a[h],(s=c[h])<=e&&e%s==0){l=h;break}if(r=r||this.getNow(),0<=l)for(h=1;h<=t;h++)n=i[1==(o=h*e)?u.replace("s",""):u],d.push({option:u,hours:o,title:o/c[l]+" "+n,from:r.clone(),to:r.clone().add(o,"hours")});return d.filter(function(e){return global.dateHelper.isValidBusinessDate(e.to)})},t.prototype.getFriendlyFromTo=function(e,t,r,i,s,n){p.isMoment(e)||(e=p(e)),p.isMoment(t)||(t=p(t)),i=i||this.getNow();var o=s||" - ",s=this.getFriendlyDateParts(e,i,n),n=this.getFriendlyDateParts(t,i,n),n={dayDiff:e?e.clone().startOf("day").diff(t,"days"):-1,fromDate:e?s[0]:"No from date set",fromTime:r&&null!=e?s[1]:"",toDate:t?n[0]:"No to date set",toTime:r&&null!=t?n[1]:""};return n.fromText=n.fromDate,n.toText=n.toDate,r&&(n.fromTime&&(n.fromText+=" "+n.fromTime),n.toTime&&(n.toText+=" "+n.toTime)),0==n.dayDiff?n.text=r?n.fromText+o+n.toText:n.fromText:n.text=n.fromText+o+n.toText,n},t.prototype.getFriendlyFromToOld=function(e,t,r){e=this.roundFromTime(e,r),r=this.roundToTime(t,r);return{from:e,to:r,daysBetween:r.clone().startOf("day").diff(e.clone().startOf("day"),"days"),duration:p.duration(e-r).humanize(),fromText:e.calendar().replace(" at "," "),toText:r.calendar().replace(" at "," ")}},t.prototype.makeStartDate=function(e,t,r,i,s,n){return t=null==t||t,r=null!=r&&r,n=n||p(),e=t&&!r?this.roundTimeFrom(e):(r=e.isSame(n,"day"),n=this._makeStartOfBusinessDay(e),!r||e.isBefore(n)?n:this.roundTimeFrom(e)),i&&e.isBefore(i)?i:e},t.prototype.makeEndDate=function(e,t,r,i,s,n){return t=null==t||t,r=null!=r&&r,n=n||p(),e=t&&!r?this.roundTimeTo(e):(t=e.isSame(n,"day"),r=this._makeEndOfBusinessDay(e),n=this._makeEndOfDay(e),t?e.isBefore(r)?r:n:e.isAfter(r)?n:r),s&&e.isAfter(s)?s:e},t.prototype.getFriendlyDateText=function(e,t,r,i){if(null==e)return"Not set";i=this.getFriendlyDateParts(e,r,i);return t?i.join(" "):i[0]},t.prototype.addAverageDuration=function(e){return e.clone().add(1,"day")},t.prototype.roundTimeFrom=function(e){return this.roundMinutes<=1?e:this.roundTime(e,this.roundMinutes,this._typeToDirection(this.roundType,"from"))},t.prototype.roundTimeTo=function(e){return this.roundMinutes<=1?e:this.roundTime(e,this.roundMinutes,this._typeToDirection(this.roundType,"to"))},t.prototype.roundTime=function(e,t,r){e=p.isMoment(e)?e:p(e);return e.seconds(0).milliseconds(0),e.roundTo("minute",t||15,r)},t.prototype.roundTimeUp=function(e,t){e=p.isMoment(e)?e:p(e);return e.seconds(0).milliseconds(0),e.roundTo("minute",t||15,"up")},t.prototype.roundTimeDown=function(e,t){e=p.isMoment(e)?e:p(e);return e.seconds(0).milliseconds(0),e.roundTo("minute",t||15,"down")},t.prototype._typeToDirection=function(e,t){switch(e){case"longer":switch(t){case"from":return"down";case"to":return"up"}break;case"shorter":switch(t){case"from":return"up";case"to":return"down"}}},t.prototype.isValidBusinessDate=function(s){var n=!1;return 0<this.businessHours.length?e.each(this._getBusinessHours(s),function(e,t){var r=p(p.utc(p.duration(t.openTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),i=p(p.utc(p.duration(t.closeTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),t=p(s.clone().format("H:mm"),"H:mm");if(n=t.isBetween(r,i)||t.isSame(r)||t.isSame(i))return!1}):n=!0,n},t.prototype.getValidBusinessDate=function(e){var t=this.getNow(),r=0;for(e.isBefore(t)&&e.date(t.date());!this.isValidBusinessDate(e)||10080<=r;)e=e.add(this.roundMinutes,"minutes"),r+=this.roundMinutes;return e},t.prototype._getBusinessHours=function(t){var e=this.businessHours;return 0<e.length?e.filter(function(e){return e.isoWeekday==t.isoWeekday()}):[]},t.prototype._makeStartOfBusinessDay=function(e){var t=e.clone().hour(this.startOfDayHours).minutes(0).seconds(0).milliseconds(0);return 0<this.businessHours.length&&(0<(e=this._getBusinessHours(e)).length&&(e=p(p.utc(p.duration(e[0].openTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),t.hour(e.hour()).minute(e.minute()))),this.getValidBusinessDate(t)},t.prototype._makeEndOfBusinessDay=function(e){var t=e.clone().hour(this.endOfDayHours).minutes(0).seconds(0).milliseconds(0);return 0<this.businessHours.length&&(0<(e=this._getBusinessHours(e).sort(function(e,t){return e.closeTime<t.closeTime})).length&&(e=p(p.utc(p.duration(e[0].closeTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),t.hour(e.hour()).minute(e.minute()))),this.getValidBusinessDate(t)},t.prototype._makeEndOfDay=function(e){return e.clone().hours(23).minutes(45).seconds(0).milliseconds(0)},t}(e,o),ie=function(o,i){function e(){}var a={id:"",name:"",itemFlags:[],kitFlags:[],customerFlags:[],orderFlags:[],reservationFlags:[],itemFields:[],kitFields:[],customerFields:[],orderFields:[],reservationFields:[],itemLabels:[],kitLabels:[],customerLabels:[],reservationLabels:[],orderLabels:[],businessHours:[],cancelled:null,calendarTemplate:"{{number}}: {{name_or_summary}} - {{contact.name}}"};e.prototype=i.prototype;function t(e){e=o.extend({},e),i.call(this,e),this.name=e.name||a.name,this.itemFlags=this.getFlags(e.itemFlags||a.itemFlags.slice()),this.kitFlags=this.getFlags(e.kitFlags||a.kitFlags.slice()),this.customerFlags=this.getFlags(e.customerFlags||a.customerFlags.slice()),this.orderFlags=this.getFlags(e.orderFlags||a.orderFlags.slice()),this.reservationFlags=this.getFlags(e.reservationFlags||a.reservationFlags.slice()),this.itemFields=e.itemFields||a.itemFields.slice(),this.kitFields=e.kitFields||a.kitFields.slice(),this.customerFields=e.customerFields||a.customerFields.slice(),this.reservationFields=e.reservationFields||a.reservationFields.slice(),this.orderFields=e.orderFields||a.orderFields.slice(),this.itemLabels=e.itemLabels||a.itemLabels.slice(),this.kitLabels=e.kitLabels||a.kitLabels.slice(),this.customerLabels=e.customerLabels||a.customerLabels.slice(),this.reservationLabels=e.reservationLabels||a.reservationLabels.slice(),this.orderLabels=e.orderLabels||a.orderLabels.slice(),this.businessHours=e.businessHours||a.businessHours.slice(),this.calendarTemplate=e.calendarTemplate||a.calendarTemplate}return((t.prototype=new e).constructor=t).prototype.updateName=function(e){return this._doApiCall({pk:this.id,method:"updateName",location:e})},t.prototype.getStats=function(e){return this._doApiCall({pk:this.id,method:"getStats",location:e})},t.prototype.updateFlags=function(e,t,r){return this._doApiCall({pk:this.id,method:"updateFlags",collection:e,flags:t,skipRead:r})},t.prototype.createField=function(e,t,r,i,s,n,o,a,c,u,l){u={collection:e,name:t,kind:r,required:i,form:s,unit:n,editor:o,description:a,search:u};return c&&0<c.length&&(u.select=c),this._doApiCall({pk:this.id,method:"createField",skipRead:l,params:u})},t.prototype.updateField=function(e,t,r,i,s,n,o,a,c,u,l){u={collection:e,name:t,required:i,form:s,unit:n,editor:o,description:a,search:u};return c&&0<c.length&&(u.select=c),t!=r&&(u.newName=r),this._doApiCall({pk:this.id,method:"updateField",skipRead:l,params:u})},t.prototype.deleteField=function(e,t,r){return this._doApiCall({pk:this.id,method:"deleteField",skipRead:r,params:{collection:e,name:t}})},t.prototype.moveField=function(e,t,r,i){return this._doApiCall({pk:this.id,method:"moveField",skipRead:i,params:{collection:e,oldPos:t,newPos:r}})},t.prototype.createLabel=function(e,t,r,i,s){return this._doApiCall({pk:this.id,method:"createLabel",skipRead:s,params:{collection:e,labelColor:t,labelName:r,labelDefault:i}})},t.prototype.updateLabel=function(e,t,r,i,s,n){return this._doApiCall({pk:this.id,method:"updateLabel",skipRead:n,params:{collection:e,labelId:t,labelColor:r,labelName:i,labelDefault:s}})},t.prototype.deleteLabel=function(e,t,r){return this._doApiCall({pk:this.id,method:"deleteLabel",skipRead:r,params:{collection:e,labelId:t}})},t.prototype.buyProduct=function(e,t,r){return this._doApiCall({pk:this.id,method:"buyProduct",skipRead:!0,params:{productId:e,quantity:t,shipping:r}})},t.prototype.buyProducts=function(e,t,r){return this._doApiCall({pk:this.id,method:"buyProducts",skipRead:!0,params:{products:e,shipping:t,coupon:r}})},t.prototype.addTags=function(e){return this._doApiCall({pk:this.id,method:"addTags",skipRead:!0,params:{tags:e}})},t.prototype.removeTags=function(e){return this._doApiCall({pk:this.id,method:"removeTags",skipRead:!0,params:{tags:e}})},t.prototype.getFieldsForCollection=function(e,r){var t=[];switch(e){case"items":t=this.itemFields;break;case"kits":t=this.kitFields;break;case"contacts":case"customers":t=this.customerFields;break;case"reservations":t=this.reservationFields;break;case"checkouts":case"orders":t=this.orderFields}return t=null!=r?o.grep(t,function(e,t){return e.form==r}):t},t.prototype.getFlagsForCollection=function(e){switch(e){case"items":return this.getFlags(this.itemFlags);case"kits":return this.getFlags(this.kitFlags);case"contacts":case"customers":return this.getFlags(this.customerFlags);case"reservations":return this.getFlags(this.reservationFlags);case"checkouts":case"orders":return this.getFlags(this.orderFlags);default:return this.getFlags([])}},t.prototype.getFlags=function(e){return e.map(function(e){return(e="string"==typeof e?{_id:e,name:e}:e)._id||(e._id=e.id),e})},t.prototype.getBusinessDays=function(){return this.businessHours.map(function(e){return e.isoWeekday})},t.prototype.getBusinessHoursForIsoWeekday=function(t){return this.businessHours.filter(function(e){return e.isoWeekday==t})},t.prototype.setBusinessHours=function(e,t){return e=(e=e||[]).slice().map(function(e){var t=o.extend({},e);return t.dayOfWeek=e.isoWeekday-1,delete t.isoWeekday,t}),this._doApiCall({method:"setBusinessHours",params:{businessHours:e,_fields:this._fields},skipRead:t,usePost:!0})},t.prototype.getDefaultBusinessHours=function(){return[{isoWeekday:1,openTime:540,closeTime:1020},{isoWeekday:2,openTime:540,closeTime:1020},{isoWeekday:3,openTime:540,closeTime:1020},{isoWeekday:4,openTime:540,closeTime:1020},{isoWeekday:5,openTime:540,closeTime:1020}]},t.prototype.setCalendarTemplate=function(e,t){return this._doApiCall({method:"setCalendarTemplate",params:{template:e,kind:t},skipRead:!0,usePost:!0})},t.prototype.clearCalendarTemplate=function(){return this._doApiCall({method:"clearCalendarTemplate",skipRead:!0})},t.prototype.getCalendarTemplatePreview=function(e,t){return this._doApiCall({method:"getCalendarTemplatePreview",params:{template:e,kind:t},skipRead:!0,usePost:!0})},t.prototype.getDefaultCalendarTemplate=function(){return a.calendarTemplate},t.prototype.isValidName=function(){return this.name=o.trim(this.name),3<=this.name.length},t.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.name=this.name,e},t.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.name=e.name||a.name,r.itemFlags=r.getFlags(e.itemFlags||a.itemFlags.slice()),r.kitFlags=r.getFlags(e.kitFlags||a.kitFlags.slice()),r.customerFlags=r.getFlags(e.customerFlags||a.customerFlags.slice()),r.orderFlags=r.getFlags(e.orderFlags||a.orderFlags.slice()),r.reservationFlags=r.getFlags(e.reservationFlags||a.reservationFlags.slice()),r.itemFields=e.itemFields||a.itemFields.slice(),r.kitFields=e.kitFields||a.kitFields.slice(),r.customerFields=e.customerFields||a.customerFields.slice(),r.reservationFields=e.reservationFields||a.reservationFields.slice(),r.orderFields=e.orderFields||a.orderFields.slice(),r.cancelled=e.cancelled||a.cancelled,r.businessHours=e.businessHours||a.businessHours.slice(),r.calendarTemplate=e.calendarTemplate||a.calendarTemplate,r._fromColorLabelsJson(e,t).then(function(e){return r._fromBusinessHoursJson(e,t)})})},t.prototype._fromBusinessHoursJson=function(e,t){return e.businessHours=e.businessHours.map(function(e){return e.isoWeekday||(e.isoWeekday=e.dayOfWeek+1),delete e.dayOfWeek,e}),o.Deferred().resolve(e)},t.prototype._fromColorLabelsJson=function(t,i){var s,n=this;return o.each(["itemLabels","kitLabels","customerLabels","reservationLabels","orderLabels"],function(e,r){n[r]=a[r].slice(),"orderLabels"==r&&n[r].push(n._getColorLabel({readonly:!0,default:!t[r].some(function(e){return!0===e.default}),name:"Unlabeled",color:"SlateGray"},i)),"reservationLabels"==r&&n[r].push(n._getColorLabel({readonly:!0,default:!t[r].some(function(e){return!0===e.default}),name:"Unlabeled",color:"LimeGreen"},i)),t[r]&&0<t[r].length&&o.each(t[r],function(e,t){(s=n._getColorLabel(t,i))&&n[r].push(s)})}),o.Deferred().resolve(t)},t}(e,re),se=function(c,e,i){function t(){}var s={name:"",status:"",codes:[],brand:"",model:"",warrantyDate:null,purchaseDate:null,purchasePrice:null,residualValue:0,location:"",category:"",geo:[0,0],address:"",order:null,kit:null,custody:null,cover:"",catalog:null,canReserve:"available",canOrder:"available",canCustody:"available",allowReserve:!0,allowOrder:!0,allowCustody:!0,flagged:null,expired:null};t.prototype=i.prototype;function r(e){e=c.extend({_fields:["*"],crtype:"cheqroom.types.item"},e),i.call(this,e),this.name=e.name||s.name,this.status=e.status||s.status,this.brand=e.brand||s.brand,this.model=e.model||s.model,this.warrantyDate=e.warrantyDate||s.warrantyDate,this.purchaseDate=e.purchaseDate||s.purchaseDate,this.purchasePrice=e.purchasePrice||s.purchasePrice,this.residualValue=e.residualValue||s.residualValue,this.codes=e.codes||s.codes,this.location=e.location||s.location,this.category=e.category||s.category,this.geo=e.geo||s.geo.slice(),this.address=e.address||s.address,this.order=e.order||s.order,this.kit=e.kit||s.kit,this.custody=e.custody||s.custody,this.cover=e.cover||s.cover,this.catalog=e.catalog||s.catalog,this.allowReserve=(void 0!==e.allowReserve?e:s).allowReserve,this.allowCheckout=(void 0!==e.allowOrder?e:s).allowOrder,this.allowCustody=(void 0!==e.allowCustody?e:s).allowCustody,this._canReserve=(void 0!==e.canReserve?e:s).canReserve,this._canCheckout=(void 0!==e.canOrder?e:s).canOrder,this._canCustody=(void 0!==e.canCustody?e:s).canCustody}return((r.prototype=new t).constructor=r).prototype.isValidName=function(){return this.name=c.trim(this.name),3<=this.name.length},r.prototype.isValidCategory=function(){return 0<c.trim(this.category).length},r.prototype.isValidLocation=function(){return 0<c.trim(this.location).length},r.prototype.isValid=function(){return this.isValidName()&&this.isValidCategory()&&("in_custody"==this.status||this.isValidLocation())},r.prototype.isEmpty=function(){return i.prototype.isEmpty.call(this)&&this.name==s.name&&this.status==s.status&&this.brand==s.brand&&this.model==s.model&&this.warrantyDate==s.warrantyDate&&this.purchaseDate==s.purchaseDate&&this.purchasePrice==s.purchasePrice&&this.residualValue==s.residualValue&&0==this.codes.length&&this.location==s.location&&this.category==s.category},r.prototype.isDirty=function(){return i.prototype.isDirty.call(this)||this._isDirtyName()||this._isDirtyBrand()||this._isDirtyModel()||this._isDirtyWarrantyDate()||this._isDirtyPurchaseDate()||this._isDirtyPurchasePrice()||this._isDirtyResidualValue()||this._isDirtyCategory()||this._isDirtyLocation()||this._isDirtyGeo()||this._isDirtyFlag()||this._isDirtyPermissions()},r.prototype._getDefaults=function(){return s},r.prototype._toJson=function(e){var t,r=i.prototype._toJson.call(this,e);for(t in r.name=this.name||s.name,r.brand=this.brand||s.brand,r.model=this.model||s.model,r.warrantyDate=this.warrantyDate||s.warrantyDate,r.purchaseDate=this.purchaseDate||s.purchaseDate,r.purchasePrice=this.purchasePrice||s.purchasePrice,r.residualValue=this.residualValue||s.residualValue,r.category=this.category||s.category,r.location=this.location||s.location,r.catalog=this.catalog||s.catalog,r)null==r[t]&&delete r[t];return r},r.prototype._fromJson=function(t,e){var r=this;return void 0===t.allowOrder&&(t.allowOrder=s.allowOrder),void 0===t.allowReserve&&(t.allowReserve=s.allowReserve),void 0===t.allowCustody&&(t.allowCustody=s.allowCustody),i.prototype._fromJson.call(this,t,e).then(function(){r.name=t.name||s.name,r.status=t.status||s.status,r.brand=t.brand||s.brand,r.model=t.model||s.model,r.warrantyDate=t.warrantyDate||s.warrantyDate,r.purchaseDate=t.purchaseDate||s.purchaseDate,r.purchasePrice=t.purchasePrice||s.purchasePrice,r.residualValue=t.residualValue||s.residualValue,r.codes=t.codes||s.codes,r.address=t.address||s.address,r.geo=t.geo||s.geo.slice(),r.cover=t.cover||s.cover,r.catalog=t.catalog||s.catalog,r.flagged=t.flagged||s.flagged,r.expired=t.expired||s.expired;var e=s.location;t.location&&(e=t.location._id||t.location),r.location=e;e=s.category;t.category&&(e=t.category._id||t.category),r.category=e;e=s.order;t.order&&(e=t.order._id||t.order),r.order=e;e=s.kit;t.kit&&(e=t.kit._id||t.kit),r.kit=e;e=s.custody;return t.custody&&(e=t.custody._id||t.custody),r.custody=e,r._canReserve=(void 0!==t.canReserve?t:s).canReserve,r._canOrder=(void 0!==t.canOrder?t:s).canOrder,r._canCustody=(void 0!==t.canCustody?t:s).canCustody,r.allowReserve=(void 0!==t.allowReserve?t:s).allowReserve,r.allowCheckout=(void 0!==t.allowOrder?t:s).allowOrder,r.allowCustody=(void 0!==t.allowCustody?t:s).allowCustody,c.publish("item.fromJson",t),t})},r.prototype._toJsonKeyValues=function(){var i={};return null!=this.keyValues&&0<this.keyValues.length&&c.each(this.keyValues,function(e,t){var r="keyValues__"+t.key;i[r+"__kind"]=t.kind,i[r+"__value"]=t.value}),i},r.prototype._isDirtyName=function(){return this._isDirtyStringProperty("name")},r.prototype._isDirtyBrand=function(){return this._isDirtyStringProperty("brand")},r.prototype._isDirtyModel=function(){return this._isDirtyStringProperty("model")},r.prototype._isDirtyWarrantyDate=function(){return this._isDirtyMomentProperty("warrantyDate")},r.prototype._isDirtyPurchaseDate=function(){return this._isDirtyMomentProperty("purchaseDate")},r.prototype._isDirtyPurchasePrice=function(){return this._isDirtyProperty("purchasePrice")},r.prototype._isDirtyResidualValue=function(){return this._isDirtyProperty("residualValue")},r.prototype._isDirtyLocation=function(){if(this.raw){var e=s.location;return this.raw.location&&(e=this.raw.location._id||this.raw.location),this.location!=e}return!1},r.prototype._isDirtyCategory=function(){if(this.raw){var e=s.category;return this.raw.category&&(e=this.raw.category._id||this.raw.category),this.category!=e}return!1},r.prototype._isDirtyPermissions=function(){if(this.raw){var e=this.raw.allowReserve,t=this.raw.allowOrder,r=this.raw.allowCustody;return this.allowReserve!=e||this.allowCheckout!=t||this.allowCustody!=r}return!1},r.prototype._isDirtyGeo=function(){if(this.raw){var e=this.raw.address||s.address,t=this.raw.geo||s.geo.slice();return this.address!=e||this.geo[0]!=t[0]||this.geo[1]!=t[1]}return!1},r.prototype._isDirtyFlag=function(){return!!this.raw&&this.raw.flag!=this.flag},r.prototype.getAvailabilities=function(e,t){return this.ds.call(this.id,"getAvailability",{fromDate:e,toDate:t})},r.prototype.update=function(e){if(this.isEmpty())return c.Deferred().reject(new Error("Cannot update to empty document"));if(!this.existsInDb())return c.Deferred().reject(new Error("Cannot update document without id"));if(!this.isValid())return c.Deferred().reject(new Error("Cannot update, invalid document"));var t=this,r=c.Deferred(),i=c.Deferred(),s=c.Deferred(),n=c.Deferred(),o=c.Deferred(),a=c.Deferred();return this._isDirtyCategory()?this.canChangeCategory(this.category).done(function(e){e.result?r.resolve():r.reject(new Error("Unable to change item category"))}):r.resolve(),r.then(function(){return t._isDirtyCategory()?i=t.changeCategory(t.category):i.resolve(),t._isDirtyLocation()?s=t.changeLocation(t.location):s.resolve(),t._isDirtyFields()?n=t._updateFields():n.resolve(),t._isDirtyName()||t._isDirtyBrand()||t._isDirtyModel()||t._isDirtyWarrantyDate()||t._isDirtyPurchaseDate()||t._isDirtyPurchasePrice()||t._isDirtyResidualValue()?a=t.updateBasicFields(t.name,t.brand,t.model,t.warrantyDate,t.purchaseDate,t.purchasePrice,t.residualValue):a.resolve(),t._isDirtyPermissions()?o=t.updateAllowedActions(t.allowReserve,t.allowCheckout,t.allowCustody):o.resolve(),c.when(i,s,n,a)})},r.prototype.create=function(t){if(this.existsInDb())return c.Deferred().reject(new Error("Cannot create document, already exists in database"));if(this.isEmpty())return c.Deferred().reject(new Error("Cannot create empty document"));if(!this.isValid())return c.Deferred().reject(new Error("Cannot create, invalid document"));var r=this,e=c.extend(this._toJson(),this._toJsonFields());return delete e.id,this.ds.create(e,this._fields).then(function(e){return 1==t?e:r._fromJson(e)})},r.prototype.createMultiple=function(e,t,r,i){if(this.existsInDb())return c.Deferred().reject(new Error("Cannot create document, already exists in database"));if(this.isEmpty())return c.Deferred().reject(new Error("Cannot create empty document"));if(!this.isValid())return c.Deferred().reject(new Error("Cannot create, invalid document"));var s=this,r=c.extend(this._toJson(),this._toJsonFields(),{times:e||1,autoNumber:t||!1,startFrom:r});return delete r.id,null!=r.model&&(r.brandModel=r.model,delete r.model),this._doApiCall({method:"createMultiple",params:r}).then(function(e){return(1==i?c.Deferred().resolve(e[0]):s._fromJson(e[0])).then(function(){return e})})},r.prototype.duplicate=function(e,t,r,i){return this._doApiCall({method:"duplicate",params:{times:e,location:t,autoNumber:r,startFrom:i},skipRead:!0})},r.prototype.canGoToCheckout=function(){return e.itemCanGoToCheckout(this)&&!c.isEmptyObject(this.order)},r.prototype.canCheckin=function(){return e.itemCanCheckin(this)},r.prototype.canExpire=function(){return e.itemCanExpire(this)},r.prototype.canUndoExpire=function(){return e.itemCanUndoExpire(this)},r.prototype.canDelete=function(){return i.prototype.canDelete.call(this)&&e.itemCanDelete(this)},r.prototype.expire=function(e,t){return this._doApiCall({method:"expire",params:{message:e||""},skipRead:t})},r.prototype.undoExpire=function(e){return this._doApiCall({method:"undoExpire",skipRead:e})},r.prototype.changeLocation=function(e,t){return this._doApiCall({method:"changeLocation",params:{location:e},skipRead:t})},r.prototype.addCode=function(e,t){return this._doApiCall({method:"addCodes",params:{codes:[e]},skipRead:t})},r.prototype.removeCode=function(e,t){return this._doApiCall({method:"removeCodes",params:{codes:[e]},skipRead:t})},r.prototype.updateGeo=function(e,t,r,i){return this._doApiCall({method:"updateGeo",params:{lat:e,lng:t,address:r},skipRead:i})},r.prototype.getLastNumber=function(){return this.ds.call(null,"getLastItemNumber",{name:this.name})},r.prototype.updateBasicFields=function(e,t,r,i,s,n,o,a){var c=this,u={};return null!=e&&e!=this.raw.name&&(u.name=e),null!=t&&t!=this.raw.brand&&(u.brand=t),null!=r&&r!=this.raw.model&&(u.model=r),null!=i&&("object"==typeof i&&i.isValid()?i.isSame(this.raw.warrantyDate)||(u.warrantyDate=i):u.warrantyDate=""),null!=s&&("object"==typeof s&&s.isValid()?s.isSame(this.raw.purchaseDate)||(u.purchaseDate=s):u.purchaseDate=""),null!=n&&n!=this.raw.purchasePrice&&(u.purchasePrice=n),null!=o&&o!=this.raw.residualValue&&(u.residualValue=o),this.ds.update(this.id,u,this._fields).then(function(e){return 1==a?e:c._fromJson(e)})},r.prototype.canChangeCategory=function(e){return this._doApiCall({collectionCall:!0,method:"canChangeCategory",params:{pks:[this.id],category:e},skipRead:!0,_fields:"*"})},r.prototype.changeCategory=function(e,t){var r=this;return this._doApiCall({collectionCall:!0,method:"changeCategory",params:{pks:[this.id],category:e},skipRead:!0}).then(function(e){return 1==t?e:r._fromJson(e[0])})},r.prototype.updateAllowedActions=function(e,t,r,i){return this._doApiCall({method:"setAllowedActions",params:{reserve:e,order:t,custody:r},skipRead:i})},r.prototype.canReserve=function(){return e.itemCanReserve(this.raw)},r.prototype.canCheckout=function(){return e.itemCanCheckout(this.raw)},r.prototype.canTakeCustody=function(){return e.itemCanTakeCustody(this.raw)},r.prototype.canReleaseCustody=function(){return e.itemCanReleaseCustody(this.raw)},r.prototype.canTransferCustody=function(){return e.itemCanTransferCustody(this.raw)},r.prototype.takeCustody=function(e,t){return this._doApiCall({method:"takeCustody",params:{customer:e},skipRead:t})},r.prototype.releaseCustody=function(e,t){return this._doApiCall({method:"releaseCustody",params:{location:e},skipRead:t})},r.prototype.transferCustody=function(e,t){return this._doApiCall({method:"transferCustody",params:{customer:e},skipRead:t})},r.prototype.getDepreciation=function(e){return this.ds.call(this.id,"getDepreciation",{frequency:e||"quarterly"})},r}(e,we,Y),ne=function(i,s,t){function e(){}var n={name:"",description:"",items:[],itemSummary:"",status:"unknown",cover:"",canReserve:"available",canOrder:"available",canCustody:"available",allowReserve:!0,allowOrder:!0,allowCustody:!0};e.prototype=s.prototype;function r(e){e=i.extend({_fields:["*"],crtype:"cheqroom.types.kit"},e),s.call(this,e),this.name=e.name||n.name,this.description=e.description||n.description,this.items=e.items||n.items.slice(),this.itemSummary=e.itemSummary||n.itemSummary,this.codes=[],this.conflicts=[],this.status=e.status||n.status,this.cover=e.cover||n.cover,this.allowReserve=(void 0!==e.allowReserve?e:n).allowReserve,this.allowCheckout=(void 0!==e.allowOrder?e:n).allowOrder,this.allowCustody=(void 0!==e.allowCustody?e:n).allowCustody,this._canReserve=(void 0!==e.canReserve?e:n).canReserve,this._canOrder=(void 0!==e.canOrder?e:n).canOrder,this._canCustody=(void 0!==e.canCustody?e:n).canCustody}return((r.prototype=new e).constructor=r).prototype.isValidName=function(){return this.name=i.trim(this.name),3<=this.name.length},r.prototype.isNameAvailableAsync=function(){return null!=this.id&&null!=this.raw&&this.name==this.raw.name?i.Deferred().resolve(!0):(this._dfdNameAvailable&&this._dfdNameAvailable.abort(),this._dfdNameAvailable=this.ds.search({name:i.trim(this.name)},"_id"),this._dfdNameAvailable.then(function(e){return 0==e.count},function(e){return!1}))},r.prototype.isValid=function(){return this.isValidName()},r.prototype.isEmpty=function(){return s.prototype.isEmpty.call(this)&&this.name==n.name},r.prototype.isDirtyItems=function(){function e(e){return(e=e||[]).map(function(e){return e._id}).sort().join(",")}var t=this.raw||{};return e(this.items)!=e(t.items)},r.prototype.isDirty=function(){var e=s.prototype.isDirty.call(this);return(e=!e&&this.raw?this._isDirtyStringProperty("name"):e)||this.isDirtyItems()},r.prototype.canCheckout=function(){return t.kitCanCheckout(this.raw)},r.prototype.canReserve=function(){return t.kitCanReserve(this.raw)},r.prototype.addItems=function(e,t){return this.existsInDb()?this._doApiCall({method:"addItems",params:{items:e},skipRead:t}):i.Deferred().reject(new Error("Cannot addItems from document without id"))},r.prototype.removeItems=function(e,t){return this.existsInDb()?this._doApiCall({method:"removeItems",params:{items:e},skipRead:t}):i.Deferred().reject(new Error("Cannot removeItems from document without id"))},r.prototype.moveItem=function(e,t,r){return this.existsInDb()?this._doApiCall({method:"moveItem",params:{item:e,toPos:t},skipRead:r}):i.Deferred().reject(new Error("Cannot moveItem from document without id"))},r.prototype.addCode=function(e,t){return this._doApiCall({method:"addCodes",params:{codes:[e]},skipRead:t})},r.prototype.removeCode=function(e,t){return this._doApiCall({method:"removeCodes",params:{codes:[e]},skipRead:t})},r.prototype.duplicate=function(e,t,r){return this._doApiCall({method:"duplicate",params:{times:e,location:t},skipRead:r||!0})},r.prototype.canTakeCustody=function(){return t.kitCanTakeCustody(this.raw)},r.prototype.canReleaseCustody=function(){return t.kitCanReleaseCustody(this.raw)},r.prototype.canTransferCustody=function(){return t.kitCanTransferCustody(this.raw)},r.prototype.takeCustody=function(e,t){return this._doApiCall({method:"takeCustody",params:{customer:e},skipRead:t})},r.prototype.releaseCustody=function(e,t){return this._doApiCall({method:"releaseCustody",params:{location:e},skipRead:t})},r.prototype.transferCustody=function(e,t){return this._doApiCall({method:"transferCustody",params:{customer:e},skipRead:t})},r.prototype._getDefaults=function(){return n},r.prototype._toJson=function(e){e=s.prototype._toJson.call(this,e);return e.name=this.name||n.name,e.description=this.description||n.description,e},r.prototype._fromJson=function(e,t){var r=this;return s.prototype._fromJson.call(this,e,t).then(function(e){return r.name=e.name||n.name,r.description=e.description||n.description,r.items=e.items||n.items.slice(),r.itemSummary=e.itemSummary||n.itemSummary,r.codes=e.codes||[],r.status=e.status||n.status,r.cover=e.cover||n.cover,r._canReserve=(void 0!==e.canReserve?e:n).canReserve,r._canOrder=(void 0!==e.canOrder?e:n).canOrder,r._canCustody=(void 0!==e.canCustody?e:n).canCustody,r.allowReserve=(void 0!==e.allowReserve?e:n).allowReserve,r.allowCheckout=(void 0!==e.allowOrder?e:n).allowOrder,r.allowCustody=(void 0!==e.allowCustody?e:n).allowCustody,r._loadConflicts(r.items),i.publish("Kit.fromJson",e),e})},r.prototype.create=function(t){if(this.existsInDb())return i.Deferred().reject(new Error("Cannot create document, already exists in database"));var r=this,e={name:this.name,items:this._getIds(this.items)};return i.extend(e,this._toJsonFields()),delete e.id,this.ds.create(e,this._fields).then(function(e){return 1==t?e:r._fromJson(e)})},r.prototype._loadConflicts=function(e){var r=[];"incomplete"==t.getKitStatus(e)&&i.each(e,function(e,t){switch(t.status){case"await_checkout":r.push({kind:"status",item:t._id,itemName:t.name,itemStatus:t.status,order:t.order});break;case"checkedout":r.push({kind:"order",item:t._id,itemName:t.name,itemStatus:t.status,order:t.order});break;case"expired":r.push({kind:"status",item:t._id,itemName:t.name,itemStatus:t.status});break;case"in_custody":r.push({kind:"custody",item:t._id,itemName:t.name,itemStatus:t.status})}}),this.conflicts=r},r}(e,Y,we),oe=function(i,s){function e(){}var n={name:"",address:""};e.prototype=s.prototype;function t(e){e=i.extend({_fields:["*"]},e),s.call(this,e),this.name=e.name||n.name,this.address=e.address||n.address}return((t.prototype=new e).constructor=t).prototype.isEmpty=function(){return s.prototype.isEmpty.call(this)&&this.name==n.name&&this.address==n.address},t.prototype.isDirty=function(){var e=s.prototype.isDirty.call(this);if(e||!this.raw)return e;var t=this.raw.name||n.name,e=this.raw.address||n.address;return this.name!=t||this.address!=e},t.prototype._getDefaults=function(){return n},t.prototype._toJson=function(e){e=s.prototype._toJson.call(this,e);return e.name=this.name||n.name,e.address=this.address||n.address,e},t.prototype._fromJson=function(e,t){var r=this;return s.prototype._fromJson.call(this,e,t).then(function(){return r.name=e.name||n.name,r.address=e.address||n.address,i.publish("location.fromJson",e),e})},t}(e,Y),he=function(a,c,i,t,r){function e(){}var s={status:"creating",from:null,to:null,due:null,contact:null,location:null,number:"",items:[],conflicts:[],by:null,archived:null,modified:null,itemSummary:null,name:null};e.prototype=i.prototype;function n(e){e=a.extend({},e),i.call(this,e),this.dsItems=e.dsItems,this.autoCleanup=null!=e.autoCleanup&&e.autoCleanup,this.dateHelper=e.dateHelper||new t,this.helper=e.helper||new r,this.unavailableFlagHelper=e.unavailableFlagHelper||function(e){return!1},this.status=e.status||s.status,this.from=e.from||s.from,this.to=e.to||s.to,this.due=e.due||s.due,this.number=e.number||s.number,this.contact=e.contact||s.contact,this.location=e.location||s.location,this.items=e.items||s.items.slice(),this.conflicts=e.conflicts||s.conflicts.slice(),this.by=e.by||s.by,this.itemSummary=e.itemSummary||s.itemSummary,this.name=e.name||s.name}return(n.prototype=new e).constructor=i,n.prototype.getNow=function(){return this._getDateHelper().getNow()},n.prototype.getNowRounded=function(){return this._getDateHelper().roundTimeFrom(this.getNow())},n.prototype.getNextTimeSlot=function(e){e=e||this.getNowRounded();var t=this._getDateHelper(),r=o(e).add(t.roundMinutes,"minutes");return r.isSame(e)&&(r=r.add(t.roundMinutes,"minutes")),t.getValidBusinessDate(r)},n.prototype.getMinDateFrom=function(){return this.getMinDate()},n.prototype.getMaxDateFrom=function(){return this.getMaxDate()},n.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.getMinDateFrom())},n.prototype.getMaxDateTo=function(){return this.getMaxDate()},n.prototype.getMinDateDue=function(){return this.getMinDateTo()},n.prototype.getMaxDateDue=function(){return this.getMaxDateTo()},n.prototype.getMinDate=function(){return this.getNow()},n.prototype.getMaxDate=function(){var e=this._getDateHelper(),t=e.getNow();return e.roundTimeTo(t).add(2,"years")},n.prototype.suggestEndDate=function(e){var t=this._getDateHelper(),e=t.addAverageDuration(e||t.getNow());return t.roundTimeTo(e)},n.prototype.isEmpty=function(){return i.prototype.isEmpty.call(this)&&this.status==s.status&&("cheqroom.types.order"==this.crtype||this.from==s.from)&&this.to==s.to&&this.due==s.due&&this.number==s.number&&this.contact==s.contact&&this.location==s.location&&0==this.items.length},n.prototype.isDirty=function(){return i.prototype.isDirty.call(this)||this._isDirtyBasic()||this._isDirtyDates()||this._isDirtyLocation()||this._isDirtyContact()||this._isDirtyItems()},n.prototype._isDirtyBasic=function(){if(this.raw){var e=this.raw.status||s.status;return this.status!=e}return!1},n.prototype._isDirtyDates=function(){if(this.raw){var e=this.raw.from||s.from,t=this.raw.to||s.to,r=this.raw.due||s.due;return this.from!=e||this.to!=t||this.due!=r}return!1},n.prototype._isDirtyLocation=function(){if(this.raw){var e=s.location;return this.raw.location&&(e=this.raw.location._id||this.raw.location),this.location!=e}return!1},n.prototype._isDirtyContact=function(){if(this.raw){var e=s.contact;return this.raw.customer&&(e=this.raw.customer._id||this.raw.customer),this.contact!=e}return!1},n.prototype._isDirtyItems=function(){if(this.raw){s.items.slice();return this.raw.items,!1}return!1},n.prototype._getDefaults=function(){return s},n.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return this.location&&(e.location=this._getId(this.location)),this.contact&&(e.customer=this._getId(this.contact)),e},n.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.cover=null,r.status=e.status||s.status,r.number=e.number||s.number,r.location=e.location||s.location,r.contact=e.customer||s.contact,r.items=e.items||s.items.slice(),r.by=e.by||s.by,r.archived=e.archived||s.archived,r.itemSummary=e.itemSummary||s.itemSummary,r.name=e.name||s.name,r.modified=e.modified||s.modified,r._getConflicts().then(function(e){r.conflicts=e})})},n.prototype._toLog=function(e){e=this._toJson(e);e.minDateFrom=this.getMinDateFrom().toJSONDate(),e.maxDateFrom=this.getMaxDateFrom().toJSONDate(),e.minDateDue=this.getMinDateDue().toJSONDate(),e.maxDateDue=this.getMaxDateDue().toJSONDate(),e.minDateTo=this.getMinDateTo().toJSONDate(),e.maxDateTo=this.getMaxDateTo().toJSONDate()},n.prototype._checkFromDateBetweenMinMax=function(e){return this._checkDateBetweenMinMax(e,this.getMinDateFrom(),this.getMaxDateFrom())},n.prototype._checkDueDateBetweenMinMax=function(e){return this._checkDateBetweenMinMax(e,this.getMinDateDue(),this.getMaxDateDue())},n.prototype._checkToDateBetweenMinMax=function(e){return this._checkDateBetweenMinMax(e,this.getMinDateTo(),this.getMaxDateTo())},n.prototype._getUniqueItemIds=function(e){return(e=e||[]).reduce(function(e,t,r,i){return-1==e.indexOf(t)&&e.push(t),e},[])},n.prototype.clearFromDate=function(e){return this.from=s.from,this._handleTransaction(e)},n.prototype.setFromDate=function(e,t){return this.from=this._getDateHelper().roundTimeFrom(e),this._handleTransaction(t)},n.prototype.clearToDate=function(e){return this.to=s.to,this._handleTransaction(e)},n.prototype.setToDate=function(e,t){return this.to=this._getDateHelper().roundTimeTo(e),this._handleTransaction(t)},n.prototype.clearDueDate=function(e){return this.due=s.due,this._handleTransaction(e)},n.prototype.setDueDate=function(e,t){return this.due=this._getDateHelper().roundTimeTo(e),this._handleTransaction(t)},n.prototype.setLabel=function(e,t){var r=this;return(this.existsInDb()?a.Deferred().resolve():this._createTransaction(t)).then(function(){return i.prototype.setLabel.call(r,e,t)})},n.prototype.setLocation=function(e,t){return this.location=e,this.existsInDb()?this._doApiCall({method:"setLocation",params:{location:e},skipRead:t}):this._createTransaction(t)},n.prototype.clearLocation=function(e){var t=this;return this.location=s.location,this._doApiCall({method:"clearLocation",skipRead:e}).then(function(){return t._ensureTransactionDeleted()})},n.prototype.setContact=function(e,t){return this.contact=e,this.existsInDb()?this._doApiCall({method:"setCustomer",params:{customer:e},skipRead:t}):this._createTransaction(t)},n.prototype.clearContact=function(e){var t=this;return this.contact=s.contact,this._doApiCall({method:"clearCustomer",skipRead:e}).then(function(){return t._ensureTransactionDeleted()})},n.prototype.setName=function(e,t){return this._doApiCall({method:"setName",params:{name:e},skipRead:t})},n.prototype.clearName=function(e){return this._doApiCall({method:"clearName",skipRead:e})},n.prototype.addItems=function(e,t){var r=this;return e=r._getUniqueItemIds(e),this._ensureTransactionExists(t).then(function(){return r._doApiCall({method:"addItems",params:{items:e},skipRead:t})})},n.prototype.removeItems=function(e,t){var r=this;return this.existsInDb()?(e=r._getUniqueItemIds(e),this._doApiCall({method:"removeItems",params:{items:e},skipRead:t}).then(function(e){return r._ensureTransactionDeleted().then(function(){return e})})):a.Deferred().reject(new Error("Cannot removeItems from document without id"))},n.prototype.clearItems=function(e){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot clearItems from document without id"));var t=this;return this._doApiCall({method:"clearItems",skipRead:e}).then(function(e){return t._ensureTransactionDeleted().then(function(){return e})})},n.prototype.swapItem=function(e,t,r){return this.existsInDb()?this._doApiCall({method:"swapItem",params:{fromItem:e,toItem:t},skipRead:r}):a.Deferred().reject(new Error("Cannot swapItem from document without id"))},n.prototype.hasItems=function(e){var t=this.items||[],i=[],s=null;return a.each(e,function(e,r){a.each(t,function(e,t){if(t._id==r)return s=r,!1}),null!=s&&i.push(s)}),i},n.prototype.archive=function(e){return this.canArchive()?this._doApiCall({method:"archive",params:{},skipRead:e}):a.Deferred().reject(new Error("Cannot archive document"))},n.prototype.undoArchive=function(e){return this.canUndoArchive()?this._doApiCall({method:"undoArchive",params:{},skipRead:e}):a.Deferred().reject(new Error("Cannot unarchive document"))},n.prototype.canArchive=function(){return null==this.archived&&("cancelled"==this.status||"closed"==this.status||"closed_manually"==this.status)},n.prototype.canUndoArchive=function(){return null!=this.archived&&("cancelled"==this.status||"closed"==this.status||"closed_manually"==this.status)},n.prototype.setField=function(e,t,r){var i=this;return this._ensureTransactionExists(r).then(function(){return i._doApiCall({method:"setField",params:{field:e,value:t},skipRead:r})})},n.prototype._getConflicts=function(){return a.Deferred().resolve([])},n.prototype._getDateHelper=function(){return this.dateHelper},n.prototype._searchItems=function(e,t,r,i,s){if(null==this.dsItems)return a.Deferred().reject(new c.ApiBadRequest(this.crtype+" has no DataSource for items"));e=e||{},this.location&&(e.location=this._getId(this.location)),null!=t&&0<t.length&&(e.listName=t);var n=this,o=null;return s&&s.length&&(o=s.slice(0),a.each(o,function(e,t){o[e]=n._getId(t)})),1==r?(e.onlyUnbooked=null==i||i,e.fromDate=this.from,e.toDate=this.to||this.due,e._limit=e._limit||20,e._skip=e._skip||0,o&&o.length&&(e.skipItems=o),this.dsItems.call(null,"searchAvailable",e)):(o&&o.length&&(e.pk__nin=o),this.dsItems.search(e))},n.prototype._checkDateBetweenMinMax=function(e,t,r){if(t=t||this.getMinDate(),r=r||this.getMaxDate(),e<t||r<e){r="date "+e.toJSONDate()+" is outside of min max range "+t.toJSONDate()+"->"+r.toJSONDate();return a.Deferred().reject(new c.ApiUnprocessableEntity(r))}return a.Deferred().resolve(e)},n.prototype._handleTransaction=function(e){var t=this.isEmpty();return this.existsInDb()?t?this.autoCleanup?this._deleteTransaction():a.Deferred().resolve():this._updateTransaction(e):t?a.Deferred().resolve():this._createTransaction(e)},n.prototype._deleteTransaction=function(){return this.delete()},n.prototype._updateTransaction=function(e){return this.update(e)},n.prototype._createTransaction=function(e){return this.create(e)},n.prototype._ensureTransactionExists=function(e){return this.existsInDb()?a.Deferred().resolve():this._createTransaction(e)},n.prototype._ensureTransactionDeleted=function(){return this.isEmpty()&&this.autoCleanup?this._deleteTransaction():a.Deferred().resolve()},n}(e,t,Y,te,ce),ae=function(d,o,r,s,h,p){function e(){}e.prototype=r.prototype;function t(e){e=d.extend({crtype:"cheqroom.types.order",_fields:["*"]},e),r.call(this,e),this.dsReservations=e.dsReservations}return((t.prototype=new e).constructor=t).prototype.getMinDateFrom=function(){return this.getNowRounded()},t.prototype.getMinDateDue=function(){return"open"==this.status?this.getNextTimeSlot():r.prototype.getMinDateDue.call(this)},t.prototype._toJson=function(e){e=r.prototype._toJson.call(this,e);return e.due=null!=this.due?this.due.toJSONDate():"null",e},t.prototype._fromJson=function(e,t){return this.from=null==e.started||"null"==e.started?this.getMinDateFrom():e.started,this.to=null==e.finished||"null"==e.finished?null:e.finished,this.due=null==e.due||"null"==e.due?null:e.due,this.reservation=e.reservation||null,r.prototype._fromJson.call(this,e,t).then(function(){return d.publish("order.fromJson",e),e})},t.prototype.getDuration=function(){return p.getOrderDuration(this.raw)},t.prototype.getFriendlyDuration=function(){return p.getFriendlyOrderDuration(this.raw,this._getDateHelper())},t.prototype.canGenerateAgreement=function(){return"open"==this.status||"closed"==this.status},t.prototype.canCheckin=function(){return"open"==this.status},t.prototype.canSpotcheck=function(){return p.canOrderSpotcheck(this.raw)},t.prototype.canGoToReservation=function(){return null!=this.reservation},t.prototype.isValidDueDate=function(){var e=this.due,t=this.status,r=this.getNextTimeSlot();this.getMaxDateDue();return"creating"!=t&&"open"!=t||null!=e&&(e.isSame(r)||e.isAfter(r))},t.prototype.canCheckout=function(){var t=this;return"creating"==this.status&&null!=this.location&&null!=this.contact&&"active"==this.contact.status&&this.isValidDueDate()&&this.items&&0<this.items.length&&0<this.items.filter(function(e){return t.id==t.helper.ensureId(e.order)}).length},t.prototype.canCheckoutAgain=function(){return"closed"==this.status&&this.contact&&"active"==this.contact.status&&this.items.filter(function(e){return"available"==e.status}).length==this.items.length},t.prototype.checkoutAgain=function(e){return this._doApiCall({method:"checkoutAgain",params:{},skipRead:e})},t.prototype.canUndoCheckout=function(){return"open"==this.status},t.prototype.canDelete=function(){var t=this;return"creating"==this.status&&this.items.filter(function(e){return e.order&&e.order==t.id}).length==this.items.length},t.prototype.canAddItems=function(){return"creating"==this.status},t.prototype.canRemoveItems=function(){return"creating"==this.status},t.prototype.canRemoveItem=function(e){return"await_checkout"==e.status&&e.order&&e.order==this.id},t.prototype.canSwapItems=function(){return"creating"==this.status},t.prototype.canGenerateDocument=function(){return"open"==this.status||"closed"==this.status},t.prototype.canExtendCheckout=function(e){var t=!0;return("open"!=this.status||e&&e.isBefore(this.getNextTimeSlot()))&&(t=!1),t=this.contact&&"active"!=this.contact.status?!1:t},t.prototype._getConflictsForExtend=function(){var r=[];if("open"==this.status){var i=[],s=this;if(d.each(this.items,function(e,t){"checkedout"==t.status&&t.order==s.id&&i.push(t)}),this.due)return this._getServerConflicts(this.items,this.from,this.due,this.id,this.helper.ensureId(this.reservation)).then(function(e){var t=s.items.filter(function(e){return s.helper.ensureId(e.order)==s.id}).map(function(e){return e._id});return r.concat(e.filter(function(e){return-1!=t.indexOf(e.item)}))})}return d.Deferred().resolve(r)},t.prototype._getConflicts=function(){var r=this,i=[];return"creating"==this.status&&0<this.items.length&&(i=this._getClientConflicts(),this.due)?this._getServerConflicts(this.items,this.from,this.due,this.id,this.helper.ensureId(this.reservation)).then(function(e){var t=r.items.filter(function(e){return r.helper.ensureId(e.order)==r.id}).map(function(e){return e._id});return i.concat(e.filter(function(e){return-1!=t.indexOf(e.item)}))}):d.Deferred().resolve(i)},t.prototype._getServerConflicts=function(r,e,t,i,s){var n,o=this,a=[],c=null,u=p.getItemIds(r.filter(function(e){return e.order==o.id})),l=!(null!=this.contact&&"active"==this.contact.status&&"maintenance"==this.contact.kind);return this.dsItems.call(null,"getAvailabilities",{items:u,fromDate:e,toDate:t}).then(function(e){return d.each(e,function(e,t){if(null!=(c=(c=d.grep(r,function(e){return e._id==t.item}))&&0<c.length?c[0]:c)&&"expired"!=c.status&&"in_custody"!=c.status&&t.order!=i&&t.reservation!=s){if("flag"==(n=(t.order?"order":"")||(t.reservation?"reservation":"")||t.kind)&&!l)return!0;a.push(new h({kind:n,item:c._id,itemName:c.name,fromDate:t.fromDate,toDate:t.toDate,doc:t.order||t.reservation}))}}),a})},t.prototype._getClientConflicts=function(){var r=this,i=[],s=this.helper.ensureId(this.location||""),n=!(null!=this.contact&&"active"==this.contact.status&&"maintenance"==this.contact.kind);return d.each(this.items,function(e,t){return t.order!=r.id||void(r.unavailableFlagHelper(t.flag)&&n?i.push(new h({kind:"flag",item:t._id,flag:t.flag,doc:t.order})):"unavailable_allow"===t.canOrder?i.push(new h({kind:"not_allowed_order",item:t._id,itemName:t.name})):"expired"==t.status?i.push(new h({kind:"expired",item:t._id,itemName:t.name,locationCurrent:t.location,locationDesired:s})):"in_custody"==t.status?i.push(new h({kind:"custody",item:t._id,itemName:t.name,locationCurrent:t.location,locationDesired:s})):s&&t.location!=s&&i.push(new h({kind:"location",item:t._id,itemName:t.name,locationCurrent:t.location,locationDesired:s})))}),i},t.prototype.setFromDueDate=function(e,t,r){if("creating"!=this.status)return d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set order from / due date, status is "+this.status));var i=this,s=this.getMinDateFrom(),n=t?this._getDateHelper().roundTimeTo(t):this._getDateHelper().addAverageDuration(s);return this._checkFromDueDate(s,n).then(function(){return i.from=s,i.due=n,i._handleTransaction(r)})},t.prototype.setFromDate=function(e,t){if("creating"!=this.status)return d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set order from date, status is "+this.status));var r=this,i=this._getDateHelper().roundTimeFrom(e);return this._checkFromDueDate(i,this.due).then(function(){return r.from=i,r._handleTransaction(t)})},t.prototype.clearFromDate=function(e){return"creating"!=this.status?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot clear order from date, status is "+this.status)):(this.from=null,this._handleTransaction(e))},t.prototype.setDueDate=function(e,t){if("creating"!=this.status&&"open"!=this.status)return d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set order due date, status is "+this.status));var r=this,i=this._getDateHelper().roundTimeTo(e);return this.from=this.getMinDateFrom(),this._checkDueDateBetweenMinMax(i).then(function(){return r.due=i,r.existsInDb()?"open"==r.status?r.canExtend(i).then(function(e){return e&&1==e.result?r.extend(i,t):d.Deferred().reject("Cannot extend order to given date because it has conflicts.",e)}):r._doApiCall({method:"setDueDate",params:{due:i},skipRead:t}):r._createTransaction(t)})},t.prototype.clearDueDate=function(e){return"creating"!=this.status?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot clear order due date, status is "+this.status)):(this.due=null,this._doApiCall({method:"clearDueDate",skipRead:e}))},t.prototype.setToDate=function(e,t){throw"Order.setToDate not implemented, it is set during order close"},t.prototype.clearToDate=function(e,t){throw"Order.clearToDate not implemented, it is set during order close"},t.prototype.searchItems=function(e,t,r,i,s){return this._searchItems(e,null!=s?s:"available",t,r,i||this.items)},t.prototype.checkin=function(e,t,r,i){var s=this;return this._doApiCall({method:"checkin",params:{items:e,location:t},skipRead:r}).then(function(e){return e},function(e){if(!i&&e&&422==e.code){if(e.opt&&-1!=e.opt.detail.indexOf("order has status closed"))return s.get();if(e.opt&&-1!=e.opt.detail.indexOf("already checked in or used somewhere else"))return s.get()}return d.Deferred().reject(e)})},t.prototype.checkout=function(e,t){var r=this;return this._doApiCall({method:"checkout",skipRead:e}).then(function(e){return e},function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("order has status open")?r.get():d.Deferred().reject(e)})},t.prototype.undoCheckout=function(e,t){var r=this;return this._doApiCall({method:"undoCheckout",skipRead:e}).then(function(e){return e},function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("order has status creating")?r.get():d.Deferred().reject(e)})},t.prototype.canExtend=function(e){return d.Deferred().resolve({result:this.canExtendCheckout(e)})},t.prototype.extend=function(t,r){var i=this;return this.canExtend(t).then(function(e){return e&&1==e.result?i._doApiCall({method:"extend",params:{due:t},skipRead:r}):d.Deferred().reject("Cannot extend order to given date because it has conflicts.",e)})},t.prototype.generateDocument=function(e,t,r){return this._doApiLongCall({method:"generateDocument",params:{template:e,signature:t},skipRead:r})},t.prototype._fromCommentsJson=function(t,r){var i=this;return i.dsReservations&&t.reservation&&t.reservation.comments&&0<t.reservation.comments.length?s.prototype._fromCommentsJson.call(i,t.reservation,d.extend(r,{ds:i.dsReservations,fromReservation:!0})).then(function(){var e=i.comments;return s.prototype._fromCommentsJson.call(i,t,r).then(function(){i.comments=i.comments.concat(e).sort(function(e,t){return t.modified>e.modified})})}):s.prototype._fromCommentsJson.call(i,t,r)},t.prototype._fromAttachmentsJson=function(t,r){var i=this;return i.dsReservations&&t.reservation&&t.reservation.attachments&&0<t.reservation.attachments.length?s.prototype._fromAttachmentsJson.call(i,t.reservation,d.extend(r,{ds:i.dsReservations,fromReservation:!0})).then(function(){var e=i.attachments;return s.prototype._fromAttachmentsJson.call(i,t,r).then(function(){i.attachments=i.attachments.concat(e).sort(function(e,t){return t.modified>e.modified})})}):s.prototype._fromAttachmentsJson.call(i,t,r)},t.prototype._checkFromDueDate=function(e,t){var i=this._getDateHelper(),s=e,n=t;return s&&n?d.when(this._checkDateBetweenMinMax(s),this._checkDateBetweenMinMax(n)).then(function(e,t){var r=i.roundMinutes;return n.diff(s,"minutes")<r?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set order from date, after (or too close to) to date "+n.toJSONDate())):s.diff(n,"minutes")>r?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set order due date, before (or too close to) from date "+s.toJSONDate())):void 0}):s?this._checkDateBetweenMinMax(s):n?this._checkDateBetweenMinMax(n):d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot from/due date, both are null"))},t}(e,t,he,Y,Q,we),Ue.prototype.canUseItemCustody=function(){return this.limits.allowCustody},Ue.prototype.canUseItemDepreciation=function(){return this.limits.allowDepreciations},Ue.prototype.canUseReporting=function(){return this.limits.allowReporting},Ue.prototype.canUseWebhooks=function(){return this.limits.allowWebhooks},Ue.prototype.canUseUserSync=function(){return this.limits.allowUserSync},Ue.prototype.canUseRestrictLocations=function(){return this.limits.allowRestrictLocations},Ue.prototype.canUseBlockContacts=function(){return this.limits.allowBlockContacts},Ue.prototype.canUseBusinessHours=function(){return this.limits.allowBusinessHours},Ue.prototype.canUseSlack=function(){return this.limits.allowIntegrationSlack},Ue.prototype.canUseSpotcheck=function(){return this.limits.allowSpotcheck},Ue.prototype.canUseCustomRoles=function(){return this.limits.allowCustomRoles},Ue.prototype.canUseSMSNotifications=function(){return this.limits.allowNotificationsSMS},Ue.prototype.canUsePushNotifications=function(){return this.limits.allowNotificationsPush},Ue.prototype.canUseEmailNotifications=function(){return this.limits.allowNotificationsEmail},Ue.prototype.canUseImport=function(){return this.limits.allowImport},Ue.prototype.canUseBookingRestrictions=function(){return this.limits.allowBookingRestrictions},Ue.prototype.canUseExport=function(){return this.limits.allowExport},Ue.prototype.canUsePdf=function(){return this.limits.allowGeneratePdf},Ue.prototype.canUseGeo=function(){return this.limits.allowGeo},Ue.prototype.canUseCheckouts=function(){return this.limits.allowOrders},Ue.prototype.canUseReservations=function(){return this.limits.allowReservations},Ue.prototype.canUseColoredLabels=function(){return this.canUseCheckouts()&&this.canUseReservations()},Ue.prototype.canUseSupportChat=function(){return this.limits.allowSupportChat},Ue.prototype.canUseEquipmentPicking=function(){return this.limits.allowEquipmentPicking},Ue.prototype.canUseLocationBusinessHours=function(){return this.limits.allowLocationBusinessHours},Ue.prototype.canUseClosedDays=function(){return this.limits.allowHolidays},Ue.prototype.hasUpgradePermission=function(){return this.hasAccountPermission("upgrade")},Ue.prototype.hasAnyAdminPermission=function(){return this.hasPermission("create","locations")||this.hasPermission("create","categories")||this.hasPermission("create","webhooks")||this.hasPermission("create","users")||this.hasPermission("create","templates")||this.hasPermission("create","syncs")||this.hasPermission("changePlan","account")||this.hasPermission("create","notifications")||this.hasPermission("update","settings")},Ue.prototype.hasDashboardPermission=function(e,t,r){return this.hasReservationPermission("read")||this.hasCheckoutPermission("read")},Ue.prototype.hasCalendarPermission=function(e,t,r){return this.hasReservationPermission("read")||this.hasCheckoutPermission("read")},Ue.prototype.hasICalPermission=function(){return this._useICal},Ue.prototype.hasEquipmentPicking=function(){return this._useEquipmentPicking},Ue.prototype.hasLocationBusinessHours=function(){return this._useLocationBusinessHours},Ue.prototype.hasClosedDays=function(){return this._useClosedDays},Ue.prototype.hasPublicInventoryPermission=function(){return this._usePublicInventory},Ue.prototype.hasBookingRestrictionsPermission=function(){return this._useBookingRestrictions},Ue.prototype.hasItemPermission=function(e,t,r){return this.hasPermission(e||"read","items",t,r)},Ue.prototype.hasItemCustodyPermission=function(){return this._useCustody},Ue.prototype.hasReleaseCustodyAtLocationPermission=function(){return this._useCustody&&this._useReleaseAtLocation},Ue.prototype.hasItemFlagPermission=function(){return this._useFlags},Ue.prototype.hasItemGeoPermission=function(){return this._useGeo},Ue.prototype.hasItemDepreciationPermission=function(){return this._useDepreciations&&this.hasItemPermission("getDepreciation")},Ue.prototype.hasUserSyncPermission=function(){return this.hasAccountUserSyncPermission("read")},Ue.prototype.hasSelfservicePermission=function(){return this._useSelfService},Ue.prototype.hasReportingPermission=function(){return this._useReporting&&-1!=this.permissions.indexOf("ACCOUNT_REPORTER")},Ue.prototype.hasExportPermission=function(){return this._useExport},Ue.prototype.hasImportPermission=function(){return this._useImport},Ue.prototype.hasLabelPermission=function(){return this.hasCheckoutPermission("setLabel")},Ue.prototype.hasSlackPermission=function(){return this._useSlack},Ue.prototype.hasSSOPermission=function(){return this._useSSO},Ue.prototype.hasApiPermission=function(){return this._useApi},Ue.prototype.hasSpotcheckPermission=function(e,t,r){return this.hasPermission(e||"read","spotchecks",t,r)},Ue.prototype.hasKitPermission=function(e,t,r){return this.hasPermission(e||"read","kits",t,r)},Ue.prototype.hasContactPermission=function(e,t,r){return this.hasPermission(e||"read","contacts",t,r)},Ue.prototype.hasContactReadOtherPermission=function(e,t,r){return-1!=this.permissions.indexOf("CUSTOMERS_READER")},Ue.prototype.hasBlockContactsPermission=function(e,t,r){return this._useBlockContacts},Ue.prototype.hasCheckoutPermission=function(e,t,r){return this.hasPermission(e||"read","orders",t,r)},Ue.prototype.hasReservationPermission=function(e,t,r){return this.hasPermission(e||"read","reservations",t,r)},Ue.prototype.hasCategoriesPermission=function(e,t,r){return this.hasPermission(e,"categories",t,r)},Ue.prototype.hasNotificationPermission=function(e,t,r){return this.hasPermission(e,"notifications",t,r)},Ue.prototype.hasUserPermission=function(e,t,r){return this.hasPermission(e,"users",t,r)},Ue.prototype.hasLocationPermission=function(e,t,r){return this.hasPermission(e,"locations",t,r)},Ue.prototype.hasRestrictLocationPermission=function(){return this._useRestrictLocations},Ue.prototype.hasWebhookPermission=function(e,t,r){return this.hasPermission(e,"webhooks",t,r)},Ue.prototype.hasAccountPermission=function(e,t,r){return this.hasPermission(e,"account",t,r)},Ue.prototype.hasAccountInvoicesPermission=function(e,t,r){return this.hasPermission(e,"invoices",t,r)},Ue.prototype.hasAccountSubscriptionPermission=function(e,t,r){return this.hasPermission(e,"subscription",t,r)},Ue.prototype.hasAccountBillingPermission=function(e,t,r){return this.hasPermission(e,"billing",t,r)},Ue.prototype.hasAccountTemplatePermission=function(e,t,r){return this.hasPermission(e,"templates",t,r)},Ue.prototype.hasAccountUserSyncPermission=function(e,t,r){return this.hasPermission(e,"syncs",t,r)},Ue.prototype.hasAssetTagsPermission=function(e,t,r){return this.hasAnyAdminPermission()},Ue.prototype.hasIntegrationsPermission=function(){return this.hasWebhookPermission("read")||this.hasSlackPermission()||this.hasApiPermission()||this.hasPublicInventoryPermission()||this.hasSSOPermission()},Ue.prototype.hasPermission=function(e,t,r,i){r=r||{};function s(t){return n.some(function(e){return t.includes(e)})}var n=this.permissions;switch(t){default:return!1;case"items":switch(e){default:return!1;case"read":case"get":case"getAvailabilities":case"getAvailability":case"getByCode":case"getChangeLog":case"getConflicts":case"getImage":case"getLastItemNumber":case"getMultiple":case"getSummary":case"getTransactions":case"list":case"scannedCodeOn":case"search":case"searchAvailable":return s(["ITEMS_READER","ITEMS_READER_RESTRICTED"]);case"create":case"createMultiple":case"duplicate":case"update":case"delete":case"deleteMultiple":case"canDelete":case"changeCategory":case"canChangeCategory":case"getDepreciation":case"updatePermissions":case"addBarcode":case"removeBarcode":case"addCodes":case"removeCodes":case"clearCatalog":case"clearCover":case"expire":case"undoExpire":case"setFields":case"setField":case"clearField":case"setAllowedActions":case"setCatalog":case"setCover":return s(["ITEMS_ADMIN","ITEMS_ADMIN_RESTRICTED"]);case"changeLocation":return s(["ITEMS_LOCATION_ADMIN_RESTRICTED"]);case"updateGeo":return this._useGeo&&s(["ITEMS_GEO_ADMIN","ITEMS_GEO_ADMIN_RESTRICTED"]);case"attach":case"addAttachment":return s(["ITEMS_ATTACHMENTS_OWN_WRITER"]);case"detach":case"removeAttachment":return s(["ITEMS_ATTACHMENTS_DELETER"])||r.own&&s(["ITEMS_ATTACHMENTS_OWN_DELETER"]);case"import":case"importAnalyze":case"importSample":case"importSpreadsheet":case"importValidate":return this._useImport&&s(["ITEMS_IMPORTER","ITEMS_IMPORTER_RESTRICTED"]);case"export":return this._useExport&&s(["ITEMS_EXPORTER","ITEMS_EXPORTER_RESTRICTED"]);case"addComment":return s(["ITEMS_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&s(["ITEMS_COMMENTS_OWN_WRITER"]);case"removeComment":return s(["ITEMS_COMMENTS_DELETER"])||r.own&&s(["ITEMS_COMMENTS_OWN_DELETER"]);case"printLabel":return s(["ITEMS_LABEL_PRINTER","ITEMS_LABEL_PRINTER_RESTRICTED"]);case"setFlag":return this._useFlags&&s(["ITEMS_FLAGGER","ITEMS_FLAGGER_RESTRICTED"]);case"clearFlag":return this._useFlags&&s(["ITEMS_UNFLAGGER","ITEMS_UNFLAGGER_RESTRICTED"]);case"reserve":return this.hasReservationPermission("create");case"checkout":return this.hasCheckoutPermission("create");case"seeOwnCustody":return this._useCustody&&s(["ITEMS_CUSTODY_OWN_READER"]);case"takeCustody":return this._useCustody&&(s(["ITEMS_CUSTODY_TAKER"])||!1!==r.restrict&&s(["ITEMS_CUSTODY_TAKER_RESTRICTED"]));case"releaseCustody":return this._useCustody&&(s(["ITEMS_CUSTODY_RELEASER","ITEMS_CUSTODY_RELEASER_RESTRICTED"])||r.own&&s(["ITEMS_CUSTODY_OWN_RELEASER"]));case"transferCustody":return this._useCustody&&(s(["ITEMS_CUSTODY_TRANSFERER"])||!1!==r.restrict&&s(["ITEMS_CUSTODY_TRANSFERER_RESTRICTED"])||r.own&&s(["ITEMS_CUSTODY_OWN_TRANSFERER"]));case"giveCustody":return this.hasContactReadOtherPermission()&&this.hasItemPermission("takeCustody",r)&&this.hasItemPermission("transferCustody",r);case"releaseCustodyAt":return this.hasItemPermission("releaseCustody",r)&&this._useReleaseAtLocation;case"getReport":return s(["ITEMS_REPORTER","ITEMS_REPORTER_RESTRICTED"])}break;case"kits":if(!this._useKits)return!1;switch(e){default:return!1;case"read":return s(["KITS_READER","KITS_READER_RESTRICTED"]);case"create":case"duplicate":case"update":case"delete":case"setFields":case"setField":case"clearField":case"addItems":case"removeItems":case"moveItem":case"setCover":return s(["KITS_ADMIN","KITS_ADMIN_RESTRICTED"]);case"attach":case"addAttachment":return s(["KITS_ATTACHMENTS_OWN_WRITER"]);case"detach":case"removeAttachment":return s(["KITS_ATTACHMENTS_DELETER"])||r.own&&s(["KITS_ATTACHMENTS_OWN_DELETER"]);case"addComment":return s(["KITS_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&s(["KITS_COMMENTS_OWN_WRITER"]);case"removeComment":return s(["KITS_COMMENTS_DELETER"])||r.own&&s(["KITS_COMMENTS_OWN_DELETER"]);case"updatePermissions":return s(["KITS_ADMIN","KITS_ADMIN_RESTRICTED"]);case"import":return this._useImport&&s(["KITS_IMPORTER","KITS_IMPORTER_RESTRICTED"]);case"export":return this._useExport&&s(["KITS_EXPORTER","KITS_EXPORTER_RESTRICTED"]);case"printLabel":return s(["KITS_LABEL_PRINTER","KITS_LABEL_PRINTER_RESTRICTED"]);case"takeApart":return this.hasReservationPermission("create")||this.hasCheckoutPermission("create");case"reserve":return this.hasReservationPermission("create");case"checkout":return this.hasCheckoutPermission("create");case"seeOwnCustody":return this.hasItemPermission("seeOwnCustody",r);case"takeCustody":return this.hasItemPermission("takeCustody",r);case"releaseCustody":return this.hasItemPermission("releaseCustody",r);case"transferCustody":return this.hasItemPermission("transferCustody",r);case"giveCustody":return this.hasItemPermission("giveCustody",r);case"releaseCustodyAt":return this.hasItemPermission("releaseCustody",r);case"getReport":return this.hasItemPermission("getReport")}break;case"orders":case"checkouts":if(!this._useOrders)return!1;switch(e){default:return!1;case"create":return this.hasCheckoutPermission("update",{own:!0});case"update":case"delete":case"setCustomer":case"clearCustomer":case"setLocation":case"clearLocation":case"addItems":case"removeItems":case"swapItems":case"undoCheckout":case"checkout":case"checkin":case"setFields":case"setField":case"clearField":case"checkoutAgain":return s(["ORDERS_WRITER","ORDERS_WRITER_RESTRICTED"])||r.own&&s(["ORDERS_OWN_WRITER"]);case"extend":return s(["ORDERS_EXTENDER_RESTRICTED"])||r.own&&s(["ORDERS_OWN_EXTENDER"]);case"read":return this.hasCheckoutPermission("readAll")||s(["ORDERS_OWN_READER"]);case"readAll":return s(["ORDERS_READER","ORDERS_READER_RESTRICTED"]);case"attach":case"addAttachment":return s(["ORDERS_ATTACHMENTS_OWN_WRITER"])||r.own&&s(["ORDERS_OWN_ATTACHMENTS_OWN_WRITER"]);case"detach":case"removeAttachment":return s(["ORDERS_ATTACHMENTS_DELETER"])||r.own&&s(["ORDERS_ATTACHMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&s(["ORDERS_OWN_ATTACHMENTS_OWN_DELETER"]);case"addComment":return s(["ORDERS_COMMENTS_OWN_WRITER"])||r.own&&s(["ORDERS_OWN_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&s(["ORDERS_COMMENTS_OWN_WRITER"])||r.own&&r.ownDoc&&s(["ORDERS_OWN_COMMENTS_OWN_WRITER"]);case"removeComment":return s(["ORDERS_COMMENTS_DELETER"])||r.own&&s(["ORDERS_COMMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&s(["ORDERS_OWN_COMMENTS_OWN_DELETER"]);case"setLabel":case"clearLabel":return s(["ORDERS_LABELER","ORDERS_LABELER_RESTRICTED"])||r.own&&s(["ORDERS_OWN_LABELER"]);case"export":return this._useExport&&s(["ORDERS_EXPORTER","ORDERS_EXPORTER_RESTRICTED"]);case"archive":case"undoArchive":return s(["ORDERS_ARCHIVER","ORDERS_ARCHIVER_RESTRICTED"])||r.own&&s(["ORDERS_OWN_ARCHIVER"]);case"generateDocument":return this._usePdf&&(s(["ORDERS_DOCUMENT_GENERATOR","ORDERS_DOCUMENT_GENERATOR_RESTRICTED"])||r.own&&s(["ORDERS_OWN_DOCUMENT_GENERATOR"]));case"checkinAt":return this._useCheckinLocation&&this.hasCheckoutPermission("checkin",r);case"forceCheckListCheckin":return this.profile.forceCheckListCheckin&&this.hasCheckoutPermission("checkin",r);case"ignoreConflicts":return s(["ORDERS_CONFLICT_CREATOR"]);case"getReport":return s(["ORDERS_REPORTER","ORDERS_REPORTER_RESTRICTED","ORDERS_OWN_REPORTER"])}break;case"reservations":if(!this._useReservations)return!1;switch(e){default:return!1;case"create":return this.hasReservationPermission("update",{own:!0});case"update":case"delete":return s(["RESERVATIONS_WRITER","RESERVATIONS_WRITER_RESTRICTED"])||r.own&&s(["RESERVATIONS_OWN_WRITER"]);case"search":case"list":case"read":return this.hasReservationPermission("readAll")||s(["RESERVATIONS_OWN_READER"]);case"readAll":return s(["RESERVATIONS_READER","RESERVATIONS_READER_RESTRICTED"]);case"setCustomer":case"clearCustomer":case"setFromToDate":case"setLocation":case"clearLocation":case"addItems":case"removeItems":case"swapItems":case"reserve":case"undoReserve":case"reserveAgain":case"setFields":case"setField":case"clearField":return this.hasReservationPermission("update",r);case"reserveRepeat":return this._useRepeatReservations&&this.hasReservationPermission("update",r);case"attach":case"addAttachment":return s(["RESERVATIONS_ATTACHMENTS_OWN_WRITER"])||r.own&&s(["RESERVATIONS_OWN_ATTACHMENTS_OWN_WRITER"]);case"detach":case"removeAttachment":return s(["RESERVATIONS_ATTACHMENTS_DELETER"])||r.own&&s(["RESERVATIONS_ATTACHMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&s(["RESERVATIONS_OWN_ATTACHMENTS_OWN_DELETER"]);case"addComment":return s(["RESERVATIONS_COMMENTS_OWN_WRITER"])||r.own&&s(["RESERVATIONS_OWN_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&s(["RESERVATIONS_COMMENTS_OWN_WRITER"])||r.own&&r.ownDoc&&s(["RESERVATIONS_OWN_COMMENTS_OWN_WRITER"]);case"removeComment":return s(["RESERVATIONS_COMMENTS_DELETER"])||r.own&&s(["RESERVATIONS_COMMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&s(["RESERVATIONS_OWN_COMMENTS_OWN_DELETER"]);case"export":return this._useExport&&s(["RESERVATIONS_EXPORTER","RESERVATIONS_EXPORTER_RESTRICTED"]);case"switchToOrder":case"makeOrder":return this.hasCheckoutPermission("create",r);case"cancel":case"undoCancel":return s(["RESERVATIONS_CANCELER","RESERVATIONS_CANCELER_RESTRICTED"])||r.own&&s(["RESERVATIONS_OWN_CANCELER"]);case"archive":case"undoArchive":return s(["RESERVATIONS_ARCHIVER","RESERVATIONS_ARCHIVER_RESTRICTED"])||r.own&&s(["RESERVATIONS_OWN_ARCHIVER"]);case"generateDocument":return this._usePdf&&s(["RESERVATIONS_DOCUMENT_GENERATOR","RESERVATIONS_DOCUMENT_GENERATOR_RESTRICTED","RESERVATIONS_OWN_DOCUMENT_GENERATOR"]);case"ignoreConflicts":return s(["RESERVATIONS_CONFLICT_CREATOR"]);case"close":case"undoClose":return this._useReservationsClose&&(s(["RESERVATIONS_CLOSER","RESERVATIONS_CLOSER_RESTRICTED"])||r.own&&s(["RESERVATIONS_OWN_CLOSER"]));case"getReport":return s(["RESERVATIONS_REPORTER","RESERVATIONS_REPORTER_RESTRICTED","RESERVATIONS_OWN_REPORTER"]);case"setLabel":case"clearLabel":return s(["RESERVATIONS_LABELER","RESERVATIONS_LABELER_RESTRICTED"])||r.own&&s(["RESERVATIONS_OWN_LABELER"])}break;case"customers":case"contacts":switch(e){default:return!1;case"read":case"get":case"list":case"search":return s(["CUSTOMERS_READER"]);case"create":case"update":case"delete":case"archive":case"undoArchive":case"setFields":case"setField":case"clearField":case"setCover":return s(["CUSTOMERS_ADMIN"]);case"attach":case"addAttachment":return s(["CUSTOMERS_ATTACHMENTS_OWN_WRITER","CUSTOMERS_ATTACHMENTS_WRITER"]);case"detach":case"removeAttachment":return s(["CUSTOMERS_ATTACHMENTS_DELETER"])||r.own&&s(["CUSTOMERS_OWN_ATTACHMENTS_OWN_DELETER","CUSTOMERS_ATTACHMENTS_OWN_DELETER"]);case"printLabel":return s(["CUSTOMERS_LABEL_PRINTER","CUSTOMERS_LABEL_PRINTER_RESTRICTED"]);case"addComment":return s(["CUSTOMERS_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&s(["CUSTOMERS_COMMENTS_OWN_WRITER"]);case"removeComment":return s(["CUSTOMERS_COMMENTS_DELETER"])||r.own&&s(["CUSTOMERS_OWN_COMMENTS_OWN_DELETER"]);case"import":case"importAnalyze":case"importSpreadsheet":case"importSample":case"importValidate":return this._useImport&&s(["CUSTOMERS_IMPORTER"]);case"export":return this._useExport&&s(["CUSTOMERS_EXPORTER"]);case"generateDocument":return this._usePdf&&s(["CUSTOMERS_DOCUMENT_GENERATOR","CUSTOMERS_OWN_DOCUMENT_GENERATOR"]);case"block":case"undoBlock":return this._useBlockContacts&&s(["CUSTOMERS_BLOCK_ADMIN"]);case"getReport":return s(["CUSTOMERS_REPORTER"]);case"changeKind":return s(["CUSTOMERS_MAINTENANCE_ADMIN"])}break;case"users":switch(e){default:return!1;case"read":return s(["USERS_READER"]);case"update":case"updateProfile":case"activate":case"deactivate":case"archive":case"undoArchive":return s(["USERS_OWN_PROFILE_ADMIN","USERS_PROFILE_ADMIN","USERS_ADMIN"]);case"updatePassword":return s(["USERS_OWN_PASSWORD_ADMIN"]);case"create":case"delete":case"linkNewCustomer":case"linkCustomer":case"unLinkCustomer":case"inviteUser":case"clearSync":case"restrictLocations":case"referFriend":return s(["USERS_ADMIN"]);case"changeAccountOwner":return this._isOwner;case"getReport":return s(["USERS_REPORTER","USERS_OWN_REPORTER"]);case"addRole":case"deleteRole":case"editRole":return this._useCustomRoles&&s(["USERS_ADMIN"])}break;case"categories":switch(e){default:return!1;case"read":return s(["CATEGORIES_READER"]);case"create":case"update":case"delete":return s(["CATEGORIES_ADMIN"])}case"locations":switch(e){default:return!1;case"read":return s(["LOCATIONS_READER","LOCATIONS_READER_RESTRICTED"]);case"create":case"update":case"delete":case"archive":return s(["LOCATIONS_ADMIN"])}break;case"syncs":if(!this._useUserSync)return!1;switch(e){default:return!1;case"read":return s(["USER_SYNCS_READER"]);case"create":case"update":case"delete":case"clone":case"testConnection":case"syncUsers":return s(["USER_SYNCS_ADMIN"])}break;case"notifications":if(!this._useNotifications)return!1;switch(e){default:return!1;case"read":return s(["NOTIFICATIONS_READER"]);case"create":case"update":case"delete":return s(["NOTIFICATIONS_ADMIN"])}break;case"webhooks":if(!this._useWebhooks)return!1;switch(e){default:return s(["WEBHOOKS_READER"]);case"read":case"create":case"update":case"delete":return s(["WEBHOOKS_ADMIN"])}break;case"account":case"subscription":case"invoices":case"billing":switch(e){default:return s(["ACCOUNT_SUBSCRIPTIONS_READER","ACCOUNT_BILLING_READER"]);case"reset":case"changePlan":case"upgrade":return s(["ACCOUNT_SUBSCRIPTIONS_ADMIN","ACCOUNT_BILLING_ADMIN"]);case"cancelPlan":return this._isOwner}break;case"templates":switch(e){default:return!1;case"read":return s(["TEMPLATES_READER"]);case"create":case"update":case"delete":case"archive":case"undoArchive":case"activate":case"deactivate":case"clone":return s(["TEMPLATES_ADMIN"])}break;case"settings":switch(e){default:return!1;case"read":return s(["ACCOUNT_SETTINGS_READER"]);case"update":return s(["ACCOUNT_SETTINGS_ADMIN"])}case"spotchecks":if(!this._useSpotcheck)return!1;switch(e){case"readAll":return s(["SPOTCHECKS_READER"]);case"read":return s(["SPOTCHECKS_READER"])||s(["SPOTCHECKS_READER_OWN"]);case"delete":return s(["SPOTCHECKS_DELETER"])||r.own&&s(["SPOTCHECKS_DELETER_OWN"]);case"addAttachment":return s(["SPOTCHECKS_ATTACHMENTS_OWN_WRITER"])||r.own&&s(["SPOTCHECKS_OWN_ATTACHMENTS_OWN_WRITER"]);case"removeAttachment":return s(["SPOTCHECKS_ATTACHMENTS_DELETER"])||r.own&&s(["SPOTCHECKS_ATTACHMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&s(["SPOTCHECKS_OWN_ATTACHMENTS_OWN_DELETER"]);case"addComment":return s(["SPOTCHECKS_COMMENTS_OWN_WRITER"])||r.own&&s(["SPOTCHECKS_OWN_COMMENTS_OWN_WRITER"]);case"updateComment":return r.own&&r.ownDoc&&s(["SPOTCHECKS_OWN_COMMENTS_OWN_WRITER"])||r.own&&s(["SPOTCHECKS_COMMENTS_OWN_WRITER"]);case"removeComment":return s(["SPOTCHECKS_COMMENTS_DELETER"])||r.own&&s(["SPOTCHECKS_COMMENTS_OWN_DELETER"])||r.own&&r.ownDoc&&s(["SPOTCHECKS_OWN_COMMENTS_OWN_DELETER"]);case"archive":case"create":return s(["SPOTCHECKS_WRITER"])||s(["SPOTCHECKS_WRITER_OWN"]);case"update":return s(["SPOTCHECKS_WRITER"])||r.own&&s(["SPOTCHECKS_WRITER_OWN"])}}},ue=Ue,le=function(d,o,i,h,n,e){function t(){}t.prototype=i.prototype;function r(e){e=d.extend({crtype:"cheqroom.types.reservation",_fields:["*"]},e),i.call(this,e),this.conflicts=[],this.order=null}return((r.prototype=new t).constructor=r).prototype.getMinDateFrom=function(){return this.getNextTimeSlot()},r.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.from&&this.from.isBefore(this.getNowRounded())?null:this.from)},r.prototype.getDuration=function(){return e.getReservationDuration(this.raw)},r.prototype.getFriendlyDuration=function(){return e.getFriendlyReservationDuration(this.raw,this._getDateHelper())},r.prototype.isValidFromDate=function(){var e=this.from,t=this.status,r=this.getNow();return"creating"!=t&&"open"!=t||null!=e&&e.isAfter(r)},r.prototype.isValidToDate=function(){var e=this.from,t=this.to,r=this.status,i=this.getNow();return"creating"!=r&&"open"!=r||null!=t&&t.isAfter(e)&&t.isAfter(i)},r.prototype.canSpotcheck=function(){return e.canReservationSpotcheck(this.raw)},r.prototype.canReserve=function(){return"creating"==this.status&&this.location&&this.contact&&"active"==this.contact.status&&this.isValidFromDate()&&this.isValidToDate()&&this.items&&this.items.length},r.prototype.canUndoReserve=function(){return"open"==this.status},r.prototype.canCancel=function(){return"open"==this.status},r.prototype.canClose=function(){return"open"==this.status},r.prototype.canUndoClose=function(){return"closed_manually"==this.status&&this.contact&&"active"==this.contact.status},r.prototype.canEdit=function(){return"creating"==this.status},r.prototype.canDelete=function(){return"creating"==this.status},r.prototype.canAddItems=function(){return"creating"==this.status},r.prototype.canRemoveItems=function(){return"creating"==this.status},r.prototype.canSwapItems=function(){return"creating"==this.status||"open"==this.status},r.prototype.canMakeOrder=function(){if("open"==this.status&&this.contact&&"active"==this.contact.status&&null!=this.to&&this.to.isAfter(this.getNow())){var e=this._getUnavailableItems();return 0==d.map(e,function(e,t){return t}).length}return!1},r.prototype.canGoToOrder=function(){return null!=this.order},r.prototype.canReserveRepeat=function(){return("open"==this.status||"closed"==this.status||"closed_manually"==this.status)&&this.contact&&"active"==this.contact.status},r.prototype.canGenerateDocument=function(){return"open"==this.status||"closed"==this.status},r.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.fromDate=null!=this.from?this.from.toJSONDate():"null",e.toDate=null!=this.to?this.to.toJSONDate():"null",e},r.prototype._fromJson=function(e,t){var r=this;return r.from=null==e.fromDate||"null"==e.fromDate?null:e.fromDate,r.to=null==e.toDate||"null"==e.toDate?null:e.toDate,r.due=null,r.order=e.order||null,r.repeatId=e.repeatId||null,r.repeatFrequency=e.repeatFrequency||"",i.prototype._fromJson.call(this,e,t).then(function(){return d.publish("reservation.fromJson",e),e})},r.prototype.visibleConflicts=function(e,t){if(0==e.length||!this.from)return e;var r=this.from,i=this.to,s=n();return t||null!=r&&null!=i&&(s.isBetween(r,i)||r.isBefore(s)||i.isBefore(s))?e:e.filter(function(e){return"order"!=e.kind||"order"==e.kind&&null!=r&&null!=i&&e.fromDate&&e.toDate&&(r.isBetween(e.fromDate,e.toDate,null,"[]")||i.isBetween(e.fromDate,e.toDate,null,"[]"))})},r.prototype._getConflicts=function(){var s=this,n=[],o=null;if(-1!=["creating","open"].indexOf(this.status)&&this.items&&this.items.length&&(this.location||this.from&&this.to||this.items.filter(function(e){return"available"!==e.canReserve}))){var a=this.location?this._getId(this.location):null,c=this.from&&this.to&&"open"==this.status,u=null!=a,l=!(null!=this.contact&&"active"==this.contact.status&&"maintenance"==this.contact.kind);return this.ds.call(this.id,"getConflicts").then(function(i){return i=i||[],d.each(s.items,function(e,t){if(o=(o=i.find(function(e){return e.item==t._id}))&&"flag"==o.kind&&!l?null:o){var r;if("flag"==(r=(r=(r=o.kind||"")||(o.order?"order":""))||(o.reservation?"reservation":""))&&!l)return!0;n.push(new h({kind:r,item:t._id,itemName:t.name,doc:o.conflictsWith,fromDate:o.fromDate,toDate:o.toDate,locationCurrent:o.locationCurrent,locationDesired:o.locationDesired}))}else l&&s.unavailableFlagHelper(t.flag)?n.push(new h({kind:"flag",item:t._id,flag:t.flag,doc:t.order})):"unavailable_allow"==t.canReserve?n.push(new h({kind:"not_allowed_reservation",item:t._id,itemName:t.name})):"open"==s.status&&"unavailable_allow"==t.canOrder?n.push(new h({kind:"not_allowed_order",item:t._id,itemName:t.name})):"expired"==t.status?n.push(new h({kind:"expired",item:t._id,itemName:t.name,doc:t.order})):"in_custody"==t.status?n.push(new h({kind:"custody",item:t._id,itemName:t.name,doc:t.order})):c&&"available"!=t.status?n.push(new h({kind:"order",item:t._id,itemName:t.name,doc:t.order})):u&&t.location!=a&&n.push(new h({kind:"location",item:t._id,itemName:t.name,locationCurrent:t.location,locationDesired:a,doc:t.order}))}),n})}return d.Deferred().resolve(n)},r.prototype.setFromToDate=function(e,t,r){if("creating"!=this.status)return d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set reservation from / to date, status is "+this.status));var i=this,s=this._getDateHelper().roundTimeFrom(e),n=t?this._getDateHelper().roundTimeTo(t):this._getDateHelper().addAverageDuration(s);return this._checkFromToDate(s,n).then(function(){return i.from=s,i.to=n,i._doApiCall({method:"setFromToDate",params:{fromDate:s,toDate:n},skipRead:r})})},r.prototype.setFromDate=function(e,t){if("creating"!=this.status)return d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set reservation from date, status is "+this.status));var r=this,i=this._getDateHelper(),s=i.roundMinutes,n=i.roundTimeFrom(e);return this._checkFromDateBetweenMinMax(n).then(function(){return r.to&&r.to.diff(n,"minutes")<s?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set reservation from date, after (or too close to) to date "+r.to.toJSONDate())):(r.from=n,r.existsInDb()?r._doApiCall({method:"setFromDate",params:{fromDate:n},skipRead:t}):r._createTransaction(t))})},r.prototype.clearFromDate=function(e){return"creating"!=this.status?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot clear reservation from date, status is "+this.status)):(this.from=null,this._doApiCall({method:"clearFromDate",skipRead:e}))},r.prototype.setToDate=function(e,t){if("creating"!=this.status)return d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set reservation to date, status is "+this.status));var r=this,i=this._getDateHelper(),s=i.roundMinutes,n=i.roundTimeTo(e);return this._checkToDateBetweenMinMax(n).then(function(){return r.from&&r.from.diff(n,"minutes")>s?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set reservation to date, before (or too close to) to date "+r.from.toJSONDate())):(r.to=n,r.existsInDb()?r._doApiCall({method:"setToDate",params:{toDate:n},skipRead:t}):r._createTransaction(t))})},r.prototype.clearToDate=function(e){return"creating"!=this.status?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot clear reservation to date, status is "+this.status)):(this.to=null,this._doApiCall({method:"clearToDate",skipRead:e}))},r.prototype.clearDueDate=function(e){throw"Reservation.clearDueDate not implemented"},r.prototype.setDueDate=function(e,t){throw"Reservation.setDueDate not implemented"},r.prototype.searchItems=function(e,t,r,i){return this._searchItems(e,null,!0,r,i||this.items)},r.prototype.reserve=function(e,t){var r=this;return this._doApiCall({method:"reserve",skipRead:e}).then(function(e){return e},function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status open")?r.get():d.Deferred().reject(e)})},r.prototype.undoReserve=function(e,t){var r=this;return this._doApiCall({method:"undoReserve",skipRead:e}).then(function(e){return e},function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status creating")?r.get():d.Deferred().reject(e)})},r.prototype.cancel=function(e,t,r){var i=this;return this._doApiCall({method:"cancel",params:{message:e||""},skipRead:t}).then(function(e){return e},function(e){return!r&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status cancelled")?i.get():d.Deferred().reject(e)})},r.prototype.cancelRepeat=function(e,t,r){var i=this;return this._doApiCall({method:"cancelRepeat",params:{message:e||""},skipRead:t}).then(function(e){return e},function(e){return!r&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status cancelled")?i.get():d.Deferred().reject(e)})},r.prototype.close=function(e,t,r){var i=this;return this._doApiCall({method:"close",params:{message:e||""},skipRead:t}).then(function(e){return e},function(e){return!r&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status closed_manually")?i.get():d.Deferred().reject(e)})},r.prototype.undoClose=function(e,t){var r=this;return this._doApiCall({method:"undoClose",skipRead:e}).then(function(e){return e},function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status open")?r.get():d.Deferred().reject(e)})},r.prototype.makeOrder=function(t){var r=this;return this._doApiCall({method:"makeOrder",skipRead:!0}).then(function(e){return e},function(e){return!t&&e&&422==e.code&&e.opt&&-1!=e.opt.detail.indexOf("reservation has status closed")?r.get().then(function(e){return{_id:r._getId(e.order)}}):d.Deferred().reject(e)})},r.prototype.switchToOrder=function(){return this._doApiCall({method:"switchToOrder",skipRead:!0})},r.prototype.generateDocument=function(e,t,r){return this._doApiLongCall({method:"generateDocument",params:{template:e,signature:t},skipRead:r})},r.prototype.canReserveAgain=function(){return this._doApiLongCall({method:"canReserveAgain",params:{_fields:"null"},skipRead:!0})},r.prototype.reserveAgain=function(e,t){return this._doApiLongCall({method:"reserveAgain",params:e,skipRead:t})},r.prototype.reserveRepeat=function(e,t,r,i){return this._doApiLongCall({method:"reserveRepeat",params:{frequency:e,until:t,customer:r,location:i},skipRead:!0})},r.prototype._checkFromToDate=function(e,t){var i=this._getDateHelper(),s=e,n=t;return s&&n?d.when(this._checkFromDateBetweenMinMax(s),this._checkToDateBetweenMinMax(n)).then(function(e,t){var r=i.roundMinutes;return n.diff(s,"minutes")<r?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set order from date, after (or too close to) to date "+n.toJSONDate())):s.diff(n,"minutes")>r?d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot set order due date, before (or too close to) from date "+s.toJSONDate())):void 0}):s?this._checkFromDateBetweenMinMax(s):n?this._checkToDateBetweenMinMax(n):d.Deferred().reject(new o.ApiUnprocessableEntity("Cannot from/due date, both are null"))},r.prototype._getUnavailableItems=function(){var r={};return"open"==this.status&&this.location&&null!=this.items&&0<this.items.length&&(this._getId(this.location),d.each(this.items,function(e,t){"available"!=t.status&&(r.status=r.status||[],r.status.push(t._id))})),r},r}(e,t,he,Q,o,we),de=function(t,e,i){function r(){}var s={id:"",status:"inactive",name:"",body:"",format:"",kind:"",width:0,height:0,unit:"inch",askSignature:!1,system:!0,archived:null,createdBy:null,createdOn:null,modifiedBy:null,modifiedOn:null};r.prototype=i.prototype;function n(e){e=t.extend({},e),i.call(this,e),this.name=e.name||s.name,this.status=e.status||s.status,this.body=e.body||s.body,this.format=e.format||s.format,this.kind=e.kind||s.kind,this.askSignature=null!=e.askSignature?1==e.askSignature:s.askSignature,this.width=e.width||s.width,this.height=e.height||s.height,this.unit=e.unit||s.unit,this.system=null!=e.system?1==e.system:s.system,this.archived=e.archived||s.archived,this.createdBy=e.createdBy||s.createdBy,this.createdOn=e.createdOn||s.createdOn,this.modifiedBy=e.modifiedBy||s.modifiedBy,this.modifiedOn=e.modifiedOn||s.modifiedOn}return((n.prototype=new r).constructor=n).prototype.isValidName=function(){return this.name=t.trim(this.name),3<=this.name.length},n.prototype.isValid=function(){return this.isValidName()},n.prototype._getDefaults=function(){return s},n.prototype.isEmpty=function(){return i.prototype.isEmpty.call(this)&&this.name==s.name},n.prototype.isArchived=function(){return e.templateIsArchived(this)},n.prototype.isDirty=function(){var e=i.prototype.isDirty.call(this);return e=!e&&this.raw?this.name!=this.raw.name||this.body!=this.raw.body||this.format!=this.raw.format||this.kind!=this.raw.kind||this.askSignature!=this.raw.askSignature||this.width!=this.raw.width||this.height!=this.raw.height||this.unit!=this.raw.unit:e},n.prototype.clone=function(){return this.ds.call(this.id,"clone")},n.prototype.archive=function(e){return this._doApiCall({method:"archive",skipRead:e})},n.prototype.undoArchive=function(e){return this._doApiCall({method:"undoArchive",skipRead:e})},n.prototype.activate=function(e){return this._doApiCall({method:"activate",skipRead:e})},n.prototype.deactivate=function(e){return this._doApiCall({method:"deactivate",skipRead:e})},n.prototype.canDelete=function(){return e.templateCanDelete(this)},n.prototype.canActivate=function(){return e.templateCanActivate(this)},n.prototype.canDeactivate=function(){return e.templateCanDeactivate(this)},n.prototype.canArchive=function(){return e.templateCanArchive(this)},n.prototype.canUndoArchive=function(){return e.templateCanUndoArchive(this)},n.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.name=this.name,e.body=this.body,e.kind=this.kind,e.askSignature=this.askSignature,e.width=this.width,e.height=this.height,e.unit=this.unit,e},n.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.name=e.name||s.name,r.status=e.status||s.status,r.body=e.body||s.body,r.format=e.format||s.format,r.kind=e.kind||s.kind,r.askSignature=null!=e.askSignature?1==e.askSignature:s.askSignature,r.width=e.width||s.width,r.height=e.height||s.height,r.unit=e.unit||s.unit,r.system=null!=e.system?1==e.system:s.system,r.archived=e.archived||s.archived,r.createdBy=e.createdBy||s.createdBy,r.createdOn=e.createdOn||s.createdOn,r.modifiedBy=e.modifiedBy||s.modifiedBy,r.modifiedOn=e.modifiedOn||s.modifiedOn,e})},n}(e,we,re),ke=function(n,R){function e(){}var w={kind:"ldap",name:"",host:"ldap://yourdomain.com",port:389,timeOut:60,login:"",password:"",newUsers:"create",existingUsers:"update",missingUsers:"ignore",overwriteLocalUsers:!0,autoSync:!1,role:"",query:"(cn=*)",base:"ou=team,dc=yourdomain,dc=com",loginField:"uid",nameField:"cn",emailField:"mail",restrictLocations:[],timezone:"Etc/GMT",hostCert:"ldap_tls_demand",caCert:"",report:"always",reportEmail:""};e.prototype=R.prototype;function t(e){e=n.extend({_fields:["*"]},e),R.call(this,e),this.helper=e.helper,this.kind=e.kind||w.kind,this.name=e.name||w.name,this.host=e.host||w.host,this.port=e.port||w.port,this.timeOut=e.timeOut||w.timeOut,this.login=e.login||w.login,this.password=e.password||w.password,this.newUsers=e.newUsers||w.newUsers,this.existingUsers=e.existingUsers||w.existingUsers,this.missingUsers=e.missingUsers||w.missingUsers,this.autoSync=(null!=e.autoSync?e:w).autoSync,this.overwriteLocalUsers=(null!=e.overwriteLocalUsers?e:w).overwriteLocalUsers,this.role=e.role||w.role,this.query=e.query||w.query,this.base=e.base||w.base,this.loginField=e.loginField||w.loginField,this.nameField=e.nameField||w.nameField,this.emailField=e.emailField||w.emailField,this.restrictLocations=(e.restrictLocations?e:w).restrictLocations.slice(),this.timezone=e.timezone||w.timezone,this.hostCert=e.hostCert||w.hostCert,this.caCert=e.caCert||w.caCert,this.report=e.report||w.report,this.reportEmail=e.reportEmail||w.reportEmail}return((t.prototype=new e).constructor=t).prototype.isValidName=function(){return this.name=n.trim(this.name),3<=this.name.length},t.prototype.isValid=function(){return this.isValidName()},t.prototype.isEmpty=function(){return R.prototype.isEmpty.call(this)&&this.kind==w.kind&&this.name==w.name&&this.host==w.host&&this.port==w.port&&this.timeOut==w.timeOut&&this.login==w.login&&this.password==w.password&&this.newUsers==w.newUsers&&this.existsingUsers==w.existingUsers&&this.missingUsers==w.missingUsers&&this.autoSync==w.autoSync&&this.overwriteLocalUsers==w.overwriteLocalUsers&&this.role==w.role&&this.query==w.query&&this.base==w.base&&this.loginField==w.loginField&&this.nameField==w.nameField&&this.emailField==w.emailField&&this.timezone==w.timezone&&this.hostCert==w.hostCert&&this.caCert==w.caCert&&this.report==w.report&&this.reportEmail==w.reportEmail&&this.restrictLocations&&0==this.restrictLocations.length},t.prototype.isDirty=function(){return this._isDirtyInfo()||this._isDirtyRestrictLocations()},t.prototype._isDirtyInfo=function(){var e=R.prototype.isDirty.call(this);if(e||!this.raw)return e;var t=this.raw.kind||w.kind,r=this.raw.name||w.name,i=this.raw.host||w.host,s=this.raw.port||w.port,n=this.raw.timeOut||w.timeOut,o=this.raw.login||w.login,a=this.raw.password||w.password,c=this.raw.newUsers||w.newUsers,u=this.raw.existingUsers||w.existingUsers,l=this.raw.missingUsers||w.missingUsers,d=(null!=this.raw.autoSync?this.raw:w).autoSync,h=(null!=this.raw.overwriteLocalUsers?this.raw:w).overwriteLocalUsers,p=this.raw.role||w.role,m=this.raw.query||w.query,f=this.raw.base||w.base,y=this.raw.loginField||w.loginField,g=this.raw.nameField||w.nameField,_=this.raw.emailField||w.emailField,v=this.raw.timezone||w.timezone,C=this.raw.hostCert||w.hostCert,D=this.raw.caCert||w.caCert,k=this.raw.report||w.report,e=this.raw.reportEmail||w.reportEmail;return this.kind!=t||this.name!=r||this.host!=i||this.port!=s||this.timeOut!=n||this.login!=o||this.password!=a||this.newUsers!=c||this.existingUsers!=u||this.missingUsers!=l||this.autoSync!=d||this.overwriteLocalUsers!=h||this.role!=p||this.query!=m||this.base!=f||this.loginField!=y||this.nameField!=g||this.emailField!=_||this.timezone!=v||this.hostCert!=C||this.caCert!=D||this.report!=k||this.reportEmail!=e||this._isDirtyRestrictLocations()},t.prototype._isDirtyRestrictLocations=function(){if(this.raw){var t=this,r=this.raw.restrictLocations||w.restrictLocations;return 0<this.restrictLocations.filter(function(e){return r.indexOf(e)<0}).length||0<r.filter(function(e){return t.restrictLocations.indexOf(e)<0}).length}return!1},t.prototype._getDefaults=function(){return w},t.prototype.clone=function(){return this.ds.call(this.id,"clone")},t.prototype.testConnection=function(){return this.ds.call(this.id,"testConnection")},t.prototype.syncUsers=function(e){return this.ds.call(this.id,"syncUsers",{wetRun:e})},t.prototype._toJson=function(e){e=R.prototype._toJson.call(this,e);return e.kind=this.kind||w.kind,e.name=this.name||w.name,e.host=this.host||w.host,e.port=this.port||w.port,e.timeOut=this.timeOut||w.timeOut,e.login=this.login||w.login,this.password&&(e.password=this.password),e.newUsers=this.newUsers||w.newUsers,e.existingUsers=this.existingUsers||w.existingUsers,e.missingUsers=this.missingUsers||w.missingUsers,e.autoSync=(null!=this.autoSync?this:w).autoSync,e.overwriteLocalUsers=(null!=this.overwriteLocalUsers?this:w).overwriteLocalUsers,e.role=this.role||w.role,e.query=this.query||w.query,e.base=this.base||w.base,e.loginField=this.loginField||w.loginField,e.nameField=this.nameField||w.nameField,e.emailField=this.emailField||w.emailField,e.timezone=this.timezone||w.timezone,e.hostCert=this.hostCert||w.hostCert,e.caCert=this.caCert||w.caCert,e.report=this.report||w.report,e.reportEmail=this.reportEmail||w.reportEmail,e},t.prototype._fromJson=function(e,t){var r=this;return R.prototype._fromJson.call(this,e,t).then(function(){return r.kind=e.kind||w.kind,r.name=e.name||w.name,r.host=e.host||w.host,r.port=e.port||w.port,r.timeOut=e.timeOut||w.timeOut,r.login=e.login||w.login,r.password=e.password||w.password,r.newUsers=e.newUsers||w.newUsers,r.existingUsers=e.existingUsers||w.existingUsers,r.missingUsers=e.missingUsers||w.missingUsers,r.autoSync=(null!=e.autoSync?e:w).autoSync,r.overwriteLocalUsers=(null!=e.overwriteLocalUsers?e:w).overwriteLocalUsers,r.role=e.role||w.role,r.query=e.query||w.query,r.base=e.base||w.base,r.loginField=e.loginField||w.loginField,r.nameField=e.nameField||w.nameField,r.emailField=e.emailField||w.emailField,r.restrictLocations=(e.restrictLocations?e:w).restrictLocations.slice(),r.timezone=e.timezone||w.timezone,r.hostCert=e.hostCert||w.hostCert,r.caCert=e.caCert||w.caCert,r.report=e.report||w.report,r.reportEmail=e.reportEmail||w.reportEmail,n.publish("usersync.fromJson",e),e})},t.prototype.setRestrictLocations=function(e,t){return this.existsInDb()?this._doApiCall({method:"setRestrictLocations",params:{restrictLocations:e},skipRead:t}):n.Deferred().reject("Usersync does not exist in database")},t.prototype.clearRestrictLocations=function(e){return this.existsInDb()?this._doApiCall({method:"clearRestrictLocations",skipRead:e}):n.Deferred().reject("Usersync does not exist in database")},t.prototype.update=function(e){if(this.isEmpty())return n.Deferred().reject(new Error("Cannot update to empty usersync"));if(!this.existsInDb())return n.Deferred().reject(new Error("Cannot update usersync without id"));if(!this.isValid())return n.Deferred().reject(new Error("Cannot update, invalid usersync"));var t=this,r=n.Deferred(),i=n.Deferred(),s=this._toJson();return this._isDirtyInfo()?i=this.ds.update(this.id,s,this._fields).then(function(e){t._fromJson(e)}):i.resolve(),this._isDirtyRestrictLocations()?r=0!=this.restrictLocations.length?this.setRestrictLocations(this.restrictLocations,!0):this.clearRestrictLocations(!0):r.resolve(),n.when(i,r)},t.prototype.create=function(e){return this.existsInDb()?n.Deferred().reject(new Error("Cannot create document, already exists in database")):this.isEmpty()?n.Deferred().reject(new Error("Cannot create empty document")):this._create(e)},t}(e,Y),Re=function(t,e,i){function r(){}var s={id:"",name:"",address:"",topic:"",hookFields:"*, location.*, items.*, customer.*,by.name,by.email",format:"",created:null,modified:null,enabled:!0,log10:[],fails:0,minutes:0};r.prototype=i.prototype;function n(e){e=t.extend({},e),i.call(this,e),this.name=e.name||s.name,this.address=e.address||s.address,this.topic=e.topic||s.topic,this.hookFields=e.hookFields||s.hookFields,this.created=e.created||s.created,this.modified=e.modified||s.modified,this.enabled=null!=e.enabled?1==e.enabled:s.enabled,this.log10=e.log10||s.log10.slice(),this.fails=e.fails||s.fails,this.minutes=e.minutes||s.minutes}return((n.prototype=new r).constructor=n).prototype.isValidName=function(){return this.name=t.trim(this.name),3<=this.name.length},n.prototype.isValidAddress=function(){return this.address=t.trim(this.address),e.isValidURL(this.address)},n.prototype.isValid=function(){return this.isValidName()&&this.isValidAddress()&&this.topic},n.prototype._getDefaults=function(){return s},n.prototype.isEmpty=function(){return i.prototype.isEmpty.call(this)&&this.name==s.name&&this.address==s.address&&this.topic==s.topic},n.prototype.isDirty=function(){var e=i.prototype.isDirty.call(this);return e=!e&&this.raw?this.name!=this.raw.name||this.address!=this.raw.address||this.topic!=this.raw.topic||this.enabled!=this.raw.enabled||this.minutes!=this.raw.minutes:e},n.prototype.canDelete=function(){return t.Deferred().resolve(!0)},n.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.name=this.name,e.address=this.address,e.topic=this.topic,e.fields=this.hookFields,e.enabled=this.enabled,e.minutes=this.minutes,e},n.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.name=e.name||s.name,r.address=e.address||s.address,r.topic=e.topic||s.topic,r.hookFields=e.fields||s.hookFields,r.created=e.created_at||s.created,r.modified=e.modified||s.modified,r.enabled=null!=e.enabled?1==e.enabled:s.enabled,r.log10=e.log10||s.log10.slice(),r.fails=e.nr_consecutive_fails||s.fails,r.minutes=e.minutes||s.minutes,e})},n}(e,we,re),Ee=function(t,i){function e(){}var s={by:null,created:null,modified:null,status:"creating",items:[],started:null,accepted:null,fromOrder:null,toOrder:null,startedBy:null};e.prototype=i.prototype;function r(e){e=t.extend({_fields:["*"],crtype:"cheqroom.types.reservation.ordertransfer"},e),i.call(this,e),this.by=e.by||s.by,this.created=e.created||s.created,this.modified=e.modified||s.modified,this.status=e.status||s.status,this.items=e.items||s.items,this.started=e.started||s.started,this.accepted=e.accepted||s.accepted,this.fromOrder=e.fromOrder||s.fromOrder,this.toOrder=e.toOrder||s.toOrder,this.startedBy=e.startedBy||s.startedBy}return((r.prototype=new e).constructor=r).prototype.isEmpty=function(){return!1},r.prototype._toJson=function(e){e=i.prototype._toJson.call(this,e);return e.items=this.items||s.items,e},r.prototype._fromJson=function(e,t){var r=this;return i.prototype._fromJson.call(this,e,t).then(function(){return r.by=e.by||s.by,r.created=e.created||s.created,r.modified=e.modified||s.modified,r.items=e.items||s.items,r.status=e.status||s.status,r.started=e.started||s.started,r.accepted=e.accepted||s.accepted,r.fromOrder=e.fromOrder||s.fromOrder,r.toOrder=e.toOrder||s.toOrder,r.startedBy=e.startedBy||s.startedBy,e})},r.prototype.addItems=function(e,t){return this._doApiCall({method:"addItems",params:{items:e},skipRead:t})},r.prototype.removeItems=function(e,t){return this._doApiCall({method:"removeItems",params:{items:e},skipRead:t})},r.prototype.start=function(e){return this._doApiCall({method:"start",params:{},skipRead:e})},r.prototype.undoStart=function(e){return this._doApiCall({method:"undoStart",params:{},skipRead:e})},r.prototype.accept=function(e,t){return this._doApiCall({method:"accept",params:e,skipRead:t})},r.prototype.getQRUrl=function(e){return this.ds._baseUrl+"/"+this.id+"/call/qr?size="+(e||300)},r}(e,Y),Ae=function(i,s){function e(){}var n={name:"",summary:"",status:"open",numTotal:0,numUnexpected:0,numChecked:0,numUnchecked:0,numIssues:0,by:{},kind:"",docId:null,created:null,closed:null,users:[],note:"",address:"",archived:null,itemFilter:{}};e.prototype=s.prototype;function t(e){e=i.extend({_fields:["*"],crtype:"cheqroom.types.spotcheck"},e),s.call(this,e),this.name=e.name||n.name,this.summary=e.summary||n.summary,this.status=e.status||n.status,this.numTotal=e.numTotal||n.numTotal,this.numChecked=e.numChecked||n.numChecked,this.numUnchecked=e.numUnchecked||n.numUnchecked,this.numUnexpected=e.numUnexpected||n.numUnexpected}return((t.prototype=new e).constructor=t).prototype.isValidName=function(){return this.name=i.trim(this.name),3<=this.name.length},t.prototype.canDelete=function(){return"open"==this.status},t.prototype.canArchive=function(){return"closed"==this.status&&!this.archived},t.prototype.canUndoArchive=function(){return null!=this.archived},t.prototype.canSpotcheckAgain=function(){return"closed"===this.status},t.prototype.isValid=function(){return this.isValidName()},t.prototype.isDirty=function(){var e=s.prototype.isDirty.call(this);return(e=!e&&this.raw?this._isDirtyStringProperty("name"):e)||this.isDirtyItems()},t.prototype.setName=function(e,t){return this._doApiCall({method:"setName",params:{name:e},skipRead:t})},t.prototype.clearName=function(e){return this._doApiCall({method:"clearName",skipRead:e})},t.prototype.getEntries=function(e){return this._doApiCall({method:"getEntries",params:e,skipRead:!0})},t.prototype.create=function(e,t){return this._doApiCall({method:"create",params:e,skipRead:t,usePost:!0})},t.prototype.markEntriesAsScanned=function(e,t,r){t=i.extend({scanItems:e},t);return this._doApiCall({method:"markEntriesAsScanned",params:t,skipRead:r})},t.prototype.unmarkEntriesAsScanned=function(e,t){return this._doApiCall({method:"unmarkEntriesAsScanned",params:{scanItems:e},skipRead:t})},t.prototype.searchEntriesByCodes=function(e){return this._doApiCall({method:"searchEntriesByCodes",params:{codes:e,_fields:"*"},skipRead:!0})},t.prototype.close=function(e,t){return this._doApiCall({method:"close",params:{message:e},skipRead:t})},t.prototype.archive=function(e){return this.canArchive()?this._doApiCall({method:"archive",params:{},skipRead:e}):i.Deferred().reject(new Error("Cannot archive document"))},t.prototype.undoArchive=function(e){return this._doApiCall({method:"undoArchive",params:{},skipRead:e})},t.prototype.spotcheckAgain=function(){return this._doApiCall({method:"spotcheckAgain",params:{name:this.name},skipRead:!0})},t.prototype._getDefaults=function(){return n},t.prototype._toJson=function(e){e=s.prototype._toJson.call(this,e);return e.name=this.name||n.name,e},t.prototype._fromJson=function(e,t){var r=this;return s.prototype._fromJson.call(this,e,t).then(function(e){return r.name=e.name||n.name,r.summary=e.summary||n.summary,r.status=e.status||n.status,r.numTotal=e.numTotal||n.numTotal,r.numUnexpected=e.numUnexpected||n.numUnexpected,r.numChecked=e.numChecked||n.numChecked,r.numUnchecked=e.numUnchecked||n.numUnchecked,r.numIssues=e.numIssues||n.numIssues,r.kind=e.kind||n.kind,r.docId=e.docId||n.docId,r.created=e.created||n.created,r.finished=e.closed||n.closed,r.users=e.users||n.users,r.note=e.message||n.note,r.address=e.lastAddress||n.address,r.archived=e.archived||n.archived,r.itemFilter=e.itemFilter||n.itemFilter,r.by=e.by||n.by,i.publish("Spotcheck.fromJson",e),e})},t}(e,Y),e=K,K=G,G=Y,Y=Z,Z=X,X=Q,Q=ee,ee=te,te=re,re=ie,ie=se,se=ne,ne=oe,oe=ae,ae=ce,ce=ue,ue=le,le=de,de=he,he=pe,pe=ke,ke=Re,Re=we,we=Ee,Ee=Te,Te=Se,Se=Ae,(Ae={}).api=t,Ae.common=Re,Ae.Availability=e,Ae.Attachment=K,Ae.Base=G,Ae.Category=Y,Ae.Comment=Z,Ae.Conflict=X,Ae.Contact=Q,Ae.DateHelper=ee,Ae.Document=te,Ae.Group=re,Ae.Item=ie,Ae.Kit=se,Ae.Location=ne,Ae.Order=oe,Ae.PermissionHandler=ce,Ae.Reservation=ue,Ae.Template=le,Ae.Transaction=de,Ae.User=he,Ae.UserSync=pe,Ae.WebHook=ke,Ae.OrderTransfer=we,Ae.Helper=ae,Ae.ColorLabel=Ee,Ae.Field=Te,Ae.Spotcheck=Se,Ae=Ae,"undefined"!=typeof module&&module.exports&&(module.exports=Ae),Ae});