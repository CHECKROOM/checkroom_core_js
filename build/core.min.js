/*! core 2015-09-28 */
!function(a){"function"==typeof define&&define.amd?define(["jquery","moment","jquery-jsonp","jquery-pubsub"],a):a($,moment,jsonp,pubsub)}(function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S;return e={isCodeValid:function(a){return null!=a.trim().match(/^[a-z0-9]{8}$/i)},isCodeFromScanner:function(a){if(!a||0==a.length)return!1;var b=a.substring(0,23),c="http://cheqroom.com/qr/".indexOf(b);return 0==c},isValidBarcode:function(a){return null!=a.match(/^[a-z0-9\-]{4,}$/i)},getCheqRoomRedirectUrl:function(a){return this.isCodeValid(a)?"http://cheqroom.com/qr/"+a.trim():""},getCheqRoomRedirectUrlQR:function(a,b){if(this.isCodeValid(a)){var c=encodeURI(this.getCheqRoomRedirectUrl(a));return"https://chart.googleapis.com/chart?chs="+b+"x"+b+"&cht=qr&choe=UTF-8&chld=L|0&chl="+c}return""}},f=function(a){return{getFriendlyOrderStatus:function(a){switch(a){case"creating":return"Incomplete";case"open":return"Open";case"closed":return"Closed";default:return"Unknown"}},getFriendlyOrderCss:function(a){switch(a){case"creating":return"label-creating";case"open":return"label-open";case"closed":return"label-closed";default:return""}},getFriendlyOrderSize:function(a){if(a.items&&a.items.length>0){var b=a.items.length+" item";return a.items.length>1&&(b+="s"),b}return"No items"},isOrderOverdue:function(b,c){return c=c||a(),"open"==b.status&&c.isAfter(b.due)},getOrderStatus:function(b,c){return c=c||a(),this.isOrderOverdue(b,c)?"Overdue":this.getFriendlyOrderStatus(b.status)},getOrderCss:function(b,c){return c=c||a(),this.isOrderOverdue(b,c)?"label-overdue":this.getFriendlyOrderCss(b.status)}}}(b),g={getFriendlyReservationCss:function(a){switch(a){case"creating":return"label-creating";case"open":return"label-open";case"closed":return"label-closed";case"cancelled":return"label-cancelled";default:return""}},getFriendlyReservationStatus:function(a){switch(a){case"creating":return"Incomplete";case"open":return"Open";case"closed":return"Closed";case"cancelled":return"Cancelled";default:return"Unknown"}}},h={getFriendlyItemStatus:function(a){switch(a){case"available":return"Available";case"checkedout":return"Checked out";case"await_checkout":return"Checking out";case"in_transit":return"In transit";case"maintenance":return"Maintenance";case"repair":return"Repair";case"inspection":return"Inspection";case"expired":return"Expired";default:return"Unknown"}},getItemStatusCss:function(a){switch(a){case"available":return"label-available";case"checkedout":return"label-checkedout";case"await_checkout":return"label-awaitcheckout";case"in_transit":return"label-transit";case"maintenance":return"label-maintenance";case"repair":return"label-repair";case"inspection":return"label-inspection";case"expired":return"label-expired";default:return""}},getItemStatusIcon:function(a){switch(a){case"available":return"fa fa-check-circle";case"checkedout":return"fa fa-times-circle";case"await_checkout":return"fa fa-ellipsis-h";case"in_transit":return"fa fa-truck";case"maintenance":return"fa fa-wrench";case"repair":return"fa fa-wrench";case"inspection":return"fa fa-stethoscope";case"expired":return"fa fa-bug";default:return""}}},i={getFriendlyConflictKind:function(a){switch(a){case"location":return"At wrong location";case"order":return"Checked out in order";case"reservation":return"Already reserved";default:return""}}},j=function(){var a=function(a){return"string"==typeof a?a:a.name};return{getCategoryKeyFromName:function(a){return"cheqroom.types.item."+a.split(" ").join("_").split(".").join("").toLowerCase()},getCategoryNameFromKey:function(a){var b=new RegExp("_","g");return a.split(".").pop().replace(b," ")},getCategorySummary:function(b){if(b=b||[],0==b.length)return"No items";for(var c={},d="",e=0,f=this,g=0,h=b.length;h>g;g++){var i=b[g],j=i.category?f.getCategoryNameFromKey(a(i.category)):"";c[j]?c[j]+=1:c[j]=1,c[j]>e&&(d=j,e=c[j])}var k=c[d]+" ";if(k+=1==e&&String.prototype.singularize?d.singularize():d,b.length>c[d]){var l=b.length-c[d];k+=" + "+l+" other"}return k}}}(),k=function(a){return{getAvatarInitial:function(b,c){var d={XS:32,S:64,M:128,L:256,XL:512},e=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f1c40f","#e67e22","#e74c3c","#95a5a6","#f39c12","#d35400","#c0392b","#bdc3c7"],f=b.split(" "),g=2==f.length?f[0].charAt(0).toUpperCase()+f[1].charAt(0).toUpperCase():f[0].charAt(0).toUpperCase(),h=g.charCodeAt(0)-65,i=h%e.length,j=d[c],k=d[c],l=j,m=k,n=a("<canvas />").attr({width:j,height:k}),o=n.get(0).getContext("2d");return window.devicePixelRatio&&(n.attr("width",j*window.devicePixelRatio),n.attr("height",k*window.devicePixelRatio),n.css("width",l),n.css("height",m),o.scale(window.devicePixelRatio,window.devicePixelRatio)),o.fillStyle=e[i],o.fillRect(0,0,j,k),o.font=j/2+"px Arial",o.textAlign="center",o.fillStyle="#FFF",o.fillText(g,l/2,m/1.5),n.get(0).toDataURL()},getImageUrl:function(a,b,c,d){var e=a.getBaseUrl()+b+"?mimeType=image/jpeg";return c&&(e+="&size="+c),d&&(e+="&_bust="+(new Date).getTime()),e},getImageCDNUrl:function(a,b,c,d){var e="https://cheqroom-cdn.s3.amazonaws.com/"+a.amazonBucket+"/groups/"+b+"/"+c;if(d&&d.length>0){{var f=e.split(".");f.pop()}e=f.join(".")+"-"+d+".jpg"}return e}}}(a),l=function(a){return{getImgFileNameFromName:function(b){return null!=b&&b.length>0?b.split(" ").join("_").split(".").join("_")+".jpg":"upload "+a().format("YYYY-MM-DD at hh:mm:ss a")+".jpg"},makeFileNameJpg:function(a){return a.indexOf(".")>=0?a.substr(0,a.lastIndexOf("."))+".jpg":a},getFileNameFromUrl:function(a){if(a){var b=a.toString().match(/.*\/(.+?)\./);if(b&&b.length>1)return b[1]}return""}}}(b),m=function(){String.prototype.pluralize=function(a,b){return"is"==this&&1!=a?"are":"this"==this?1==a?this:"these":this.endsWith("s")?(b=b||"es",1==a?this:this+b):this.endsWith("y")?(b=b||"ies",1==a?this:this.substr(0,this.length-1)+b):(b=b||"s",1==a?this:this+b)},String.prototype.capitalize=function(a){return(a?this.toLowerCase():this).replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},String.prototype.startsWith||(String.prototype.startsWith=function(a){return 0==this.indexOf(a)}),String.prototype.endsWith||(String.prototype.endsWith=function(a){return this.length<a.length?!1:this.lastIndexOf(a)==this.length-a.length}),String.prototype.truncate||(String.prototype.truncate=function(a){a=null!=a?a:25;var b=this.match(RegExp("^.{0,"+a+"}[S]*")),c=b[0].length;return b=b[0].replace(/\s$/,""),c<this.length&&(b+="&hellip;"),b}),String.prototype.isValidUrl||(String.prototype.isValidUrl=function(){var a=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return a.test(this)?!0:!1}),String.prototype.hashCode||(String.prototype.hashCode=function(){var a,b,c,d=0;if(0==this.length)return d;for(a=0,c=this.length;c>a;a++)b=this.charCodeAt(a),d=(d<<5)-d+b,d|=0;return d});var a={};a.latin_map={"Á":"A","Ă":"A","Ắ":"A","Ặ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ǎ":"A","Â":"A","Ấ":"A","Ậ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ä":"A","Ǟ":"A","Ȧ":"A","Ǡ":"A","Ạ":"A","Ȁ":"A","À":"A","Ả":"A","Ȃ":"A","Ā":"A","Ą":"A","Å":"A","Ǻ":"A","Ḁ":"A","Ⱥ":"A","Ã":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ḃ":"B","Ḅ":"B","Ɓ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ć":"C","Č":"C","Ç":"C","Ḉ":"C","Ĉ":"C","Ċ":"C","Ƈ":"C","Ȼ":"C","Ď":"D","Ḑ":"D","Ḓ":"D","Ḋ":"D","Ḍ":"D","Ɗ":"D","Ḏ":"D","ǲ":"D","ǅ":"D","Đ":"D","Ƌ":"D","Ǳ":"DZ","Ǆ":"DZ","É":"E","Ĕ":"E","Ě":"E","Ȩ":"E","Ḝ":"E","Ê":"E","Ế":"E","Ệ":"E","Ề":"E","Ể":"E","Ễ":"E","Ḙ":"E","Ë":"E","Ė":"E","Ẹ":"E","Ȅ":"E","È":"E","Ẻ":"E","Ȇ":"E","Ē":"E","Ḗ":"E","Ḕ":"E","Ę":"E","Ɇ":"E","Ẽ":"E","Ḛ":"E","Ꝫ":"ET","Ḟ":"F","Ƒ":"F","Ǵ":"G","Ğ":"G","Ǧ":"G","Ģ":"G","Ĝ":"G","Ġ":"G","Ɠ":"G","Ḡ":"G","Ǥ":"G","Ḫ":"H","Ȟ":"H","Ḩ":"H","Ĥ":"H","Ⱨ":"H","Ḧ":"H","Ḣ":"H","Ḥ":"H","Ħ":"H","Í":"I","Ĭ":"I","Ǐ":"I","Î":"I","Ï":"I","Ḯ":"I","İ":"I","Ị":"I","Ȉ":"I","Ì":"I","Ỉ":"I","Ȋ":"I","Ī":"I","Į":"I","Ɨ":"I","Ĩ":"I","Ḭ":"I","Ꝺ":"D","Ꝼ":"F","Ᵹ":"G","Ꞃ":"R","Ꞅ":"S","Ꞇ":"T","Ꝭ":"IS","Ĵ":"J","Ɉ":"J","Ḱ":"K","Ǩ":"K","Ķ":"K","Ⱪ":"K","Ꝃ":"K","Ḳ":"K","Ƙ":"K","Ḵ":"K","Ꝁ":"K","Ꝅ":"K","Ĺ":"L","Ƚ":"L","Ľ":"L","Ļ":"L","Ḽ":"L","Ḷ":"L","Ḹ":"L","Ⱡ":"L","Ꝉ":"L","Ḻ":"L","Ŀ":"L","Ɫ":"L","ǈ":"L","Ł":"L","Ǉ":"LJ","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ń":"N","Ň":"N","Ņ":"N","Ṋ":"N","Ṅ":"N","Ṇ":"N","Ǹ":"N","Ɲ":"N","Ṉ":"N","Ƞ":"N","ǋ":"N","Ñ":"N","Ǌ":"NJ","Ó":"O","Ŏ":"O","Ǒ":"O","Ô":"O","Ố":"O","Ộ":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ö":"O","Ȫ":"O","Ȯ":"O","Ȱ":"O","Ọ":"O","Ő":"O","Ȍ":"O","Ò":"O","Ỏ":"O","Ơ":"O","Ớ":"O","Ợ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ȏ":"O","Ꝋ":"O","Ꝍ":"O","Ō":"O","Ṓ":"O","Ṑ":"O","Ɵ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Õ":"O","Ṍ":"O","Ṏ":"O","Ȭ":"O","Ƣ":"OI","Ꝏ":"OO","Ɛ":"E","Ɔ":"O","Ȣ":"OU","Ṕ":"P","Ṗ":"P","Ꝓ":"P","Ƥ":"P","Ꝕ":"P","Ᵽ":"P","Ꝑ":"P","Ꝙ":"Q","Ꝗ":"Q","Ŕ":"R","Ř":"R","Ŗ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ȑ":"R","Ȓ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꜿ":"C","Ǝ":"E","Ś":"S","Ṥ":"S","Š":"S","Ṧ":"S","Ş":"S","Ŝ":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṩ":"S","Ť":"T","Ţ":"T","Ṱ":"T","Ț":"T","Ⱦ":"T","Ṫ":"T","Ṭ":"T","Ƭ":"T","Ṯ":"T","Ʈ":"T","Ŧ":"T","Ɐ":"A","Ꞁ":"L","Ɯ":"M","Ʌ":"V","Ꜩ":"TZ","Ú":"U","Ŭ":"U","Ǔ":"U","Û":"U","Ṷ":"U","Ü":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ǖ":"U","Ṳ":"U","Ụ":"U","Ű":"U","Ȕ":"U","Ù":"U","Ủ":"U","Ư":"U","Ứ":"U","Ự":"U","Ừ":"U","Ử":"U","Ữ":"U","Ȗ":"U","Ū":"U","Ṻ":"U","Ų":"U","Ů":"U","Ũ":"U","Ṹ":"U","Ṵ":"U","Ꝟ":"V","Ṿ":"V","Ʋ":"V","Ṽ":"V","Ꝡ":"VY","Ẃ":"W","Ŵ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẁ":"W","Ⱳ":"W","Ẍ":"X","Ẋ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ẏ":"Y","Ỵ":"Y","Ỳ":"Y","Ƴ":"Y","Ỷ":"Y","Ỿ":"Y","Ȳ":"Y","Ɏ":"Y","Ỹ":"Y","Ź":"Z","Ž":"Z","Ẑ":"Z","Ⱬ":"Z","Ż":"Z","Ẓ":"Z","Ȥ":"Z","Ẕ":"Z","Ƶ":"Z","Ĳ":"IJ","Œ":"OE","ᴀ":"A","ᴁ":"AE","ʙ":"B","ᴃ":"B","ᴄ":"C","ᴅ":"D","ᴇ":"E","ꜰ":"F","ɢ":"G","ʛ":"G","ʜ":"H","ɪ":"I","ʁ":"R","ᴊ":"J","ᴋ":"K","ʟ":"L","ᴌ":"L","ᴍ":"M","ɴ":"N","ᴏ":"O","ɶ":"OE","ᴐ":"O","ᴕ":"OU","ᴘ":"P","ʀ":"R","ᴎ":"N","ᴙ":"R","ꜱ":"S","ᴛ":"T","ⱻ":"E","ᴚ":"R","ᴜ":"U","ᴠ":"V","ᴡ":"W","ʏ":"Y","ᴢ":"Z","á":"a","ă":"a","ắ":"a","ặ":"a","ằ":"a","ẳ":"a","ẵ":"a","ǎ":"a","â":"a","ấ":"a","ậ":"a","ầ":"a","ẩ":"a","ẫ":"a","ä":"a","ǟ":"a","ȧ":"a","ǡ":"a","ạ":"a","ȁ":"a","à":"a","ả":"a","ȃ":"a","ā":"a","ą":"a","ᶏ":"a","ẚ":"a","å":"a","ǻ":"a","ḁ":"a","ⱥ":"a","ã":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ḃ":"b","ḅ":"b","ɓ":"b","ḇ":"b","ᵬ":"b","ᶀ":"b","ƀ":"b","ƃ":"b","ɵ":"o","ć":"c","č":"c","ç":"c","ḉ":"c","ĉ":"c","ɕ":"c","ċ":"c","ƈ":"c","ȼ":"c","ď":"d","ḑ":"d","ḓ":"d","ȡ":"d","ḋ":"d","ḍ":"d","ɗ":"d","ᶑ":"d","ḏ":"d","ᵭ":"d","ᶁ":"d","đ":"d","ɖ":"d","ƌ":"d","ı":"i","ȷ":"j","ɟ":"j","ʄ":"j","ǳ":"dz","ǆ":"dz","é":"e","ĕ":"e","ě":"e","ȩ":"e","ḝ":"e","ê":"e","ế":"e","ệ":"e","ề":"e","ể":"e","ễ":"e","ḙ":"e","ë":"e","ė":"e","ẹ":"e","ȅ":"e","è":"e","ẻ":"e","ȇ":"e","ē":"e","ḗ":"e","ḕ":"e","ⱸ":"e","ę":"e","ᶒ":"e","ɇ":"e","ẽ":"e","ḛ":"e","ꝫ":"et","ḟ":"f","ƒ":"f","ᵮ":"f","ᶂ":"f","ǵ":"g","ğ":"g","ǧ":"g","ģ":"g","ĝ":"g","ġ":"g","ɠ":"g","ḡ":"g","ᶃ":"g","ǥ":"g","ḫ":"h","ȟ":"h","ḩ":"h","ĥ":"h","ⱨ":"h","ḧ":"h","ḣ":"h","ḥ":"h","ɦ":"h","ẖ":"h","ħ":"h","ƕ":"hv","í":"i","ĭ":"i","ǐ":"i","î":"i","ï":"i","ḯ":"i","ị":"i","ȉ":"i","ì":"i","ỉ":"i","ȋ":"i","ī":"i","į":"i","ᶖ":"i","ɨ":"i","ĩ":"i","ḭ":"i","ꝺ":"d","ꝼ":"f","ᵹ":"g","ꞃ":"r","ꞅ":"s","ꞇ":"t","ꝭ":"is","ǰ":"j","ĵ":"j","ʝ":"j","ɉ":"j","ḱ":"k","ǩ":"k","ķ":"k","ⱪ":"k","ꝃ":"k","ḳ":"k","ƙ":"k","ḵ":"k","ᶄ":"k","ꝁ":"k","ꝅ":"k","ĺ":"l","ƚ":"l","ɬ":"l","ľ":"l","ļ":"l","ḽ":"l","ȴ":"l","ḷ":"l","ḹ":"l","ⱡ":"l","ꝉ":"l","ḻ":"l","ŀ":"l","ɫ":"l","ᶅ":"l","ɭ":"l","ł":"l","ǉ":"lj","ſ":"s","ẜ":"s","ẛ":"s","ẝ":"s","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ᵯ":"m","ᶆ":"m","ń":"n","ň":"n","ņ":"n","ṋ":"n","ȵ":"n","ṅ":"n","ṇ":"n","ǹ":"n","ɲ":"n","ṉ":"n","ƞ":"n","ᵰ":"n","ᶇ":"n","ɳ":"n","ñ":"n","ǌ":"nj","ó":"o","ŏ":"o","ǒ":"o","ô":"o","ố":"o","ộ":"o","ồ":"o","ổ":"o","ỗ":"o","ö":"o","ȫ":"o","ȯ":"o","ȱ":"o","ọ":"o","ő":"o","ȍ":"o","ò":"o","ỏ":"o","ơ":"o","ớ":"o","ợ":"o","ờ":"o","ở":"o","ỡ":"o","ȏ":"o","ꝋ":"o","ꝍ":"o","ⱺ":"o","ō":"o","ṓ":"o","ṑ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","õ":"o","ṍ":"o","ṏ":"o","ȭ":"o","ƣ":"oi","ꝏ":"oo","ɛ":"e","ᶓ":"e","ɔ":"o","ᶗ":"o","ȣ":"ou","ṕ":"p","ṗ":"p","ꝓ":"p","ƥ":"p","ᵱ":"p","ᶈ":"p","ꝕ":"p","ᵽ":"p","ꝑ":"p","ꝙ":"q","ʠ":"q","ɋ":"q","ꝗ":"q","ŕ":"r","ř":"r","ŗ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ȑ":"r","ɾ":"r","ᵳ":"r","ȓ":"r","ṟ":"r","ɼ":"r","ᵲ":"r","ᶉ":"r","ɍ":"r","ɽ":"r","ↄ":"c","ꜿ":"c","ɘ":"e","ɿ":"r","ś":"s","ṥ":"s","š":"s","ṧ":"s","ş":"s","ŝ":"s","ș":"s","ṡ":"s","ṣ":"s","ṩ":"s","ʂ":"s","ᵴ":"s","ᶊ":"s","ȿ":"s","ɡ":"g","ᴑ":"o","ᴓ":"o","ᴝ":"u","ť":"t","ţ":"t","ṱ":"t","ț":"t","ȶ":"t","ẗ":"t","ⱦ":"t","ṫ":"t","ṭ":"t","ƭ":"t","ṯ":"t","ᵵ":"t","ƫ":"t","ʈ":"t","ŧ":"t","ᵺ":"th","ɐ":"a","ᴂ":"ae","ǝ":"e","ᵷ":"g","ɥ":"h","ʮ":"h","ʯ":"h","ᴉ":"i","ʞ":"k","ꞁ":"l","ɯ":"m","ɰ":"m","ᴔ":"oe","ɹ":"r","ɻ":"r","ɺ":"r","ⱹ":"r","ʇ":"t","ʌ":"v","ʍ":"w","ʎ":"y","ꜩ":"tz","ú":"u","ŭ":"u","ǔ":"u","û":"u","ṷ":"u","ü":"u","ǘ":"u","ǚ":"u","ǜ":"u","ǖ":"u","ṳ":"u","ụ":"u","ű":"u","ȕ":"u","ù":"u","ủ":"u","ư":"u","ứ":"u","ự":"u","ừ":"u","ử":"u","ữ":"u","ȗ":"u","ū":"u","ṻ":"u","ų":"u","ᶙ":"u","ů":"u","ũ":"u","ṹ":"u","ṵ":"u","ᵫ":"ue","ꝸ":"um","ⱴ":"v","ꝟ":"v","ṿ":"v","ʋ":"v","ᶌ":"v","ⱱ":"v","ṽ":"v","ꝡ":"vy","ẃ":"w","ŵ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẁ":"w","ⱳ":"w","ẘ":"w","ẍ":"x","ẋ":"x","ᶍ":"x","ý":"y","ŷ":"y","ÿ":"y","ẏ":"y","ỵ":"y","ỳ":"y","ƴ":"y","ỷ":"y","ỿ":"y","ȳ":"y","ẙ":"y","ɏ":"y","ỹ":"y","ź":"z","ž":"z","ẑ":"z","ʑ":"z","ⱬ":"z","ż":"z","ẓ":"z","ȥ":"z","ẕ":"z","ᵶ":"z","ᶎ":"z","ʐ":"z","ƶ":"z","ɀ":"z","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ĳ":"ij","œ":"oe","ﬆ":"st","ₐ":"a","ₑ":"e","ᵢ":"i","ⱼ":"j","ₒ":"o","ᵣ":"r","ᵤ":"u","ᵥ":"v","ₓ":"x"},String.prototype.latinise=function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,function(b){return a.latin_map[b]||b})},String.prototype.latinize=String.prototype.latinise,String.prototype.isLatin=function(){return this==this.latinise()},String.prototype.OnlyAlphaNumSpaceAndUnderscore=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[\W]/g,"")},String.prototype.OnlyAlphaNumSpaceUnderscoreAndDot=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[^a-z0-9_\.]/g,"")},Number.prototype.between||(Number.prototype.between=function(a,b){var c=Math.min(a,b),d=Math.max(a,b);return this>=c&&d>=this})}(),n={isValidEmail:function(a){var b=/^([\w-\+]+(?:\.[\w-\+]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)},isValidPhone:function(a){var b=/^\d{9,}$/.test(a);if(b)return!0;var c=a.match(/^[\s()+-]*([0-9][\s()+-]*){10,20}(( x| ext)\d{1,5}){0,1}$/);return null!=c&&c.length>0}},o=function(a){return{badgeify:function(a){return a>100?"100+":a>10?"10+":a>0?""+a:""},getLoginName:function(a,b){var c=/[\s-]*/gim;return a.latinise().toLowerCase().replace(c,"")+"."+b.latinise().toLowerCase().replace(c,"")},getUrlParam:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return d?decodeURIComponent(d[1].replace(/\+/g," ")):null},getParsedLines:function(b){if(b&&b.length>0){var c=b.split(/\s*([,;\r\n]+|\s\s)\s*/);return c.filter(function(b,c,d){return b.length>0&&b.indexOf(",")<0&&b.indexOf(";")<0&&a.trim(b).length>0&&d.indexOf(b)>=c})}return[]}}}(a),p=function(){var a=function(){function a(a,b){var c=b.trim();return/^<\/?(ul|ol|li|h|p|bl)/i.test(c)?"\n"+b+"\n":"\n<p>"+c+"</p>\n"}function b(a,b){return"\n<ul>\n	<li>"+b.trim()+"</li>\n</ul>"}function c(a,b){return"\n<ol>\n	<li>"+b.trim()+"</li>\n</ol>"}function d(a,b,c){return"\n<blockquote>"+c.trim()+"</blockquote>"}function e(a,b,c){var d=b.length;return"<h"+d+">"+c.trim()+"</h"+d+">"}this.rules=[{regex:/(#+)(.*)/g,replacement:e},{regex:/!\[([^\[]+)\]\(([^\)]+)\)/g,replacement:"<img src='$2' alt='$1'>"},{regex:/\[([^\[]+)\]\(([^\)]+)\)/g,replacement:"<a href='$2'>$1</a>"},{regex:/(\*\*|__)(.*?)\1/g,replacement:"<strong>$2</strong>"},{regex:/(\*|_)(.*?)\1/g,replacement:"<em>$2</em>"},{regex:/\~\~(.*?)\~\~/g,replacement:"<del>$1</del>"},{regex:/\:\"(.*?)\"\:/g,replacement:"<q>$1</q>"},{regex:/`(.*?)`/g,replacement:"<code>$1</code>"},{regex:/\n\*(.*)/g,replacement:b},{regex:/\n[0-9]+\.(.*)/g,replacement:c},{regex:/\n(&gt;|\>)(.*)/g,replacement:d},{regex:/\n-{5,}/g,replacement:"\n<hr />"},{regex:/\n([^\n]+)\n/g,replacement:a},{regex:/<\/ul>\s?<ul>/g,replacement:""},{regex:/<\/ol>\s?<ol>/g,replacement:""},{regex:/<\/blockquote><blockquote>/g,replacement:"\n"}],this.addRule=function(a,b){a.global=!0,a.multiline=!1,this.rules.push({regex:a,replacement:b})},this.render=function(a){return a="\n"+a+"\n",this.rules.forEach(function(b){a=a.replace(b.regex,b.replacement)}),a.trim()}};window.Slimdown=a}(),q=function(a,b,c,d,e,f,g,h,i,j,k,l,m){return a.extend({},b,c,d,e,f,g,h,i,k,l)}(a,e,f,g,h,i,j,k,l,m,n,o,p),r=function(a,b,c,d){a.ajaxSetup({cache:!1});var e={};return e.NetworkNotConnected=function(a,b){this.code=999,this.message=a||"Connection interrupted",this.opt=b},e.NetworkNotConnected.prototype=new Error,e.NetworkTimeout=function(a,b){this.code=408,this.message=a||"Could not reach the server in time",this.opt=b},e.NetworkTimeout.prototype=new Error,e.ApiError=function(a,b){this.code=500,this.message=a||"Something went wrong on the server",this.opt=b},e.ApiError.prototype=new Error,e.ApiNotFound=function(a,b){this.code=404,this.message=a||"Could not find what you're looking for",this.opt=b},e.ApiNotFound.prototype=new Error,e.ApiBadRequest=function(a,b){this.code=400,this.message=a||"The server did not understand your request",this.opt=b},e.ApiBadRequest.prototype=new Error,e.ApiUnauthorized=function(a,b){this.code=401,this.message=a||"Your session has expired",this.opt=b},e.ApiUnauthorized.prototype=new Error,e.ApiForbidden=function(a,b){this.code=403,this.message=a||"You don't have sufficient rights",this.opt=b},e.ApiForbidden.prototype=new Error,e.ApiUnprocessableEntity=function(a,b){this.code=422,this.message=a||"Some data is invalid",this.opt=b},e.ApiUnprocessableEntity.prototype=new Error,e.ApiPaymentRequired=function(a,b){this.code=402,this.message=a||"Your subscription has expired",this.opt=b},e.ApiPaymentRequired.prototype=new Error,e.ApiAjax=function(a){a=a||{},this.useJsonp=null!=a.useJsonp?a.useJsonp:!0,this.timeOut=a.timeOut||1e4,this.responseInTz=!0},e.ApiAjax.prototype.get=function(a,b){return this.useJsonp?this._getJsonp(a,b):this._getAjax(a,b)},e.ApiAjax.prototype.post=function(a,b,c){if(this.useJsonp)throw"ApiAjax cannot post while useJsonp is true";return this._postAjax(a,b,c)},e.ApiAjax.prototype._handleAjaxSuccess=function(a,b,c){return this.responseInTz&&(b=this._fixDates(b)),a.resolve(b)},e.ApiAjax.prototype._handleAjaxError=function(a,b,c,d,f){var g=null;if("timeout"===d)a.reject(new e.NetworkTimeout(g,f));else switch(b.status){case 400:a.reject(new e.ApiBadRequest(g,f));break;case 401:a.reject(new e.ApiUnauthorized(g,f));break;case 402:a.reject(new e.ApiPaymentRequired(g,f));break;case 403:a.reject(new e.ApiForbidden(g,f));break;case 404:a.reject(new e.ApiNotFound(g,f));break;case 408:a.reject(new e.NetworkTimeout(g,f));break;case 422:a.reject(new e.ApiUnprocessableEntity(g,f));break;case 500:default:a.reject(new e.ApiError(g,f))}},e.ApiAjax.prototype._postAjax=function(b,c,d,e){var f=a.Deferred(),g=this;return a.ajax({type:"POST",url:b,data:JSON.stringify(this._prepareDict(c)),contentType:"application/json; charset=utf-8",timeout:d||this.timeOut,success:function(a){return g._handleAjaxSuccess(f,a,e)},error:function(a,b,c){return g._handleAjaxError(f,a,b,c,e)}}),f.promise()},e.ApiAjax.prototype._getAjax=function(b,c,d){var e=a.Deferred(),f=this;return a.ajax({url:b,timeout:c||this.timeOut,success:function(a){return f._handleAjaxSuccess(e,a,d)},error:function(a,b,c){return f._handleAjaxError(e,a,b,c,d)}}),e.promise()},e.ApiAjax.prototype._getJsonp=function(b,c,d){var f=a.Deferred(),g=this;return a.jsonp({url:b,type:"GET",timeout:c||this.timeOut,dataType:" jsonp",callbackParameter:"callback",success:function(a,b,c){return g._handleAjaxSuccess(f,a)},error:function(a,b){f.reject(new e.ApiError(null,d))}}),f.promise()},e.ApiAjax.prototype._prepareDict=function(b){return a.each(b,function(a,d){c.isMoment(d)&&(b[a]=d.toJSONDate())}),b},e.ApiAjax.prototype._fixDates=function(b){if("string"==typeof b||b instanceof String){if(b.endsWith("+00:00")){var d=b.length;if(25==d)return c(b.substring(0,d-6));if(32==d)return c(b.substring(0,d-6).split(".")[0])}}else if(b instanceof Object||a.isArray(b)){var e=this;a.each(b,function(a,c){b[a]=e._fixDates(c)})}return b},e.ApiUser=function(a){a=a||{},this.userId=a.userId||"",this.userToken=a.userToken||"",this.tokenType=a.tokenType||""},e.ApiUser.prototype.fromStorage=function(){this.userId=window.localStorage.getItem("userId")||"",this.userToken=window.localStorage.getItem("userToken")||"",this.tokenType=window.localStorage.getItem("tokenType")||""},e.ApiUser.prototype.toStorage=function(){window.localStorage.setItem("userId",this.userId),window.localStorage.setItem("userToken",this.userToken),window.localStorage.setItem("tokenType",this.tokenType)},e.ApiUser.prototype.removeFromStorage=function(){window.localStorage.removeItem("userId"),window.localStorage.removeItem("userToken"),window.localStorage.removeItem("tokenType")},e.ApiUser.prototype.clearToken=function(){window.localStorage.setItem("userToken",null),window.localStorage.setItem("tokenType",null)},e.ApiUser.prototype.isValid=function(){return this.userId&&this.userId.length>0&&this.userToken&&this.userToken.length>0},e.ApiUser.prototype._reset=function(){this.userId="",this.userToken="",this.tokenType=""},e.ApiAuth=function(a){a=a||{},this.urlAuth=a.urlAuth||"",this.ajax=a.ajax},e.ApiAuth.prototype.authenticate=function(b,c){var d=this.urlAuth+"?"+a.param({user:b,password:c,auth_v:2}),e=a.Deferred();return this.ajax.get(d).done(function(a){if("OK"==a.status)e.resolve(a.data);else{var b=new Error("Your username or password is not correct");e.reject(b)}}).fail(function(a){e.reject(a)}),e.promise()},e.ApiAuthV2=function(a){a=a||{},this.urlAuth=a.urlAuth||"",this.ajax=a.ajax},e.ApiAuthV2.prototype.authenticate=function(b,c){var d=this.urlAuth+"?"+a.param({user:b,password:c,auth_v:2}),f=a.Deferred();return this.ajax.get(d).done(function(a){if("OK"==a.status)f.resolve(a.data);else{var b=null;b=a.message&&a.message.indexOf("expired")>0?new e.ApiPaymentRequired(a.message):new Error("Your username or password is not correct"),f.reject(b)}}).fail(function(a){f.reject(a)}),f.promise()},e.ApiAnonymous=function(a){a=a||{},this.ajax=a.ajax,this.urlApi=a.urlApi||""},e.ApiAnonymous.prototype.call=function(b,c,d,e){var f=this.urlApi+"/"+b+"?"+a.param(this.ajax._prepareDict(c));return this.ajax.get(f,d,e)},e.ApiAnonymous.prototype.longCall=function(a,b,c){return this.call(a,b,3e4,c)},e.ApiDataSource=function(a){a=a||{},this.collection=a.collection||"",this.urlApi=a.urlApi||"",this.user=a.user,this.ajax=a.ajax,this.version=a.version;var b=null!=this.user.tokenType&&this.user.tokenType.length>0?this.user.tokenType:"null";this._baseUrl=this.urlApi+"/"+this.user.userId+"/"+this.user.userToken+"/"+b+"/"+this.collection+"/"},e.ApiDataSource.prototype.exists=function(b,c){var d="exists",f=a.Deferred(),g=this,h=this.getBaseUrl()+b,i=this.getParams(c);return a.isEmptyObject(i)||(h+="?"+this.getParams(i)),this._ajaxGet(d,h).done(function(a){f.resolve(a)}).fail(function(a){g.ajax.useJsonp?f.resolve(null):a instanceof e.ApiNotFound?f.resolve(null):f.reject(a)}),f.promise()},e.ApiDataSource.prototype.get=function(b,c){var d="get",e=this.getBaseUrl()+b,f=this.getParamsDict(c);return a.isEmptyObject(f)||(e+="?"+this.getParams(f)),this._ajaxGet(d,e)},e.ApiDataSource.prototype.getIgnore404=function(b,c){var d=this,f=a.Deferred();return this.get(b,c).done(function(a){f.resolve(a)}).fail(function(a){d.ajax.useJsonp?f.resolve(null):a instanceof e.ApiNotFound?f.resolve(null):f.reject(a)}),f.promise()},e.ApiDataSource.prototype.getMultiple=function(b,c){var d="getMultiple",e=this.getBaseUrl()+b.join(",")+",",f=this.getParamsDict(c);return a.isEmptyObject(f)||(e+="?"+this.getParams(f)),this._ajaxGet(d,e)},e.ApiDataSource.prototype["delete"]=function(a){var b="delete",c=this.getBaseUrl()+a+"/delete";return this._ajaxGet(b,c)},e.ApiDataSource.prototype.update=function(b,c,d){var e="update",f=this.getBaseUrl()+b+"/update",g=a.extend({},c);return null!=d&&d.length>0&&(g._fields=a.isArray(d)?d.join(","):d),f+="?"+this.getParams(g),this._ajaxGet(e,f)},e.ApiDataSource.prototype.create=function(b,c){var d="create",e=this.getBaseUrl()+"create",f=a.extend({},b);return null!=c&&c.length>0&&(f._fields=a.isArray(c)?c.join(","):c),e+="?"+this.getParams(f),this._ajaxGet(d,e)},e.ApiDataSource.prototype.createMultiple=function(b,c){var d=a.Deferred(),e=this,f=b.slice(0),g=[],h=function(a){if(a.length>0){var b=a.pop();e.create(b,c).done(function(b){return g.push(b._id),h(a)}).fail(function(a){d.reject(a)})}else d.resolve(g)};return h(f),d.promise()},e.ApiDataSource.prototype.list=function(b,c,d,e,f){b=b||"";var g="list."+b,h=this.getBaseUrl();null!=b&&b.length>0&&(h+="list/"+b+"/");var i=this.getParamsDict(c,d,e,f);return a.isEmptyObject(i)||(h+="?"+this.getParams(i)),this._ajaxGet(g,h)},e.ApiDataSource.prototype.search=function(a,b,c,d,e,f){var g="search",h=this.searchUrl(a,b,c,d,e,f);return this._ajaxGet(g,h)},e.ApiDataSource.prototype.searchUrl=function(b,c,d,e,f,g){var h=this.getBaseUrl()+"search",i=a.extend(this.getParamsDict(c,d,e,f),b);return null!=g&&g.length>0&&(i.mimeType=g),h+="?"+this.getParams(i)},e.ApiDataSource.prototype.call=function(b,c,d,e,f,g){var h="call."+c,i=null!=b&&b.length>0?this.getBaseUrl()+b+"/call/"+c:this.getBaseUrl()+"call/"+c,j=a.extend({},this.getParamsDict(e,null,null,null),d);return g?this._ajaxPost(h,i,j,f):(i+="?"+this.getParams(j),this._ajaxGet(h,i,f))},e.ApiDataSource.prototype.longCall=function(a,b,c,d,e){return this.call(a,b,c,d,3e4,e)},e.ApiDataSource.prototype.getBaseUrl=function(){return this._baseUrl},e.ApiDataSource.prototype.getParams=function(b){return a.param(this.ajax._prepareDict(b))},e.ApiDataSource.prototype.getParamsDict=function(b,c,d,e){var f={};return b&&(f._fields=a.isArray(b)?b.join(","):b.replace(/\s/g,"")),c&&(f._limit=c),d&&(f._skip=d),e&&(f._sort=e),this.version&&(f._v=this.version),f},e.ApiDataSource.prototype._ajaxGet=function(a,b,c){return this.ajax.get(b,c,{coll:this.collection,cmd:a})},e.ApiDataSource.prototype._ajaxPost=function(a,b,c,d){return this.ajax.post(b,c,d,{coll:this.collection,cmd:a})},e}(a,c,b,q),s=function(a,b,c){var d={id:""},e=function(a){this.ds=a.ds,this.fields=a.fields,this.raw=null,this.id=a.id||d.id};return e.prototype.reset=function(){return this._fromJson(this._getDefaults(),null)},e.prototype.existsInDb=function(){return null!=this.id&&this.id.length>0},e.prototype.isEmpty=function(){return!0},e.prototype.isDirty=function(){return!1},e.prototype.isValid=function(){return!0},e.prototype.discardChanges=function(){return this.raw?this._fromJson(this.raw,null):this.reset()},e.prototype.reload=function(b){return this.existsInDb()?this.get(b):a.Deferred().reject(new c.ApiError("Cannot reload document, id is empty or null"))},e.prototype.get=function(b){if(this.existsInDb()){var d=this;return this.ds.get(this.id,b||this.fields).then(function(a){return d._fromJson(a)})}return a.Deferred().reject(new c.ApiError("Cannot get document, id is empty or null"))},e.prototype.create=function(b){if(this.existsInDb())return a.Deferred().reject(new Error("Cannot create document, already exists in database"));if(this.isEmpty())return a.Deferred().reject(new Error("Cannot create empty document"));if(!this.isValid())return a.Deferred().reject(new Error("Cannot create, invalid document"));var c=this,d=this._toJson();return delete d.id,this.ds.create(d,this.fields).then(function(a){return 1==b?a:c._fromJson(a)})},e.prototype.update=function(b){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot update document without id"));if(this.isEmpty())return a.Deferred().reject(new Error("Cannot update to empty document"));if(!this.isValid())return a.Deferred().reject(new Error("Cannot update, invalid document"));var c=this,d=this._toJson();return delete d.id,this.ds.update(this.id,d,this.fields).then(function(a){return 1==b?a:c._fromJson(a)})},e.prototype["delete"]=function(){if(this.existsInDb()){var b=this;return this.ds["delete"](this.id).then(function(){return b.reset()})}return a.Deferred().reject(new Error("Document does not exist"))},e.prototype._getDefaults=function(){return d},e.prototype._toJson=function(a){return{id:this.id}},e.prototype._fromJson=function(b,c){return this.raw=b,this.id=b._id||d.id,a.Deferred().resolve(b)},e.prototype._getId=function(a,b){return"string"==typeof a?a:a[b||"_id"]},e.prototype._doApiCall=function(a){var b=this;return this.ds.call(1==a.collectionCall?null:a.pk||this.id,a.method,a.params,a.fields||this.fields,a.timeOut,a.usePost).then(function(c){return 1==a.skipRead?c:b._fromJson(c)})},e}(a,q,r),t=function(a,b,c,d){var e={id:"",planning:"",item:"",from:null,to:null,order:"",reservation:""},f=function(){};f.prototype=d.prototype;var g=function(b){var c=a.extend({},b);d.call(this,c),this.planning=c.planning||e.planning,this.item=c.item||e.item,this.from=c.from||e.from,this.to=c.to||e.to,this.order=c.order||e.order,this.reservation=c.reservation||e.reservation};return g.prototype=new f,g.prototype.constructor=g,g.prototype._getDefaults=function(){return e},g.prototype.isEmpty=function(){return!1},g.prototype.canDelete=function(){return a.Deferred().resolve(!1)},g.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.planning=this.planning,b.item=this.item,b.fromDate=this.from,b.toDate=this.to,b.order=this.order,b.reservation=this.reservation,b},g.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.planning=a.planning||e.planning,c.item=a.item||e.item,c.from=a.fromDate||e.from,c.to=a.toDate||e.to,c.order=a.order||e.order,c.reservation=a.reservation||e.reservation,a})},g}(a,q,r,s),u={cdn:"https://cheqroom-cdn.s3.amazonaws.com",amazonBucket:"app"},v=function(a,b){return{getImageCDNUrl:function(a,c,d){var e=b.cdn+"/"+b.amazonBucket+"/groups/"+a+"/"+c;if(d&&d.length>0){{var f=e.split(".");f.pop()}e=f.join(".")+"-"+d+".jpg"}return e},getImageUrl:function(a,b,c,d){var e=a.getBaseUrl()+b+"?mimeType=image/jpeg";return c&&(e+="&size="+c),d&&(e+="&_bust="+(new Date).getTime()),e},getNumItemsLeft:function(a,b){return a.maxItems-b.detailed.production.items.total+b.detailed.production.items.expired},getNumUsersLeft:function(a,b){return a.maxUsers-b.detailed.production.users.active},getAccessRights:function(a,b,c){var d="root"==a||"admin"==a,e="root"==a||"admin"==a||"user"==a,f=c.allowReservations&&b.useReservations,g=c.allowGeneratePdf&&b.useOrderAgreements,h=c.allowWebHooks;return{contacts:{create:e,remove:e,update:!0},items:{create:d,remove:d,update:d,updateFlag:d,updateLocation:d,updateGeo:!0},orders:{create:!0,remove:!0,update:!0,updateContact:"selfservice"!=a,updateLocation:!0,generatePdf:g&&e},reservations:{create:f,remove:f,update:f,updateContact:f&&"selfservice"!=a,updateLocation:f},locations:{create:d,remove:d,update:d},users:{create:d,remove:d,update:d,updateOther:d,updateOwn:!0},webHooks:{create:h&&d,remove:h&&d,update:h&&d},stickers:{print:d,buy:d},categories:{create:d,update:d},account:{update:d}}},ensureValue:function(a,b){return"string"==typeof a?a:a[b]},ensureId:function(a){return this.ensureValue(a,"_id")}}}(a,u),w=function(a){var b={id:"",pk:"",key:"",kind:"string",value:null,modified:null,by:null},c=function(a){this.ds=a.ds,this.fields=a.fields,this.raw=null,this.id=a.id||b.id,this.pk=a.pk||b.pk,this.key=a.key||b.key,this.kind=a.kind||b.kind,this.value=a.value||b.value,this.modified=a.modified||b.modified,this.by=a.by||b.by};return c.prototype.existsInDb=function(){return null!=this.id&&this.id.length>0},c.prototype.getName=function(){
var a=this.key.split(";"),b=a[0];return b.split(".").pop().split("+").join(" ")},c.prototype.getUnit=function(){var a=this.key.split(";");return 2==a.length?a[1]:""},c.prototype.isEmpty=function(){return this.id==b.id&&this.pk==b.pk&&this.key==b.key&&this.kind==b.kind&&this.value==b.value&&this.modified==b.modified&&this.by==b.by},c.prototype.isDirty=function(){return!1},c.prototype.isValid=function(){return!0},c.prototype.reset=function(){return this._fromJson(b,null)},c.prototype._toJson=function(a){return{id:this.id,pk:this.pk,key:this.key,kind:this.kind,value:this.value,modified:this.modified,by:this.by}},c.prototype._fromJson=function(c,d){return this.raw=c,this.id=c.id||b.id,this.pk=c.pk||b.pk,this.key=c.key||b.key,this.kind=c.kind||b.kind,this.value=c.value||b.value,this.modified=c.modified||b.modified,this.by=c.by||b.by,a.Deferred().resolve(c)},c}(a),x=function(a,b,c){var d=/(?:\.([^.]+))?$/,e=["jpg","png"],f=["jpg","png","doc","docx","pdf"],g={isCover:!1,canBeCover:!0},h=function(){};h.prototype=c.prototype;var i=function(a){c.call(this,a),this.ds=a.ds,this.isCover=null!=a.isCover?a.isCover:g.isCover,this.canBeCover=null!=a.canBeCover?a.canBeCover:g.canBeCover};return i.prototype=new h,i.prototype.constructor=i,i.prototype.getThumbnailUrl=function(a){return this.hasPreview()?b.getImageUrl(this.ds,this.id,a||"S"):""},i.prototype.getDownloadUrl=function(){return this.ds.getBaseUrl()+this.id+"?download=True"},i.prototype.getExt=function(a){return a=a||this.id,d.exec(a)[1]||""},i.prototype.isImage=function(){var b=this.id,c=this.getExt(b);return a.inArray(c,e)>=0},i.prototype.hasPreview=function(){var b=this.id,c=this.getExt(b);return a.inArray(c,f)>=0},i}(a,v,w),y=function(a,b){var c="cheqroom.Comment",d=function(){};d.prototype=b.prototype;var e=function(a){a=a||{},a.key=c,a.kind="string",b.call(this,a)};return e.prototype=new d,e.prototype.constructor=e,e}(a,w),z=function(a,b,c){var d=/(?:\.([^.]+))?$/,e=["jpg","png"],f=["jpg","png","doc","docx","pdf"],g={isCover:!1,canBeCover:!0},h=function(){};h.prototype=c.prototype;var i=function(a){c.call(this,a),this.ds=a.ds,this.isCover=null!=a.isCover?a.isCover:g.isCover,this.canBeCover=null!=a.canBeCover?a.canBeCover:g.canBeCover};return i.prototype=new h,i.prototype.constructor=i,i.prototype.getThumbnailUrl=function(a){return this.hasPreview()?b.getImageUrl(this.ds,this.id,a||"S"):""},i.prototype.getDownloadUrl=function(){return this.ds.getBaseUrl()+this.id+"?download=True"},i.prototype.getExt=function(a){return a=a||this.id,d.exec(a)[1]||""},i.prototype.isImage=function(){var b=this.id,c=this.getExt(b);return a.inArray(c,e)>=0},i.prototype.hasPreview=function(){var b=this.id,c=this.getExt(b);return a.inArray(c,f)>=0},i}(a,v,w),A=function(a,b,c,d,e,f,g){var h="cheqroom.Comment",i="cheqroom.Attachment",j="cheqroom.prop.Image",k="cheqroom.attachment.Image",l={id:"",modified:null,cover:null,comments:[],attachments:[],keyValues:[]},m=function(){};m.prototype=d.prototype;var n=function(b){var c=a.extend({},b);d.call(this,c),this.dsAttachments=c.dsAttachments,this.crtype=c.crtype,this.modified=c.modified||l.modified,this.comments=c.comments||l.comments.slice(),this.attachments=c.attachments||l.attachments.slice(),this.keyValues=c.keyValues||l.keyValues.slice(),this.cover=c.cover||l.cover};return n.prototype=new m,n.prototype.constructor=n,n.prototype._getDefaults=function(){return l},n.prototype.isEmpty=function(){return!(null!=this.comments&&0!=this.comments.length||null!=this.attachments&&0!=this.attachments.length||null!=this.keyValues&&0!=this.keyValues.length)},n.prototype.canDelete=function(){return this.existsInDb()?this.ds.call(this.id,"canDelete"):a.Deferred().resolve({result:!1,message:""})},n.prototype.addComment=function(a,b){return this.addKeyValue(h,a,"string",b)},n.prototype.updateComment=function(a,b,c){return this.updateKeyValue(a,h,b,"string",c)},n.prototype.deleteComment=function(a,b){return this.removeKeyValue(a,b)},n.prototype.addKeyValue=function(a,b,c,d){return this._doApiCall({method:"addKeyValue",params:{key:a,value:b,kind:c},skipRead:d})},n.prototype.updateKeyValue=function(a,b,c,d,e){return this._doApiCall({method:"updateKeyValue",params:{id:a,key:b,value:c,kind:d},skipRead:e})},n.prototype.removeKeyValue=function(a,b){return this._doApiCall({method:"removeKeyValue",params:{id:a},skipRead:b})},n.prototype.setKeyValue=function(a,b,c,d,e){var f={key:b,value:c,kind:d};return null!=a&&a.length>0&&(f.id=a),this._doApiCall({method:"setKeyValue",params:f,skipRead:e})},n.prototype.moveKeyValueIndex=function(a,b){},n.prototype.getImageUrl=function(a,b,c,d){var e=c||this.cover;return null!=e&&e.length>0?this.helper.getImageCDNUrl(b,e,a):this.helper.getImageUrl(this.ds,this.id,a,d)},n.prototype.setCover=function(a,b){return this._doApiCall({method:"setCover",params:{kvId:a._id},skipRead:b})},n.prototype.attachImage=function(a,b){return this.attach(a,j,b)},n.prototype.attachFile=function(a,b){return this.attach(a,i,b)},n.prototype.attach=function(b,d,e){return this.existsInDb()?this._doApiCall({method:"attach",params:{attachments:[b._id],key:d},skipRead:e}):a.Deferred().reject(new c.ApiError("Cannot attach attachment, id is empty or null"))},n.prototype.detach=function(b,d){return this.existsInDb()?this._doApiCall({method:"detach",params:{attachments:[b],kvId:b},skipRead:d}):a.Deferred().reject(new c.ApiError("Cannot detach attachment, id is empty or null"))},n.prototype._toJson=function(a){return d.prototype._toJson.call(this,a)},n.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.modified=a.modified||l.modified,c._fromKeyValuesJson(a,b)})},n.prototype._fromKeyValuesJson=function(b,c){var d=null,e=this;if(this.comments=l.comments.slice(),this.attachments=l.attachments.slice(),this.keyValues=l.keyValues.slice(),this.cover=b.cover||l.cover,b.keyValues&&b.keyValues.length){var f=b.keyValues.sort(function(a,b){return b.modified>a.modified});a.each(f,function(a,b){switch(b.key){case h:d=e._getComment(b,c),d&&(e.comments=e.comments||[],e.comments.push(d));break;case j:case i:case k:d=e._getAttachment(b,c),d&&(e.attachments=e.attachments||[],e.attachments.push(d));break;default:d=e._getKeyValue(b,c),d&&(e.keyValues=e.keyValues||[],e.keyValues.push(d))}})}return a.Deferred().resolve(b)},n.prototype._getComment=function(b,c){var d=a.extend({ds:this.ds,fields:this.fields},c||{},b);return new e(d)},n.prototype._getAttachment=function(b,c){var d=a.extend({ds:this.dsAttachments,fields:this.fields},c||{},b);return new f(d)},n.prototype._getKeyValue=function(b,c){var d=a.extend({ds:this.ds,fields:this.fields},c||{},b);return new g(d)},n}(a,q,r,s,y,z,w),B=function(a,b){var c="cheqroom.Comment",d=function(){};d.prototype=b.prototype;var e=function(a){a=a||{},a.key=c,a.kind="string",b.call(this,a)};return e.prototype=new d,e.prototype.constructor=e,e}(a,w),C=function(a){var b={kind:"",doc:"",item:"",itemName:"",locationCurrent:"",locationDesired:"",fromDate:null,toDate:null},c=function(a){this.ds=a.ds,this.fields=a.fields,this.raw=null,this.kind=a.kind||b.kind,this.doc=a.doc||b.doc,this.item=a.item||b.item,this.itemName=a.itemName||b.itemName,this.locationCurrent=a.locationCurrent||b.locationCurrent,this.locationDesired=a.locationDesired||b.locationDesired,this.fromDate=a.fromDate||b.fromDate,this.toDate=a.toDate||b.toDate};return c.prototype._toJson=function(a){return{kind:this.kind,doc:this.doc,item:this.item,itemName:this.itemName,locationCurrent:this.locationCurrent,locationDesired:this.locationDesired,fromDate:this.fromDate,toDate:this.toDate}},c.prototype._fromJson=function(c,d){return this.raw=c,this.kind=c.kind||b.kind,this.item=c.item||b.item,this.itemName=c.itemName||b.itemName,this.fromDate=c.fromDate||b.fromDate,this.toDate=c.toDate||b.toDate,a.Deferred().resolve(c)},c}(a),D=function(a,b,c,d,e,f,g){var h="cheqroom.Comment",i="cheqroom.Attachment",j="cheqroom.prop.Image",k="cheqroom.attachment.Image",l={id:"",modified:null,cover:null,comments:[],attachments:[],keyValues:[]},m=function(){};m.prototype=d.prototype;var n=function(b){var c=a.extend({},b);d.call(this,c),this.dsAttachments=c.dsAttachments,this.crtype=c.crtype,this.modified=c.modified||l.modified,this.comments=c.comments||l.comments.slice(),this.attachments=c.attachments||l.attachments.slice(),this.keyValues=c.keyValues||l.keyValues.slice(),this.cover=c.cover||l.cover};return n.prototype=new m,n.prototype.constructor=n,n.prototype._getDefaults=function(){return l},n.prototype.isEmpty=function(){return!(null!=this.comments&&0!=this.comments.length||null!=this.attachments&&0!=this.attachments.length||null!=this.keyValues&&0!=this.keyValues.length)},n.prototype.canDelete=function(){return this.existsInDb()?this.ds.call(this.id,"canDelete"):a.Deferred().resolve({result:!1,message:""})},n.prototype.addComment=function(a,b){return this.addKeyValue(h,a,"string",b)},n.prototype.updateComment=function(a,b,c){return this.updateKeyValue(a,h,b,"string",c)},n.prototype.deleteComment=function(a,b){return this.removeKeyValue(a,b)},n.prototype.addKeyValue=function(a,b,c,d){return this._doApiCall({method:"addKeyValue",params:{key:a,value:b,kind:c},skipRead:d})},n.prototype.updateKeyValue=function(a,b,c,d,e){return this._doApiCall({method:"updateKeyValue",params:{id:a,key:b,value:c,kind:d},skipRead:e})},n.prototype.removeKeyValue=function(a,b){return this._doApiCall({method:"removeKeyValue",params:{id:a},skipRead:b})},n.prototype.setKeyValue=function(a,b,c,d,e){var f={key:b,value:c,kind:d};return null!=a&&a.length>0&&(f.id=a),this._doApiCall({method:"setKeyValue",params:f,skipRead:e})},n.prototype.moveKeyValueIndex=function(a,b){},n.prototype.getImageUrl=function(a,b,c,d){var e=c||this.cover;return null!=e&&e.length>0?this.helper.getImageCDNUrl(b,e,a):this.helper.getImageUrl(this.ds,this.id,a,d)},n.prototype.setCover=function(a,b){return this._doApiCall({method:"setCover",params:{kvId:a._id},skipRead:b})},n.prototype.attachImage=function(a,b){return this.attach(a,j,b)},n.prototype.attachFile=function(a,b){return this.attach(a,i,b)},n.prototype.attach=function(b,d,e){return this.existsInDb()?this._doApiCall({method:"attach",params:{attachments:[b._id],key:d},skipRead:e}):a.Deferred().reject(new c.ApiError("Cannot attach attachment, id is empty or null"))},n.prototype.detach=function(b,d){return this.existsInDb()?this._doApiCall({method:"detach",params:{attachments:[b],kvId:b},skipRead:d}):a.Deferred().reject(new c.ApiError("Cannot detach attachment, id is empty or null"))},n.prototype._toJson=function(a){return d.prototype._toJson.call(this,a)},n.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.modified=a.modified||l.modified,c._fromKeyValuesJson(a,b)})},n.prototype._fromKeyValuesJson=function(b,c){var d=null,e=this;if(this.comments=l.comments.slice(),this.attachments=l.attachments.slice(),this.keyValues=l.keyValues.slice(),this.cover=b.cover||l.cover,b.keyValues&&b.keyValues.length){var f=b.keyValues.sort(function(a,b){return b.modified>a.modified});a.each(f,function(a,b){switch(b.key){case h:d=e._getComment(b,c),d&&(e.comments=e.comments||[],e.comments.push(d));break;case j:case i:case k:d=e._getAttachment(b,c),d&&(e.attachments=e.attachments||[],e.attachments.push(d));break;default:d=e._getKeyValue(b,c),d&&(e.keyValues=e.keyValues||[],e.keyValues.push(d))}})}return a.Deferred().resolve(b)},n.prototype._getComment=function(b,c){var d=a.extend({ds:this.ds,fields:this.fields},c||{},b);return new e(d)},n.prototype._getAttachment=function(b,c){var d=a.extend({ds:this.dsAttachments,fields:this.fields},c||{},b);return new f(d)},n.prototype._getKeyValue=function(b,c){var d=a.extend({ds:this.ds,fields:this.fields},c||{},b);return new g(d)},n}(a,q,r,s,y,z,w),E=function(a,b,c){var d={name:"",company:"",phone:"",email:""},e=function(){};e.prototype=b.prototype;var f=function(c){var e=a.extend({fields:["*"],crtype:"cheqroom.types.customer"},c);b.call(this,e),this.name=e.name||d.name,this.company=e.company||d.company,this.phone=e.phone||d.phone,this.email=e.email||d.email};return f.prototype=new e,f.prototype.constructor=f,f.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=3},f.prototype.isValidCompany=function(){return this.company=a.trim(this.company),this.company.length>=3},f.prototype.isValidPhone=function(){return this.phone=a.trim(this.phone),c.isValidPhone(this.phone)},f.prototype.isValidEmail=function(){return this.email=a.trim(this.email),c.isValidEmail(this.email)},f.prototype.isValid=function(){return this.isValidName()&&this.isValidCompany()&&this.isValidPhone()&&this.isValidEmail()},f.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==d.name&&this.company==d.company&&this.phone==d.phone&&this.email==d.email},f.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);return!a&&this.raw&&(a=this.name!=this.raw.name||this.company!=this.raw.company||this.phone!=this.raw.phone||this.email!=this.raw.email),a},f.prototype._getDefaults=function(){return d},f.prototype._toJson=function(a){var c=b.prototype._toJson.call(this,a);return c.name=this.name||d.name,c.company=this.company||d.company,c.phone=this.phone||d.phone,c.email=this.email||d.email,c},f.prototype._fromJson=function(c,e){var f=this;return b.prototype._fromJson.call(this,c,e).then(function(b){return f.name=b.name||d.name,f.company=b.company||d.company,f.phone=b.phone||d.phone,f.email=b.email||d.email,a.publish("contact.fromJson",b),b})},f}(a,D,q),F=function(a,b){b.fn.toJSONDate=function(){return this.format("YYYY-MM-DDTHH:mm:ss.000[Z]")},b.fn.roundTo=function(a,c,d){a=b.normalizeUnits(a),c=c||1;var e=function(a){switch(d){case"up":a=Math.ceil(a/c);break;case"down":a=Math.floor(a/c);break;default:a=Math.round(a/c)}return a*c};switch(a){case"year":this.year(e(this.year()));break;case"month":this.month(e(this.month()));break;case"week":this.weekday(e(this.weekday()));break;case"isoWeek":this.isoWeekday(e(this.isoWeekday()));break;case"day":this.day(e(this.day()));break;case"hour":this.hour(e(this.hour()));break;case"minute":this.minute(e(this.minute()));break;case"second":this.second(e(this.second()));break;default:this.millisecond(e(this.millisecond()))}return this};var c=15,d=function(a){a=a||{},this.roundType=a.roundType||"nearest",this.roundMinutes=a.roundMinutes||c};return d.prototype.getNow=function(){return b()},d.prototype.getFriendlyDuration=function(a){return a.humanize()},d.prototype.getFriendlyDateParts=function(a,b,c){b=b||this.getNow(),c=c||"MMM D [at] h:mm a";var d=b.diff(a,"days"),e=Math.abs(d)<7?a.calendar():a.format(c);return e.replace("AM","am").replace("PM","pm").split(" at ")},d.prototype.getFriendlyFromTo=function(a,b,c,d,e,f){d=d||this.getNow();var g=e||" - ",h=this.getFriendlyDateParts(a,d,f),i=this.getFriendlyDateParts(b,d,f),j={dayDiff:a.diff(b,"days"),fromDate:h[0],fromTime:c?h[1]:"",toDate:i[0],toTime:c?i[1]:""};return j.fromText=j.fromDate,j.toText=j.toDate,c&&(j.fromText+=" "+j.fromTime,j.toText+=" "+j.toTime),j.text=0==j.dayDiff?c?j.fromText+g+j.toTime:j.fromText:j.fromText+g+j.toText,j},d.prototype.getFriendlyFromToOld=function(a,c,d){var e=this.roundFromTime(a,d),f=this.roundToTime(c,d);return{from:e,to:f,daysBetween:f.clone().startOf("day").diff(e.clone().startOf("day"),"days"),duration:b.duration(e-f).humanize(),fromText:e.calendar().replace(" at "," "),toText:f.calendar().replace(" at "," ")}},d.prototype.getFriendlyDateText=function(a,b,c,d){if(null==a)return"Not set";var e=this.getFriendlyDateParts(a,c,d);return b?e.join(""):e[0]},d.prototype.addAverageDuration=function(a){return a.clone().add(1,"day")},d.prototype.roundTimeFrom=function(a){return this.roundMinutes<=1?a:this.roundTime(a,this.roundMinutes,this._typeToDirection(this.roundType,"from"))},d.prototype.roundTimeTo=function(a){return this.roundMinutes<=1?a:this.roundTime(a,this.roundMinutes,this._typeToDirection(this.roundType,"to"))},d.prototype.roundTime=function(a,d,e){var f=b.isMoment(a)?a:b(a);return f.seconds(0).milliseconds(0),f.roundTo("minute",d||c,e)},d.prototype.roundTimeUp=function(a,d){var e=b.isMoment(a)?a:b(a);return e.seconds(0).milliseconds(0),e.roundTo("minute",d||c,"up")},d.prototype.roundTimeDown=function(a,d){var e=b.isMoment(a)?a:b(a);return e.seconds(0).milliseconds(0),e.roundTo("minute",d||c,"down")},d.prototype._typeToDirection=function(a,b){switch(a){case"longer":switch(b){case"from":return"down";case"to":return"up"}break;case"shorter":switch(b){case"from":return"up";case"to":return"down"}}},d}(a,b),G=function(a,b,c){var d={id:""},e=function(a){this.ds=a.ds,this.fields=a.fields,this.raw=null,this.id=a.id||d.id};return e.prototype.reset=function(){return this._fromJson(this._getDefaults(),null)},e.prototype.existsInDb=function(){return null!=this.id&&this.id.length>0},e.prototype.isEmpty=function(){return!0},e.prototype.isDirty=function(){return!1},e.prototype.isValid=function(){return!0},e.prototype.discardChanges=function(){return this.raw?this._fromJson(this.raw,null):this.reset()},e.prototype.reload=function(b){return this.existsInDb()?this.get(b):a.Deferred().reject(new c.ApiError("Cannot reload document, id is empty or null"))},e.prototype.get=function(b){if(this.existsInDb()){var d=this;return this.ds.get(this.id,b||this.fields).then(function(a){return d._fromJson(a)})}return a.Deferred().reject(new c.ApiError("Cannot get document, id is empty or null"))},e.prototype.create=function(b){if(this.existsInDb())return a.Deferred().reject(new Error("Cannot create document, already exists in database"));if(this.isEmpty())return a.Deferred().reject(new Error("Cannot create empty document"));if(!this.isValid())return a.Deferred().reject(new Error("Cannot create, invalid document"));var c=this,d=this._toJson();return delete d.id,this.ds.create(d,this.fields).then(function(a){return 1==b?a:c._fromJson(a)})},e.prototype.update=function(b){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot update document without id"));if(this.isEmpty())return a.Deferred().reject(new Error("Cannot update to empty document"));if(!this.isValid())return a.Deferred().reject(new Error("Cannot update, invalid document"));var c=this,d=this._toJson();return delete d.id,this.ds.update(this.id,d,this.fields).then(function(a){return 1==b?a:c._fromJson(a)})},e.prototype["delete"]=function(){if(this.existsInDb()){var b=this;return this.ds["delete"](this.id).then(function(){return b.reset()})}return a.Deferred().reject(new Error("Document does not exist"))},e.prototype._getDefaults=function(){return d},e.prototype._toJson=function(a){return{id:this.id}},e.prototype._fromJson=function(b,c){return this.raw=b,this.id=b._id||d.id,a.Deferred().resolve(b)},e.prototype._getId=function(a,b){return"string"==typeof a?a:a[b||"_id"]},e.prototype._doApiCall=function(a){var b=this;return this.ds.call(1==a.collectionCall?null:a.pk||this.id,a.method,a.params,a.fields||this.fields,a.timeOut,a.usePost).then(function(c){return 1==a.skipRead?c:b._fromJson(c)})},e}(a,q,r),H=function(a,b){var c="cheqroom.prop.Custom",d=0,e=0,f={name:"",status:"",codes:[],flag:"",location:"",category:"",geo:[d,e],address:"",order:null},g=function(){};g.prototype=b.prototype;var h=function(c){var d=a.extend({fields:["*"],crtype:"cheqroom.types.item"},c);b.call(this,d),this.name=d.name||f.name,this.status=d.status||f.status,this.codes=d.codes||f.codes,this.flag=d.flag||f.flag,this.location=d.location||f.location,this.category=d.category||f.category,this.geo=d.geo||f.geo.slice(),this.address=d.address||f.address,this.order=d.order||f.order};return h.prototype=new g,h.prototype.constructor=h,h.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=3},h.prototype.isValidCategory=function(){return a.trim(this.category).length>0},h.prototype.isValidLocation=function(){return a.trim(this.location).length>0},h.prototype.isValid=function(){return this.isValidName()&&this.isValidCategory()&&this.isValidLocation()},h.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==f.name&&this.status==f.status&&0==this.codes.length&&this.flag==f.flag&&this.location==f.location&&this.category==f.category},h.prototype.isDirty=function(){return b.prototype.isDirty.call(this)||this._isDirtyName()||this._isDirtyCategory()||this._isDirtyLocation()||this._isDirtyFlag()||this._isDirtyGeo()},h.prototype._getDefaults=function(){return f},h.prototype._toJson=function(a){var c=b.prototype._toJson.call(this,a);return c.name=this.name||f.name,c.category=this.category||f.category,c.location=this.location||f.location,c},h.prototype._fromJson=function(c,d){var e=this;return b.prototype._fromJson.call(this,c,d).then(function(){e.name=c.name||f.name,e.status=c.status||f.status,e.codes=c.codes||f.codes,e.address=c.address||f.address,e.geo=c.geo||f.geo.slice();var b=f.location;c.location&&(b=c.location._id?c.location._id:c.location),e.location=b;var g=f.category;c.category&&(g=c.category._id?c.category._id:c.category),e.category=g;var h=f.order;return c.order&&(h=c.order._id?c.order._id:c.order),e.order=h,e._fromJsonFlag(c,d).then(function(){return a.publish("item.fromJson",c),c})})},h.prototype._fromJsonFlag=function(b,d){var e=this;return this.flag=f.flag,null!=b.keyValues&&b.keyValues.length>0&&a.each(b.keyValues,function(a,b){return b.key==c?(e.flag=b.value,!1):void 0}),a.Deferred().resolve(b)},h.prototype._getKeyValue=function(a,d){return a.key==c?null:b.prototype._getKeyValue(a,d)},h.prototype._isDirtyName=function(){return this.raw?this.name!=this.raw.name:!1},h.prototype._isDirtyLocation=function(){if(this.raw){var a=f.location;return this.raw.location&&(a=this.raw.location._id?this.raw.location._id:this.raw.location),this.location!=a}return!1},h.prototype._isDirtyCategory=function(){if(this.raw){var a=f.category;return this.raw.category&&(a=this.raw.category._id?this.raw.category._id:this.raw.category),this.category!=a}return!1},h.prototype._isDirtyFlag=function(){if(this.raw){var b=f.flag;return this.raw.keyValues&&this.raw.keyValues.length&&a.each(this.raw.keyValues,function(a,d){return d.key==c?(b=d.value,!1):void 0}),this.flag!=b}return!1},h.prototype._isDirtyGeo=function(){if(this.raw){var a=this.raw.address||f.address,b=this.raw.geo||f.geo.slice();return this.address!=a||this.geo[0]!=b[0]||this.geo[1]!=b[1]}return!1},h.prototype.getAvailabilities=function(a,b){return this.ds.call(this.id,"getAvailability",{fromDate:a,toDate:b})},h.prototype.duplicate=function(a){return this._doApiCall({method:"duplicate",params:{times:a},skipRead:!0})},h.prototype.expire=function(a){return this._doApiCall({method:"expire",skipRead:a})},h.prototype.undoExpire=function(a){return this._doApiCall({method:"undoExpire",skipRead:a})},h.prototype.changeLocation=function(a,b){return this._doApiCall({method:"changeLocation",params:{location:a},skipRead:b})},h.prototype.addCode=function(a,b){return this._doApiCall({method:"addCodes",params:{codes:[a]},skipRead:b})},h.prototype.removeCode=function(a,b){return this._doApiCall({method:"removeCodes",params:{codes:[a]},skipRead:b})},h.prototype.updateGeo=function(a,b,c,d){return this._doApiCall({method:"updateGeo",params:{lat:a,lng:b,address:c},skipRead:d})},h.prototype.updateName=function(a,b){var c=this;return this.ds.update(this.id,{name:a},this.fields).then(function(a){return 1==b?a:c._fromJson(a)})},h.prototype.canChangeCategory=function(a){return this._doApiCall({collectionCall:!0,method:"canChangeCategory",params:{pks:[this.id],category:a},skipRead:!0})},h.prototype.changeCategory=function(a,b){var c=this;return this._doApiCall({collectionCall:!0,method:"changeCategory",params:{pks:[this.id],category:a},skipRead:!0}).then(function(a){return 1==b?a:c._fromJson(a[0])})},h.prototype.setFlag=function(a,b){return this.setKeyValue(null,c,a,"string",b)},h}(a,D),I=function(a){var b={id:"",pk:"",key:"",kind:"string",value:null,modified:null,by:null},c=function(a){this.ds=a.ds,this.fields=a.fields,this.raw=null,this.id=a.id||b.id,this.pk=a.pk||b.pk,this.key=a.key||b.key,this.kind=a.kind||b.kind,this.value=a.value||b.value,this.modified=a.modified||b.modified,this.by=a.by||b.by};return c.prototype.existsInDb=function(){return null!=this.id&&this.id.length>0},c.prototype.getName=function(){var a=this.key.split(";"),b=a[0];return b.split(".").pop().split("+").join(" ")},c.prototype.getUnit=function(){var a=this.key.split(";");return 2==a.length?a[1]:""},c.prototype.isEmpty=function(){return this.id==b.id&&this.pk==b.pk&&this.key==b.key&&this.kind==b.kind&&this.value==b.value&&this.modified==b.modified&&this.by==b.by},c.prototype.isDirty=function(){return!1},c.prototype.isValid=function(){return!0},c.prototype.reset=function(){return this._fromJson(b,null)},c.prototype._toJson=function(a){return{id:this.id,pk:this.pk,key:this.key,kind:this.kind,value:this.value,modified:this.modified,by:this.by}},c.prototype._fromJson=function(c,d){return this.raw=c,this.id=c.id||b.id,this.pk=c.pk||b.pk,this.key=c.key||b.key,this.kind=c.kind||b.kind,this.value=c.value||b.value,this.modified=c.modified||b.modified,this.by=c.by||b.by,a.Deferred().resolve(c)},c}(a),J=function(a,b){var c={name:"",address:""},d=function(){};d.prototype=b.prototype;var e=function(d){var e=a.extend({fields:["*"]},d);b.call(this,e),this.name=e.name||c.name,this.address=e.address||c.address};return e.prototype=new d,e.prototype.constructor=e,e.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==c.name&&this.address==c.address},e.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);if(!a&&this.raw){var d=this.raw.name||c.name,e=this.raw.address||c.address;return this.name!=d||this.address!=e}return a},e.prototype._getDefaults=function(){return c},e.prototype._toJson=function(a){var d=b.prototype._toJson.call(this,a);return d.name=this.name||c.name,d.address=this.address||c.address,d},e.prototype._fromJson=function(d,e){var f=this;return b.prototype._fromJson.call(this,d,e).then(function(){return f.name=d.name||c.name,f.address=d.address||c.address,a.publish("location.fromJson",d),d})},e}(a,D),K=function(a,b){var c={name:"",address:""},d=function(){};d.prototype=b.prototype;var e=function(d){var e=a.extend({fields:["*"]},d);b.call(this,e),this.name=e.name||c.name,this.address=e.address||c.address};return e.prototype=new d,e.prototype.constructor=e,e.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==c.name&&this.address==c.address},e.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);if(!a&&this.raw){var d=this.raw.name||c.name,e=this.raw.address||c.address;return this.name!=d||this.address!=e}return a},e.prototype._getDefaults=function(){return c},e.prototype._toJson=function(a){var d=b.prototype._toJson.call(this,a);return d.name=this.name||c.name,d.address=this.address||c.address,d},e.prototype._fromJson=function(d,e){var f=this;return b.prototype._fromJson.call(this,d,e).then(function(){return f.name=d.name||c.name,f.address=d.address||c.address,a.publish("location.fromJson",d),d})},e}(a,D),L=function(a,b){b.fn.toJSONDate=function(){return this.format("YYYY-MM-DDTHH:mm:ss.000[Z]")},b.fn.roundTo=function(a,c,d){a=b.normalizeUnits(a),c=c||1;var e=function(a){switch(d){case"up":a=Math.ceil(a/c);break;case"down":a=Math.floor(a/c);break;default:a=Math.round(a/c)}return a*c};switch(a){case"year":this.year(e(this.year()));break;case"month":this.month(e(this.month()));break;case"week":this.weekday(e(this.weekday()));break;case"isoWeek":this.isoWeekday(e(this.isoWeekday()));break;case"day":this.day(e(this.day()));break;case"hour":this.hour(e(this.hour()));break;case"minute":this.minute(e(this.minute()));break;case"second":this.second(e(this.second()));break;default:this.millisecond(e(this.millisecond()))}return this};var c=15,d=function(a){a=a||{},this.roundType=a.roundType||"nearest",this.roundMinutes=a.roundMinutes||c};return d.prototype.getNow=function(){return b()},d.prototype.getFriendlyDuration=function(a){return a.humanize()},d.prototype.getFriendlyDateParts=function(a,b,c){b=b||this.getNow(),c=c||"MMM D [at] h:mm a";var d=b.diff(a,"days"),e=Math.abs(d)<7?a.calendar():a.format(c);return e.replace("AM","am").replace("PM","pm").split(" at ")},d.prototype.getFriendlyFromTo=function(a,b,c,d,e,f){d=d||this.getNow();var g=e||" - ",h=this.getFriendlyDateParts(a,d,f),i=this.getFriendlyDateParts(b,d,f),j={dayDiff:a.diff(b,"days"),fromDate:h[0],fromTime:c?h[1]:"",toDate:i[0],toTime:c?i[1]:""};return j.fromText=j.fromDate,j.toText=j.toDate,c&&(j.fromText+=" "+j.fromTime,j.toText+=" "+j.toTime),j.text=0==j.dayDiff?c?j.fromText+g+j.toTime:j.fromText:j.fromText+g+j.toText,j},d.prototype.getFriendlyFromToOld=function(a,c,d){var e=this.roundFromTime(a,d),f=this.roundToTime(c,d);return{from:e,to:f,daysBetween:f.clone().startOf("day").diff(e.clone().startOf("day"),"days"),duration:b.duration(e-f).humanize(),fromText:e.calendar().replace(" at "," "),toText:f.calendar().replace(" at "," ")}},d.prototype.getFriendlyDateText=function(a,b,c,d){if(null==a)return"Not set";var e=this.getFriendlyDateParts(a,c,d);return b?e.join(""):e[0]},d.prototype.addAverageDuration=function(a){return a.clone().add(1,"day")},d.prototype.roundTimeFrom=function(a){return this.roundMinutes<=1?a:this.roundTime(a,this.roundMinutes,this._typeToDirection(this.roundType,"from"))},d.prototype.roundTimeTo=function(a){return this.roundMinutes<=1?a:this.roundTime(a,this.roundMinutes,this._typeToDirection(this.roundType,"to"))},d.prototype.roundTime=function(a,d,e){var f=b.isMoment(a)?a:b(a);return f.seconds(0).milliseconds(0),f.roundTo("minute",d||c,e)},d.prototype.roundTimeUp=function(a,d){var e=b.isMoment(a)?a:b(a);return e.seconds(0).milliseconds(0),e.roundTo("minute",d||c,"up")},d.prototype.roundTimeDown=function(a,d){var e=b.isMoment(a)?a:b(a);return e.seconds(0).milliseconds(0),e.roundTo("minute",d||c,"down")},d.prototype._typeToDirection=function(a,b){switch(a){case"longer":switch(b){case"from":return"down";case"to":return"up"}break;case"shorter":switch(b){case"from":return"up";case"to":return"down"}}},d}(a,b),M=function(a,c,d,e,f,g){var h={status:"creating",from:null,to:null,due:null,contact:"",location:"",items:[],conflicts:[]},i=function(){};i.prototype=d.prototype;var j=function(b){var c=a.extend({},b);d.call(this,c),this.dsItems=c.dsItems,this.autoCleanup=null!=c.autoCleanup?c.autoCleanup:!1,this.dateHelper=c.dateHelper||new f,this.status=c.status||h.status,this.from=c.from||h.from,this.to=c.to||h.to,this.due=c.due||h.due,this.contact=c.contact||h.contact,this.location=c.location||h.location,this.items=c.items||h.items.slice(),this.conflicts=c.conflicts||h.conflicts.slice()};return j.prototype=new i,j.prototype.constructor=d,j.prototype.getNow=function(){return this._getDateHelper().getNow()},j.prototype.getNowRounded=function(){return this._getDateHelper().roundTimeFrom(this.getNow())},j.prototype.getNextTimeSlot=function(a){a=a||this.getNowRounded();var c=b(a).add(this._getDateHelper().roundMinutes,"minutes");return c.isSame(a)&&(c=c.add(this._getDateHelper().roundMinutes,"minutes")),c},j.prototype.getMinDateFrom=function(){return this.getMinDate()},j.prototype.getMaxDateFrom=function(){return this.getMaxDate()},j.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.getMinDateFrom())},j.prototype.getMaxDateTo=function(){return this.getMaxDate()},j.prototype.getMinDateDue=function(){return this.getMinDateTo()},j.prototype.getMaxDateDue=function(){return this.getMaxDateTo()},j.prototype.getMinDate=function(){return this.getNow()},j.prototype.getMaxDate=function(){var a=this._getDateHelper(),b=a.getNow(),c=a.roundTimeTo(b);return c.add(365,"day")},j.prototype.suggestEndDate=function(a){var b=this._getDateHelper(),c=b.addAverageDuration(a||b.getNow());return b.roundTimeTo(c)},j.prototype.isEmpty=function(){return d.prototype.isEmpty.call(this)&&this.status==h.status&&this.from==h.from&&this.to==h.to&&this.due==h.due&&this.contact==h.contact&&this.location==h.location&&0==this.items.length;

},j.prototype.isDirty=function(){return d.prototype.isDirty.call(this)||this._isDirtyBasic()||this._isDirtyDates()||this._isDirtyLocation()||this._isDirtyContact()||this._isDirtyItems()},j.prototype._isDirtyBasic=function(){if(this.raw){var a=this.raw.status||h.status;return this.status!=a}return!1},j.prototype._isDirtyDates=function(){if(this.raw){var a=this.raw.from||h.from,b=this.raw.to||h.to,c=this.raw.due||h.due;return this.from!=a||this.to!=b||this.due!=c}return!1},j.prototype._isDirtyLocation=function(){if(this.raw){var a=h.location;return this.raw.location&&(a=this.raw.location._id?this.raw.location._id:this.raw.location),this.location!=a}return!1},j.prototype._isDirtyContact=function(){if(this.raw){var a=h.contact;return this.raw.customer&&(a=this.raw.customer._id?this.raw.customer._id:this.raw.customer),this.contact!=a}return!1},j.prototype._isDirtyItems=function(){if(this.raw){{h.items.slice()}return this.raw.items,!1}return!1},j.prototype._getDefaults=function(){return h},j.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.due=this.due,this.location&&(b.location=this._getId(this.location)),this.contact&&(b.customer=this._getId(this.contact)),b},j.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.cover=null,c.status=a.status||h.status,c.location=a.location||h.location,c.contact=a.customer||h.contact,c.items=a.items||h.items.slice(),c._getConflicts().then(function(a){c.conflicts=a})})},j.prototype._toLog=function(a){var b=this._toJson(a);b.minDateFrom=this.getMinDateFrom().toJSONDate(),b.maxDateFrom=this.getMaxDateFrom().toJSONDate(),b.minDateDue=this.getMinDateDue().toJSONDate(),b.maxDateDue=this.getMaxDateDue().toJSONDate(),b.minDateTo=this.getMinDateTo().toJSONDate(),b.maxDateTo=this.getMaxDateTo().toJSONDate()},j.prototype._checkFromDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateFrom(),this.getMaxDateFrom())},j.prototype._checkDueDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateDue(),this.getMaxDateDue())},j.prototype._checkToDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateTo(),this.getMaxDateTo())},j.prototype.clearFromDate=function(a){return this.from=h.from,this._handleTransaction(a)},j.prototype.setFromDate=function(a,b){return this.from=this._getDateHelper().roundTimeFrom(a),this._handleTransaction(b)},j.prototype.clearToDate=function(a){return this.to=h.to,this._handleTransaction(a)},j.prototype.setToDate=function(a,b){return this.to=this._getDateHelper().roundTimeTo(a),this._handleTransaction(b)},j.prototype.clearDueDate=function(a){return this.due=h.due,this._handleTransaction(a)},j.prototype.setDueDate=function(a,b){return this.due=this._getDateHelper().roundTimeTo(a),this._handleTransaction(b)},j.prototype.setLocation=function(a,b){return this.location=a,this.existsInDb()?this._doApiCall({method:"setLocation",params:{location:a},skipRead:b}):this._createTransaction(b)},j.prototype.clearLocation=function(a){var b=this;return this.location=h.location,this._doApiCall({method:"clearLocation",skipRead:a}).then(function(){return b._ensureTransactionDeleted()})},j.prototype.setContact=function(a,b){return this.contact=a,this.existsInDb()?this._doApiCall({method:"setCustomer",params:{customer:a},skipRead:b}):this._createTransaction(b)},j.prototype.clearContact=function(a){var b=this;return this.contact=h.contact,this._doApiCall({method:"clearCustomer",skipRead:a}).then(function(){return b._ensureTransactionDeleted()})},j.prototype.addItems=function(a,b){var c=this;return this._ensureTransactionExists(b).then(function(){return c._doApiCall({method:"addItems",params:{items:a},skipRead:b})})},j.prototype.removeItems=function(b,c){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot removeItems from document without id"));var d=this;return this._doApiCall({method:"removeItems",params:{items:b},skipRead:c}).then(function(){return d._ensureTransactionDeleted()})},j.prototype.clearItems=function(b){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot clearItems from document without id"));var c=this;return this._doApiCall({method:"clearItems",skipRead:b}).then(function(){return c._ensureTransactionDeleted()})},j.prototype.swapItem=function(b,c,d){return this.existsInDb()?this._doApiCall({method:"swapItem",params:{fromItem:b,toItem:c},skipRead:d}):a.Deferred().reject(new Error("Cannot clearItems from document without id"))},j.prototype.hasItems=function(b){var c=this.items||[],d=[],e=null;return a.each(b,function(b,f){a.each(c,function(a,b){return b._id==f?(e=f,!1):void 0}),null!=e&&d.push(e)}),d},j.prototype._getConflicts=function(){return a.Deferred().resolve([])},j.prototype._getDateHelper=function(){return this.dateHelper},j.prototype._searchItems=function(b,d,e,f,g){if(null==this.dsItems)return a.Deferred().reject(new c.ApiBadRequest(this.crtype+" has no DataSource for items"));b=b||{},b.location=this._getId(this.location),null!=d&&d.length>0&&(b.listName=d);var h=this,i=null;return g&&g.length&&(i=g.slice(0),a.each(i,function(a,b){i[a]=h._getId(b)})),1==e?(b.onlyUnbooked=null!=f?f:!0,b.fromDate=this.from,b.toDate=this.to,b._limit=b._limit||20,b._skip=b._skip||0,i&&i.length&&(b.skipItems=i),this.dsItems.call(null,"searchAvailable",b)):(i&&i.length&&(b.pk__nin=i),this.dsItems.search(b))},j.prototype._checkDateBetweenMinMax=function(b,d,e){if(d=d||this.getMinDate(),e=e||this.getMaxDate(),d>b||b>e){var f="date "+b.toJSONDate()+" is outside of min max range "+d.toJSONDate()+"->"+e.toJSONDate();return a.Deferred().reject(new c.ApiUnprocessableEntity(f))}return a.Deferred().resolve(b)},j.prototype._handleTransaction=function(b){var c=this.isEmpty();return this.existsInDb()?c?this.autoCleanup?this._deleteTransaction():a.Deferred().resolve():this._updateTransaction(b):c?a.Deferred().resolve():this._createTransaction(b)},j.prototype._deleteTransaction=function(){return this["delete"]()},j.prototype._updateTransaction=function(a){return this.update(a)},j.prototype._createTransaction=function(a){return this.create(a)},j.prototype._ensureTransactionExists=function(b){return this.existsInDb()?a.Deferred().resolve():this._createTransaction(b)},j.prototype._ensureTransactionDeleted=function(){return this.isEmpty()&&this.autoCleanup?this._deleteTransaction():a.Deferred().resolve()},j}(a,r,D,K,L,v),N=function(a){var b={kind:"",doc:"",item:"",itemName:"",locationCurrent:"",locationDesired:"",fromDate:null,toDate:null},c=function(a){this.ds=a.ds,this.fields=a.fields,this.raw=null,this.kind=a.kind||b.kind,this.doc=a.doc||b.doc,this.item=a.item||b.item,this.itemName=a.itemName||b.itemName,this.locationCurrent=a.locationCurrent||b.locationCurrent,this.locationDesired=a.locationDesired||b.locationDesired,this.fromDate=a.fromDate||b.fromDate,this.toDate=a.toDate||b.toDate};return c.prototype._toJson=function(a){return{kind:this.kind,doc:this.doc,item:this.item,itemName:this.itemName,locationCurrent:this.locationCurrent,locationDesired:this.locationDesired,fromDate:this.fromDate,toDate:this.toDate}},c.prototype._fromJson=function(c,d){return this.raw=c,this.kind=c.kind||b.kind,this.item=c.item||b.item,this.itemName=c.itemName||b.itemName,this.fromDate=c.fromDate||b.fromDate,this.toDate=c.toDate||b.toDate,a.Deferred().resolve(c)},c}(a),O=function(a,c,d,e){var f=function(){};f.prototype=d.prototype;var g=function(b){var c=a.extend({crtype:"cheqroom.types.order",fields:["*"]},b);d.call(this,c)};return g.prototype=new f,g.prototype.constructor=g,g.prototype.getMinDateFrom=function(){return this.getNowRounded()},g.prototype.getMinDateDue=function(){return"open"==this.status?this.getNextTimeSlot():d.prototype.getMinDateDue.call(this)},g.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.fromDate=null!=this.fromDate?this.fromDate.toJSONDate():"null",b.toDate=null!=this.toDate?this.toDate.toJSONDate():"null",b.due=null!=this.due?this.due.toJSONDate():"null",b},g.prototype._fromJson=function(b,c){var e=this;return e.from=null==b.started||"null"==b.started?null:b.started,e.to=null==b.finished||"null"==b.finished?null:b.finished,e.due=null==b.due||"null"==b.due?null:b.due,d.prototype._fromJson.call(this,b,c).then(function(){return a.publish("order.fromJson",b),b})},g.prototype.getFriendlyDuration=function(){var a=this.getDuration();return null!=a?this._getDateHelper().getFriendlyDuration(a):""},g.prototype.getDuration=function(){if(null!=this.from){var a="closed"==this.status?this.to:this.due;if(a)return b.duration(a-this.from)}return null},g.prototype.canGenerateAgreement=function(){return"open"==this.status||"closed"==this.status},g.prototype.canCheckin=function(){return"open"==this.status},g.prototype.canCheckout=function(){return"creating"==this.status&&this.location&&this.contact&&this.due&&this.due.isAfter(this._getDateHelper().getNow())&&this.items&&this.items.length},g.prototype.canUndoCheckout=function(){return"open"==this.status},g.prototype._getConflicts=function(){var b=[];if("creating"==this.status&&this.items.length>0){var c=this._getId(this.location);if(a.each(this.items,function(a,d){"expired"==d.status?b.push(new e({kind:"expired",item:d._id,itemName:d.name,locationCurrent:d.location,locationDesired:c})):d.location!=c&&b.push(new e({kind:"location",item:d._id,itemName:d.name,locationCurrent:d.location,locationDesired:c}))}),this.due){var d=this,f="",g=null;return this.dsItems.call(null,"getAvailabilities",{items:a.map(this.items,function(a){return a._id}),fromDate:this.from,toDate:this.due}).then(function(c){return a.each(c,function(c,h){g=a.grep(d.items,function(a){return a._id==h.item}),g&&g.length>0&&(g=g[0]),null!=g&&"expired"!=g.status&&h.order!=d.id&&(f="",f=f||h.order?"order":"",f=f||h.reservation?"reservation":"",b.push(new e({kind:f,item:g._id,itemName:g.name,fromDate:h.fromDate,toDate:h.toDate,doc:h.order||h.reservation})))}),b})}}return a.Deferred().resolve(b)},g.prototype.setFromDueDate=function(b,d,e){if("creating"!=this.status)return a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order from / due date, status is "+this.status));var f=this,g=this.getMinDateFrom(),h=d?this._getDateHelper().roundTimeTo(d):this._getDateHelper().addAverageDuration(g);return this._checkFromDueDate(g,h).then(function(){return f.from=g,f.due=h,f._handleTransaction(e)})},g.prototype.setFromDate=function(b,d){if("creating"!=this.status)return a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order from date, status is "+this.status));var e=this,f=this._getDateHelper().roundTimeFrom(b);return this._checkFromDueDate(f,this.due).then(function(){return e.from=f,e._handleTransaction(d)})},g.prototype.clearFromDate=function(b){return"creating"!=this.status?a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot clear order from date, status is "+this.status)):(this.from=null,this._handleTransaction(b))},g.prototype.setDueDate=function(b,d){if("creating"!=this.status&&"open"!=this.status)return a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order due date, status is "+this.status));var e=this,f=this._getDateHelper().roundTimeTo(b);return this.from=this.getMinDateFrom(),this._checkDueDateBetweenMinMax(f).then(function(){return e.due=f,e._handleTransaction(d)})},g.prototype.clearDueDate=function(b){return"creating"!=this.status?a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot clear order due date, status is "+this.status)):(this.due=null,this._handleTransaction(b))},g.prototype.setToDate=function(a,b){throw"Order.setToDate not implemented, it is set during order close"},g.prototype.clearToDate=function(a,b){throw"Order.clearToDate not implemented, it is set during order close"},g.prototype.searchItems=function(a,b,c,d){return this._searchItems(a,"available",b,c,d||this.items)},g.prototype.checkin=function(a,b,c){return this._doApiCall({method:"checkin",params:{items:a,location:b},skipRead:c})},g.prototype.checkout=function(a){return this._doApiCall({method:"checkout",skipRead:a})},g.prototype.undoCheckout=function(a){return this._doApiCall({method:"undoCheckout",skipRead:a})},g.prototype.generateAgreement=function(a){return this._doApiCall({method:"generateAgreement",skipRead:a})},g.prototype._checkFromDueDate=function(b,d){var e=this._getDateHelper(),f=b,g=d;return f&&g?a.when(this._checkDateBetweenMinMax(f),this._checkDateBetweenMinMax(g)).then(function(b,d){var h=e.roundMinutes;return g.diff(f,"minutes")<h?a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order from date, after (or too close to) to date "+g.toJSONDate())):f.diff(g,"minutes")>h?a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot set order due date, before (or too close to) from date "+f.toJSONDate())):void 0}):f?this._checkDateBetweenMinMax(f):g?this._checkDateBetweenMinMax(g):a.Deferred().reject(new c.ApiUnprocessableEntity("Cannot from/due date, both are null"))},g}(a,r,M,N),P=function(a,b,c,d){var e=function(){};e.prototype=c.prototype;var f=function(b){var d=a.extend({crtype:"cheqroom.types.reservation",fields:["*"]},b);c.call(this,d),this.conflicts=[]};return f.prototype=new e,f.prototype.constructor=f,f.prototype.getMinDateFrom=function(){return this.getNextTimeSlot()},f.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.from)},f.prototype.canReserve=function(){return"creating"==this.status&&this.location&&this.contact&&this.from&&this.to&&this.items&&this.items.length},f.prototype.canCancel=function(){return"open"==this.status},f.prototype.canEdit=function(){return"creating"==this.status},f.prototype.canDelete=function(){return"creating"==this.status},f.prototype.canMakeOrder=function(){if("open"==this.status&&null!=this.to&&this.to.isAfter(this.getNow())){var b=this._getUnavailableItems(),c=a.map(b,function(a,b){return b}).length;return 0==c}return!1},f.prototype._toJson=function(a){var b=c.prototype._toJson.call(this,a);return b.fromDate=null!=this.from?this.from.toJSONDate():"null",b.toDate=null!=this.to?this.to.toJSONDate():"null",b},f.prototype._fromJson=function(b,d){var e=this;return e.from=null==b.fromDate||"null"==b.fromDate?null:b.fromDate,e.to=null==b.toDate||"null"==b.toDate?null:b.toDate,e.due=null,c.prototype._fromJson.call(this,b,d).then(function(){return e.existsInDb()?e._loadConflicts(b,d).then(function(){a.publish("reservation.fromJson",b)}):void a.publish("reservation.fromJson",b)})},f.prototype._getConflicts=function(){var b=[],c=null;if(this.items&&this.items.length&&(this.location||this.from&&this.to))if("open"==this.status){var e=this._getId(this.location);a.each(this.items,function(a,c){"available"!=c.status?b.push(new d({kind:"status",item:c._id,itemName:c.name,doc:c.order})):c.location!=e&&b.push(new d({kind:"location",item:c._id,itemName:c.name,locationCurrent:c.location,locationDesired:e,doc:c.order}))})}else if("creating"==this.status){var f=this;return this.ds.call(this.id,"getConflicts").then(function(e){e&&e.length&&a.each(f.items,function(f,g){if(c=a.grep(e,function(a){return a.item==g._id})){var h="";h=h||c.order?"order":"",h=h||c.reservation?"reservation":"",b.push(new d({kind:h,item:g._id,itemName:g.name,doc:c.conflictsWith}))}})})}return a.Deferred().resolve(b)},f.prototype.setFromToDate=function(c,d,e){if("creating"!=this.status)return a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation from / to date, status is "+this.status));var f=this,g=this._getDateHelper().roundTimeFrom(c),h=d?this._getDateHelper().roundTimeTo(d):this._getDateHelper().addAverageDuration(g);return this._checkFromToDate(g,h).then(function(){return f.from=g,f.to=h,f._handleTransaction(e)})},f.prototype.setFromDate=function(c,d){if("creating"!=this.status)return a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation from date, status is "+this.status));var e=this,f=this._getDateHelper(),g=f.roundMinutes,h=f.roundTimeFrom(c);return this._checkFromDateBetweenMinMax(h).then(function(){return e.to&&e.to.diff(h,"minutes")<g?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation from date, after (or too close to) to date "+e.to.toJSONDate())):(e.from=h,e._handleTransaction(d))})},f.prototype.clearFromDate=function(c){return"creating"!=this.status?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot clear reservation from date, status is "+this.status)):(this.from=null,this._handleTransaction(c))},f.prototype.setToDate=function(c,d){if("creating"!=this.status)return a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation to date, status is "+this.status));var e=this,f=this._getDateHelper(),g=f.roundMinutes,h=f.roundTimeTo(c);return this._checkToDateBetweenMinMax(h).then(function(){return e.from&&e.from.diff(h,"minutes")>g?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set reservation to date, before (or too close to) to date "+e.from.toJSONDate())):(e.to=h,e._handleTransaction(d))})},f.prototype.clearToDate=function(c){return"creating"!=this.status?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot clear reservation to date, status is "+this.status)):(this.to=null,this._handleTransaction(c))},f.prototype.clearDueDate=function(a){throw"Reservation.clearDueDate not implemented"},f.prototype.setDueDate=function(a,b){throw"Reservation.setDueDate not implemented"},f.prototype.searchItems=function(a,b,c,d){return this._searchItems(a,null,!0,c,d||this.items)},f.prototype.reserve=function(a){return this._doApiCall({method:"reserve",skipRead:a})},f.prototype.undoReserve=function(a){return this._doApiCall({method:"undoReserve",skipRead:a})},f.prototype.cancel=function(a){return this._doApiCall({method:"cancel",skipRead:a})},f.prototype.makeOrder=function(){return this._doApiCall({method:"makeOrder",skipRead:!0})},f.prototype._checkFromToDate=function(c,d){var e=this._getDateHelper(),f=c,g=d;return f&&g?a.when(this._checkFromDateBetweenMinMax(f),this._checkToDateBetweenMinMax(g)).then(function(c,d){var h=e.roundMinutes;return g.diff(f,"minutes")<h?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set order from date, after (or too close to) to date "+g.toJSONDate())):f.diff(g,"minutes")>h?a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot set order due date, before (or too close to) from date "+f.toJSONDate())):void 0}):f?this._checkFromDateBetweenMinMax(f):g?this._checkToDateBetweenMinMax(g):a.Deferred().reject(new b.ApiUnprocessableEntity("Cannot from/due date, both are null"))},f.prototype._getUnavailableItems=function(){var b={};if("open"==this.status&&this.location&&null!=this.items&&this.items.length>0){var c=this,d=c._getId(c.location);a.each(this.items,function(a,c){"available"!=c.status?(b.status=b.status||[],b.status.push(c._id)):c.location!=d&&(b.location=b.location||[],b.location.push(c._id))})}return b},f.prototype._loadConflicts=function(b,c){var e=this,f=this._getId(this.location),g=null!=f&&f.length>0,h=null!=this.from||null!=this.to,i=null!=this.items&&this.items.length>0,j="creating"!=this.status&&"open"!=this.status;return j||!g&&!h&&!i?(this.conflicts=[],a.Deferred().resolve(b)):"creating"==this.status?this.ds.call(this.id,"getConflicts").then(function(a){e.conflicts=a||[]}):"open"==this.status?(this.conflicts=[],a.each(this.raw.items,function(a,b){"expired"==b.status?e.conflicts.push(new d({item:e._getId(b),kind:"expired"})):"available"!=b.status?e.conflicts.push(new d({item:e._getId(b),kind:"status"})):b.location!=f&&e.conflicts.push(new d({item:e._getId(b),kind:"location"}))}),a.Deferred().resolve(b)):(this.conflicts=[],a.Deferred().resolve(b))},f}(a,r,M,N),Q=function(a,c,d,e,f,g){var h={status:"creating",from:null,to:null,due:null,contact:"",location:"",items:[],conflicts:[]},i=function(){};i.prototype=d.prototype;var j=function(b){var c=a.extend({},b);d.call(this,c),this.dsItems=c.dsItems,this.autoCleanup=null!=c.autoCleanup?c.autoCleanup:!1,this.dateHelper=c.dateHelper||new f,this.status=c.status||h.status,this.from=c.from||h.from,this.to=c.to||h.to,this.due=c.due||h.due,this.contact=c.contact||h.contact,this.location=c.location||h.location,this.items=c.items||h.items.slice(),this.conflicts=c.conflicts||h.conflicts.slice()};return j.prototype=new i,j.prototype.constructor=d,j.prototype.getNow=function(){return this._getDateHelper().getNow()},j.prototype.getNowRounded=function(){return this._getDateHelper().roundTimeFrom(this.getNow())},j.prototype.getNextTimeSlot=function(a){a=a||this.getNowRounded();var c=b(a).add(this._getDateHelper().roundMinutes,"minutes");return c.isSame(a)&&(c=c.add(this._getDateHelper().roundMinutes,"minutes")),c},j.prototype.getMinDateFrom=function(){return this.getMinDate()},j.prototype.getMaxDateFrom=function(){return this.getMaxDate()},j.prototype.getMinDateTo=function(){return this.getNextTimeSlot(this.getMinDateFrom())},j.prototype.getMaxDateTo=function(){return this.getMaxDate()},j.prototype.getMinDateDue=function(){return this.getMinDateTo()},j.prototype.getMaxDateDue=function(){return this.getMaxDateTo()},j.prototype.getMinDate=function(){return this.getNow()},j.prototype.getMaxDate=function(){var a=this._getDateHelper(),b=a.getNow(),c=a.roundTimeTo(b);return c.add(365,"day")},j.prototype.suggestEndDate=function(a){var b=this._getDateHelper(),c=b.addAverageDuration(a||b.getNow());return b.roundTimeTo(c)},j.prototype.isEmpty=function(){return d.prototype.isEmpty.call(this)&&this.status==h.status&&this.from==h.from&&this.to==h.to&&this.due==h.due&&this.contact==h.contact&&this.location==h.location&&0==this.items.length},j.prototype.isDirty=function(){return d.prototype.isDirty.call(this)||this._isDirtyBasic()||this._isDirtyDates()||this._isDirtyLocation()||this._isDirtyContact()||this._isDirtyItems()},j.prototype._isDirtyBasic=function(){if(this.raw){var a=this.raw.status||h.status;return this.status!=a}return!1},j.prototype._isDirtyDates=function(){if(this.raw){var a=this.raw.from||h.from,b=this.raw.to||h.to,c=this.raw.due||h.due;return this.from!=a||this.to!=b||this.due!=c}return!1},j.prototype._isDirtyLocation=function(){if(this.raw){var a=h.location;return this.raw.location&&(a=this.raw.location._id?this.raw.location._id:this.raw.location),this.location!=a}return!1},j.prototype._isDirtyContact=function(){if(this.raw){var a=h.contact;return this.raw.customer&&(a=this.raw.customer._id?this.raw.customer._id:this.raw.customer),this.contact!=a}return!1},j.prototype._isDirtyItems=function(){if(this.raw){{h.items.slice()}return this.raw.items,!1}return!1},j.prototype._getDefaults=function(){return h},j.prototype._toJson=function(a){var b=d.prototype._toJson.call(this,a);return b.due=this.due,this.location&&(b.location=this._getId(this.location)),this.contact&&(b.customer=this._getId(this.contact)),b},j.prototype._fromJson=function(a,b){var c=this;return d.prototype._fromJson.call(this,a,b).then(function(){return c.cover=null,c.status=a.status||h.status,c.location=a.location||h.location,c.contact=a.customer||h.contact,c.items=a.items||h.items.slice(),c._getConflicts().then(function(a){c.conflicts=a})})},j.prototype._toLog=function(a){var b=this._toJson(a);b.minDateFrom=this.getMinDateFrom().toJSONDate(),b.maxDateFrom=this.getMaxDateFrom().toJSONDate(),b.minDateDue=this.getMinDateDue().toJSONDate(),b.maxDateDue=this.getMaxDateDue().toJSONDate(),b.minDateTo=this.getMinDateTo().toJSONDate(),b.maxDateTo=this.getMaxDateTo().toJSONDate()},j.prototype._checkFromDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateFrom(),this.getMaxDateFrom())},j.prototype._checkDueDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateDue(),this.getMaxDateDue())},j.prototype._checkToDateBetweenMinMax=function(a){return this._checkDateBetweenMinMax(a,this.getMinDateTo(),this.getMaxDateTo())},j.prototype.clearFromDate=function(a){return this.from=h.from,this._handleTransaction(a)},j.prototype.setFromDate=function(a,b){return this.from=this._getDateHelper().roundTimeFrom(a),this._handleTransaction(b)},j.prototype.clearToDate=function(a){return this.to=h.to,this._handleTransaction(a)},j.prototype.setToDate=function(a,b){return this.to=this._getDateHelper().roundTimeTo(a),this._handleTransaction(b)},j.prototype.clearDueDate=function(a){return this.due=h.due,this._handleTransaction(a)},j.prototype.setDueDate=function(a,b){return this.due=this._getDateHelper().roundTimeTo(a),this._handleTransaction(b)},j.prototype.setLocation=function(a,b){return this.location=a,this.existsInDb()?this._doApiCall({method:"setLocation",params:{location:a},skipRead:b}):this._createTransaction(b)},j.prototype.clearLocation=function(a){var b=this;return this.location=h.location,this._doApiCall({method:"clearLocation",skipRead:a}).then(function(){return b._ensureTransactionDeleted()})},j.prototype.setContact=function(a,b){return this.contact=a,this.existsInDb()?this._doApiCall({method:"setCustomer",params:{customer:a},skipRead:b}):this._createTransaction(b)},j.prototype.clearContact=function(a){var b=this;return this.contact=h.contact,this._doApiCall({method:"clearCustomer",skipRead:a}).then(function(){return b._ensureTransactionDeleted()})},j.prototype.addItems=function(a,b){var c=this;return this._ensureTransactionExists(b).then(function(){return c._doApiCall({method:"addItems",params:{items:a},skipRead:b})})},j.prototype.removeItems=function(b,c){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot removeItems from document without id"));var d=this;return this._doApiCall({method:"removeItems",params:{items:b},skipRead:c}).then(function(){return d._ensureTransactionDeleted()})},j.prototype.clearItems=function(b){if(!this.existsInDb())return a.Deferred().reject(new Error("Cannot clearItems from document without id"));var c=this;return this._doApiCall({method:"clearItems",skipRead:b}).then(function(){return c._ensureTransactionDeleted()})},j.prototype.swapItem=function(b,c,d){return this.existsInDb()?this._doApiCall({method:"swapItem",params:{fromItem:b,toItem:c},skipRead:d}):a.Deferred().reject(new Error("Cannot clearItems from document without id"))},j.prototype.hasItems=function(b){var c=this.items||[],d=[],e=null;return a.each(b,function(b,f){a.each(c,function(a,b){return b._id==f?(e=f,!1):void 0}),null!=e&&d.push(e)}),d},j.prototype._getConflicts=function(){return a.Deferred().resolve([])},j.prototype._getDateHelper=function(){return this.dateHelper},j.prototype._searchItems=function(b,d,e,f,g){if(null==this.dsItems)return a.Deferred().reject(new c.ApiBadRequest(this.crtype+" has no DataSource for items"));b=b||{},b.location=this._getId(this.location),null!=d&&d.length>0&&(b.listName=d);var h=this,i=null;return g&&g.length&&(i=g.slice(0),a.each(i,function(a,b){i[a]=h._getId(b)})),1==e?(b.onlyUnbooked=null!=f?f:!0,b.fromDate=this.from,b.toDate=this.to,b._limit=b._limit||20,b._skip=b._skip||0,i&&i.length&&(b.skipItems=i),this.dsItems.call(null,"searchAvailable",b)):(i&&i.length&&(b.pk__nin=i),this.dsItems.search(b))},j.prototype._checkDateBetweenMinMax=function(b,d,e){if(d=d||this.getMinDate(),e=e||this.getMaxDate(),d>b||b>e){var f="date "+b.toJSONDate()+" is outside of min max range "+d.toJSONDate()+"->"+e.toJSONDate();return a.Deferred().reject(new c.ApiUnprocessableEntity(f))}return a.Deferred().resolve(b)},j.prototype._handleTransaction=function(b){var c=this.isEmpty();return this.existsInDb()?c?this.autoCleanup?this._deleteTransaction():a.Deferred().resolve():this._updateTransaction(b):c?a.Deferred().resolve():this._createTransaction(b)},j.prototype._deleteTransaction=function(){return this["delete"]()},j.prototype._updateTransaction=function(a){return this.update(a)},j.prototype._createTransaction=function(a){return this.create(a)},j.prototype._ensureTransactionExists=function(b){return this.existsInDb()?a.Deferred().resolve():this._createTransaction(b)},j.prototype._ensureTransactionDeleted=function(){return this.isEmpty()&&this.autoCleanup?this._deleteTransaction():a.Deferred().resolve()},j}(a,r,D,K,L,v),R=function(a,b,c){var d={name:"",email:"",group:"",picture:"",role:"user",active:!0},e=function(){};e.prototype=b.prototype;var f=function(c){var e=a.extend({fields:["*","group","picture"]},c);b.call(this,e),this.helper=e.helper,this.name=e.name||d.name,this.picture=e.picture||d.picture,this.email=e.email||d.email,this.role=e.role||d.role,this.active=null!=e.active?e.active:d.active};return f.prototype=new e,f.prototype.constructor=f,f.prototype.isValidName=function(){return this.name=a.trim(this.name),this.name.length>=4},f.prototype.isValidEmail=function(){return this.email=a.trim(this.email),c.isValidEmail(this.email)},f.prototype.isValidRole=function(){switch(this.role){case"user":case"admin":case"root":return!0;default:return!1}},f.prototype.isValidPassword=function(){this.password=a.trim(this.password);var b=this.password.length,c=this.password.match(/[0-9]/);return b>=4&&c},f.prototype.isValid=function(){return this.isValidName()&&this.isValidEmail()&&this.isValidRole()},f.prototype.isEmpty=function(){return b.prototype.isEmpty.call(this)&&this.name==d.name&&this.email==d.email&&this.role==d.role},f.prototype.isDirty=function(){var a=b.prototype.isDirty.call(this);if(!a&&this.raw){var c=this.raw.name||d.name,e=this.raw.role||d.role,f=this.raw.email||d.email,g=null!=this.raw.active?this.raw.active:d.active;return this.name!=c||this.email!=f||this.role!=e||this.active!=g}return a},f.prototype.getImageUrl=function(a,b){return null!=this.picture&&this.picture.length>0?this.helper.getImageCDNUrl(this.group,this.picture,a,b):this.helper.getImageUrl(this.ds,this.id,a,b)},f.prototype._getDefaults=function(){return d},f.prototype.addKeyValue=function(b,c,d,e){return a.Deferred().reject("Not implemented for User, use setPicture instead?")},f.prototype.addKeyValue=function(b,c,d,e,f){return a.Deferred().reject("Not implemented for User, use setPicture instead?")},f.prototype.removeKeyValue=function(b,c){return a.Deferred().reject("Not implemented for User, use clearPicture instead?")},f.prototype.setPicture=function(b,c){return this.existsInDb()?(this.picture=b,this._doApiCall({method:"setPicture",params:{attachment:b},skipRead:c})):a.Deferred().reject("User does not exist in database")},f.prototype.clearPicture=function(b){return this.existsInDb()?this._doApiCall({method:"clearPicture",skipRead:b}):a.Deferred().reject("User does not exist in database")},f.prototype._toJson=function(a){var c=b.prototype._toJson.call(this,a);return c.name=this.name||d.name,c.email=this.email||d.email,c.group=this.group||d.group,c.role=this.role||d.role,c.active=this.active||d.active,c},f.prototype._fromJson=function(c,e){var f=this;return b.prototype._fromJson.call(this,c,e).then(function(){return f.group=c.group&&null!=c.group._id?c.group._id:c.group||d.group,f.name=c.name||d.name,f.picture=c.picture||d.picture,f.email=c.email||d.email,f.role=c.role||d.role,f.active=null!=c.active?c.active:d.active,a.publish("user.fromJson",c),c})},f}(a,D,q),S=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={};return s.api=a,s.common=r,s.helper=n,s.Availability=b,s.Attachment=c,s.Base=d,s.Comment=e,s.Conflict=f,s.Contact=g,s.DateHelper=h,s.Document=i,s.Item=j,s.KeyValue=k,s.Location=l,s.Order=m,s.Reservation=o,s.Transaction=p,s.User=q,s}(r,t,x,A,B,C,E,F,G,H,I,J,O,v,P,Q,R,q)});