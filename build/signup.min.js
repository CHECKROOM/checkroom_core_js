/*! core 2017-01-23 */
!function(a){"function"==typeof define&&define.amd?define(["jquery","moment","jstz","jquery-jsonp","jquery-pubsub"],a):a($,moment,jstz,jsonp,pubsub)}(function(a,b,c,d,e){var f,g,h,i,j;return f=function(a,b,c){var d=2048;a.ajaxSetup({cache:!1});var e={};return e.NetworkNotConnected=function(a,b){this.code=999,this.message=a||"Connection interrupted",this.opt=b},e.NetworkNotConnected.prototype=new Error,e.NetworkTimeout=function(a,b){this.code=408,this.message=a||"Could not reach the server in time",this.opt=b},e.NetworkTimeout.prototype=new Error,e.ApiError=function(a,b){this.code=500,this.message=a||"Something went wrong on the server",this.opt=b},e.ApiError.prototype=new Error,e.ApiNotFound=function(a,b){this.code=404,this.message=a||"Could not find what you're looking for",this.opt=b},e.ApiNotFound.prototype=new Error,e.ApiBadRequest=function(a,b){this.code=400,this.message=a||"The server did not understand your request",this.opt=b},e.ApiBadRequest.prototype=new Error,e.ApiUnauthorized=function(a,b){this.code=401,this.message=a||"Your session has expired",this.opt=b},e.ApiUnauthorized.prototype=new Error,e.ApiForbidden=function(a,b){this.code=403,this.message=a||"You don't have sufficient rights",this.opt=b},e.ApiForbidden.prototype=new Error,e.ApiUnprocessableEntity=function(a,b){this.code=422,this.message=a||"Some data is invalid",this.opt=b},e.ApiUnprocessableEntity.prototype=new Error,e.ApiPaymentRequired=function(a,b){this.code=402,this.message=a||"Your subscription has expired",this.opt=b},e.ApiPaymentRequired.prototype=new Error,e.ApiServerCapicity=function(a,b){this.code=503,this.message=a||"Back-end server is at capacity",this.opt=b},e.ApiServerCapicity.prototype=new Error,e.ApiAjax=function(a){a=a||{},this.useJsonp=null==a.useJsonp||a.useJsonp,this.timeOut=a.timeOut||1e4,this.responseInTz=!0},e.ApiAjax.prototype.get=function(a,b){return this.useJsonp?this._getJsonp(a,b):this._getAjax(a,b)},e.ApiAjax.prototype.post=function(a,b,c){if(this.useJsonp)throw"ApiAjax cannot post while useJsonp is true";return this._postAjax(a,b,c)},e.ApiAjax.prototype._handleAjaxSuccess=function(a,b,c){return this.responseInTz&&(b=this._fixDates(b)),a.resolve(b)},e.ApiAjax.prototype._handleAjaxError=function(a,b,c,d,f){if("abort"!=c){var g=null;if("timeout"===d)a.reject(new e.NetworkTimeout(g,f));else switch(b&&(b.statusText&&b.statusText.indexOf("Notify user:")>-1&&(g=b.statusText.slice(b.statusText.indexOf("Notify user:")+13)),422==b.status&&b.responseText&&b.responseText.match(/HTTPError: \(.+\)/g).length>0&&(f={detail:b.responseText.match(/HTTPError: \(.+\)/g)[0]})),b.status){case 400:a.reject(new e.ApiBadRequest(g,f));break;case 401:a.reject(new e.ApiUnauthorized(g,f));break;case 402:a.reject(new e.ApiPaymentRequired(g,f));break;case 403:a.reject(new e.ApiForbidden(g,f));break;case 404:a.reject(new e.ApiNotFound(g,f));break;case 408:a.reject(new e.NetworkTimeout(g,f));break;case 422:a.reject(new e.ApiUnprocessableEntity(g,f));break;case 503:a.reject(new e.ApiServerCapicity(g,f));break;case 500:default:a.reject(new e.ApiError(g,f))}}},e.ApiAjax.prototype._postAjax=function(b,c,d,e){var f=a.Deferred(),g=this,h=a.ajax({type:"POST",url:b,data:JSON.stringify(this._prepareDict(c)),contentType:"application/json; charset=utf-8",timeout:d||this.timeOut,success:function(a){return g._handleAjaxSuccess(f,a,e)},error:function(a,b,c){return g._handleAjaxError(f,a,b,c,e)}}),i=f.promise();return i.abort=function(){h.abort()},i},e.ApiAjax.prototype._getAjax=function(b,c,d){var e=a.Deferred(),f=this,g=a.ajax({url:b,timeout:c||this.timeOut,success:function(a){return f._handleAjaxSuccess(e,a,d)},error:function(a,b,c){return f._handleAjaxError(e,a,b,c,d)}}),h=e.promise();return h.abort=function(){g.abort()},h},e.ApiAjax.prototype._getJsonp=function(b,c,d){var f=a.Deferred(),g=this,h=a.jsonp({url:b,type:"GET",timeout:c||this.timeOut,dataType:" jsonp",callbackParameter:"callback",success:function(a,b,c){return g._handleAjaxSuccess(f,a)},error:function(a,b){f.reject(new e.ApiError(null,d))}}),i=f.promise();return i.abort=function(){h.abort()},i},e.ApiAjax.prototype._prepareDict=function(b){return b?(a.each(b,function(a,d){c.isMoment(d)&&(b[a]=d.toJSONDate())}),b):{}},e.ApiAjax.prototype._fixDates=function(b){if("string"==typeof b||b instanceof String){if(b.endsWith("+00:00")){var d=b.length;if(25==d)return c(b.substring(0,d-6));if(32==d)return c(b.substring(0,d-6).split(".")[0])}}else if(b instanceof Object||a.isArray(b)){var e=this;a.each(b,function(a,c){b[a]=e._fixDates(c)})}return b},e.ApiUser=function(a){a=a||{},this.userId=a.userId||"",this.userToken=a.userToken||"",this.tokenType=a.tokenType||""},e.ApiUser.prototype.fromStorage=function(){this.userId=window.localStorage.getItem("userId")||"",this.userToken=window.localStorage.getItem("userToken")||"",this.tokenType=window.localStorage.getItem("tokenType")||""},e.ApiUser.prototype.toStorage=function(){window.localStorage.setItem("userId",this.userId),window.localStorage.setItem("userToken",this.userToken),window.localStorage.setItem("tokenType",this.tokenType)},e.ApiUser.prototype.removeFromStorage=function(){window.localStorage.removeItem("userId"),window.localStorage.removeItem("userToken"),window.localStorage.removeItem("tokenType")},e.ApiUser.prototype.clearToken=function(){window.localStorage.setItem("userToken",null),window.localStorage.setItem("tokenType",null)},e.ApiUser.prototype.isValid=function(){return this.userId&&this.userId.length>0&&this.userToken&&this.userToken.length>0},e.ApiUser.prototype._reset=function(){this.userId="",this.userToken="",this.tokenType=""},e.ApiAuth=function(a){a=a||{},this.urlAuth=a.urlAuth||"",this.ajax=a.ajax,this.version=a.version},e.ApiAuth.prototype.authenticate=function(b,c){var d=this.urlAuth+"?"+a.param({user:b,password:c,auth_v:2,_v:this.version}),e=a.Deferred();return this.ajax.get(d,3e4).done(function(a){"OK"==a.status?e.resolve(a.data):e.reject(a)}).fail(function(a){e.reject(a)}),e.promise()},e.ApiAuthV2=function(a){a=a||{},this.urlAuth=a.urlAuth||"",this.ajax=a.ajax,this.version=a.version},e.ApiAuthV2.prototype.authenticate=function(b,c){var d=this.urlAuth+"?"+a.param({user:b,password:c,auth_v:2,_v:this.version}),f=a.Deferred();return this.ajax.get(d,3e4).done(function(a){if("OK"==a.status)f.resolve(a.data);else{var b=null;b=a.message&&a.message.indexOf("expired")>0?new e.ApiPaymentRequired(a.message):new Error("Your username or password is not correct"),f.reject(b)}}).fail(function(a){f.reject(a)}),f.promise()},e.ApiAnonymous=function(a){a=a||{},this.ajax=a.ajax,this.urlApi=a.urlApi||"",this.version=a.version},e.ApiAnonymous.prototype.call=function(b,c,d,e){this.version&&(c=c||{},c._v=this.version);var f=this.urlApi+"/"+b+"?"+a.param(this.ajax._prepareDict(c));return this.ajax.get(f,d,e)},e.ApiAnonymous.prototype.longCall=function(a,b,c){return this.call(a,b,3e4,c)},e.ApiDataSource=function(a){a=a||{},this.collection=a.collection||"",this.urlApi=a.urlApi||"",this.user=a.user,this.ajax=a.ajax,this.version=a.version;var b=null!=this.user.tokenType&&this.user.tokenType.length>0?this.user.tokenType:"null";this._baseUrl=this.urlApi+"/"+this.user.userId+"/"+this.user.userToken+"/"+b+"/"+this.collection+"/"},e.ApiDataSource.prototype.exists=function(b,c){var d="exists",f=a.Deferred(),g=this,h=this.getBaseUrl()+b,i=this.getParams(c);return a.isEmptyObject(i)||(h+="?"+this.getParams(i)),this._ajaxGet(d,h).done(function(a){f.resolve(a)}).fail(function(a){g.ajax.useJsonp?f.resolve(null):a instanceof e.ApiNotFound?f.resolve(null):f.reject(a)}),f.promise()},e.ApiDataSource.prototype.get=function(b,c){var d="get",e=this.getBaseUrl()+b,f=this.getParamsDict(c);return a.isEmptyObject(f)||(e+="?"+this.getParams(f)),this._ajaxGet(d,e)},e.ApiDataSource.prototype.getIgnore404=function(b,c){var d=this,f=a.Deferred();return this.get(b,c).done(function(a){f.resolve(a)}).fail(function(a){d.ajax.useJsonp?f.resolve(null):a instanceof e.ApiNotFound?f.resolve(null):f.reject(a)}),f.promise()},e.ApiDataSource.prototype.getMultiple=function(b,c){var d="getMultiple",e=this.getBaseUrl()+b.join(",")+",",f=this.getParamsDict(c);return a.isEmptyObject(f)||(e+="?"+this.getParams(f)),this._ajaxGet(d,e)},e.ApiDataSource.prototype.delete=function(a){var b="delete",c=this.getBaseUrl()+a+"/delete";return this._ajaxGet(b,c)},e.ApiDataSource.prototype.deleteMultiple=function(a){var b="deleteMultiple",c=this.getBaseUrl()+a.join(",")+"/delete";return this._ajaxGet(b,c)},e.ApiDataSource.prototype.update=function(b,c,d){var e="update",f=this.getBaseUrl()+b+"/update",g=a.extend({},c);return null!=d&&d.length>0&&(g._fields=a.isArray(d)?d.join(","):d),f+="?"+this.getParams(g),this._ajaxGet(e,f)},e.ApiDataSource.prototype.create=function(b,c){var d="create",e=this.getBaseUrl()+"create",f=a.extend({},b);return null!=c&&c.length>0&&(f._fields=a.isArray(c)?c.join(","):c),e+="?"+this.getParams(f),this._ajaxGet(d,e)},e.ApiDataSource.prototype.createMultiple=function(b,c){var d=a.Deferred(),e=this,f=b.slice(0),g=[],h=function(a){if(a.length>0){var b=a.pop();e.create(b,c).done(function(b){return g.push(b._id),h(a)}).fail(function(a){d.reject(a)})}else d.resolve(g)};return h(f),d.promise()},e.ApiDataSource.prototype.list=function(b,c,d,e,f){b=b||"";var g="list."+b,h=this.getBaseUrl();null!=b&&b.length>0&&(h+="list/"+b+"/");var i=this.getParamsDict(c,d,e,f);return a.isEmptyObject(i)||(h+="?"+this.getParams(i)),this._ajaxGet(g,h)},e.ApiDataSource.prototype.search=function(a,b,c,d,e,f){var g="search",h=this.searchUrl(a,b,c,d,e,f);return this._ajaxGet(g,h)},e.ApiDataSource.prototype.searchUrl=function(b,c,d,e,f,g){var h=this.getBaseUrl()+"search",i=a.extend(this.getParamsDict(c,d,e,f),b);return null!=g&&g.length>0&&(i.mimeType=g),h+="?"+this.getParams(i)},e.ApiDataSource.prototype.call=function(b,c,e,f,g,h){var i="call."+c,j=null!=b&&b.length>0?this.getBaseUrl()+b+"/call/"+c:this.getBaseUrl()+"call/"+c,k=a.extend({},this.getParamsDict(f,null,null,null),e),l=j+"?"+this.getParams(k);return h||l.length>=d?this._ajaxPost(i,j,k,g):this._ajaxGet(i,l,g)},e.ApiDataSource.prototype.callMultiple=function(b,c,e,f,g,h){var i="call."+c,j=this.getBaseUrl()+b.join(",")+"/call/"+c,k=a.extend({},this.getParamsDict(f,null,null,null),e),l=j+"?"+this.getParams(k);return h||l.length>=d?this._ajaxPost(i,j,k,g):this._ajaxGet(i,l,g)},e.ApiDataSource.prototype.longCall=function(a,b,c,d,e){return this.call(a,b,c,d,3e4,e)},e.ApiDataSource.prototype.getBaseUrl=function(){return this._baseUrl},e.ApiDataSource.prototype.getParams=function(b){return a.param(this.ajax._prepareDict(b))},e.ApiDataSource.prototype.getParamsDict=function(b,c,d,e){var f={};return b&&(f._fields=a.isArray(b)?b.join(","):b.replace(/\s/g,"")),c&&(f._limit=c),d&&(f._skip=d),e&&(f._sort=e),this.version&&(f._v=this.version),f},e.ApiDataSource.prototype._ajaxGet=function(a,b,c){return this.ajax.get(b,c,{coll:this.collection,cmd:a})},e.ApiDataSource.prototype._ajaxPost=function(a,b,c,d){return this.ajax.post(b,c,d,{coll:this.collection,cmd:a})},e}(a,d,b),g={amazonBucket:"app"},h={isValidEmail:function(a){var b=/^([\w-\+]+(?:\.[\w-\+]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)},isValidPhone:function(a){var b=/^\d{9,}$/.test(a);if(b)return!0;var c=a.match(/^[\s()+-]*([0-9][\s()+-]*){10,20}(( x| ext)\d{1,5}){0,1}$/);return null!=c&&c.length>0},isValidURL:function(a){var b=/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/;return b.test(a)},isValidPassword:function(a){var b=a.match(/[0-9]/);return a.length>=4&&b}},i=function(a){var b={};return b.sortFields=function(b,c,d,e){var f=[],g=null,h=null;c=c.slice(),null!=d&&(c=c.filter(function(a){return a.form==d}));for(var i=0;i<c.length&&(g=c[i],h=b[g.name],f.push(a.extend({value:h},g)),!(null!=e&&f.length>=e));i++);return f},b.stringifyOrdered=function(a){if(keys=[],a)for(var b in a)keys.push(b);keys.sort();var b,c={};for(var d in keys)b=keys[d],c[b]=a[b];return JSON.stringify(c)},b.areEqual=function(a,c){return b.stringifyOrdered(a||{})==b.stringifyOrdered(c||{})},b.badgeify=function(a){return a>100?"100+":a>10?"10+":a>0?""+a:""},b.getLoginName=function(a,b){var c=/[\s-]*/gim;return a.latinise().toLowerCase().replace(c,"")+"."+b.latinise().toLowerCase().replace(c,"")},b.getUrlParam=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(window.location.href);return d?decodeURIComponent(d[1].replace(/\+/g," ")):null},b.getParsedLines=function(b){if(b&&b.length>0){var c=b.split(/\s*([,;\r\n]+|\s\s)\s*/);return c.filter(function(b,c,d){return b.length>0&&b.indexOf(",")<0&&b.indexOf(";")<0&&a.trim(b).length>0&&d.indexOf(b)>=c})}return[]},b}(a),j=function(a,b,c,d,e,f){var g="1215_cr_90",h="yearly",i="attempt",j="trial",k=function(a){this.ds=a.ds||new c.ApiAnonymous({urlApi:d.urlApi,ajax:new c.ApiAjax({useJsonp:d.useJsonp})}),this.firstName=a.firstName||"",this.lastName=a.lastName||"",this.company=a.lastName||"",this.timezone=a.timezone||b.determine().name(),this.email=a.email||"",this.login=a.login||"",this.password=a.password||"",this.plan=a.plan||g,this.period=a.plan||h,this.source=a.source||"",this.phone=a.phone||"",this.industry=a.industry||"",this.onBeforeCreateAccount=a.onBeforeCreateAccount,this.onCreatedAccount=a.onCreatedAccount,this.onBeforeActivateAccount=a.onBeforeActivateAccount,this.onActivatedAccount=a.onActivatedAccount};return k.prototype.validContactInfo=function(){return this.firstNameIsValid()&&this.lastNameIsValid()&&this.companyIsValid()&&this.emailIsValid()},k.prototype.validCredentials=function(){return this.loginIsValid()&&this.passwordIsValid()},k.prototype.firstNameIsValid=function(){var b=a.trim(this.firstName);return b.length>=2&&b.length<=25},k.prototype.lastNameIsValid=function(){var b=a.trim(this.lastName);return b.length>=2&&b.length<=25},k.prototype.companyIsValid=function(){var b=a.trim(this.company);return b.length>=3&&b.length<=50},k.prototype.companyExists=function(){var a=this.getGroupId();return this.ds.call("accountExists",{account:a}).then(function(a){return a.result})},k.prototype.emailIsValid=function(){return e.isValidEmail(this.email)},k.prototype.emailExists=function(){return this.emailIsValid()?this.ds.call("emailExists",{email:this.email}).then(function(a){return a.result}):a.Deferred().resolve(!0)},k.prototype.loginIsValid=function(){var a=this.login.NoWhiteSpaceInWord().OnlyAlphaNumSpaceUnderscoreAndDot();return a.length>=4&&a==this.login},k.prototype.loginExists=function(){return this.loginIsValid()?this.ds.call("loginExists",{login:this.login}).then(function(a){return a.result}):a.Deferred().resolve(!0)},k.prototype.passwordIsValid=function(){return e.isValidPassword(a.trim(this.password))},k.prototype.phoneIsValid=function(){return e.isValidPhone(a.trim(this.phone))},k.prototype.getGroupId=function(){var b=a.trim(this.company);return b.OnlyAlphaNumSpaceAndUnderscore()},k.prototype.getFullName=function(){var b=a.trim(this.firstName),c=a.trim(this.lastName);return b+" "+c},k.prototype.createAccount=function(){var b=this,c=this.onBeforeCreateAccount||a.Deferred().resolve(),d=this.onCreatedAccount||a.Deferred().resolve();return c().then(function(){return b.ds.longCall("createAccount",{kind:j,period:a.trim(b.period),plan:a.trim(b.plan),company:a.trim(b.company),groupId:b.getGroupId()}).then(function(a){return d(a)})})},k.prototype.activateAccount=function(){var b=this,c=this.onBeforeActivateAccount||a.Deferred().resolve(),d=this.onActivatedAccount||a.Deferred().resolve();return c().then(function(){return b.ds.longCall("activateAccount",{groupId:b.getGroupId(),name:b.getFullName(),login:a.trim(b.login),password:a.trim(b.password),timezone:a.trim(b.timezone),load_sample:!1,owner_customer:!0,maintenance_customer:!0}).then(function(a){return d(a)})})},k.fromQueryString=function(){var a=f.getUrlParam("name","").capitalize(),c=f.getUrlParam("email",""),d=f.getUrlParam("company",""),e=f.getUrlParam("firstName","").capitalize(),j=f.getUrlParam("lastName","").capitalize(),l=f.getUrlParam("login","").toLowerCase(),m=f.getUrlParam("source",i),n=f.getUrlParam("plan",g),o=f.getUrlParam("period",h),p=f.getUrlParam("period",b.determine().name());if(0==e.length&&0==j.length&&a.length>0){var q=a.split(" ");e=q.shift(),j=q.join(" ")}return 0==l.length&&e.length>0&&j.length>0&&(l=f.getLoginName(e,j)),new k({name:a,email:c,company:d,timezone:p,firstName:e,lastName:j,login:l,source:m,plan:n,period:o})},k}(a,c,f,g,h,i)});