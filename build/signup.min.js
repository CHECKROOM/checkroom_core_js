/*! cheqroom-core 2022-01-11 */

!function(t){"function"==typeof define&&define.amd?define(["jquery","moment"],t):t($,moment)}(function(t,e){var i,r,n,o,s,a,u,l,c,p,h,d,m,f,g,y,A,v,w,S;function D(t){this.raw=t=t||{},this.name=t.name||l.name,this.value=t.value||l.value,this.required=t.required||l.required,this.unit=t.unit||l.unit,this.kind=t.kind||l.kind,this.form=t.form||l.form,this.editor=t.editor||l.editor,this.description=t.description||l.description,this.select=t.select||l.select}function x(t,e){this.ds=(t=t||{}).ds||new y.ApiAnonymous({urlApi:e.urlApi,ajax:new y.ApiAjax}),this.firstName=t.firstName||"",this.lastName=t.lastName||"",this.company=t.company||"",this.timezone=t.timezone||"America/New_York",this.email=t.email||"",this.password=t.password||"",this.plan=t.plan||S,this.period=t.period||"yearly",this.deviceKind=t.deviceKind||null,this.source=t.source||"",this.phone=t.phone||"",this.industry=t.industry||"",this.tags=t.tags||[],this.fields=[],this.inviteToken=t.inviteToken||"",this.selfserviceToken=t.selfserviceToken||"",this.onBeforeCreateAccount=t.onBeforeCreateAccount||function(){return g.Deferred().resolve()},this.onCreatedAccount=t.onCreatedAccount||function(){return g.Deferred().resolve()},this.onBeforeActivateAccount=t.onBeforeActivateAccount||function(){return g.Deferred().resolve()},this.onActivatedAccount=t.onActivatedAccount||function(){return g.Deferred().resolve()},this.onBeforeActivateInvite=t.onBeforeActivateInvite||function(){return g.Deferred().resolve()},this.onActivatedInvite=t.onActivatedInvite||function(){return g.Deferred().resolve()},this.onBeforeActivateSelfService=t.onBeforeActivateSelfService||function(){return g.Deferred().resolve()},this.onActivatedSelfService=t.onActivatedSelfService||function(){return g.Deferred().resolve()},this.onContactFields=t.onContactFields||function(){return g.Deferred().resolve()}}return(o=t).fn.ajaxQueue=function(){var i=(new o.Deferred).resolve();return function(t,e){if("function"!=typeof t)throw"must be a function";return i=i.then(t,e||t)}},i=function(l,n){var u=2048,c=function(){};l.ajaxSetup({beforeSend:function(t,e){"GET"==e.type?e.url+=(-1==e.url.indexOf("?")?"?":"&")+"_="+(new Date).getTime():e.data._=(new Date).getTime()}});var s={NetworkNotConnected:function(t,e){this.code=999,this.message=t||"Connection interrupted",this.opt=e}};return s.NetworkNotConnected.prototype=new Error,s.NetworkTimeout=function(t,e){this.code=408,this.message=t||"Could not reach the server in time",this.opt=e},s.NetworkTimeout.prototype=new Error,s.ApiError=function(t,e){this.code=500,this.message=t||"Something went wrong on the server",this.opt=e},s.ApiError.prototype=new Error,s.ApiNotFound=function(t,e){this.code=404,this.message=t||"Could not find what you're looking for",this.opt=e},s.ApiNotFound.prototype=new Error,s.ApiBadRequest=function(t,e){this.code=400,this.message=t||"The server did not understand your request",this.opt=e},s.ApiBadRequest.prototype=new Error,s.ApiUnauthorized=function(t,e){this.code=401,this.message=t||"Your session has expired",this.opt=e},s.ApiUnauthorized.prototype=new Error,s.ApiForbidden=function(t,e){this.code=403,this.message=t||"You don't have sufficient rights",this.opt=e},s.ApiForbidden.prototype=new Error,s.ApiUnprocessableEntity=function(t,e){this.code=422,this.message=t||"Some data is invalid",this.opt=e},s.ApiUnprocessableEntity.prototype=new Error,s.ApiSubscriptionLimit=function(t,e){this.code=422,this.message=t||"You have reached your subscription limit",this.opt=e},s.ApiSubscriptionLimit.prototype=new Error,s.ApiPaymentRequired=function(t,e){this.code=402,this.message=t||"Your subscription has expired",this.opt=e},s.ApiPaymentRequired.prototype=new Error,s.ApiServerCapicity=function(t,e){this.code=503,this.message=t||"Back-end server is at capacity",this.opt=e},s.ApiServerCapicity.prototype=new Error,s.ApiAjax=function(t){this.timeOut=(t=t||{}).timeOut||1e4,this.responseInTz=!0,this.beforeSend=t.beforeSend||function(){}},s.ApiAjax.prototype.get=function(t,e){return c("ApiAjax: get "+t),this._getAjax(t,e)},s.ApiAjax.prototype.post=function(t,e,i){return c("ApiAjax: post "+t),this._postAjax(t,e,i)},s.ApiAjax.prototype._handleAjaxSuccess=function(t,e,i){return this.responseInTz&&(e=this._fixDates(e)),t.resolve(e)},s.ApiAjax.prototype._handleAjaxError=function(t,e,i,r,n){if("abort"!=i){var o="";if("timeout"===r)t.reject(new s.NetworkTimeout(o,n));else{if(e){r={};try{r=JSON.parse(e.responseText)}catch(t){}e.statusText&&-1<e.statusText.indexOf("Notify user:")&&(o=r.message),422==e.status&&(o=r.message,n={detail:r.message,status:r.status})}switch(e.status){case 400:t.reject(new s.ApiBadRequest(o,n));break;case 401:t.reject(new s.ApiUnauthorized(o,n));break;case 402:t.reject(new s.ApiPaymentRequired(o,n));break;case 403:t.reject(new s.ApiForbidden(o,n));break;case 404:t.reject(new s.ApiNotFound(o,n));break;case 408:t.reject(new s.NetworkTimeout(o,n));break;case 422:o&&0<=o.indexOf("limit")&&0<=o.indexOf("reach")?t.reject(new s.ApiSubscriptionLimit(o,n)):t.reject(new s.ApiUnprocessableEntity(o,n));break;case 503:t.reject(new s.ApiServerCapicity(o,n));break;default:t.reject(new s.ApiError(o,n))}}}},s.ApiAjax.prototype._postAjax=function(t,e,i,r){var n=l.Deferred(),o=this,s=l.ajax({type:"POST",url:t,beforeSend:o.beforeSend,data:JSON.stringify(this._prepareDict(e)),contentType:"application/json; charset=utf-8",timeout:i||this.timeOut,success:function(t){return o._handleAjaxSuccess(n,t,r)},error:function(t,e,i){return o._handleAjaxError(n,t,e,i,r)}}),i=n.promise();return i.abort=function(){s.abort()},i},s.ApiAjax.prototype._getAjax=function(t,e,r){var n=l.Deferred(),o=this,i=l.ajax({url:t,beforeSend:o.beforeSend,timeout:e||this.timeOut,success:function(t){return o._handleAjaxSuccess(n,t,r)},error:function(t,e,i){return o._handleAjaxError(n,t,e,i,r)}}),e=n.promise();return e.abort=function(){i.abort()},e},s.ApiAjax.prototype._prepareDict=function(i){return i?(l.each(i,function(t,e){n.isMoment(e)&&(i[t]=e.toJSONDate())}),i):{}},s.ApiAjax.prototype._fixDates=function(i){var r;if("string"==typeof i||i instanceof String){if(i.endsWith("+00:00")){var t=i.length;if(25==t)return n(i.substring(0,t-6));if(32==t)return n(i.substring(0,t-6).split(".")[0])}}else(i instanceof Object||l.isArray(i))&&(r=this,l.each(i,function(t,e){i[t]=r._fixDates(e)}));return i},s.ApiUser=function(t){this.userId=(t=t||{}).userId||"",this.userEmail=t.userEmail||"",this.userToken=t.userToken||"",this.userJwt=t.jwt||"",this.tokenType=t.tokenType||"",this.impersonated=t.impersonated||!1},s.ApiUser.prototype.fromStorage=function(){this.userId=window.localStorage.getItem("userId")||"",this.userEmail=window.localStorage.getItem("userEmail")||"",this.userToken=window.localStorage.getItem("userToken")||"",this.userJwt=window.localStorage.getItem("userJwt")||"",this.tokenType=window.localStorage.getItem("tokenType")||"",this.impersonated="true"===window.localStorage.getItem("impersonated")},s.ApiUser.prototype.toStorage=function(){window.localStorage.setItem("userId",this.userId),window.localStorage.setItem("userEmail",this.userEmail),window.localStorage.setItem("userToken",this.userToken),window.localStorage.setItem("userJwt",this.userJwt),window.localStorage.setItem("tokenType",this.tokenType),window.localStorage.setItem("impersonated",this.impersonated)},s.ApiUser.prototype.removeFromStorage=function(){window.localStorage.removeItem("userId"),window.localStorage.removeItem("userEmail"),window.localStorage.removeItem("userToken"),window.localStorage.removeItem("userJwt"),window.localStorage.removeItem("tokenType"),window.localStorage.removeItem("impersonated")},s.ApiUser.prototype.clearToken=function(){window.localStorage.setItem("userToken",null),window.localStorage.setItem("userJwt",null),window.localStorage.setItem("tokenType",null)},s.ApiUser.prototype.isValid=function(){return c("ApiUser: isValid"),null!=this.userId&&0<this.userId.length&&null!=this.userToken&&0<this.userToken.length},s.ApiUser.prototype._reset=function(){this.userId="",this.userToken="",this.userJwt="",this.tokenType="",this.userEmail="",this.impersonated=!1},s.ApiAuth=function(t){this.urlAuth=(t=t||{}).urlAuth||"",this.ajax=t.ajax,this.version=t.version,this.platform=t.platform,this.device=t.device,this.sso=t.sso,this.allowAccountOwner=void 0===t.allowAccountOwner||t.allowAccountOwner},s.ApiAuth.prototype.authenticate=function(t,e){c("ApiAuth: authenticate "+t);var i=this,e={user:t,password:e,_v:this.version};this.platform&&(e.platform=this.platform),this.device&&(e.device=this.device),this.sso&&(e.sso=this.sso);var r=l.Deferred();return this.ajax.post(this.urlAuth,e,3e4).done(function(t){"OK"!=t.status||-1!=["expired","cancelled_expired","archived"].indexOf(t.subscription)&&!i.allowAccountOwner?r.reject(t):r.resolve(t.data,!0===t.is_impersonated)}).fail(function(t){r.reject(t)}),r.promise()},s.ApiAuthV2=s.ApiAuth,s.ApiAnonymous=function(t){this.ajax=(t=t||{}).ajax,this.urlApi=t.urlApi||"",this.version=t.version},s.ApiAnonymous.prototype.call=function(t,e,i,r){c("ApiAnonymous: call "+t),this.version&&((e=e||{})._v=this.version);var n=this.urlApi+"/"+t,t=n+"?"+l.param(this.ajax._prepareDict(e));return r||u<=t.length?this.ajax.post(n,e,i):this.ajax.get(t,i)},s.ApiAnonymous.prototype.longCall=function(t,e,i){return c("ApiAnonymous: longCall "+t),this.call(t,e,6e4,i)},s.ApiDataSource=function(t){this.collection=(t=t||{}).collection||"",this.urlApi=t.urlApi||"",this.user=t.user,this.ajax=t.ajax,this.version=t.version},s.ApiDataSource.prototype.exists=function(t,e){c("ApiDataSource: "+this.collection+": exists "+t);var i=l.Deferred(),t=this.getBaseUrl()+t,e=this.getParams(e);return l.isEmptyObject(e)||(t+="?"+this.getParams(e)),this._ajaxGet("exists",t).done(function(t){i.resolve(t)}).fail(function(t){t instanceof s.ApiNotFound?i.resolve(null):i.reject(t)}),i.promise()},s.ApiDataSource.prototype.get=function(t,e){c("ApiDataSource: "+this.collection+": get "+t);t=this.getBaseUrl()+t,e=this.getParamsDict(e);return l.isEmptyObject(e)||(t+="?"+this.getParams(e)),this._ajaxGet("get",t)},s.ApiDataSource.prototype.getIgnore404=function(t,e){c("ApiDataSource: "+this.collection+": getIgnore404 "+t);var i=l.Deferred();return this.get(t,e).done(function(t){i.resolve(t)}).fail(function(t){t instanceof s.ApiNotFound?i.resolve(null):i.reject(t)}),i.promise()},s.ApiDataSource.prototype.getMultiple=function(i,r){c("ApiDataSource: "+this.collection+": getMultiple "+i);var t=i.map(function(t,e){return e%100==0?i.slice(e,e+100):null}).filter(function(t){return t}),n=this,o=[],s=new l.fn.ajaxQueue,e=l.Deferred(),a=[],u=e.promise();return u.abort=function(){l.each(a,function(t,e){e.abort()})},l.each(t,function(t,e){var i=n.getBaseUrl()+e.join(","),e=n.getParamsDict(r);l.isEmptyObject(e)||(i+="?"+n.getParams(e)),s(function(){var t=n._ajaxGet("getMultiple",i);return t.then(function(t){t=l.isArray(t)?t:[t],o=o.concat(t)}),a.push(t),t})}),s(function(){return e.resolve(o)}),u},s.ApiDataSource.prototype.delete=function(t){c("ApiDataSource: "+this.collection+": delete "+t);t=this.getBaseUrl()+t+"/delete";return this._ajaxGet("delete",t)},s.ApiDataSource.prototype.deleteMultiple=function(t,e){c("ApiDataSource: "+this.collection+": deleteMultiple "+t);var i="deleteMultiple",r=this.getBaseUrl()+"delete",n={pk:t},t=r+"?"+this.getParams(n);return e||u<=t.length?this._ajaxPost(i,r,n):this._ajaxGet(i,t)},s.ApiDataSource.prototype.update=function(t,e,i,r,n){c("ApiDataSource: "+this.collection+": update "+t);t=this.getBaseUrl()+t+"/update",e=l.extend({},e);null!=i&&0<i.length&&(e._fields=l.isArray(i)?i.join(","):i);i=t+"?"+this.getParams(e);return n||u<=i.length?this._ajaxPost("update",t,e,r):this._ajaxGet("update",i,r)},s.ApiDataSource.prototype.create=function(t,e,i,r){c("ApiDataSource: "+this.collection+": create");var n=this.getBaseUrl()+"create",t=l.extend({},t);null!=e&&0<e.length&&(t._fields=l.isArray(e)?e.join(","):e);e=n+"?"+this.getParams(t);return r||u<=e.length?this._ajaxPost("create",n,t,i):this._ajaxGet("create",e,i)},s.ApiDataSource.prototype.createMultiple=function(t,i){c("ApiDataSource: "+this.collection+": createMultiple ("+t.length+")");var r=l.Deferred(),n=this,t=t.slice(0),o=[],s=function(e){var t;0<e.length?(t=e.pop(),n.create(t,i).done(function(t){return o.push(t._id),s(e)}).fail(function(t){r.reject(t)})):r.resolve(o)};return s(t),r.promise()},s.ApiDataSource.prototype.list=function(t,e,i,r,n){c("ApiDataSource: "+this.collection+": list "+(t=t||""));var o="list."+t,s=this.getBaseUrl();null!=t&&0<t.length&&(s+="list/"+t+"/");n=this.getParamsDict(e,i,r,n);return l.isEmptyObject(n)||(s+="?"+this.getParams(n)),this._ajaxGet(o,s)},s.ApiDataSource.prototype.search=function(t,e,i,r,n,o){c("ApiDataSource: "+this.collection+": search "+t);var s=this.getBaseUrl()+"search",a=this.searchUrl(t,e,i,r,n,o);if(a.length>=u){o=this.searchParams(t,e,i,r,n,o);return this._ajaxPost("search",s,o)}return this._ajaxGet("search",a)},s.ApiDataSource.prototype.searchUrl=function(t,e,i,r,n,o){var s=this.getBaseUrl()+"search",t=l.extend(this.getParamsDict(e,i,r,n),t);return null!=o&&0<o.length&&(t.mimeType=o),s+="?"+this.getParams(t)},s.ApiDataSource.prototype.searchParams=function(t,e,i,r,n,o){this.getBaseUrl();t=l.extend(this.getParamsDict(e,i,r,n),t);return null!=o&&0<o.length&&(t.mimeType=o),t},s.ApiDataSource.prototype.export=function(t,e,i,r,n,o){c("ApiDataSource: "+this.collection+": export "+t);o=this.exportUrl(t,e,i,r,n,o);return this._ajaxGet("export",o)},s.ApiDataSource.prototype.exportUrl=function(t,e,i,r,n,o){var s=this.getBaseUrl()+"call/export",t=l.extend(this.getParamsDict(e,i,r,n),t);return null!=o&&0<o.length&&(t.mimeType=o),s+="?"+this.getParams(t)},s.ApiDataSource.prototype.call=function(t,e,i,r,n,o){c("ApiDataSource: "+this.collection+": call "+e);var s="call."+e,e=null!=t&&0<t.length?this.getBaseUrl()+t+"/call/"+e:this.getBaseUrl()+"call/"+e,r=l.extend({},this.getParamsDict(r,null,null,null),i),i=e+"?"+this.getParams(r);return o||u<=i.length?this._ajaxPost(s,e,r,n):this._ajaxGet(s,i,n)},s.ApiDataSource.prototype.callMultiple=function(t,e,i,r,n,o){c("ApiDataSource: "+this.collection+": call "+e);var s="call."+e,e=this.getBaseUrl()+t.join(",")+"/call/"+e,r=l.extend({},this.getParamsDict(r,null,null,null),i),i=e+"?"+this.getParams(r);return o||u<=i.length?this._ajaxPost(s,e,r,n):this._ajaxGet(s,i,n)},s.ApiDataSource.prototype.longCall=function(t,e,i,r,n){return this.call(t,e,i,r,6e4,n)},s.ApiDataSource.prototype.getBaseUrl=function(t){var e=null!=this.user.tokenType&&0<this.user.tokenType.length?this.user.tokenType:"null";return this.urlApi+"/"+this.user.userId+"/"+("jwt"!==e||t?this.user.userToken:"null")+"/"+(t?"null":e)+"/"+this.collection+"/"},s.ApiDataSource.prototype.getParams=function(t){return l.param(this.ajax._prepareDict(t))},s.ApiDataSource.prototype.getParamsDict=function(t,e,i,r){var n={};return t&&(n._fields=l.isArray(t)?t.join(","):t.replace(/\s/g,"")),e&&(n._limit=e),i&&(n._skip=i),r&&(n._sort=r),this.version&&(n._v=this.version),n},s.ApiDataSource.prototype._ajaxGet=function(t,e,i){return this.ajax.get(e,i,{coll:this.collection,cmd:t})},s.ApiDataSource.prototype._ajaxPost=function(t,e,i,r){return this.ajax.post(e,i,r,{coll:this.collection,cmd:t})},s}(t,e),s=e,a=t,u=r={isValidEmail:function(t){t=t.match(/^([\w-\+']+(?:\.[\w-\+']+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,}(?:\.[a-z]{2})?)$/i);return null!=t&&0<t.length},isValidPhone:function(t){if(t=t.replace(/[^A-Za-z 0-9 \.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,""),$.isNumeric(t))return!0;t=t.match(/^[\s()+-]*([0-9][\s()+-]*){7,20}(( x| ext)\d{1,5}){0,1}$/);return null!=t&&0<t.length},isValidURL:function(t){t=t.match(/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{1,}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_@\!-]+))*$/);return null!=t&&0<t.length},isValidPassword:function(t){var e=t.match(/[0-9]/);return 4<=t.length&&e},isNumeric:function(t,e){$.isNumeric(t);return e?(0^t)===Number(t):$.isNumeric(t)},isValidDate:function(t){return isNaN(t)||(t=parseInt(t)),s(t).isValid()}},l={name:null,value:null,required:!{amazonBucket:"app"},unit:"",kind:"string",form:!1,editor:null,description:"",select:[]},D.prototype.isValid=function(t){var e=a.trim(this.value);if(!this.required&&""==e)return!0;switch(this.kind){case"float":case"decimal":case"currency":return u.isNumeric(e);case"int":return u.isNumeric(e,!0);case"date":case"datetime":return u.isValidDate(e);case"string":case"select":return"phone"==this.editor?u.isValidPhone(e):"email"==this.editor?u.isValidEmail(e):"url"==this.editor?u.isValidURL(e):"number"==this.editor?u.isNumeric(e):""!=e;default:return!0}},D.prototype.isDirty=function(){return this.raw.value!=this.value},D.prototype.isEmpty=function(){return""==a.trim(this.value)},n=D,function(t,d){d.fn.toJSONDate=function(){return this.format("YYYY-MM-DD[T]HH:mm:ss.000[Z]")},d.fn.roundTo=function(t,e,i){t=d.normalizeUnits(t),e=e||1;function r(t){switch(i){case"up":t=Math.ceil(t/e);break;case"down":t=Math.floor(t/e);break;default:t=Math.round(t/e)}return t*e}switch(t){case"year":this.year(r(this.year()));break;case"month":this.month(r(this.month()));break;case"week":this.weekday(r(this.weekday()));break;case"isoWeek":this.isoWeekday(r(this.isoWeekday()));break;case"day":this.day(r(this.day()));break;case"hour":this.hour(r(this.hour()));break;case"minute":this.minute(r(this.minute()));break;case"second":this.second(r(this.second()));break;default:this.millisecond(r(this.millisecond()))}return this};function e(t){this.roundType=(t=t||{}).roundType||"nearest",this.roundMinutes=t.roundMinutes||15,this.timeFormat24=t.timeFormat24||!1,this._momentFormat=this.timeFormat24?"MMM D [at] H:mm":"MMM D [at] h:mm a",this.startOfDayHours=null!=t.startOfDayHours?startOfDayHours:9,this.endOfDayHours=null!=t.endOfDayHours?endOfDayHours:17,this.businessHours=t.businessHours||[],this.weekStart=t.weekStart||1}e.prototype.parseDate=function(t){if(("string"==typeof t||t instanceof String)&&t.endsWith("+00:00")){var e=t.length;return 25==e?d(t.substring(0,e-6)):32==e?d(t.substring(0,e-6).split(".")[0]):void 0}},e.prototype.getNow=function(){return d()},e.prototype.getFriendlyDuration=function(t){return t.humanize()},e.prototype.getFriendlyDateParts=function(t,e,i){return d.isMoment(t)||(t=d(t)),e=e||this.getNow(),t.calendar().replace("AM","am").replace("PM","pm").split(" at ")},e.prototype.getDateRanges=function(t,e,i,r){i&&!d.isMoment(i)&&(i=d(i)),r=r||{year:"year",years:"years",month:"month",months:"months",week:"week",weeks:"weeks",day:"day",days:"days",hour:"hour",hours:"hours"};for(var n,o,s,a=["years","months","weeks","days","hours"],u=[8760,720,168,24,1],l=null,c=-1,p=[],h=0;h<a.length;h++)if(l=a[h],(n=u[h])<=t&&t%n==0){c=h;break}if(i=i||this.getNow(),0<=c)for(h=1;h<=e;h++)o=r[1==(s=h*t)?l.replace("s",""):l],p.push({option:l,hours:s,title:s/u[c]+" "+o,from:i.clone(),to:i.clone().add(s,"hours")});return p.filter(function(t){return global.dateHelper.isValidBusinessDate(t.to)})},e.prototype.getFriendlyFromTo=function(t,e,i,r,n,o){d.isMoment(t)||(t=d(t)),d.isMoment(e)||(e=d(e)),r=r||this.getNow();var s=n||" - ",n=this.getFriendlyDateParts(t,r,o),o=this.getFriendlyDateParts(e,r,o),o={dayDiff:t?t.clone().startOf("day").diff(e,"days"):-1,fromDate:t?n[0]:"No from date set",fromTime:i&&null!=t?n[1]:"",toDate:e?o[0]:"No to date set",toTime:i&&null!=e?o[1]:""};return o.fromText=o.fromDate,o.toText=o.toDate,i&&(o.fromTime&&(o.fromText+=" "+o.fromTime),o.toTime&&(o.toText+=" "+o.toTime)),0==o.dayDiff?o.text=i?o.fromText+s+o.toText:o.fromText:o.text=o.fromText+s+o.toText,o},e.prototype.getFriendlyFromToOld=function(t,e,i){t=this.roundFromTime(t,i),i=this.roundToTime(e,i);return{from:t,to:i,daysBetween:i.clone().startOf("day").diff(t.clone().startOf("day"),"days"),duration:d.duration(t-i).humanize(),fromText:t.calendar().replace(" at "," "),toText:i.calendar().replace(" at "," ")}},e.prototype.makeStartDate=function(t,e,i,r,n,o){return e=null==e||e,i=null!=i&&i,o=o||d(),t=e&&!i?this.roundTimeFrom(t):(i=t.isSame(o,"day"),o=this._makeStartOfBusinessDay(t),!i||t.isBefore(o)?o:this.roundTimeFrom(t)),r&&t.isBefore(r)?r:t},e.prototype.makeEndDate=function(t,e,i,r,n,o){return e=null==e||e,i=null!=i&&i,o=o||d(),t=e&&!i?this.roundTimeTo(t):(e=t.isSame(o,"day"),i=this._makeEndOfBusinessDay(t),o=this._makeEndOfDay(t),e?t.isBefore(i)?i:o:t.isAfter(i)?o:i),n&&t.isAfter(n)?n:t},e.prototype.getFriendlyDateText=function(t,e,i,r){if(null==t)return"Not set";r=this.getFriendlyDateParts(t,i,r);return e?r.join(" "):r[0]},e.prototype.addAverageDuration=function(t){return t.clone().add(1,"day")},e.prototype.roundTimeFrom=function(t){return this.roundMinutes<=1?t:this.roundTime(t,this.roundMinutes,this._typeToDirection(this.roundType,"from"))},e.prototype.roundTimeTo=function(t){return this.roundMinutes<=1?t:this.roundTime(t,this.roundMinutes,this._typeToDirection(this.roundType,"to"))},e.prototype.roundTime=function(t,e,i){t=d.isMoment(t)?t:d(t);return t.seconds(0).milliseconds(0),t.roundTo("minute",e||15,i)},e.prototype.roundTimeUp=function(t,e){t=d.isMoment(t)?t:d(t);return t.seconds(0).milliseconds(0),t.roundTo("minute",e||15,"up")},e.prototype.roundTimeDown=function(t,e){t=d.isMoment(t)?t:d(t);return t.seconds(0).milliseconds(0),t.roundTo("minute",e||15,"down")},e.prototype._typeToDirection=function(t,e){switch(t){case"longer":switch(e){case"from":return"down";case"to":return"up"}break;case"shorter":switch(e){case"from":return"up";case"to":return"down"}}},e.prototype.isValidBusinessDate=function(n){var o=!1;return 0<this.businessHours.length?t.each(this._getBusinessHours(n),function(t,e){var i=d(d.utc(d.duration(e.openTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),r=d(d.utc(d.duration(e.closeTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),e=d(n.clone().format("H:mm"),"H:mm");if(o=e.isBetween(i,r)||e.isSame(i)||e.isSame(r))return!1}):o=!0,o},e.prototype.getValidBusinessDate=function(t){var e=this.getNow(),i=0;for(t.isBefore(e)&&t.date(e.date());!this.isValidBusinessDate(t)||10080<=i;)t=t.add(this.roundMinutes,"minutes"),i+=this.roundMinutes;return t},e.prototype._getBusinessHours=function(e){var t=this.businessHours;return 0<t.length?t.filter(function(t){return t.isoWeekday==e.isoWeekday()}):[]},e.prototype._makeStartOfBusinessDay=function(t){var e=t.clone().hour(this.startOfDayHours).minutes(0).seconds(0).milliseconds(0);return 0<this.businessHours.length&&(0<(t=this._getBusinessHours(t)).length&&(t=d(d.utc(d.duration(t[0].openTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),e.hour(t.hour()).minute(t.minute()))),this.getValidBusinessDate(e)},e.prototype._makeEndOfBusinessDay=function(t){var e=t.clone().hour(this.endOfDayHours).minutes(0).seconds(0).milliseconds(0);return 0<this.businessHours.length&&(0<(t=this._getBusinessHours(t).sort(function(t,e){return t.closeTime<e.closeTime})).length&&(t=d(d.utc(d.duration(t[0].closeTime,"minutes").asMilliseconds()).format("H:mm"),"H:mm"),e.hour(t.hour()).minute(t.minute()))),this.getValidBusinessDate(e)},e.prototype._makeEndOfDay=function(t){return t.clone().hours(23).minutes(45).seconds(0).milliseconds(0)}}(t,e),function(){String.prototype.pluralize=function(t,e){return"is"==this&&1!=t?"are":"this"==this?1==t?this:"these":this.endsWith("s")?(e=e||"es",1==t?this:this+e):this.endsWith("y")?(e=e||"ies",1==t?this:this.substr(0,this.length-1)+e):(e=e||"s",1==t?this:this+e)},String.prototype.capitalize=function(t){return(t?this.toLowerCase():this).replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()})},String.prototype.truncate||(String.prototype.truncate=function(t){t=null!=t?t:25;var t=(e=this.match(RegExp("^.{0,"+t+"}[S]*")))[0].length,e=e[0].replace(/\s$/,"");return t<this.length&&(e+="&hellip;"),e}),String.prototype.isValidUrl||(String.prototype.isValidUrl=function(){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(this)}),String.prototype.hashCode||(String.prototype.hashCode=function(){var t,e,i=0;if(0==this.length)return i;for(t=0,e=this.length;t<e;t++)i=(i<<5)-i+this.charCodeAt(t),i|=0;return i});var e={latin_map:{"Á":"A","Ă":"A","Ắ":"A","Ặ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ǎ":"A","Â":"A","Ấ":"A","Ậ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ä":"A","Ǟ":"A","Ȧ":"A","Ǡ":"A","Ạ":"A","Ȁ":"A","À":"A","Ả":"A","Ȃ":"A","Ā":"A","Ą":"A","Å":"A","Ǻ":"A","Ḁ":"A","Ⱥ":"A","Ã":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ḃ":"B","Ḅ":"B","Ɓ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ć":"C","Č":"C","Ç":"C","Ḉ":"C","Ĉ":"C","Ċ":"C","Ƈ":"C","Ȼ":"C","Ď":"D","Ḑ":"D","Ḓ":"D","Ḋ":"D","Ḍ":"D","Ɗ":"D","Ḏ":"D","ǲ":"D","ǅ":"D","Đ":"D","Ƌ":"D","Ǳ":"DZ","Ǆ":"DZ","É":"E","Ĕ":"E","Ě":"E","Ȩ":"E","Ḝ":"E","Ê":"E","Ế":"E","Ệ":"E","Ề":"E","Ể":"E","Ễ":"E","Ḙ":"E","Ë":"E","Ė":"E","Ẹ":"E","Ȅ":"E","È":"E","Ẻ":"E","Ȇ":"E","Ē":"E","Ḗ":"E","Ḕ":"E","Ę":"E","Ɇ":"E","Ẽ":"E","Ḛ":"E","Ꝫ":"ET","Ḟ":"F","Ƒ":"F","Ǵ":"G","Ğ":"G","Ǧ":"G","Ģ":"G","Ĝ":"G","Ġ":"G","Ɠ":"G","Ḡ":"G","Ǥ":"G","Ḫ":"H","Ȟ":"H","Ḩ":"H","Ĥ":"H","Ⱨ":"H","Ḧ":"H","Ḣ":"H","Ḥ":"H","Ħ":"H","Í":"I","Ĭ":"I","Ǐ":"I","Î":"I","Ï":"I","Ḯ":"I","İ":"I","Ị":"I","Ȉ":"I","Ì":"I","Ỉ":"I","Ȋ":"I","Ī":"I","Į":"I","Ɨ":"I","Ĩ":"I","Ḭ":"I","Ꝺ":"D","Ꝼ":"F","Ᵹ":"G","Ꞃ":"R","Ꞅ":"S","Ꞇ":"T","Ꝭ":"IS","Ĵ":"J","Ɉ":"J","Ḱ":"K","Ǩ":"K","Ķ":"K","Ⱪ":"K","Ꝃ":"K","Ḳ":"K","Ƙ":"K","Ḵ":"K","Ꝁ":"K","Ꝅ":"K","Ĺ":"L","Ƚ":"L","Ľ":"L","Ļ":"L","Ḽ":"L","Ḷ":"L","Ḹ":"L","Ⱡ":"L","Ꝉ":"L","Ḻ":"L","Ŀ":"L","Ɫ":"L","ǈ":"L","Ł":"L","Ǉ":"LJ","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ń":"N","Ň":"N","Ņ":"N","Ṋ":"N","Ṅ":"N","Ṇ":"N","Ǹ":"N","Ɲ":"N","Ṉ":"N","Ƞ":"N","ǋ":"N","Ñ":"N","Ǌ":"NJ","Ó":"O","Ŏ":"O","Ǒ":"O","Ô":"O","Ố":"O","Ộ":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ö":"O","Ȫ":"O","Ȯ":"O","Ȱ":"O","Ọ":"O","Ő":"O","Ȍ":"O","Ò":"O","Ỏ":"O","Ơ":"O","Ớ":"O","Ợ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ȏ":"O","Ꝋ":"O","Ꝍ":"O","Ō":"O","Ṓ":"O","Ṑ":"O","Ɵ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Õ":"O","Ṍ":"O","Ṏ":"O","Ȭ":"O","Ƣ":"OI","Ꝏ":"OO","Ɛ":"E","Ɔ":"O","Ȣ":"OU","Ṕ":"P","Ṗ":"P","Ꝓ":"P","Ƥ":"P","Ꝕ":"P","Ᵽ":"P","Ꝑ":"P","Ꝙ":"Q","Ꝗ":"Q","Ŕ":"R","Ř":"R","Ŗ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ȑ":"R","Ȓ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꜿ":"C","Ǝ":"E","Ś":"S","Ṥ":"S","Š":"S","Ṧ":"S","Ş":"S","Ŝ":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṩ":"S","Ť":"T","Ţ":"T","Ṱ":"T","Ț":"T","Ⱦ":"T","Ṫ":"T","Ṭ":"T","Ƭ":"T","Ṯ":"T","Ʈ":"T","Ŧ":"T","Ɐ":"A","Ꞁ":"L","Ɯ":"M","Ʌ":"V","Ꜩ":"TZ","Ú":"U","Ŭ":"U","Ǔ":"U","Û":"U","Ṷ":"U","Ü":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ǖ":"U","Ṳ":"U","Ụ":"U","Ű":"U","Ȕ":"U","Ù":"U","Ủ":"U","Ư":"U","Ứ":"U","Ự":"U","Ừ":"U","Ử":"U","Ữ":"U","Ȗ":"U","Ū":"U","Ṻ":"U","Ų":"U","Ů":"U","Ũ":"U","Ṹ":"U","Ṵ":"U","Ꝟ":"V","Ṿ":"V","Ʋ":"V","Ṽ":"V","Ꝡ":"VY","Ẃ":"W","Ŵ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẁ":"W","Ⱳ":"W","Ẍ":"X","Ẋ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ẏ":"Y","Ỵ":"Y","Ỳ":"Y","Ƴ":"Y","Ỷ":"Y","Ỿ":"Y","Ȳ":"Y","Ɏ":"Y","Ỹ":"Y","Ź":"Z","Ž":"Z","Ẑ":"Z","Ⱬ":"Z","Ż":"Z","Ẓ":"Z","Ȥ":"Z","Ẕ":"Z","Ƶ":"Z","Ĳ":"IJ","Œ":"OE","ᴀ":"A","ᴁ":"AE","ʙ":"B","ᴃ":"B","ᴄ":"C","ᴅ":"D","ᴇ":"E","ꜰ":"F","ɢ":"G","ʛ":"G","ʜ":"H","ɪ":"I","ʁ":"R","ᴊ":"J","ᴋ":"K","ʟ":"L","ᴌ":"L","ᴍ":"M","ɴ":"N","ᴏ":"O","ɶ":"OE","ᴐ":"O","ᴕ":"OU","ᴘ":"P","ʀ":"R","ᴎ":"N","ᴙ":"R","ꜱ":"S","ᴛ":"T","ⱻ":"E","ᴚ":"R","ᴜ":"U","ᴠ":"V","ᴡ":"W","ʏ":"Y","ᴢ":"Z","á":"a","ă":"a","ắ":"a","ặ":"a","ằ":"a","ẳ":"a","ẵ":"a","ǎ":"a","â":"a","ấ":"a","ậ":"a","ầ":"a","ẩ":"a","ẫ":"a","ä":"a","ǟ":"a","ȧ":"a","ǡ":"a","ạ":"a","ȁ":"a","à":"a","ả":"a","ȃ":"a","ā":"a","ą":"a","ᶏ":"a","ẚ":"a","å":"a","ǻ":"a","ḁ":"a","ⱥ":"a","ã":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ḃ":"b","ḅ":"b","ɓ":"b","ḇ":"b","ᵬ":"b","ᶀ":"b","ƀ":"b","ƃ":"b","ɵ":"o","ć":"c","č":"c","ç":"c","ḉ":"c","ĉ":"c","ɕ":"c","ċ":"c","ƈ":"c","ȼ":"c","ď":"d","ḑ":"d","ḓ":"d","ȡ":"d","ḋ":"d","ḍ":"d","ɗ":"d","ᶑ":"d","ḏ":"d","ᵭ":"d","ᶁ":"d","đ":"d","ɖ":"d","ƌ":"d","ı":"i","ȷ":"j","ɟ":"j","ʄ":"j","ǳ":"dz","ǆ":"dz","é":"e","ĕ":"e","ě":"e","ȩ":"e","ḝ":"e","ê":"e","ế":"e","ệ":"e","ề":"e","ể":"e","ễ":"e","ḙ":"e","ë":"e","ė":"e","ẹ":"e","ȅ":"e","è":"e","ẻ":"e","ȇ":"e","ē":"e","ḗ":"e","ḕ":"e","ⱸ":"e","ę":"e","ᶒ":"e","ɇ":"e","ẽ":"e","ḛ":"e","ꝫ":"et","ḟ":"f","ƒ":"f","ᵮ":"f","ᶂ":"f","ǵ":"g","ğ":"g","ǧ":"g","ģ":"g","ĝ":"g","ġ":"g","ɠ":"g","ḡ":"g","ᶃ":"g","ǥ":"g","ḫ":"h","ȟ":"h","ḩ":"h","ĥ":"h","ⱨ":"h","ḧ":"h","ḣ":"h","ḥ":"h","ɦ":"h","ẖ":"h","ħ":"h","ƕ":"hv","í":"i","ĭ":"i","ǐ":"i","î":"i","ï":"i","ḯ":"i","ị":"i","ȉ":"i","ì":"i","ỉ":"i","ȋ":"i","ī":"i","į":"i","ᶖ":"i","ɨ":"i","ĩ":"i","ḭ":"i","ꝺ":"d","ꝼ":"f","ᵹ":"g","ꞃ":"r","ꞅ":"s","ꞇ":"t","ꝭ":"is","ǰ":"j","ĵ":"j","ʝ":"j","ɉ":"j","ḱ":"k","ǩ":"k","ķ":"k","ⱪ":"k","ꝃ":"k","ḳ":"k","ƙ":"k","ḵ":"k","ᶄ":"k","ꝁ":"k","ꝅ":"k","ĺ":"l","ƚ":"l","ɬ":"l","ľ":"l","ļ":"l","ḽ":"l","ȴ":"l","ḷ":"l","ḹ":"l","ⱡ":"l","ꝉ":"l","ḻ":"l","ŀ":"l","ɫ":"l","ᶅ":"l","ɭ":"l","ł":"l","ǉ":"lj","ſ":"s","ẜ":"s","ẛ":"s","ẝ":"s","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ᵯ":"m","ᶆ":"m","ń":"n","ň":"n","ņ":"n","ṋ":"n","ȵ":"n","ṅ":"n","ṇ":"n","ǹ":"n","ɲ":"n","ṉ":"n","ƞ":"n","ᵰ":"n","ᶇ":"n","ɳ":"n","ñ":"n","ǌ":"nj","ó":"o","ŏ":"o","ǒ":"o","ô":"o","ố":"o","ộ":"o","ồ":"o","ổ":"o","ỗ":"o","ö":"o","ȫ":"o","ȯ":"o","ȱ":"o","ọ":"o","ő":"o","ȍ":"o","ò":"o","ỏ":"o","ơ":"o","ớ":"o","ợ":"o","ờ":"o","ở":"o","ỡ":"o","ȏ":"o","ꝋ":"o","ꝍ":"o","ⱺ":"o","ō":"o","ṓ":"o","ṑ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","õ":"o","ṍ":"o","ṏ":"o","ȭ":"o","ƣ":"oi","ꝏ":"oo","ɛ":"e","ᶓ":"e","ɔ":"o","ᶗ":"o","ȣ":"ou","ṕ":"p","ṗ":"p","ꝓ":"p","ƥ":"p","ᵱ":"p","ᶈ":"p","ꝕ":"p","ᵽ":"p","ꝑ":"p","ꝙ":"q","ʠ":"q","ɋ":"q","ꝗ":"q","ŕ":"r","ř":"r","ŗ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ȑ":"r","ɾ":"r","ᵳ":"r","ȓ":"r","ṟ":"r","ɼ":"r","ᵲ":"r","ᶉ":"r","ɍ":"r","ɽ":"r","ↄ":"c","ꜿ":"c","ɘ":"e","ɿ":"r","ś":"s","ṥ":"s","š":"s","ṧ":"s","ş":"s","ŝ":"s","ș":"s","ṡ":"s","ṣ":"s","ṩ":"s","ʂ":"s","ᵴ":"s","ᶊ":"s","ȿ":"s","ɡ":"g","ᴑ":"o","ᴓ":"o","ᴝ":"u","ť":"t","ţ":"t","ṱ":"t","ț":"t","ȶ":"t","ẗ":"t","ⱦ":"t","ṫ":"t","ṭ":"t","ƭ":"t","ṯ":"t","ᵵ":"t","ƫ":"t","ʈ":"t","ŧ":"t","ᵺ":"th","ɐ":"a","ᴂ":"ae","ǝ":"e","ᵷ":"g","ɥ":"h","ʮ":"h","ʯ":"h","ᴉ":"i","ʞ":"k","ꞁ":"l","ɯ":"m","ɰ":"m","ᴔ":"oe","ɹ":"r","ɻ":"r","ɺ":"r","ⱹ":"r","ʇ":"t","ʌ":"v","ʍ":"w","ʎ":"y","ꜩ":"tz","ú":"u","ŭ":"u","ǔ":"u","û":"u","ṷ":"u","ü":"u","ǘ":"u","ǚ":"u","ǜ":"u","ǖ":"u","ṳ":"u","ụ":"u","ű":"u","ȕ":"u","ù":"u","ủ":"u","ư":"u","ứ":"u","ự":"u","ừ":"u","ử":"u","ữ":"u","ȗ":"u","ū":"u","ṻ":"u","ų":"u","ᶙ":"u","ů":"u","ũ":"u","ṹ":"u","ṵ":"u","ᵫ":"ue","ꝸ":"um","ⱴ":"v","ꝟ":"v","ṿ":"v","ʋ":"v","ᶌ":"v","ⱱ":"v","ṽ":"v","ꝡ":"vy","ẃ":"w","ŵ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẁ":"w","ⱳ":"w","ẘ":"w","ẍ":"x","ẋ":"x","ᶍ":"x","ý":"y","ŷ":"y","ÿ":"y","ẏ":"y","ỵ":"y","ỳ":"y","ƴ":"y","ỷ":"y","ỿ":"y","ȳ":"y","ẙ":"y","ɏ":"y","ỹ":"y","ź":"z","ž":"z","ẑ":"z","ʑ":"z","ⱬ":"z","ż":"z","ẓ":"z","ȥ":"z","ẕ":"z","ᵶ":"z","ᶎ":"z","ʐ":"z","ƶ":"z","ɀ":"z","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ĳ":"ij","œ":"oe","ﬆ":"st","ₐ":"a","ₑ":"e","ᵢ":"i","ⱼ":"j","ₒ":"o","ᵣ":"r","ᵤ":"u","ᵥ":"v","ₓ":"x"}};String.prototype.latinise=function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,function(t){return e.latin_map[t]||t})},String.prototype.latinize=String.prototype.latinise,String.prototype.isLatin=function(){return this==this.latinise()},String.prototype.OnlyAlphaNumSpaceAndUnderscore=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[\W]/g,"")},String.prototype.OnlyAlphaNumSpaceUnderscoreAndDot=function(){return $.trim(this).toLowerCase().replace(/[\s-]+/g,"_").latinise().replace(/[^a-z0-9_\.]/g,"")},String.prototype.NoWhiteSpaceInWord||(String.prototype.NoWhiteSpaceInWord=function(){return this.replace(/[\s]+/g,"")}),String.prototype.addLeadingZero||(String.prototype.addLeadingZero=function(t){var e=this.toString();return e.length<t?("0"+e).addLeadingZero(t):e}),String.prototype.lpad=function(t,e){for(var i=this;i.length<e;)i=t+i;return i},Number.prototype.between||(Number.prototype.between=function(t,e){var i=Math.min(t,e),e=Math.max(t,e);return i<=this&&this<=e}),Array.prototype.joinOther||(Array.prototype.joinOther=function(t,e,i){if(this.length<2)return this.join(e);e=e||", ",i=i||"other",(!t||t<0)&&(t=1);for(var r=this.slice(0),n=r.join(e);1<r.length&&n.length>t;)r.pop(),n=r.join(e);var o=this.length-r.length;return 0<o&&(n+=" +"+o+" "+i),n}),Array.prototype.joinAdvanced||(Array.prototype.joinAdvanced=function(t,e){var i=this.slice(0),r="";return 1===i.length?r=i[0]:2===i.length?r=i.join(e):2<i.length&&(r=i.slice(0,-1).join(t)+e+i.slice(-1)),r}),CanvasRenderingContext2D.prototype.roundRect=function(t,e,i,r,n,o,s){var a={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};if(void 0===s&&(s=!0),"object"==typeof n)for(var u in n)a[u]=n[u];this.beginPath(),this.moveTo(t+a.upperLeft,e),this.lineTo(t+i-a.upperRight,e),this.quadraticCurveTo(t+i,e,t+i,e+a.upperRight),this.lineTo(t+i,e+r-a.lowerRight),this.quadraticCurveTo(t+i,e+r,t+i-a.lowerRight,e+r),this.lineTo(t+a.lowerLeft,e+r),this.quadraticCurveTo(t,e+r,t,e+r-a.lowerLeft),this.lineTo(t,e+a.upperLeft),this.quadraticCurveTo(t,e,t+a.upperLeft,e),this.closePath(),s&&this.stroke(),o&&this.fill()}}(),c=localStorage.setItem,p=localStorage.getItem,h=localStorage.removeItem,d={},Storage.prototype.setItem=function(e,i){try{c.apply(this,[e,i])}catch(t){d[e]=String(i)}return!0},Storage.prototype.getItem=function(e){try{return p.apply(this,[e])}catch(t){return d.hasOwnProperty(e)?d[e]:void 0}return null},Storage.prototype.removeItem=function(e){try{h.apply(this,[e])}catch(t){delete d[e]}return!0},f={sortFields:function(t,e,i,r){var n,o,s=[];e=e.slice(),null!=i&&(e=e.filter(function(t){return t.form==i}));for(var a=0;a<e.length&&(o=t[(n=e[a]).name],s.push(m.extend({value:o},n)),!(null!=r&&s.length>=r));a++);return s},stringifyOrdered:function(t){if(keys=[],t)for(var e in t)keys.push(e);keys.sort();var i,r={};for(i in keys)r[e=keys[i]]=t[e];return JSON.stringify(r)},areEqual:function(t,e){return f.stringifyOrdered(t||{})==f.stringifyOrdered(e||{})},badgeify:function(t){return 100<t?"99+":10<t?"10+":0<t?""+t:""},getLoginName:function(t,e){var i=/[\s-]*/gim,r=[];return t&&r.push(t.latinise().toLowerCase().replace(i,"")),e&&r.push(e.latinise().toLowerCase().replace(i,"")),r.join(".")},getUrlParam:function(t,e,i){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(i||window.location.href);return i?decodeURIComponent(i[1].replace(/\+/g," ")):e}},(m=t).urlParam=f.getUrlParam,f.getParsedLines=function(t){return t&&0<t.length?t.split(/\s*([,;\r\n]+|\s\s)\s*/).filter(function(t,e,i){return 0<t.length&&t.indexOf(",")<0&&t.indexOf(";")<0&&0<m.trim(t).length&&i.indexOf(t)>=e}).map(function(t){return m.trim(t)}):[]},f.getFriendlyFileName=function(t){return t.replace(/[^a-z0-9]/gi,"_").toLowerCase()},f.getFriendlyKind=function(t){return"number"==t?"numeric":"select"==t?"dropdown list":"text"==t?"multi line text":"string"==t?"single line text":t},f.arrayToCSV=function(t,e){var i=new Blob([t],{type:"text/csv;charset=utf-8;"});window.navigator&&window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(i,e):((t=window.document.createElement("a")).download=e,t.href=window.URL.createObjectURL(i),t.style.display="none",window.document.body.appendChild(t),t.click())},f.kFormatter=function(t){return 999<Math.abs(t)?Math.sign(t)*(Math.abs(t)/1e3).toFixed(0)+"k":Math.sign(t)*Math.abs(t)},f.sanitizeHtml=function(t){return m("<div />").text(t).html().replace(/&nbsp;/g," ").replace(/&amp;/g,"&")},f.removeHtmlTags=function(t){return t.replace(/(<([^>]+)>)/gi,"")},g=t,y=i,A=n,v=r,w=f,S="cr_2004_plus_yearly_usd_500",x.prototype.validContactInfo=function(){return this.firstNameIsValid()&&this.lastNameIsValid()&&this.companyIsValid()&&this.emailIsValid()},x.prototype.validCredentials=function(){return this.passwordIsValid()},x.prototype.firstNameIsValid=function(){var t=g.trim(this.firstName);return 2<=t.length&&t.length<=25},x.prototype.lastNameIsValid=function(){var t=g.trim(this.lastName);return 2<=t.length&&t.length<=25},x.prototype.companyIsValid=function(){var t=g.trim(this.company);return 3<=t.length&&t.length<=46},x.prototype.companyExists=function(){var t=this.getGroupId();return this.dfdAccountExists&&this.dfdAccountExists.abort(),this.dfdAccountExists=this.ds.call("accountExists",{account:t}),this.dfdAccountExists.then(function(t){return t.result})},x.prototype.emailIsValid=function(){var t=g.trim(this.email);return v.isValidEmail(t)},x.prototype.emailExists=function(){return this.emailIsValid()?(this.dfdEmailExists&&this.dfdEmailExists.abort(),this.dfdEmailExists=this.ds.call("emailExists",{email:this.email}),this.dfdEmailExists.then(function(t){return t.result})):g.Deferred().resolve(!1)},x.prototype.checkInvited=function(){return this.ds.call("checkInvited",{email:this.email}).then(function(t){return t})},x.prototype.passwordIsValid=function(){return v.isValidPassword(g.trim(this.password))},x.prototype.phoneIsValid=function(){return v.isValidPhone(g.trim(this.phone))},x.prototype.parseFields=function(t){if(!t)return[];var e=[];t=t.filter(function(t){return t.form&&t.required});for(var i=0;i<t.length;i++)e.push(this._getField(t[i]));this.fields=e,this.onContactFields(e)},x.prototype.inviteIsValid=function(){var e=this;return""!=g.trim(this.inviteToken)?this.ds.call("checkInvite",{code:this.inviteToken,email:this.email}).then(function(t){return e.parseFields(t.customerFields),t.result}):g.Deferred().resolve(!1)},x.prototype.selfServiceIsValid=function(){var e=this;return""!=g.trim(this.selfserviceToken)?this.ds.call("checkSelfServiceKey",{key:this.selfserviceToken}).then(function(t){return e.parseFields(t.customerFields),t.result}):g.Deferred().resolve(!1)},x.prototype.getGroupId=function(){return g.trim(this.company).replace(/[\.-\s]/g,"_").OnlyAlphaNumSpaceAndUnderscore()},x.prototype.getFullName=function(){var t=g.trim(this.firstName),e=g.trim(this.lastName);return g.trim(t+" "+e)},x.prototype.setFullName=function(t){t=x.splitFirstLastName(g.trim(t));this.firstName=t.firstName,this.lastName=t.lastName},x.prototype._getField=function(t){return new A(t)},x.prototype.createAccount=function(){var t=this,e=this.onBeforeCreateAccount,i=this.onCreatedAccount;return e().then(function(){return t.ds.longCall("createAccount",{kind:"trial",period:g.trim(t.period),subscription:g.trim(t.plan),company:g.trim(t.company),groupId:t.getGroupId(),signupDevice:t.deviceKind,tags:t.tags},!0).then(function(t){return i(t)})})},x.prototype.activateAccount=function(e){var t=this,i=this.onBeforeActivateAccount,r=this.onActivatedAccount;return i().then(function(){return t.ds.longCall("activateAccount",{groupId:t.getGroupId(),name:t.getFullName(),email:g.trim(t.email),password:g.trim(t.password),timezone:g.trim(t.timezone),load_sample:!1,owner_customer:!0,maintenance_customer:!0},!0).then(function(t){return e&&x.storeLoginToken(t.data),r(t)})})},x.storeLoginToken=function(t){new y.ApiUser({userId:t.userId,userEmail:t.email,userToken:t.token}).toStorage()},x.prototype.activateInvite=function(e){var t=this,i=this.onBeforeActivateInvite,r=this.onActivatedInvite;return i().then(function(){var i={name:t.getFullName(),email:g.trim(t.email),code:t.inviteToken,password:g.trim(t.password),timezone:g.trim(t.timezone)};return t.fields&&g.each(t.fields,function(t,e){i["fields__"+e.name]=e.value}),t.ds.longCall("activateInvite",i,!0).then(function(t){return e&&x.storeLoginToken(t.data),r(t)})})},x.prototype.activateSelfService=function(e){var t=this,i=this.onBeforeActivateSelfService,r=this.onActivatedSelfService;return i().then(function(){var i={name:t.getFullName(),password:g.trim(t.password),timezone:g.trim(t.timezone),email:g.trim(t.email),phone:g.trim(t.phone),key:t.selfserviceToken};return t.fields&&g.each(t.fields,function(t,e){i["fields__"+e.name]=e.value}),t.ds.longCall("createSelfServiceUser",i,!0).then(function(t){return e&&x.storeLoginToken(t.data),r(t)})})},x.prototype.storeLead=function(t){return this.ds.call("storeLead",{firstName:g.trim(this.firstName),lastName:g.trim(this.lastName),email:g.trim(this.email),company:g.trim(this.company),phone:this.phone,tags:t||[]})},x.splitFirstLastName=function(t){t=t.split(" ");return{firstName:g.trim(t.shift()),lastName:g.trim(t.join(" "))}},x.fromQueryString=function(t,e){var i,r=w.getUrlParam("name","").capitalize(),n=w.getUrlParam("email","").replace(" ","+"),o=w.getUrlParam("company",""),s=w.getUrlParam("firstName","").capitalize(),a=w.getUrlParam("lastName","").capitalize(),u=w.getUrlParam("source","attempt"),l=w.getUrlParam("period","yearly"),c=w.getUrlParam("plan",S),p=w.getUrlParam("timezone","America/New_York"),h=w.getUrlParam("code",""),d=w.getUrlParam("key",""),m=w.getUrlParam("phone","").replace(" ","+");return 0==s.length&&0==a.length&&0<r.length&&(s=(i=x.splitFirstLastName(r)).firstName,a=i.lastName),-1!=["starter","basic","professional","enterprise"].indexOf(c)&&(c=S),new x(g.extend({name:r,email:n,company:o,timezone:p,firstName:s,lastName:a,source:u,plan:c,period:l,phone:m,inviteToken:h,selfserviceToken:d},t),e)},x});