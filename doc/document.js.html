<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: document.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"CHEQROOM","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">CHEQROOM</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="Base">
            <span class="title">
                <a href="Base.html">Base</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Base#_doApiCall"><a href="Base.html#_doApiCall">_doApiCall</a></li>
            
                <li data-name="Base#_fromJson"><a href="Base.html#_fromJson">_fromJson</a></li>
            
                <li data-name="Base#_toJson"><a href="Base.html#_toJson">_toJson</a></li>
            
                <li data-name="Base#create"><a href="Base.html#create">create</a></li>
            
                <li data-name="Base#delete"><a href="Base.html#delete">delete</a></li>
            
                <li data-name="Base#discardChanges"><a href="Base.html#discardChanges">discardChanges</a></li>
            
                <li data-name="Base#existsInDb"><a href="Base.html#existsInDb">existsInDb</a></li>
            
                <li data-name="Base#get"><a href="Base.html#get">get</a></li>
            
                <li data-name="Base#isDirty"><a href="Base.html#isDirty">isDirty</a></li>
            
                <li data-name="Base#isEmpty"><a href="Base.html#isEmpty">isEmpty</a></li>
            
                <li data-name="Base#isValid"><a href="Base.html#isValid">isValid</a></li>
            
                <li data-name="Base#reload"><a href="Base.html#reload">reload</a></li>
            
                <li data-name="Base#reset"><a href="Base.html#reset">reset</a></li>
            
                <li data-name="Base#update"><a href="Base.html#update">update</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Contact">
            <span class="title">
                <a href="Contact.html">Contact</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Contact#_doApiCall"><a href="Contact.html#_doApiCall">_doApiCall</a></li>
            
                <li data-name="Contact#_fromJson"><a href="Contact.html#_fromJson">_fromJson</a></li>
            
                <li data-name="Contact#_toJson"><a href="Contact.html#_toJson">_toJson</a></li>
            
                <li data-name="Contact#create"><a href="Contact.html#create">create</a></li>
            
                <li data-name="Contact#delete"><a href="Contact.html#delete">delete</a></li>
            
                <li data-name="Contact#discardChanges"><a href="Contact.html#discardChanges">discardChanges</a></li>
            
                <li data-name="Contact#existsInDb"><a href="Contact.html#existsInDb">existsInDb</a></li>
            
                <li data-name="Contact#get"><a href="Contact.html#get">get</a></li>
            
                <li data-name="Contact#isDirty"><a href="Contact.html#isDirty">isDirty</a></li>
            
                <li data-name="Contact#isEmpty"><a href="Contact.html#isEmpty">isEmpty</a></li>
            
                <li data-name="Contact#isValid"><a href="Contact.html#isValid">isValid</a></li>
            
                <li data-name="Contact#isValidCompany"><a href="Contact.html#isValidCompany">isValidCompany</a></li>
            
                <li data-name="Contact#isValidEmail"><a href="Contact.html#isValidEmail">isValidEmail</a></li>
            
                <li data-name="Contact#isValidName"><a href="Contact.html#isValidName">isValidName</a></li>
            
                <li data-name="Contact#isValidPhone"><a href="Contact.html#isValidPhone">isValidPhone</a></li>
            
                <li data-name="Contact#reload"><a href="Contact.html#reload">reload</a></li>
            
                <li data-name="Contact#reset"><a href="Contact.html#reset">reset</a></li>
            
                <li data-name="Contact#update"><a href="Contact.html#update">update</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Document">
            <span class="title">
                <a href="Document.html">Document</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Document#_doApiCall"><a href="Document.html#_doApiCall">_doApiCall</a></li>
            
                <li data-name="Document#_fromJson"><a href="Document.html#_fromJson">_fromJson</a></li>
            
                <li data-name="Document#_toJson"><a href="Document.html#_toJson">_toJson</a></li>
            
                <li data-name="Document#create"><a href="Document.html#create">create</a></li>
            
                <li data-name="Document#delete"><a href="Document.html#delete">delete</a></li>
            
                <li data-name="Document#discardChanges"><a href="Document.html#discardChanges">discardChanges</a></li>
            
                <li data-name="Document#existsInDb"><a href="Document.html#existsInDb">existsInDb</a></li>
            
                <li data-name="Document#get"><a href="Document.html#get">get</a></li>
            
                <li data-name="Document#isDirty"><a href="Document.html#isDirty">isDirty</a></li>
            
                <li data-name="Document#isEmpty"><a href="Document.html#isEmpty">isEmpty</a></li>
            
                <li data-name="Document#isValid"><a href="Document.html#isValid">isValid</a></li>
            
                <li data-name="Document#reload"><a href="Document.html#reload">reload</a></li>
            
                <li data-name="Document#reset"><a href="Document.html#reset">reset</a></li>
            
                <li data-name="Document#update"><a href="Document.html#update">update</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="KeyValue">
            <span class="title">
                <a href="KeyValue.html">KeyValue</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="KeyValue#_fromJson"><a href="KeyValue.html#_fromJson">_fromJson</a></li>
            
                <li data-name="KeyValue#_toJson"><a href="KeyValue.html#_toJson">_toJson</a></li>
            
                <li data-name="KeyValue#existsInDb"><a href="KeyValue.html#existsInDb">existsInDb</a></li>
            
                <li data-name="KeyValue#getName"><a href="KeyValue.html#getName">getName</a></li>
            
                <li data-name="KeyValue#getUnit"><a href="KeyValue.html#getUnit">getUnit</a></li>
            
                <li data-name="KeyValue#isDirty"><a href="KeyValue.html#isDirty">isDirty</a></li>
            
                <li data-name="KeyValue#isEmpty"><a href="KeyValue.html#isEmpty">isEmpty</a></li>
            
                <li data-name="KeyValue#isValid"><a href="KeyValue.html#isValid">isValid</a></li>
            
                <li data-name="KeyValue#reset"><a href="KeyValue.html#reset">reset</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="document.js.html">Source: document.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>/**
 * The Document module
 * a base class for all documents from the CHECKROOM API
 * @module document
 * @copyright CHECKROOM NV 2015
 */
define([
    'jquery',
    'common',
    'api'], /** @lends Document */function ($, common, api) {

    // Some constant values
    var DEFAULTS = {
        id: ""
    };

    /**
     * @name Document
     * @class
     * @constructor
     */
    var Document = function(spec) {
        this.ds = spec.ds;                                              // ApiDataSource object
        this.fields = spec.fields;                                      // e.g. [*]

        this.raw = null;                                                // raw json object
        this.id = spec.id || DEFAULTS.id;                               // doc _id
    };

    /**
     * Resets the object
     * @name  Document#reset
     * @method
     * @returns {promise}
     */
    Document.prototype.reset = function() {
        // By default, reset just reads from the DEFAULTS dict again
        return this._fromJson(this._getDefaults(), null);
    };

    /**
     * Checks if the document exists in the database
     * @name  Document#existsInDb
     * @method
     * @returns {boolean}
     */
    Document.prototype.existsInDb = function() {
        // Check if we have a primary key
        return (this.id!=null) && (this.id.length>0);
    };

    /**
     * Checks if the object is empty
     * @name  Document#isEmpty
     * @method
     * @returns {boolean}
     */
    Document.prototype.isEmpty = function() {
        return true;
    };

    /**
     * Checks if the object needs to be saved
     * We don't check any of the keyvalues (or comments, attachments) here
     * @name  Document#isDirty
     * @method
     * @returns {boolean}
     */
    Document.prototype.isDirty = function() {
        return false;
    };

    /**
     * Checks if the object is valid
     * @name  Document#isValid
     * @method
     * @returns {boolean}
     */
    Document.prototype.isValid = function() {
        return true;
    };

    /**
     * Discards any changes made to the object from the previously loaded raw response
     * or resets it when no old raw response was found
     * @name  Document#discardChanges
     * @method
     * @returns {promise}
     */
    Document.prototype.discardChanges = function() {
        return (this.raw) ? this._fromJson(this.raw, null) : this.reset();
    };

    /**
     * Reloads the object from db
     * @name  Document#reload
     * @method
     * @param fields
     * @returns {promise}
     */
    Document.prototype.reload = function(fields) {
        if (this.existsInDb()) {
            return this.get(fields);
        } else {
            return $.Deferred().reject(new api.ApiError('Cannot reload document, id is empty or null'));
        }
    };

    /**
     * Gets an object by the default api.get
     * @name  Document#get
     * @method
     * @param fields
     * @returns {promise}
     */
    Document.prototype.get = function(fields) {
        if (this.existsInDb()) {
            var that = this;
            return this.ds.get(this.id, fields || this.fields)
                .then(function(data) {
                    return that._fromJson(data);
                });
        } else {
            return $.Deferred().reject(new api.ApiError('Cannot get document, id is empty or null'));
        }
    };

    /**
     * Creates an object by the default api.create
     * @name  Document#create
     * @method
     * @param skipRead skips reading the response via _fromJson (false)
     * @returns {promise}
     */
    Document.prototype.create = function(skipRead) {
        if (this.existsInDb()) {
            return $.Deferred().reject(new Error("Cannot create document, already exists in database"));
        }
        if (this.isEmpty()) {
            return $.Deferred().reject(new Error("Cannot create empty document"));
        }
        if (!this.isValid()) {
            return $.Deferred().reject(new Error("Cannot create, invalid document"));
        }

        var that = this;
        var data = this._toJson();
        delete data.id;
        return this.ds.create(data, this.fields)
            .then(function(data) {
                return (skipRead==true) ? data : that._fromJson(data);
            });
    };

    /**
     * Updates an object by the default api.update
     * @name  Document#update
     * @method
     * @param skipRead skips reading the response via _fromJson (false)
     * @returns {promise}
     */
    Document.prototype.update = function(skipRead) {
        if (!this.existsInDb()) {
            return $.Deferred().reject(new Error("Cannot update document without id"));
        }
        if (this.isEmpty()) {
            return $.Deferred().reject(new Error("Cannot update to empty document"));
        }
        if (!this.isValid()) {
            return $.Deferred().reject(new Error("Cannot update, invalid document"));
        }

        var that = this;
        var data = this._toJson();
        delete data.id;
        return this.ds.update(this.id, data, this.fields)
            .then(function(data) {
                return (skipRead==true) ? data : that._fromJson(data);
            });
    };

    /**
     * Deletes an object by the default api.delete
     * @name  Document#delete
     * @method
     * @returns {promise}
     */
    Document.prototype.delete = function() {
        // Call the api /delete on this document
        if (this.existsInDb()) {
            var that = this;
            return this.ds.delete(this.id)
                .then(function() {
                    return that.reset();
                });
        } else {
            return $.Deferred().reject(new Error("Contact does not exist"));
        }
    };


    // toJson, fromJson
    // ----
    Document.prototype._getDefaults = function() {
        return DEFAULTS;
    };

    /**
     * _toJson, makes a dict of this object
     * Possibly inheriting classes will override this method,
     * because not all fields can be set during create / update
     * @name  Document#_toJson
     * @method
     * @param options
     * @returns {{}}
     * @private
     */
    Document.prototype._toJson = function(options) {
        return {
            id: this.id
        };
    };

    /**
     * _fromJson: in this implementation we'll only read
     * the data.keyValues into: comments, attachments, keyValues
     * @name  Document#_fromJson
     * @method
     * @param {object} data the json response
     * @param {object} options dict
     * @private
     */
    Document.prototype._fromJson = function(data, options) {
        this.raw = data;
        this.id = data._id || DEFAULTS.id;
        return $.Deferred().resolve(data);
    };

    // Implementation stuff
    // ---

    /**
     * Wrapping the this.ds.call method
     * {pk: '', method: '', params: {}, fields: '', timeOut: null, usePost: null, skipRead: null}
     * @name  Document#_doApiCall
     * @method
     * @param spec
     * @returns {promise}
     * @private
     */
    Document.prototype._doApiCall = function(spec) {
        var that = this;
        return this.ds.call(
                (spec.collectionCall==true) ? null : (spec.pk || this.id),
                spec.method,
                spec.params,
                spec.fields || this.fields,
                spec.timeOut,
                spec.usePost)
            .then(function(data) {
                return (spec.skipRead==true) ? data : that._fromJson(data);
            });
    };

    return Document;

});
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Thu Apr 02 2015 12:20:59 GMT+0200 (CEST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
