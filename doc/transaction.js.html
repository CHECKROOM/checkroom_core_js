<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: transaction.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"CHEQROOM","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">CHEQROOM</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="Base">
            <span class="title">
                <a href="Base.html">Base</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Base#_doApiCall"><a href="Base.html#_doApiCall">_doApiCall</a></li>
            
                <li data-name="Base#_fromJson"><a href="Base.html#_fromJson">_fromJson</a></li>
            
                <li data-name="Base#_toJson"><a href="Base.html#_toJson">_toJson</a></li>
            
                <li data-name="Base#create"><a href="Base.html#create">create</a></li>
            
                <li data-name="Base#delete"><a href="Base.html#delete">delete</a></li>
            
                <li data-name="Base#discardChanges"><a href="Base.html#discardChanges">discardChanges</a></li>
            
                <li data-name="Base#existsInDb"><a href="Base.html#existsInDb">existsInDb</a></li>
            
                <li data-name="Base#get"><a href="Base.html#get">get</a></li>
            
                <li data-name="Base#isDirty"><a href="Base.html#isDirty">isDirty</a></li>
            
                <li data-name="Base#isEmpty"><a href="Base.html#isEmpty">isEmpty</a></li>
            
                <li data-name="Base#isValid"><a href="Base.html#isValid">isValid</a></li>
            
                <li data-name="Base#reload"><a href="Base.html#reload">reload</a></li>
            
                <li data-name="Base#reset"><a href="Base.html#reset">reset</a></li>
            
                <li data-name="Base#update"><a href="Base.html#update">update</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Contact">
            <span class="title">
                <a href="Contact.html">Contact</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Contact#_doApiCall"><a href="Contact.html#_doApiCall">_doApiCall</a></li>
            
                <li data-name="Contact#_fromJson"><a href="Contact.html#_fromJson">_fromJson</a></li>
            
                <li data-name="Contact#_toJson"><a href="Contact.html#_toJson">_toJson</a></li>
            
                <li data-name="Contact#create"><a href="Contact.html#create">create</a></li>
            
                <li data-name="Contact#delete"><a href="Contact.html#delete">delete</a></li>
            
                <li data-name="Contact#discardChanges"><a href="Contact.html#discardChanges">discardChanges</a></li>
            
                <li data-name="Contact#existsInDb"><a href="Contact.html#existsInDb">existsInDb</a></li>
            
                <li data-name="Contact#get"><a href="Contact.html#get">get</a></li>
            
                <li data-name="Contact#isDirty"><a href="Contact.html#isDirty">isDirty</a></li>
            
                <li data-name="Contact#isEmpty"><a href="Contact.html#isEmpty">isEmpty</a></li>
            
                <li data-name="Contact#isValid"><a href="Contact.html#isValid">isValid</a></li>
            
                <li data-name="Contact#isValidCompany"><a href="Contact.html#isValidCompany">isValidCompany</a></li>
            
                <li data-name="Contact#isValidEmail"><a href="Contact.html#isValidEmail">isValidEmail</a></li>
            
                <li data-name="Contact#isValidName"><a href="Contact.html#isValidName">isValidName</a></li>
            
                <li data-name="Contact#isValidPhone"><a href="Contact.html#isValidPhone">isValidPhone</a></li>
            
                <li data-name="Contact#reload"><a href="Contact.html#reload">reload</a></li>
            
                <li data-name="Contact#reset"><a href="Contact.html#reset">reset</a></li>
            
                <li data-name="Contact#update"><a href="Contact.html#update">update</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Document">
            <span class="title">
                <a href="Document.html">Document</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Document#_doApiCall"><a href="Document.html#_doApiCall">_doApiCall</a></li>
            
                <li data-name="Document#_fromJson"><a href="Document.html#_fromJson">_fromJson</a></li>
            
                <li data-name="Document#_toJson"><a href="Document.html#_toJson">_toJson</a></li>
            
                <li data-name="Document#create"><a href="Document.html#create">create</a></li>
            
                <li data-name="Document#delete"><a href="Document.html#delete">delete</a></li>
            
                <li data-name="Document#discardChanges"><a href="Document.html#discardChanges">discardChanges</a></li>
            
                <li data-name="Document#existsInDb"><a href="Document.html#existsInDb">existsInDb</a></li>
            
                <li data-name="Document#get"><a href="Document.html#get">get</a></li>
            
                <li data-name="Document#isDirty"><a href="Document.html#isDirty">isDirty</a></li>
            
                <li data-name="Document#isEmpty"><a href="Document.html#isEmpty">isEmpty</a></li>
            
                <li data-name="Document#isValid"><a href="Document.html#isValid">isValid</a></li>
            
                <li data-name="Document#reload"><a href="Document.html#reload">reload</a></li>
            
                <li data-name="Document#reset"><a href="Document.html#reset">reset</a></li>
            
                <li data-name="Document#update"><a href="Document.html#update">update</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="KeyValue">
            <span class="title">
                <a href="KeyValue.html">KeyValue</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="KeyValue#_fromJson"><a href="KeyValue.html#_fromJson">_fromJson</a></li>
            
                <li data-name="KeyValue#_toJson"><a href="KeyValue.html#_toJson">_toJson</a></li>
            
                <li data-name="KeyValue#existsInDb"><a href="KeyValue.html#existsInDb">existsInDb</a></li>
            
                <li data-name="KeyValue#getName"><a href="KeyValue.html#getName">getName</a></li>
            
                <li data-name="KeyValue#getUnit"><a href="KeyValue.html#getUnit">getUnit</a></li>
            
                <li data-name="KeyValue#isDirty"><a href="KeyValue.html#isDirty">isDirty</a></li>
            
                <li data-name="KeyValue#isEmpty"><a href="KeyValue.html#isEmpty">isEmpty</a></li>
            
                <li data-name="KeyValue#isValid"><a href="KeyValue.html#isValid">isValid</a></li>
            
                <li data-name="KeyValue#reset"><a href="KeyValue.html#reset">reset</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="transaction.js.html">Source: transaction.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>/**
 * The Transaction module
 * a base class for Reservations and Orders
 * Share similar manipulating of: status, dates, items, contacts, locations, comments, attachments
 * @module transaction
 * @implements Base
 * @copyright CHECKROOM NV 2015
 */
define([
    'jquery',
    'api',
    'base'], function ($, api, Base) {

    var DEFAULTS = {
        status: "creating",
        from: null,
        to: null,
        due: null,
        contact: "",
        location: "",
        items: []
    };

    // Allow overriding the ctor during inheritance
    // http://stackoverflow.com/questions/4152931/javascript-inheritance-call-super-constructor-or-use-prototype-chain
    var tmp = function(){};
    tmp.prototype = Base.prototype;

    /**
     * @class Transaction
     * @constructor
     * @extends Base
     */
    var Transaction = function(opt) {
        var spec = $.extend({}, opt);
        Base.call(this, spec);

        this.dsItems = spec.dsItems;                        // we'll also access the /items collection

        // should we automatically delete the transaction from the database?
        this.autoCleanup = (spec.autoCleanup!=null) ? spec.autoCleanup : false;
        this.helper = spec.helper;

        this.status = spec.status || DEFAULTS.status;        // the status of the order or reservation
        this.from = spec.from || DEFAULTS.from;              // a date in the future
        this.to = spec.to || DEFAULTS.to;                    // a date in the future
        this.due = spec.due || DEFAULTS.due;                 // a date even further in the future, we suggest some standard avg durations
        this.contact = spec.contact || DEFAULTS.contact;     // a contact id
        this.location = spec.location || DEFAULTS.location;  // a location id
        this.items = spec.items || DEFAULTS.items.slice();   // an array of item ids
    };

    Transaction.prototype = new tmp();
    Transaction.prototype.constructor = Location;

    //
    // Date helpers (possibly overwritten)
    //

    /**
     * Gets the lowest possible date to start this transaction
     * @returns {Moment} min date
     */
    Transaction.prototype.getMinDate = function() {
        var helper = this._getHelper();
        var now = helper.getNow();
        return now;
    };

    /**
     * Gets the latest possible date to end this transaction
     * @returns {Moment} max date
     */
    Transaction.prototype.getMaxDate = function() {
        var helper = this._getHelper();
        var now = helper.getNow();
        var next = helper.roundTimeTo(now);
        return next.add(365, "day"); // TODO: Is this a sensible date?
    };

    /**
     * suggestEndDate, makes a new moment() object with a suggested end date,
     * already rounded up according to the group.profile settings
     * @param {Moment} m a suggested end date for this transaction
     * @returns {*}
     */
    Transaction.prototype.suggestEndDate = function(m) {
        var helper = this._getHelper();
        var end = helper.addAverageDuration(m || helper.getNow());
        return helper.roundTimeTo(end);
    };

    //
    // Base overrides
    //
    /**
     * Checks if the transaction is empty
     * @returns {*|boolean|boolean|boolean|boolean|boolean|boolean|boolean}
     */
    Transaction.prototype.isEmpty = function() {
        return (
            (Base.prototype.isEmpty.call(this)) &&
            (this.status==DEFAULTS.status) &&
            (this.from==DEFAULTS.from) &&
            (this.to==DEFAULTS.to) &&
            (this.due==DEFAULTS.due) &&
            (this.contact==DEFAULTS.contact) &&
            (this.location==DEFAULTS.location) &&
            (this.items.length==0)  // not DEFAULTS.items? :)
        );
    };

    /**
     * Checks if the transaction is dirty and needs saving
     * @returns {*|boolean|boolean|boolean|boolean|boolean|boolean|boolean}
     */
    Transaction.prototype.isDirty = function() {
        return (
            Base.prototype.isDirty.call(this) || 
            this._isDirtyBasic() ||
            this._isDirtyDates() ||
            this._isDirtyLocation() ||
            this._isDirtyContact() ||
            this._isDirtyItems()
        );
    };

    Transaction.prototype._isDirtyBasic = function() {
        if (this.raw) {
            var status = this.raw.status || DEFAULTS.status;
            return (this.status!=status);
        } else {
            return false;
        }
    };

    Transaction.prototype._isDirtyDates = function() {
        if (this.raw) {
            var from = this.raw.from || DEFAULTS.from;
            var to = this.raw.to || DEFAULTS.to;
            var due = this.raw.due || DEFAULTS.due;
            return (
                (this.from!=from) ||
                (this.to!=to) || 
                (this.due!=due));
        } else {
            return false;
        }
    };

    Transaction.prototype._isDirtyLocation = function() {
        if (this.raw) {
            var location = DEFAULTS.location;
            if (this.raw.location) {
                location = (this.raw.location._id) ? this.raw.location._id : this.raw.location;
            }
            return (this.location!=location);
        } else {
            return false;
        }
    };

    Transaction.prototype._isDirtyContact = function() {
        if (this.raw) {
            var contact = DEFAULTS.contact;
            if (this.raw.customer) {
                contact = (this.raw.customer._id) ? this.raw.customer._id : this.raw.customer;
            }
            return (this.contact!=contact);
        } else {
            return false;
        }
    };

    Transaction.prototype._isDirtyItems = function() {
        if (this.raw) {
            var items = DEFAULTS.items.slice();
            if (this.raw.items) {
                // TODO!!
            }
            return false;
        } else {
            return false;
        }
    };

    Transaction.prototype._getDefaults = function() {
        return DEFAULTS;
    };

    /**
     * Writes out some shared fields for all transactions
     * Inheriting classes will probably add more to this
     * @param options
     * @returns {object}
     * @private
     */
    Transaction.prototype._toJson = function(options) {
        var data = Base.prototype._toJson.call(this, options);
        //data.started = this.from;  // VT: Will be set during checkout
        //data.finished = this.to;  // VT: Will be set during final checkin
        data.due = this.due;
        if (this.location) {
            data.location = this.location;
        }
        if (this.contact) {
            data.customer = this.contact;  // Vincent: It's still called the "customer" field!
        }
        return data;
    };

    /**
     * Reads the transaction from a json object
     * @param data
     * @param options
     * @returns {promise}
     * @private
     */
    Transaction.prototype._fromJson = function(data, options) {
        var that = this;
        return Base.prototype._fromJson.call(this, data, options)
            .then(function() {
                that.status = data.status || DEFAULTS.status;
                that.location = data.location || DEFAULTS.location;
                that.contact = data.customer || DEFAULTS.contact;
                that.items = data.items || DEFAULTS.items.slice();
            });
    };

    Transaction.prototype._toLog = function(options) {
        var obj = this._toJson(options);
        obj.minDate = this.getMinDate().toJSONDate();
        obj.maxDate = this.getMaxDate().toJSONDate();
        console.log(obj);
    };

    // Setters
    // ----
    /*
    TransactionModel.prototype.setFromDate = function(date) {
        var roundDate = helper.roundFromTime(date, this.global.groupProfile);
        system.log('TransactionModel: setFromDate '+date.calendar() + ' -- rounded to ' + roundDate.calendar());
        this.from(roundDate);
        return this._handleTransaction();
    };
    */

    // From date setters

    /**
     * Clear the transaction from date
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.clearFromDate = function(skipRead) {
        this.from = DEFAULTS.from;
        return this._handleTransaction(skipRead);
    };

    /**
     * Sets the transaction from date
     * @param date
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.setFromDate = function(date, skipRead) {
        this.from = this.helper.roundTimeFrom(date);
        return this._handleTransaction(skipRead);
    };

    // To date setters

    /**
     * Clear the transaction to date
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.clearToDate = function(skipRead) {
        this.to = DEFAULTS.to;
        return this._handleTransaction(skipRead);
    };

    /**
     * Sets the transaction to date
     * @param date
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.setToDate = function(date, skipRead) {
        this.to = this.helper.roundTimeTo(date);
        return this._handleTransaction(skipRead);
    };

    // Due date setters

    /**
     * Clear the transaction due date
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.clearDueDate = function(skipRead) {
        this.due = DEFAULTS.due;
        return this._handleTransaction(skipRead);
    };

    /**
     * Set the transaction due date
     * @param date
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.setDueDate = function(date, skipRead) {
        this.due = this.helper.roundTimeTo(date);
        return this._handleTransaction(skipRead);
    };

    // Location setters
    /**
     * Sets the location for this transaction
     * @param locationId
     * @param skipRead skip parsing the returned json response into the transaction
     * @returns {promise}
     */
    Transaction.prototype.setLocation = function(locationId, skipRead) {
        this.location = locationId;
        if (this.existsInDb()) {
            return this._doApiCall({method: 'setLocation', params: {location: locationId}, skipRead: skipRead});
        } else {
            return this._createTransaction(skipRead);
        }
    };

    /**
     * Clears the location for this transaction
     * @param skipRead skip parsing the returned json response into the transaction
     * @returns {promise}
     */
    Transaction.prototype.clearLocation = function(skipRead) {
        var that = this;
        this.location = DEFAULTS.location;
        return this._doApiCall({method: 'clearLocation', skipRead: skipRead})
            .then(function() {
                return that._ensureTransactionDeleted();
            });
    };

    // Contact setters

    /**
     * Sets the contact for this transaction
     * @param contactId
     * @param skipRead skip parsing the returned json response into the transaction
     * @returns {promise}
     */
    Transaction.prototype.setContact = function(contactId, skipRead) {
        this.contact = contactId;
        if (this.existsInDb()) {
            return this._doApiCall({method: 'setCustomer', params: {customer: contactId}, skipRead: skipRead});
        } else {
            return this._createTransaction(skipRead);
        }
    };

    /**
     * Clears the contact for this transaction
     * @param skipRead skip parsing the returned json response into the transaction
     * @returns {promise}
     */
    Transaction.prototype.clearContact = function(skipRead) {
        var that = this;
        this.contact = DEFAULTS.contact;
        return this._doApiCall({method: 'clearCustomer', skipRead: skipRead})
            .then(function() {
                return that._ensureTransactionDeleted();
            });
    };

    // Business logic
    // ----

    // Inheriting classes will use the setter functions below to update the object in memory
    // the _handleTransaction will create, update or delete the actual document via the API

    /**
     * addItems; adds a bunch of Items to the transaction using a list of item ids
     * It creates the transaction if it doesn't exist yet
     * @method addItems
     * @param items
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.addItems = function(items, skipRead) {
        var that = this;
        return this._ensureTransactionExists(skipRead)
            .then(function() {
                return that._doApiCall({
                    method: 'addItems',
                    params: {items: items},
                    skipRead: skipRead
                });
            });
    };

    /**
     * removeItems; removes a bunch of Items from the transaction using a list of item ids
     * It deletes the transaction if it's empty afterwards and autoCleanup is true
     * @method removeItems
     * @param items
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.removeItems = function(items, skipRead) {
        if (!this.existsInDb()) {
            return $.Deferred().reject(new Error("Cannot removeItems from document without id"));
        }

        var that = this;
        return this._doApiCall({
            method: 'removeItems',
            params: {items: items},
            skipRead: skipRead
        })
            .then(function() {
                return that._ensureTransactionDeleted();
            });
    };

    /**
     * clearItems; removes all Items from the transaction
     * It deletes the transaction if it's empty afterwards and autoCleanup is true
     * @method clearItems
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.clearItems = function(skipRead) {
        if (!this.existsInDb()) {
            return $.Deferred().reject(new Error("Cannot clearItems from document without id"));
        }

        var that = this;
        return this._doApiCall({
            method: 'clearItems',
            skipRead: skipRead
        })
            .then(function() {
                return that._ensureTransactionDeleted();
            });
    };

    /**
     * swapItem; swaps one item for another in a transaction
     * @method swapItem
     * @param fromItem
     * @param toItem
     * @param skipRead
     * @returns {promise}
     */
    Transaction.prototype.swapItem = function(fromItem, toItem, skipRead) {
        if (!this.existsInDb()) {
            return $.Deferred().reject(new Error("Cannot clearItems from document without id"));
        }

        // swapItem cannot create or delete a transaction
        return this._doApiCall({
            method: 'swapItem',
            params: {fromItem: fromItem, toItem: toItem},
            skipRead: skipRead
        });
    };

    //
    // Implementation stuff
    //
    Transaction.prototype._getHelper = function() {
        return this.helper;
    };

    Transaction.prototype._getDateHelper = function() {
        return this._getHelper().dateHelper;
    };

    /**
     * Searches for Items that are available for this transaction
     * @param params: a dict with params, just like items/search
     * @param listName: restrict search to a certain list
     * @param useAvailabilies (uses items/searchAvailable instead of items/search)
     * @param onlyUnbooked (true by default, only used when useAvailabilies=true)
     * @param skipItems array of item ids that should be skipped
     * @returns {*}
     */
    Transaction.prototype._searchItems = function(params, listName, useAvailabilies, onlyUnbooked, skipItems) {
        if (this.dsItems==null) {
            return $.Deferred().reject(new api.ApiBadRequest(this.crtype+" has no DataSource for items"));
        }

        // Restrict the search to just the Items that are:
        // - at this location
        // - in the specified list (if any)
        params = params || {};
        params.location = this.location;

        if( (listName!=null) &&
            (listName.length>0)) {
            params.listName = listName
        }

        if (useAvailabilies==true) {
            // We'll use a more advanced API call /items/searchAvailable
            // It's a bit slower and the .count result is not usable

            // It requires some more parameters to be set
            params.onlyUnbooked = (onlyUnbooked!=null) ? onlyUnbooked : true;
            params.fromDate = this.from;
            params.toDate = this.to;
            params._limit = 20;  // TODO
            params._skip = 0;  // TODO
            if( (skipItems) &&
                (skipItems.length)) {
                params.skipItems = skipItems;
            }

            return this.dsItems.call(null, 'searchAvailable', params);
        } else {
            // We don't need to use availabilities,
            // we should better use the regular /search
            // it's faster and has better paging :)
            if( (skipItems) &&
                (skipItems.length)) {
                params.pk__nin = skipItems;
            }
            return this.dsItems.search(params);
        }
    };

    /**
     * Returns a rejected promise when a date is not between min and max date
     * Otherwise the deferred just resolves to the date
     * It's used to do some quick checks of transaction dates
     * @param date
     * @returns {*}
     * @private
     */
    Transaction.prototype._checkDateBetweenMinMax = function(date) {
        var minDate = this.getMinDate();
        var maxDate = this.getMaxDate();
        if( (date&lt;minDate) || 
            (date>maxDate)) {
            var msg = "date is outside of min max range " + minDate.toJSONDate() +"->" + maxDate.toJSONDate();
            return $.Deferred().reject(new api.ApiUnprocessableEntity(msg));
        } else {
            return $.Deferred().resolve(date);
        }
    };

    /**
     * _handleTransaction: creates, updates or deletes a transaction document
     * @returns {*}
     * @private
     */
    Transaction.prototype._handleTransaction = function(skipRead) {
        var isEmpty = this.isEmpty();
        if (this.existsInDb()) {
            if (isEmpty) {
                if (this.autoCleanup) {
                    return this._deleteTransaction();
                } else {
                    return $.Deferred().resolve();
                }
            } else {
                return this._updateTransaction(skipRead);
            }
        } else if (!isEmpty) {
            return this._createTransaction(skipRead);
        } else {
            return $.Deferred().resolve();
        }
    };

    Transaction.prototype._deleteTransaction = function() {
        return this.delete();
    };

    Transaction.prototype._updateTransaction = function(skipRead) {
        return this.update(skipRead);
    };

    Transaction.prototype._createTransaction = function(skipRead) {
        return this.create(skipRead);
    };

    Transaction.prototype._ensureTransactionExists = function(skipRead) {
        return (!this.existsInDb()) ? this._createTransaction(skipRead) : $.Deferred().resolve();
    };

    Transaction.prototype._ensureTransactionDeleted = function() {
        return ((this.isEmpty()) && (this.autoCleanup)) ? this._deleteTransaction() : $.Deferred().resolve();
    };

    return Transaction;
});
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Thu Apr 02 2015 12:20:59 GMT+0200 (CEST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
